<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #790: XMP embedding corrupts CorelDRAW EPS files - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="PaDREgtSCdaScXxYJngkbJUSuSTeELVWAhAQtZDSZszf7Xr9eSjF1scVY1SZryhfqoDtXS/zFOz/MIA90+uBow==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #790: XMP embedding corrupts CorelDRAW EPS files" href="https://dev.exiv2.org/issues/790.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #790</h2>

<div class="issue tracker-1 status-5 priority-6 priority-high2 closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>XMP embedding corrupts CorelDRAW EPS files</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/206">Volker Grabsch</a> <a title="30 Sep 2011 07:13" href="/projects/exiv2/activity?from=2011-09-30">about 10 years</a> ago.
        Updated <a title="03 May 2012 17:14" href="/projects/exiv2/activity?from=2012-05-03">over 9 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Urgent</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/206">Volker Grabsch</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">image format</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="23 Apr 2012" href="/versions/49">0.23</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">30 Sep 2011</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>When XMP is embedded into an EPS file generated by CorelDRAW, the resulting EPS file is corrupt and won't open. As of Exiv2 0.22, the only workaround is removing the XMP via "exiv2 -dx".</p>


	<p>This issue exists with all CorelDRAW versions from 11 to X5, and possibly also with older versions of CorelDRAW. The resulting file can't be opened with any application, because the problem happens at the level of PostScript code.</p>


	<p>Note that this issue is very different from the issue with Illustrator-8 EPS files, where only one application (Illustrator) wasn't able to open the modified EPS file, but all other applications worked perfectly fine with it.</p>


	<p>The problem is caused by CorelDRAW's somewhat strange interpretation of the DSC specification. Usually, the PostScript code after %%EndPageSetup leaves the stack in the same state as it started. However, in CorelDRAW's code the first effective PostScript command is "restore" (called by "@rs" called by "@rax"). This works only well if the last command of PageSetup was "@sv" (which calls "save"). However, this is exactly where our XMP embedding code is inserted, in conformance with the XMP specification. So the "restore" undoes some definition of our XMP embedding which leads to an "undefined" error later in the second part of the XMP embedding code (at %%PageTrailer).</p>


	<p>In simpler words, the CorelDRAW EPS code expects the last command of %%PageSetup to be "@sv", otherwise it won't work properly.</p>


	<p>I think we can improve our embedding code to add some workaround for the special case of CorelDRAW EPS files.</p>
  </div>
</div>







</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 2619" href="/projects/exiv2/repository/exiv2/revisions/2619">Revision 2619</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/2619/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/206">Volker Grabsch</a> <a title="04 Oct 2011 06:14" href="/projects/exiv2/activity?from=2011-10-04">about 10 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-6 priority-high2 closed" title="Bug: XMP embedding corrupts CorelDRAW EPS files (Closed)" href="/issues/790">#790</a>: Added workaround for EPS files generated by CorelDRAW</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-2009" class="journal has-notes has-details">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/206">Volker Grabsch</a> <a title="04 Oct 2011 06:16" href="/projects/exiv2/activity?from=2011-10-04">about 10 years</a> ago
      <span id="journal-2009-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>New</i> to <i>Resolved</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
    </ul>
    <div id="journal-2009-notes" class="wiki"><p>I fixed this issue and added some test EPS files generated by CorelDRAW. (<a class="changeset" title="#790: Added workaround for EPS files generated by CorelDRAW" href="/projects/exiv2/repository/exiv2/revisions/2619">r2619</a>)</p></div>
    </div>
  </div>
  
  <div id="change-2118" class="journal has-details">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="03 May 2012 17:14" href="/projects/exiv2/activity?from=2012-05-03">over 9 years</a> ago
      <span id="journal-2118-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
    </ul>
    
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/790.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/790.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
