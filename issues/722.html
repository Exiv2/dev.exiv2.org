<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #722: Unit tests do not build with CMake and out of source build - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="3WafvBD1Jmk0sbpUETJa14ne8b/qVa5v77RIEJyPB3s/KzRTYo/qaWHVpViu5Vbktkylxhu2D9USlNiY37bgFA==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #722: Unit tests do not build with CMake and out of source build" href="https://dev.exiv2.org/issues/722.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #722</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Unit tests do not build with CMake and out of source build</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/121">Johannes Wienke</a> <a title="28 Aug 2010 02:37" href="/projects/exiv2/activity?from=2010-08-28">about 11 years</a> ago.
        Updated <a title="24 Jul 2013 15:30" href="/projects/exiv2/activity?from=2013-07-24">over 8 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/119">Robin Mills</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">build</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="31 Jul 2013" href="/versions/50">0.24</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">28 Aug 2010</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <pre>
[ 66%] Building CXX object samples/CMakeFiles/addmoddel.dir/addmoddel.cpp.o
cd /home/languitar/workspace/build/exiv2/samples &#38;&#38; /usr/bin/c++   -DEXV_HAVE_DLL -DEXV_LOCALEDIR=/home/languitar/vol/digikam/share/locale -DEXV_HAVE_STDINT_H -g -I/home/languitar/workspace/build/exiv2 -I/home/languitar/workspace/exiv2/xmpsdk/include   -Wall -Wcast-align -Wpointer-arith -Wformat-security -Wmissing-format-attribute -Woverloaded-virtual -W -o CMakeFiles/addmoddel.dir/addmoddel.cpp.o -c /home/languitar/workspace/exiv2/samples/addmoddel.cpp
/home/languitar/workspace/exiv2/samples/addmoddel.cpp:5:27: fatal error: exiv2/exiv2.hpp: No such file or directory
compilation terminated.
</pre>

	<p>The unit tests should make use of the headers from the source folder instead of an installed version (which is currently not installed on my computer, hence it fails). Or is there any good reason why this is not the case? Other wise I could easily generate a patch for this.</p>
  </div>
</div>






<hr />
<div id="relations">
<div class="contextual">
</div>

<p><strong>Related issues</strong></p>

<form data-cm-url="/issues/context_menu" action="/issues/722" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="yO3qfruGXKXOCJ53Iu98l3MzUsE9vJJhnhBz5cZD3wgqoEGRyfyQpZtsgXudOHCkTKEGuMxfM9tjMONthXo4Zw==" />
  <table class="list issues odd-even"><tr id="relation-90" class="issue hascontextmenu issue tracker-2 status-5 priority-4 priority-default closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="536" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-2 status-5 priority-4 priority-default closed" href="/issues/536">Feature #536</a>: Switch to a unified build system based on cmake</td><td class="status">Closed</td><td class="start_date"></td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr></table>
</form>
<form class="new_relation" id="new-relation-form" style="display: none;" action="/issues/722/relations" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />


<p><select onchange="setPredecessorFieldsVisibility();" name="relation[relation_type]" id="relation_relation_type"><option selected="selected" value="relates">Related to</option>
<option value="duplicates">Is duplicate of</option>
<option value="duplicated">Has duplicate</option>
<option value="blocks">Blocks</option>
<option value="blocked">Blocked by</option>
<option value="precedes">Precedes</option>
<option value="follows">Follows</option>
<option value="copied_to">Copied to</option>
<option value="copied_from">Copied from</option></select>
Issue #<input size="10" type="text" name="relation[issue_to_id]" id="relation_issue_to_id" />
<span id="predecessor_fields" style="display:none;">
Delay: <input size="3" type="text" name="relation[delay]" id="relation_delay" /> days
</span>
<input type="submit" name="commit" value="Add" data-disable-with="Add" />
<a href="#" onclick="$(&quot;#new-relation-form&quot;).hide();; return false;">Cancel</a>
</p>

<script>
//<![CDATA[
observeAutocompleteField('relation_issue_to_id', '/issues/auto_complete?issue_id=722&project_id=exiv2&scope=all')
//]]>
</script>

<script>
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>
</div>

</div>




<div id="history">
<h3>History</h3>
  <div id="change-1717" class="journal has-notes">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="28 Aug 2010 03:18" href="/projects/exiv2/activity?from=2010-08-28">about 11 years</a> ago
      <span id="journal-1717-private_notes" class=""></span>
    </h4>

    <div id="journal-1717-notes" class="wiki"><p>It's important that the samples are built against the installed exiv2. That's part of the test. That way it tests pkgconfig and some other obscure issues. Last time I looked, I didn't quite see how to best do this with cmake, so if you can, yes, a patch would be most welcome.</p>


	<p>Regards from the Coding Sprint @ Aix-en-Provence :)</p></div>
    </div>
  </div>
  
  <div id="change-1719" class="journal has-notes">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/121">Johannes Wienke</a> <a title="28 Aug 2010 03:26" href="/projects/exiv2/activity?from=2010-08-28">about 11 years</a> ago
      <span id="journal-1719-private_notes" class=""></span>
    </h4>

    <div id="journal-1719-notes" class="wiki"><p>Hm, I don't really agree to build unit tests against an installed version. Normally you want to use unit tests to check if installing a version is safe. I would propose to build the unit tests in the first instance against the code from the build folder and add a custom target like "postinstallcheck" that builds them against the installed version if desired. To support this a good pattern is to have the same folder structure for include files in the project as the headers are installed later on. Hence something like exiv2project/src/exiv2/xyz.cpp would make building tests easier.</p></div>
    </div>
  </div>
  
  <div id="change-2154" class="journal has-details">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="06 May 2012 17:29" href="/projects/exiv2/activity?from=2012-05-06">over 9 years</a> ago
      <span id="journal-2154-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Assignee</strong> set to <i>Robin Mills</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-2170" class="journal has-details">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="23 May 2012 18:39" href="/projects/exiv2/activity?from=2012-05-23">over 9 years</a> ago
      <span id="journal-2170-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>New</i> to <i>Assigned</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-2174" class="journal has-notes has-details">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Jun 2012 15:24" href="/projects/exiv2/activity?from=2012-06-03">over 9 years</a> ago
      <span id="journal-2174-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Category</strong> set to <i>build</i></li>
       <li><strong>Target version</strong> set to <i>0.24</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>50</i></li>
    </ul>
    <div id="journal-2174-notes" class="wiki"><p>I've submitted changes to build exiv2 with MSVC: SVN:2746 (see Bug <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Switch to a unified build system based on cmake (Closed)" href="/issues/536">#536</a>).  I've modified the default configuration of CMakeLists.txt to build the sample applications.  The build can be tested for Linux (and Mac) with:</p>


	<p>cd exiv2<br />mkdir build ; cd build<br />cmake ..<br />cp -R ../test test<br />cd test ; make test</p>


	<p>This runs the suite against the build you have just created.  The script test/testMSVC.sh can be used to run the suite on MSVC builds from CygWin or MinGW.</p>


	<p>I have not yet investigated "out of source" builds.</p></div>
    </div>
  </div>
  
  <div id="change-2249" class="journal has-notes has-details">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="02 Oct 2012 17:44" href="/projects/exiv2/activity?from=2012-10-02">about 9 years</a> ago
      <span id="journal-2249-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Resolved</i></li>
       <li><strong>% Done</strong> changed from <i>50</i> to <i>100</i></li>
    </ul>
    <div id="journal-2249-notes" class="wiki"><p>I've submitted a fix for this.  SVN:2890 <a class="external" href="http://dev.exiv2.org/projects/exiv2/repository/revisions/2889">http://dev.exiv2.org/projects/exiv2/repository/revisions/2889</a></p>


	<p>I put a symlink into the build-directory (and his children samples and po) exiv2 -> &lt;exivdir&gt;/src.</p></div>
    </div>
  </div>
  
  <div id="change-2553" class="journal has-notes has-details">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="24 Jul 2013 15:30" href="/projects/exiv2/activity?from=2013-07-24">over 8 years</a> ago
      <span id="journal-2553-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
    </ul>
    <div id="journal-2553-notes" class="wiki"><p>Fixed in 0.24.</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/722.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/722.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
