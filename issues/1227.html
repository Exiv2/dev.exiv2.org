<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #1227:  File extension Issue - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="OoWfapGFBQVyu3SwElRJTcUJk+Hc+9UiFP0Se1oYQaLYyDSF4//JBSffa7ytg0V++pvHmC0YdJjp3YLzGSGmzQ==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #1227:  File extension Issue" href="https://dev.exiv2.org/issues/1227.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #1227</h2>

<div class="issue tracker-1 status-2 priority-4 priority-default details">
    <div class="next-prev-links contextual">
      <a title="#1222" accesskey="p" href="/issues/1222">« Previous</a> |
        <span class="position">
          <a href="/issues?f%5B%5D=status_id&amp;op%5Bstatus_id%5D=o&amp;page=2&amp;per_page=25&amp;set_filter=1&amp;sort=updated_on%3Adesc%2Cid%3Adesc&amp;v%5Bstatus_id%5D%5B%5D=">30 of 78</a>
        </span> |
      <a title="#842" accesskey="n" href="/issues/842">Next »</a>
    </div>

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3> File extension Issue</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/4757">Henk van den Berg</a> <a title="18 Sep 2016 19:46" href="/projects/exiv2/activity?from=2016-09-18">about 5 years</a> ago.
        Updated <a title="23 Sep 2016 08:12" href="/projects/exiv2/activity?from=2016-09-23">about 5 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Assigned</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/76">Gilles Caulier</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">insufficient information</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="31 Dec 2020" href="/versions/54">0.28</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">18 Sep 2016</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-0"><tr><td style="width: 100%;" class="todo"></td></tr></table><p class="percent">0%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value">1.00 h</div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Randomly Digikam (5.1.0) seems to create a file with .JPG4392 (or other numbers) after tags are updated. The issue is that the actual image file is not updated with the change.</p>


	<p>Can you please advise what this issue is.</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1064">Singapore2012IMG_1274.jpg2184</a>    <span class="size">(2.61 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1064/Singapore2012IMG_1274.jpg2184">Singapore2012IMG_1274.jpg2184</a>  </td>
  <td></td>
  <td>
      <span class="author">Henk van den Berg, 20 Sep 2016 08:47</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1065">Singapore2012IMG_1274.jpg2184</a>    <span class="size">(2.61 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1065/Singapore2012IMG_1274.jpg2184">Singapore2012IMG_1274.jpg2184</a>  </td>
  <td></td>
  <td>
      <span class="author">Henk van den Berg, 20 Sep 2016 08:47</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>







<hr />
<div id="relations">
<div class="contextual">
</div>

<p><strong>Related issues</strong></p>

<form data-cm-url="/issues/context_menu" action="/issues/1227" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="MlVZBU4uXto1AsTQfqZ5F4IrcYaz5CCjTkmf2ZkgeH3QGPLqPFSS2mBm29zBcXUkvbkl/0IHgRmzaQ9R2hmfEg==" />
  <table class="list issues odd-even"><tr id="relation-243" class="issue hascontextmenu issue tracker-1 status-2 priority-4 priority-default"><td class="checkbox"><input type="checkbox" name="ids[]" value="1222" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-1 status-2 priority-4 priority-default" href="/issues/1222">Bug #1222</a>: Failed to rename file to</td><td class="status">Assigned</td><td class="start_date">06 Sep 2016</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-0"><tr><td style="width: 100%;" class="todo"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr><tr id="relation-244" class="issue hascontextmenu issue tracker-1 status-2 priority-4 priority-default"><td class="checkbox"><input type="checkbox" name="ids[]" value="1228" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-1 status-2 priority-4 priority-default" href="/issues/1228">Bug #1228</a>: Crash in Windows when reading metadata in parallel</td><td class="status">Assigned</td><td class="start_date">22 Sep 2016</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-0"><tr><td style="width: 100%;" class="todo"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr><tr id="relation-245" class="issue hascontextmenu issue tracker-1 status-5 priority-4 priority-default closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="1207" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-1 status-5 priority-4 priority-default closed" href="/issues/1207">Bug #1207</a>: digiKam maintenance tool to synchronize files metadata and database crash in Exiv2 (re-entrancy issue ?)</td><td class="status">Closed</td><td class="start_date">13 Aug 2016</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr></table>
</form>
<form class="new_relation" id="new-relation-form" style="display: none;" action="/issues/1227/relations" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />


<p><select onchange="setPredecessorFieldsVisibility();" name="relation[relation_type]" id="relation_relation_type"><option selected="selected" value="relates">Related to</option>
<option value="duplicates">Is duplicate of</option>
<option value="duplicated">Has duplicate</option>
<option value="blocks">Blocks</option>
<option value="blocked">Blocked by</option>
<option value="precedes">Precedes</option>
<option value="follows">Follows</option>
<option value="copied_to">Copied to</option>
<option value="copied_from">Copied from</option></select>
Issue #<input size="10" type="text" name="relation[issue_to_id]" id="relation_issue_to_id" />
<span id="predecessor_fields" style="display:none;">
Delay: <input size="3" type="text" name="relation[delay]" id="relation_delay" /> days
</span>
<input type="submit" name="commit" value="Add" data-disable-with="Add" />
<a href="#" onclick="$(&quot;#new-relation-form&quot;).hide();; return false;">Cancel</a>
</p>

<script>
//<![CDATA[
observeAutocompleteField('relation_issue_to_id', '/issues/auto_complete?issue_id=1227&project_id=exiv2&scope=all')
//]]>
</script>

<script>
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>
</div>

</div>




<div id="history">
<h3>History</h3>
  <div id="change-5607" class="journal has-notes has-details">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="18 Sep 2016 20:48" href="/projects/exiv2/activity?from=2016-09-18">about 5 years</a> ago
      <span id="journal-5607-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Assignee</strong> set to <i>Robin Mills</i></li>
       <li><strong>Target version</strong> set to <i>0.28</i></li>
    </ul>
    <div id="journal-5607-notes" class="wiki"><p>Exiv2 creates temporary files using the name of the image file name and the process id.  The metadata is created in this temporary file and when it has been successfully written, the metadata is copied to the original file and the temporary file is deleted.  This approach is used to minimise the risk to your valuable original image file.  It sounds as though there is something preventing the temporary file from being copied into your image file and it is being left behind for you to spot it.  However your file is undamaged.</p>


	<p>Here are questions you could consider:</p>


	<ol>
	<li>Is it possible that your image is write protected (read-only)?</li>
		<li>Is there a virus checker in use?</li>
		<li>Have you seen this on another computer?</li>
		<li>Is your file on local stored (e.g. Hard Drive) or is it on a Network Drive</li>
		<li>Can you think of anything special or unusual about your setup?</li>
	</ol>


	<p>To make progress with this, I need details such as:</p>


	<ol>
	<li>Which version of Exiv2 are you using?  <em><strong><code>$ exiv2 -vV </code></strong></em></li>
		<li>Your platform (Windows, Linux or Mac)</li>
		<li>How was the code built? </li>
		<li>An image file which exhibits the behaviour that you describe.</li>
	</ol>


	<p>Robin</p></div>
    </div>
  </div>
  
  <div id="change-5609" class="journal has-details">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="20 Sep 2016 04:24" href="/projects/exiv2/activity?from=2016-09-20">about 5 years</a> ago
      <span id="journal-5609-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Category</strong> set to <i>insufficient information</i></li>
       <li><strong>Status</strong> changed from <i>New</i> to <i>Closed</i></li>
       <li><strong>Target version</strong> changed from <i>0.28</i> to <i>0.26</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
       <li><strong>Estimated time</strong> set to <i>1.00 h</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-5610" class="journal has-notes has-details">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4757">Henk van den Berg</a> <a title="20 Sep 2016 08:47" href="/projects/exiv2/activity?from=2016-09-20">about 5 years</a> ago
      <span id="journal-5610-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/1064">Singapore2012IMG_1274.jpg2184</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/1064/Singapore2012IMG_1274.jpg2184">Singapore2012IMG_1274.jpg2184</a> added</li>
       <li><strong>File</strong> <a href="/attachments/1065">Singapore2012IMG_1274.jpg2184</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/1065/Singapore2012IMG_1274.jpg2184">Singapore2012IMG_1274.jpg2184</a> added</li>
    </ul>
    <div id="journal-5610-notes" class="wiki"><p>Thanks for your feedback and I will try to provide you context on the set up.</p>


	<p>Three computers: 2 Windows PCs and 1 Mac<br />Files are located in a dropbox<br />Virus checker: 1 Mac and 1 PC do not run a virus checking App. I will verify the if the second PC runs it.<br />The application used is Digikam version 5.1.0. which is open standard. I am using the packaged version and I am not a developer.  I reported the issue to them and they referred me to report the issue to Exiv. Digikam recently upgraded from 4.x.x to 5.x.x and I did not have the issue before the upgrade<br />Please find attached a sample of an image and file<br />Please let me know if you have any further questions and hope this helps.</p>


	<p>Henk</p></div>
    </div>
  </div>
  
  <div id="change-5611" class="journal has-notes has-details">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="20 Sep 2016 08:58" href="/projects/exiv2/activity?from=2016-09-20">about 5 years</a> ago
      <span id="journal-5611-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Closed</i> to <i>Assigned</i></li>
       <li><strong>Assignee</strong> changed from <i>Robin Mills</i> to <i>Gilles Caulier</i></li>
       <li><strong>Target version</strong> changed from <i>0.26</i> to <i>0.28</i></li>
       <li><strong>% Done</strong> changed from <i>100</i> to <i>0</i></li>
    </ul>
    <div id="journal-5611-notes" class="wiki"><p>I'm very suspicious of Dropbox.  It could lock your files.  Is this happening on the Mac, or Windows or Both? Which version of Windows or Mac?</p>


	<p>I no longer support digiKam.  They have demanded and wasted lots of my time.   Other members of Team Exiv2 may help.  I'm assigning this to Gilles Caulier who is the Lead Engineer for digiKam.</p></div>
    </div>
  </div>
  
  <div id="change-5617" class="journal has-notes">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/134">Niels Kristian Bech Jensen</a> <a title="23 Sep 2016 04:44" href="/projects/exiv2/activity?from=2016-09-23">about 5 years</a> ago
      <span id="journal-5617-private_notes" class=""></span>
    </h4>

    <div id="journal-5617-notes" class="wiki"><p>It seems to me that this issue, issue <a class="issue tracker-1 status-2 priority-4 priority-default" title="Bug: Failed to rename file to (Assigned)" href="/issues/1222">#1222</a> and this bug report from UFRaw: <a class="external" href="https://sourceforge.net/p/ufraw/bugs/409/">https://sourceforge.net/p/ufraw/bugs/409/</a> might be related. The common demoninator seems to be spawning processes/multi threading on the Windows platform. Could it be some sort of file lock mechanism playing havoc? I do not know anything about the Windows internals.</p>


	<p>Best regards,<br />Niels Kristian Bech Jensen</p></div>
    </div>
  </div>
  
  <div id="change-5619" class="journal has-notes">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="23 Sep 2016 08:12" href="/projects/exiv2/activity?from=2016-09-23">about 5 years</a> ago
      <span id="journal-5619-private_notes" class=""></span>
    </h4>

    <div id="journal-5619-notes" class="wiki"><p>Niels:</p>


	<p>Thanks for stepping into <a class="issue tracker-1 status-2 priority-4 priority-default" title="Bug: Failed to rename file to (Assigned)" href="/issues/1222">#1222</a> and <a class="issue tracker-1 status-2 priority-4 priority-default" title="Bug:  File extension Issue (Assigned)" href="/issues/1227">#1227</a>  For sure, there's something nasty happening and it's going to take some time to discover what's at the bottom of this.</p>


	<p>When I investigated <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: digiKam maintenance tool to synchronize files metadata and database crash in Exiv2 (re-entrancy i... (Closed)" href="/issues/1207">#1207</a> for Gilles on MacOS-X, he asked me to use "a lot more than 3 threads".  So I did.  I got messages from the OS that I've never seen before about "resource not available".  I've subsequently learned that MacOS-X has limits of about 256 open files per process.  Those limits can be changed by the user, however that is not a useful fix.  It's important that multi-threaded application control/limit the number of threads opening files.  I think we'll learn that Windows requires similar treatment.</p>


	<p>The Windows platform is also challenged by invisible processes such as Virus Checkers, Dropbox and other agents who may be locking the files.  <em><strong>We are not alone</strong></em>.  Something's going on.</p>


	<p>Regrettably, I am flat out at present getting finished with v0.26.  The test program samples/mt-test.cpp may be a useful starting point from which to investigate this issue.</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/1227.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/1227.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
