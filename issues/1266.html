<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #1266: CMake fails to link zlib with debug config using msvc 2015. - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="KMWX62gl52xDzJftPzdvXzo3DKl/no1rKJSvx8Ho8BTKiDwEGl8rbBaoiOGA4GNsBaVY0I59LNHVtD9PgtEXew==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #1266: CMake fails to link zlib with debug config using msvc 2015." href="https://dev.exiv2.org/issues/1266.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #1266</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>CMake fails to link zlib with debug config using msvc 2015.</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="10 Dec 2016 17:58" href="/projects/exiv2/activity?from=2016-12-10">almost 5 years</a> ago.
        Updated <a title="13 Dec 2016 17:48" href="/projects/exiv2/activity?from=2016-12-13">almost 5 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/4722">Ben Touchette</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">build</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="28 Apr 2017" href="/versions/52">0.26</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">10 Dec 2016</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value">13 Dec 2016</div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value">10.00 h</div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Compilation fails for exiv2 and samples when using CMake with MS VS 2015 Community Edition and gives link errors about missing zlib symbols.</p>


	<p>CMakeLists.txt is missing the zlib target_link_libraries and fails. Add this line before the expat one in the msvc check fixes the issue:</p>
	<pre><code>TARGET_LINK_LIBRARIES( exiv2lib ${PRIVATE_VAR} ${ZLIB_LIBRARIES} )</code></pre>


	<p>Adding patch for comments.</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1116">exiv2-cmake-msvc-2015-link-patch.diff</a>    <span class="size">(582 Bytes)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1116/exiv2-cmake-msvc-2015-link-patch.diff">exiv2-cmake-msvc-2015-link-patch.diff</a>  </td>
  <td></td>
  <td>
      <span class="author">Ben Touchette, 10 Dec 2016 17:58</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>








</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 4696" href="/projects/exiv2/repository/exiv2/revisions/4696">Revision 4696</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4696/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="13 Dec 2016 17:46" href="/projects/exiv2/activity?from=2016-12-13">almost 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: CMake fails to link zlib with debug config using msvc 2015. (Closed)" href="/issues/1266">#1266</a> Add path to zlib for cmake msvc to src/CMakeList.txt to fix debug buildtype build issues</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-5783" class="journal has-notes has-details">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="11 Dec 2016 11:04" href="/projects/exiv2/activity?from=2016-12-11">almost 5 years</a> ago
      <span id="journal-5783-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Category</strong> set to <i>build</i></li>
       <li><strong>Assignee</strong> set to <i>Robin Mills</i></li>
       <li><strong>Target version</strong> set to <i>0.26</i></li>
    </ul>
    <div id="journal-5783-notes" class="wiki"><p>Your patch looks good.  However I'm wondering how you are building Exiv2/CMake/MSVC as the buildserver has successfully built this without the patch!</p>


	<p>So my questions is: "What are you doing and why?"  If you want to debug code in VS2015, I recommend you keep away from CMake.  Open msvc/exiv2.sln.  The convertor will take about 5 minutes to run (why is it so slow?).  Then build.  Set your breakpoints and execute exiv2.exe</p>


	<p>I see Daniel has added entries concerning CURL (and SSH) that look suspicious to me.  CURL should only be linked when EXIV2_ENABLE_CURL is set.</p></div>
    </div>
  </div>
  
  <div id="change-5784" class="journal has-notes">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="11 Dec 2016 11:57" href="/projects/exiv2/activity?from=2016-12-11">almost 5 years</a> ago
      <span id="journal-5784-private_notes" class=""></span>
    </h4>

    <div id="journal-5784-notes" class="wiki"><p>I don't disagree with any of the particulars, except i have a client that uses CMake in their build process and have the support libraries outside the standard paths thus it requires passing them to do CMake during the configuration phase where it finds them but fails on finding the specified path without that patch when building for the debug target during the actual build at which point the linker complains of not find it. Setting the build to release works fine though without the changes.</p></div>
    </div>
  </div>
  
  <div id="change-5785" class="journal has-notes has-details">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="11 Dec 2016 13:17" href="/projects/exiv2/activity?from=2016-12-11">almost 5 years</a> ago
      <span id="journal-5785-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>New</i> to <i>Assigned</i></li>
       <li><strong>Assignee</strong> changed from <i>Robin Mills</i> to <i>Ben Touchette</i></li>
    </ul>
    <div id="journal-5785-notes" class="wiki"><p>Well, if your patch is working for you, I am happy.  The daily build performed for VS2015 is release/x64 and release/win32.  I'll check tomorrow that it hasn't broken.</p>


	<p>It's useful that you are working with CMake/MSVC.  There may be more pain ahead, however it's only by using those horrors that we can find and fix such mysterious behaviour.</p>


	<p>I've assigned this to you.  When you're happy, please close this, set the <span>done to 100</span> and update "estimated time" to account for your effort.</p></div>
    </div>
  </div>
  
  <div id="change-5786" class="journal has-notes">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="11 Dec 2016 14:03" href="/projects/exiv2/activity?from=2016-12-11">almost 5 years</a> ago
      <span id="journal-5786-private_notes" class=""></span>
    </h4>

    <div id="journal-5786-notes" class="wiki"><p>I don't think it will be broken, as it worked here. Only the debug version had the issue. I'll take care of updating it tomorrow, having a rather awful morning right now and i think i need to stay away from anything critical, lol, smh.</p></div>
    </div>
  </div>
  
  <div id="change-5787" class="journal has-notes has-details">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="13 Dec 2016 17:48" href="/projects/exiv2/activity?from=2016-12-13">almost 5 years</a> ago
      <span id="journal-5787-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Due date</strong> set to <i>13 Dec 2016</i></li>
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Closed</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
       <li><strong>Estimated time</strong> set to <i>10.00 h</i></li>
    </ul>
    <div id="journal-5787-notes" class="wiki"><p>closing.</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/1266.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/1266.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
