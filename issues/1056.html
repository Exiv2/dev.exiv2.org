<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #1056: Tiff file is not shown by Windows 8.1 viewer because of &quot;Exif.Thumbnail.JPEGInterchangeFormatLength&quot; field - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="/H6P7wFsQrA6Z5z2Aih/o5lf8vpwz3Mm44vDJnbKBEoeMyQAcxaOsG8Dg/q9/3OQps2mg4Es0pweq1OuNfPjJQ==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #1056: Tiff file is not shown by Windows 8.1 viewer because of &quot;Exif.Thumbnail.JPEGInterchangeFormatLength&quot; field" href="https://dev.exiv2.org/issues/1056.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #1056</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Tiff file is not shown by Windows 8.1 viewer because of &quot;Exif.Thumbnail.JPEGInterchangeFormatLength&quot; field</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/4404">Danylo Kozub</a> <a title="15 Apr 2015 08:47" href="/projects/exiv2/activity?from=2015-04-15">over 6 years</a> ago.
        Updated <a title="21 Jun 2015 16:39" href="/projects/exiv2/activity?from=2015-06-21">over 6 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/119">Robin Mills</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">metadata</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="17 May 2015" href="/versions/51">0.25</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">15 Apr 2015</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>I open original tiff (10.tiff), read metadata, then I clear metadata and write to new tiff:</p>


	<p>Exiv2::Image::AutoPtr tempImage = Exiv2::ImageFactory::open(dest_path);<br />tempImage->clearMetadata();<br />tempImage->writeMetadata();</p>


	<p>The strange thing is that resulting file (11.tif) contains "Exif.Thumbnail.JPEGInterchangeFormatLength"=0 field, which causes problems with Windows 8.1 viewer.</p>


	<p>then I repeat saving again for the second tiff file, this field is gone!!</p>


	<p>I cant find any logic to at least create some workaround for this problem, please help.</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/764">10.tif</a>    <span class="size">(39.5 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/764/10.tif">10.tif</a>  </td>
  <td></td>
  <td>
      <span class="author">Danylo Kozub, 15 Apr 2015 08:47</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/765">11.tif</a>    <span class="size">(39.5 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/765/11.tif">11.tif</a>  </td>
  <td></td>
  <td>
      <span class="author">Danylo Kozub, 15 Apr 2015 08:47</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>








</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 3711" href="/projects/exiv2/repository/exiv2/revisions/3711">Revision 3711</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3711/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="21 Apr 2015 14:44" href="/projects/exiv2/activity?from=2015-04-21">over 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Tiff file is not shown by Windows 8.1 viewer because of &quot;Exif.Thumbnail.JPEGInterchangeFormatLeng... (Closed)" href="/issues/1056">#1056</a>.  Changed LangAltValueComparator to return bool str1 < str2 ? true : false.  Test reference files updated to reflect alphabetic lang output.</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-3429" class="journal has-details">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4404">Danylo Kozub</a> <a title="15 Apr 2015 08:47" href="/projects/exiv2/activity?from=2015-04-15">over 6 years</a> ago
      <span id="journal-3429-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/764">10.tif</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/764/10.tif">10.tif</a> added</li>
       <li><strong>File</strong> <a href="/attachments/765">11.tif</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/765/11.tif">11.tif</a> added</li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-3430" class="journal has-notes has-details">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="15 Apr 2015 10:04" href="/projects/exiv2/activity?from=2015-04-15">over 6 years</a> ago
      <span id="journal-3430-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Category</strong> set to <i>metadata</i></li>
       <li><strong>Status</strong> changed from <i>New</i> to <i>Assigned</i></li>
       <li><strong>Assignee</strong> set to <i>Robin Mills</i></li>
       <li><strong>Target version</strong> set to <i>0.25</i></li>
    </ul>
    <div id="journal-3430-notes" class="wiki"><p>What a curious thing.  My instant reaction is to say "Call Microsoft".  However every puzzle is interesting, so here's what I've done:<pre>526 rmills@rmillsmbp:~/Downloads/foo $ cp ../10.tif .
527 rmills@rmillsmbp:~/Downloads/foo $ cp ../11.tif .
528 rmills@rmillsmbp:~/Downloads/foo $ cp 10.tif 12.tif
529 rmills@rmillsmbp:~/Downloads/foo $ exiv2 -M"del Exif.Thumbnail.JPEGInterchangeFormatLength" 12.tif
530 rmills@rmillsmbp:~/Downloads/foo $ ls -alt
total 240
-rw-r--r--@  1 rmills  staff  40432 15 Apr 10:27 12.tif
drwxr-xr-x+  5 rmills  staff    170 15 Apr 10:27 .
-rw-r--r--@  1 rmills  staff  40462 15 Apr 10:27 11.tif
-rw-r--r--@  1 rmills  staff  40450 15 Apr 10:27 10.tif
drwx------+ 97 rmills  staff   3298 15 Apr 10:27 ..
531 rmills@rmillsmbp:~/Downloads/foo $ exiv2 -pa 10.tif &gt; 10.txt 
10.tif: (No XMP data found in the file)
532 rmills@rmillsmbp:~/Downloads/foo $ exiv2 -pa 11.tif &gt; 11.txt 
11.tif: (No XMP data found in the file)
533 rmills@rmillsmbp:~/Downloads/foo $ exiv2 -pa 12.tif &gt; 12.txt 
12.tif: (No XMP data found in the file)
534 rmills@rmillsmbp:~/Downloads/foo $ diff 10.txt 11.txt
6c6,7
&lt; Exif.Image.StripOffsets                      Long        5  250 8290 16330 24370 32410
---
&gt; Exif.Image.StripOffsets                      Long        5  262 8302 16342 24382 32422
&gt; Exif.Image.Orientation                       Short       1  top, left
535 rmills@rmillsmbp:~/Downloads/foo $ diff 10.txt 12.txt
6c6
&lt; Exif.Image.StripOffsets                      Long        5  250 8290 16330 24370 32410
---
&gt; Exif.Image.StripOffsets                      Long        5  232 8272 16312 24352 32392
14d13
&lt; Exif.Thumbnail.JPEGInterchangeFormatLength   SLong       1  0
536 rmills@rmillsmbp:~/Downloads/foo $ </pre>I can see the Downloads/foo directory on the Windows7 Virtual Machine on my Mac.  The Explorer icons look fine.  File/Properties are fine.  They all open OK in mspaint.exe</p>


	<p>I've copied foo/*.tif to my Wife's Lenova slate running Windows 8.1.  Again, I see nothing unusual.  Images open in "Reader".</p>


	<p>I don't see anything in the difference between 10.tif and 11.tif that has to do with Exif.Thumbnail.JPEGInterchangeFormatLength.  If you want to provide more evidence, can I ask you to use exiv2.exe to modify files and then I can reproduce your workflow on my machine(s).  Please provide the output of the command exiv2 -vV (verbose Version) so I know which version of exiv2 you are using.</p></div>
    </div>
  </div>
  
  <div id="change-3431" class="journal has-notes">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4404">Danylo Kozub</a> <a title="15 Apr 2015 20:46" href="/projects/exiv2/activity?from=2015-04-15">over 6 years</a> ago
      <span id="journal-3431-private_notes" class=""></span>
    </h4>

    <div id="journal-3431-notes" class="wiki"><p>Thanks for your suggestions.</p>


	<p>1. I've checked again on two 8.1 computers - 10.tif and 11.tif definitely have problems with Windows Viewer. Maybe this depends on Windows updates.</p>


	<p>2. I confirm that exiv2 deletes Exif.Thumbnail.JPEGInterchangeFormatLength flag correctly.</p>


	<p>3. I've checked exiv2 sources and the only difference with my code which I can see is that I am reading metadata from one tiff and writing it to another tiff file while exiv2 updates the same tiff file. So my question is if it is possible to transfer metadata from one file to another with single command?</p></div>
    </div>
  </div>
  
  <div id="change-3432" class="journal has-notes">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="15 Apr 2015 21:39" href="/projects/exiv2/activity?from=2015-04-15">over 6 years</a> ago
      <span id="journal-3432-private_notes" class=""></span>
    </h4>

    <div id="journal-3432-notes" class="wiki"><p>The sample application metacopy copies the metadata from one image to another.</p>


	<p>$ make config <br />$ ./configure <br />$ make -j<br />$ sudo make install<br />$ make samples<br />bin/metacopy 10.tif 11.tif</p>


	<p>If you're building with MSVC, the Solution will build into bin/$platform/$config/metacopy.exe<br />eg: &lt;exiv2dir&gt;/msvc2005/bin/x64/release/metacopy.exe</p></div>
    </div>
  </div>
  
  <div id="change-3433" class="journal has-notes">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4404">Danylo Kozub</a> <a title="16 Apr 2015 14:15" href="/projects/exiv2/activity?from=2015-04-16">over 6 years</a> ago
      <span id="journal-3433-private_notes" class=""></span>
    </h4>

    <div id="journal-3433-notes" class="wiki"><p>I found the bug in my code :( Thanks and sorry for the troubles!</p></div>
    </div>
  </div>
  
  <div id="change-3434" class="journal has-notes has-details">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="16 Apr 2015 15:52" href="/projects/exiv2/activity?from=2015-04-16">over 6 years</a> ago
      <span id="journal-3434-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Resolved</i></li>
    </ul>
    <div id="journal-3434-notes" class="wiki"><p>That's what we want: Happy Users.</p>


	<p>I'm going to set the status to "Resolved" which means I don't plan to do further work on this issue.  The status will be set to "Closed" during review when we ship v0.25.</p></div>
    </div>
  </div>
  
  <div id="change-3599" class="journal has-details">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 May 2015 16:10" href="/projects/exiv2/activity?from=2015-05-08">over 6 years</a> ago
      <span id="journal-3599-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-3832" class="journal has-details">
    <div id="note-8">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-8" class="journal-link">#8</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="21 Jun 2015 16:39" href="/projects/exiv2/activity?from=2015-06-21">over 6 years</a> ago
      <span id="journal-3832-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
    </ul>
    
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/1056.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/1056.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
