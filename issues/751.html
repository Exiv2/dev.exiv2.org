<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #751: adobe xmp namespace - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="lSNXN8K8CrJRTB68sSye1uS360rOhXu1vDaNA9JU2mZ3bvzYsMbGsgQoAbAO+5Ll2yW/Mz9m2g9BFh2LkW09CQ==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #751: adobe xmp namespace" href="https://dev.exiv2.org/issues/751.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #751</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>adobe xmp namespace</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/261">Adrian F</a> <a title="17 Jan 2011 04:40" href="/projects/exiv2/activity?from=2011-01-17">almost 11 years</a> ago.
        Updated <a title="13 Oct 2015 21:22" href="/projects/exiv2/activity?from=2015-10-13">about 6 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/119">Robin Mills</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">xmp</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="28 Apr 2017" href="/versions/52">0.26</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">17 Jan 2011</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p><a class="external" href="http://ns.adobe.com/xap/1.0/">http://ns.adobe.com/xap/1.0/</a> is now registered with the prefix xmp rather than the previous prefix xap. A consequence of this is I have old files with ratings described using xap:Rating i.e.<br />"http://ns.adobe.com/xap/1.0/" xap:Rating="4"</p>


	<p>and new files with ratings described using xmp:Rating i.e.<br />"http://ns.adobe.com/xap/1.0/" xmp:Rating="4"</p>


	<p>At startup I initialise exiv2 to avoid thread-safe issues and so <a class="external" href="http://ns.adobe.com/xap/1.0/">http://ns.adobe.com/xap/1.0/</a> is registered with the prefix xmp. If I then read several files some of which use the xap:Rating style and some use the xmp:Rating style in more than one thread the conflict between the prefixes causes many non thread-safe re-registration attempts in exiv2 and memory exception throws in the xmp sdk. I think the root cause of this is the fact both exiv2 and the xmp sdk use one to one maps to represent prefix URI pairs and because of the prefix name change in the xmp sdk there is no longer a one to one relationship between <a class="external" href="http://ns.adobe.com/xap/1.0/">http://ns.adobe.com/xap/1.0/</a> and a prefix.</p>
  </div>
</div>






<hr />
<div id="relations">
<div class="contextual">
</div>

<p><strong>Related issues</strong></p>

<form data-cm-url="/issues/context_menu" action="/issues/751" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="nVyXe/J9gX5pxLZlkAcPS9XNtqk47LvNCWn83QMoOAF/ETyUgAdNfjygqWkv0AN46l/i0MkPGnf0SWxVQBHfbg==" />
  <table class="list issues odd-even"><tr id="relation-81" class="issue hascontextmenu issue tracker-2 status-5 priority-4 priority-default closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="742" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-2 status-5 priority-4 priority-default closed" href="/issues/742">Feature #742</a>: External XMPSDK and/or XMPSDK 2014.12</td><td class="status">Closed</td><td class="start_date">23 Nov 2010</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr><tr id="relation-86" class="issue hascontextmenu issue tracker-4 status-5 priority-4 priority-default closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="786" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-4 status-5 priority-4 priority-default closed" href="/issues/786">Patch #786</a>: thread safety of xmp toolkit</td><td class="status">Closed</td><td class="start_date">10 Aug 2011</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr><tr id="relation-167" class="issue hascontextmenu issue tracker-2 status-5 priority-4 priority-default closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="941" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-2 status-5 priority-4 priority-default closed" href="/issues/941">Feature #941</a>: Upgrade xmpsdk source to Adobe&#39;s current version</td><td class="status">Closed</td><td class="start_date">27 Dec 2013</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr><tr id="relation-177" class="issue hascontextmenu issue tracker-1 status-5 priority-4 priority-default closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="1113" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-1 status-5 priority-4 priority-default closed" href="/issues/1113">Bug #1113</a>: Crash in Exiv2 0.25</td><td class="status">Closed</td><td class="start_date">31 Aug 2015</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr></table>
</form>
<form class="new_relation" id="new-relation-form" style="display: none;" action="/issues/751/relations" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />


<p><select onchange="setPredecessorFieldsVisibility();" name="relation[relation_type]" id="relation_relation_type"><option selected="selected" value="relates">Related to</option>
<option value="duplicates">Is duplicate of</option>
<option value="duplicated">Has duplicate</option>
<option value="blocks">Blocks</option>
<option value="blocked">Blocked by</option>
<option value="precedes">Precedes</option>
<option value="follows">Follows</option>
<option value="copied_to">Copied to</option>
<option value="copied_from">Copied from</option></select>
Issue #<input size="10" type="text" name="relation[issue_to_id]" id="relation_issue_to_id" />
<span id="predecessor_fields" style="display:none;">
Delay: <input size="3" type="text" name="relation[delay]" id="relation_delay" /> days
</span>
<input type="submit" name="commit" value="Add" data-disable-with="Add" />
<a href="#" onclick="$(&quot;#new-relation-form&quot;).hide();; return false;">Cancel</a>
</p>

<script>
//<![CDATA[
observeAutocompleteField('relation_issue_to_id', '/issues/auto_complete?issue_id=751&project_id=exiv2&scope=all')
//]]>
</script>

<script>
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>
</div>

</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 3914" href="/projects/exiv2/repository/exiv2/revisions/3914">Revision 3914</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3914/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="29 Aug 2015 16:43" href="/projects/exiv2/activity?from=2015-08-29">about 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: method is missing in Exiv2 to get list of known XMP namespaces (Closed)" href="/issues/640">#640</a> <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: adobe xmp namespace (Closed)" href="/issues/751">#751</a>  Fix to test suit to prevent crash in exiv2json -x test/data/BlueSquare.xmp (see <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: adobe xmp namespace (Closed)" href="/issues/751">#751</a> for discussion)</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-1850" class="journal has-notes">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="17 Jan 2011 16:21" href="/projects/exiv2/activity?from=2011-01-17">almost 11 years</a> ago
      <span id="journal-1850-private_notes" class=""></span>
    </h4>

    <div id="journal-1850-notes" class="wiki"><p>Yes, the issue is the <a href="http://dev.exiv2.org/boards/3/topics/687#message-717" class="external">globel registry for namespaces and prefixes</a>.</p>


	<p>Fixing this probably requires changes in the XMP-SDK as well as Exiv2 itself. We should upgrade the XMP-SDK (<a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: External XMPSDK and/or XMPSDK 2014.12 (Closed)" href="/issues/742">#742</a>) and check if the issue is fixed there (according to comments in the code the Adobe developers are aware of this too) before attempting to fix it ourselves.</p></div>
    </div>
  </div>
  
  <div id="change-4029" class="journal has-notes has-details">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="22 Aug 2015 15:38" href="/projects/exiv2/activity?from=2015-08-22">about 6 years</a> ago
      <span id="journal-4029-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Category</strong> set to <i>xmp</i></li>
       <li><strong>Status</strong> changed from <i>New</i> to <i>Closed</i></li>
       <li><strong>Assignee</strong> set to <i>Andreas Huggel</i></li>
       <li><strong>Target version</strong> set to <i>0.26</i></li>
    </ul>
    <div id="journal-4029-notes" class="wiki"><p>I'm going to close this.  I've associated this to <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Upgrade xmpsdk source to Adobe&#39;s current version (Closed)" href="/issues/941">#941</a> which is the project to upgrade the version of Adobe XMPsdk being used by Exiv2.</p></div>
    </div>
  </div>
  
  <div id="change-4045" class="journal has-details">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="22 Aug 2015 16:13" href="/projects/exiv2/activity?from=2015-08-22">about 6 years</a> ago
      <span id="journal-4045-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-4141" class="journal has-notes">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="29 Aug 2015 17:12" href="/projects/exiv2/activity?from=2015-08-29">about 6 years</a> ago
      <span id="journal-4141-private_notes" class=""></span>
    </h4>

    <div id="journal-4141-notes" class="wiki"><p>I discovered that exiv2json was crashing on test/data/BlueSquare.xmp.  That file uses xap and xapMM.  Changing to xmp and xmpMM fixed the crash (<a class="changeset" title="#640 #751  Fix to test suit to prevent crash in exiv2json -x test/data/BlueSquare.xmp (see #751 f..." href="/projects/exiv2/repository/exiv2/revisions/3914">r3914</a>).</p>


	<p>XMPsdk maintains two maps prefix->URI and URI->prefix.  By maintaining both, Adobe are attempting to guarantee that no URI is used by more than one prefix, every prefix is unique.  This assertion isn't always true.  XMPMeta::DumpNamespaces tests that the size of both maps are the same.  There are two "orphans":<pre>xmp: ---&gt; http://ns.adobe.com/xap/1.0/
xmpMM: ---&gt; http://ns.adobe.com/xap/1.0/mm/ </pre>The reason for the "orphans" is because src/properties.cpp and xmpsdk/src/XMPMeta.cpp both (correctly) register the namespace prefix xmp and xmpMM.  Then the file BlueSquare.xml contains the code:<pre>    xmlns:xap="http://ns.adobe.com/xap/1.0/" 
    xmlns:xapMM="http://ns.adobe.com/xap/1.0/mm/"</pre>XMPsdk then updates its maps.  Of course the  xap and xapMM are new and unique, however the URI is not.  It's a pity the library doesn't throw when when RegisterNs is called and it's only detected by DumpNamespaces.</p>


	<p>I was unsuccessful in trying to fix this in xmpsdk in XMPMeta::DumpNamespaces by trying to sync the two maps.  Don't know why that didn't work, although I didn't want to touch the Adobe code anyway.  I suspect the latest version of Adobes XMPsdk will have some magic to deal with this.</p></div>
    </div>
  </div>
  
  <div id="change-4145" class="journal has-notes has-details">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="29 Aug 2015 20:30" href="/projects/exiv2/activity?from=2015-08-29">about 6 years</a> ago
      <span id="journal-4145-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Closed</i> to <i>Resolved</i></li>
       <li><strong>Assignee</strong> changed from <i>Andreas Huggel</i> to <i>Robin Mills</i></li>
    </ul>
    <div id="journal-4145-notes" class="wiki"><p>I'm going to re-open this and mark it Resolved/100% - just to keep it visible for the moment.</p></div>
    </div>
  </div>
  
  <div id="change-4395" class="journal has-details">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="13 Oct 2015 21:22" href="/projects/exiv2/activity?from=2015-10-13">about 6 years</a> ago
      <span id="journal-4395-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
    </ul>
    
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/751.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/751.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
