<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #1212: Sigma 18-35mm f/1.8 not recognized - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="Dcc1fs8bkljLf+qXxfpWA1KxY1u8xSfRjxbGZvqugkLvip6RvWFeWJ4b9Zt6LVowbSM3Ik0mhmtyNlbuuZdlLQ==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #1212: Sigma 18-35mm f/1.8 not recognized" href="https://dev.exiv2.org/issues/1212.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #1212</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Sigma 18-35mm f/1.8 not recognized</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/4737">Martin Ramshaw</a> <a title="25 Aug 2016 01:48" href="/projects/exiv2/activity?from=2016-08-25">about 5 years</a> ago.
        Updated <a title="28 Aug 2016 07:08" href="/projects/exiv2/activity?from=2016-08-28">about 5 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/360">Thomas Beutlich</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">lens</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="28 Apr 2017" href="/versions/52">0.26</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">25 Aug 2016</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value">2.00 h</div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Looks like Sigma has reused code 150 for this lens.</p>


	<p>[Filed as a Bug although it really seems like an enhancement to me.]</p>


	<p>It profiles as follows:</p>


	<p>owner@G30AB:/Photography/CR2s/2016-06-02$ exiv2 -pt IMG_0634.CR2 | grep -ai lens<br />Exif.CanonCs.LensType                        Short       1  150<br />Exif.CanonCs.Lens                            Short       3  18.0 - 35.0 mm<br />Exif.Canon.LensModel                         Ascii      74  18-35mm<br />Exif.Photo.LensSpecification                 Rational    4  18/1 35/1 0/1 0/1<br />Exif.Photo.LensModel                         Ascii       8  18-35mm<br />Exif.Photo.LensSerialNumber                  Ascii      11  0000000000<br />owner@G30AB:/Photography/CR2s/2016-06-02$</p>
  </div>
</div>







</div>




<div id="history">
<h3>History</h3>
  <div id="change-5450" class="journal has-notes has-details">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/360">Thomas Beutlich</a> <a title="25 Aug 2016 06:05" href="/projects/exiv2/activity?from=2016-08-25">about 5 years</a> ago
      <span id="journal-5450-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>New</i> to <i>Assigned</i></li>
       <li><strong>Assignee</strong> set to <i>Thomas Beutlich</i></li>
       <li><strong>Target version</strong> set to <i>0.26</i></li>
    </ul>
    <div id="journal-5450-notes" class="wiki"><p>It says "Canon EF 14mm f/2.8L or Sigma Lens" on <a class="external" href="http://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/Canon.html#LensType">http://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/Canon.html#LensType</a> whereas it is "Canon EF 14mm f/2.8L" in <a class="source" href="/projects/exiv2/repository/exiv2/entry/trunk/src/canonmn.cpp#L834">source:trunk/src/canonmn.cpp#L834</a>.</p>


	<p>Anything more to fix?</p></div>
    </div>
  </div>
  
  <div id="change-5453" class="journal has-notes has-details">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="25 Aug 2016 11:35" href="/projects/exiv2/activity?from=2016-08-25">about 5 years</a> ago
      <span id="journal-5453-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Priority</strong> changed from <i>Low</i> to <i>Normal</i></li>
    </ul>
    <div id="journal-5453-notes" class="wiki"><p>Lens recognition is tricky because every manufacturer does this a different way and it's very common for the LensID to be used by more than one lens.  To recognise the lens, Exiv2 has code that inspects other metadata to "guess" the lens.</p>


	<p>To enable the user to identify his lens, v0.26 (currently in development on the trunk) uses a file.  On Linux/Mac/Cygwin/MinGW the file is ~/.exiv2 For Windows it's c:\Users\username\exiv2.ini.  The file is stored in Windows .ini format.  You can identify your lens with an entry such as:<pre>[sony]
150=Sigma 18-35mm f/1.8</pre>When you do this, all applications which use libexiv2 will recognise your lens.  libexiv2 is used by GIMP, GwenView, digiKam and many other open source image processing tools.</p>


	<p>This new feature is extensively discussed in <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Camera accessory overflow file (Closed)" href="/issues/1034">#1034</a> <a class="external" href="http://dev.exiv2.org/issues/1034">http://dev.exiv2.org/issues/1034</a></p></div>
    </div>
  </div>
  
  <div id="change-5456" class="journal has-details">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="25 Aug 2016 17:05" href="/projects/exiv2/activity?from=2016-08-25">about 5 years</a> ago
      <span id="journal-5456-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
       <li><strong>Estimated time</strong> set to <i>1.00 h</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-5457" class="journal has-notes">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4737">Martin Ramshaw</a> <a title="26 Aug 2016 00:00" href="/projects/exiv2/activity?from=2016-08-26">about 5 years</a> ago
      <span id="journal-5457-private_notes" class=""></span>
    </h4>

    <div id="journal-5457-notes" class="wiki"><p>What has been proposed is only a work-around, not a fix.</p>


	<p>It appears this has all but been marked 'closed' even so.</p>


	<p>I applaud the attempt to enable savvy users to be able to<br />shortcut the lengthy release cycle of this project. This<br />issue of device ids, etc. is a pretty old one but this is<br />hardly a high-priority project. USB ids for instance need<br />a pretty rapid turn-around. Not carping, just a comment!</p>


	<p>I'd suggest that the target be changed to 0.27 as well,<br />as it looks like 0.26 is in 'code freeze' while you guys<br />try to catch up to the announced release date.</p>


	<p>Interestingly enough, I have had a lot of similiar ideas<br />myself in relation to LensFun; I only own a few lenses and<br />I can make my own profiles (in fact, I'd prefer to do so)<br />which I would like to apply in preference to the profiles<br />supplied by LensFun. But I digress.</p>


	<p>let me know what the projected 0.26 release date is, maybe<br />I can test and submit a patch by then. Or not. As you like.</p></div>
    </div>
  </div>
  
  <div id="change-5459" class="journal has-notes">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="26 Aug 2016 08:12" href="/projects/exiv2/activity?from=2016-08-26">about 5 years</a> ago
      <span id="journal-5459-private_notes" class=""></span>
    </h4>

    <div id="journal-5459-notes" class="wiki"><p>Martin</p>


	<p>There is no fix for lens recognition when the manufacturer has used a LensID for more than one lens.  When the lens is not unique, we have to inspect other metadata to deduce the lens in use. This is unsatisfactory.  It is a guess.</p>


	<p>The work-around by having the ~/.exiv2 file is a sensible feature.  About 50% of issues reported to Exiv2 concern lens recognition and giving the user a way have his lens recognised saves everybody unhappiness.  And it's instant.  Nobody has to wait on a new release of software and the lens is known to every application using libexiv2.</p>


	<p>The status of v0.26 is here and updated yesterday.  This page is frequently updated:  <a class="external" href="http://dev.exiv2.org/news/2">http://dev.exiv2.org/news/2</a></p>


	<p>There is no point in assigning this to v0.27 as I don't want to spend further time on this.  If however you wish to provide a test file and a code patch to correctly deduce your lens, I'll be happy to review and consider it for either v0.26 and v0.27.</p></div>
    </div>
  </div>
  
  <div id="change-5462" class="journal has-notes">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4737">Martin Ramshaw</a> <a title="27 Aug 2016 00:50" href="/projects/exiv2/activity?from=2016-08-27">about 5 years</a> ago
      <span id="journal-5462-private_notes" class=""></span>
    </h4>

    <div id="journal-5462-notes" class="wiki"><p>I had a feeling things were not going to be all that simple.</p>


	<p>Command-line works, darktable (re-compiled) not so much:</p>


	<p>kuby@Work:~/Documents/exiv2$ !1269<br />grep exiv2 exiv2.trace <br />execve("/usr/local/bin/exiv2", ["exiv2", "-pt", "IMG_0353.CR2"], [/* 67 vars */]) = 0<br />open("/usr/local/lib/libexiv2.so.14", O_RDONLY|O_CLOEXEC) = 3<br />open("/usr/local/share/locale/en_CA/LC_MESSAGES/exiv2.mo", O_RDONLY) = -1 ENOENT (No such file or directory)<br />open("/usr/local/share/locale/en/LC_MESSAGES/exiv2.mo", O_RDONLY) = -1 ENOENT (No such file or directory)<br />open("/usr/share/locale-langpack/en_CA/LC_MESSAGES/exiv2.mo", O_RDONLY) = 3<br />open("/usr/share/locale-langpack/en/LC_MESSAGES/exiv2.mo", O_RDONLY) = -1 ENOENT (No such file or directory)<br />open("/home/kuby/.exiv2", O_RDONLY)     = 3<br />open("/home/kuby/.exiv2", O_RDONLY)     = 3<br />kuby@Work:~/Documents/exiv2$ grep exiv2 darktable.trace <br />open("/opt/darktable/bin/../lib/darktable/libexiv2.so.14", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)<br />open("/usr/local/lib/libexiv2.so.14", O_RDONLY|O_CLOEXEC) = 3<br />stat("/home/kuby/Documents/exiv2/IMG_0353.CR2", {st_mode=S_IFREG|0644, st_size=21815367, ...}) = 0<br />stat("/home/kuby/Documents/exiv2/IMG_0353.CR2", {st_mode=S_IFREG|0644, st_size=21815367, ...}) = 0<br />access("/home/kuby/Documents/exiv2/IMG_0353.CR2.xmp", F_OK) = 0<br />open("/home/kuby/Documents/exiv2/IMG_0353.CR2.xmp", O_RDONLY) = 29<br />stat("/home/kuby/Documents/exiv2/IMG_0353.CR2.xmp", {st_mode=S_IFREG|0664, st_size=2644, ...}) = 0<br />open("/home/kuby/Documents/exiv2/IMG_0353.CR2.xmp", O_WRONLY|O_CREAT|O_TRUNC, 0666) = 29<br />kuby@Work:~/Documents/exiv2$ cat <sub>/.exiv2 <br />[canon]<br />150=Sigma 18-35mm f/1.8 DC HSM [A]<br />kuby@Work:</sub>/Documents/exiv2$ !1289<br />exiv2 -pt IMG_0353.CR2 | grep -ai lens<br />Exif.CanonCs.LensType                        Short       1  Sigma 18-35mm f/1.8 DC HSM [A]<br />Exif.CanonCs.Lens                            Short       3  18.0 - 35.0 mm<br />Exif.Canon.LensModel                         Ascii      74  18-35mm<br />Exif.Photo.LensSpecification                 Rational    4  18/1 35/1 0/1 0/1<br />Exif.Photo.LensModel                         Ascii       8  18-35mm<br />Exif.Photo.LensSerialNumber                  Ascii      11  0000000000<br />kuby@Work:~/Documents/exiv2$</p>


	<p>As you can see from the traces above, darktable doesn't read ".exiv2".</p>


	<p>Without knowing the details of the library code involved, this may or<br />may not be correct, feedback is welcome.</p></div>
    </div>
  </div>
  
  <div id="change-5463" class="journal has-notes">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4737">Martin Ramshaw</a> <a title="27 Aug 2016 01:22" href="/projects/exiv2/activity?from=2016-08-27">about 5 years</a> ago
      <span id="journal-5463-private_notes" class=""></span>
    </h4>

    <div id="journal-5463-notes" class="wiki"><p>Okay, never mind, this appears to have been a darktable problem rather an exiv2 problem.</p>


	<p>recompiled ufraw works as expected:</p>


	<p>kuby@Work:~/Documents/exiv2/ufraw-0.22$ strace ufraw 2> ufraw.trace<br />kuby@Work:~/Documents/exiv2/ufraw-0.22$ grep exiv2 ufraw.trace <br />open("/usr/local/lib/libexiv2.so.14", O_RDONLY|O_CLOEXEC) = 3<br />stat("/home/kuby/Documents/exiv2/ufraw-0.22", {st_mode=S_IFDIR|0775, st_size=4096, ...}) = 0<br />open("/home/kuby/Documents/exiv2/IMG_0353.CR2", O_RDONLY) = 5<br />open("/home/kuby/Documents/exiv2/IMG_0353.CR2", O_RDONLY) = 6<br />stat("/home/kuby/Documents/exiv2/IMG_0353.CR2", {st_mode=S_IFREG|0644, st_size=21815367, ...}) = 0<br />stat("/home/kuby/Documents/exiv2/IMG_0353.CR2", {st_mode=S_IFREG|0644, st_size=21815367, ...}) = 0<br />stat("/home/kuby/Documents/exiv2/IMG_0353.CR2", {st_mode=S_IFREG|0644, st_size=21815367, ...}) = 0<br />open("/home/kuby/Documents/exiv2/IMG_0353.CR2", O_RDONLY) = 6<br />stat("/home/kuby/Documents/exiv2/IMG_0353.CR2", {st_mode=S_IFREG|0644, st_size=21815367, ...}) = 0<br />open("/home/kuby/Documents/exiv2/IMG_0353.CR2", O_RDONLY) = 6<br />stat("/home/kuby/Documents/exiv2/IMG_0353.CR2", {st_mode=S_IFREG|0644, st_size=21815367, ...}) = 0<br />stat("/home/kuby/Documents/exiv2/IMG_0353.CR2", {st_mode=S_IFREG|0644, st_size=21815367, ...}) = 0<br />stat("/home/kuby/Documents/exiv2/IMG_0353.CR2", {st_mode=S_IFREG|0644, st_size=21815367, ...}) = 0<br />open("/home/kuby/.exiv2", O_RDONLY)     = 6<br />open("/home/kuby/.exiv2", O_RDONLY)     = 6<br />open("/usr/local/share/locale/en_CA/LC_MESSAGES/exiv2.mo", O_RDONLY) = -1 ENOENT (No such file or directory)<br />open("/usr/local/share/locale/en/LC_MESSAGES/exiv2.mo", O_RDONLY) = -1 ENOENT (No such file or directory)<br />open("/usr/share/locale-langpack/en_CA/LC_MESSAGES/exiv2.mo", O_RDONLY) = 6<br />open("/usr/share/locale-langpack/en/LC_MESSAGES/exiv2.mo", O_RDONLY) = -1 ENOENT (No such file or directory)<br />stat("/home/kuby/Documents/exiv2/ufraw-0.22", {st_mode=S_IFDIR|0775, st_size=4096, ...}) = 0<br />lstat("/home/kuby/Documents/exiv2/IMG_0353.png", 0x7ffdf4594b80) = -1 ENOENT (No such file or directory)<br />lstat("/home/kuby/Documents/exiv2/IMG_0353.png", 0x7ffdf4594750) = -1 ENOENT (No such file or directory)<br />lstat("/home/kuby/Documents/exiv2/IMG_0353.png", 0x7ffdf45920e0) = -1 ENOENT (No such file or directory)<br />getcwd("/home/kuby/Documents/exiv2/ufraw-0.22", 48) = 38<br />open("/home/kuby/Documents/exiv2/ufraw-0.22/.badpixels", O_RDONLY) = -1 ENOENT (No such file or directory)<br />open("/home/kuby/Documents/exiv2/.badpixels", O_RDONLY) = -1 ENOENT (No such file or directory)<br />lstat("/home/kuby/Documents/exiv2/IMG_0353.png", 0x7ffdf4593dd0) = -1 ENOENT (No such file or directory)<br />kuby@Work:~/Documents/exiv2/ufraw-0.22$</p></div>
    </div>
  </div>
  
  <div id="change-5464" class="journal has-notes">
    <div id="note-8">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-8" class="journal-link">#8</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="27 Aug 2016 12:49" href="/projects/exiv2/activity?from=2016-08-27">about 5 years</a> ago
      <span id="journal-5464-private_notes" class=""></span>
    </h4>

    <div id="journal-5464-notes" class="wiki"><p>Martin</p>


	<p>You have to be sure that DT (or any application) is using a version of the library which contains the code to read ~/.exiv2  You can see libraries used by an application with the utility <strong><code> lsof </code></strong>.   I've discussed this with somebody here:  <a class="external" href="http://dev.exiv2.org/issues/1181#note-2">http://dev.exiv2.org/issues/1181#note-2</a></p>


	<p>Please be aware that trunk builds of libexiv2 can cause problems with shipping binary versions of applications.  To use trunk builds of libexiv2 with an application, I recommend totally rebuilding the application using exiv2 header files for that version of libexiv2.  Rebuilding everything is a messy chore.</p>


	<p>To avoid the burden of rebuilding applications, Pascal (he of DT fame) cherry picks the Exiv2 codebase and maintains libexiv2 v0.25 binaries which contain some v0.26 lens code.  This is discussed here.  <a class="external" href="http://dev.exiv2.org/issues/1181#note-7">http://dev.exiv2.org/issues/1181#note-7</a></p></div>
    </div>
  </div>
  
  <div id="change-5467" class="journal has-notes">
    <div id="note-9">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-9" class="journal-link">#9</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4737">Martin Ramshaw</a> <a title="27 Aug 2016 19:16" href="/projects/exiv2/activity?from=2016-08-27">about 5 years</a> ago
      <span id="journal-5467-private_notes" class=""></span>
    </h4>

    <div id="journal-5467-notes" class="wiki"><p>Not sure who Tim is, but you should let him know that when someone<br />says they have recompiled an application it probably means just that.</p>


	<p>Also, let him know that 'ldd' is more useful than 'lsof' for libraries:</p>


	<p>kuby@Work:~$ ldd /opt/darktable/bin/darktable | grep exiv2<br />        libexiv2.so.14 => /usr/local/lib/libexiv2.so.14 (0x00007fcd551f7000)<br />kuby@Work:~$ ldd /usr/bin/darktable | grep exiv2<br />        libexiv2.so.12 => /usr/lib/libexiv2.so.12 (0x00007f2b30e82000)<br />kuby@Work:~$</p>


	<p>Finally, let him know that if a library is in /usr/local/lib it is probably<br />a WIP testing library that has been compiled there specifically.</p>


	<p>[Also, when one is planning to fix some code, one really needs the source.<br /> Compiled binaries are not particularly useful for this purpose.]</p></div>
    </div>
  </div>
  
  <div id="change-5468" class="journal has-notes">
    <div id="note-10">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-10" class="journal-link">#10</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="27 Aug 2016 19:36" href="/projects/exiv2/activity?from=2016-08-27">about 5 years</a> ago
      <span id="journal-5468-private_notes" class=""></span>
    </h4>

    <div id="journal-5468-notes" class="wiki"><p>Are we having a bad day, Martin?  Apologies for calling you Tim.</p>


	<p>I regret that I've said something amiss and you clearly did rebuild everything from source.  It does however happen that folks recompile libexiv2 and encounter issues with binary distributions of applications.  I see that you have understood that trap and done what's required to avoid it.</p>


	<p>I'm not sure that ldd and lsof are alternatives.  ldd reports information from an executable.  lsof reports open files in memory.  Both are useful in different ways.</p></div>
    </div>
  </div>
  
  <div id="change-5472" class="journal has-details">
    <div id="note-11">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-11" class="journal-link">#11</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="27 Aug 2016 20:39" href="/projects/exiv2/activity?from=2016-08-27">about 5 years</a> ago
      <span id="journal-5472-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Closed</i></li>
       <li><strong>Estimated time</strong> changed from <i>1.00 h</i> to <i>2.00 h</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-5475" class="journal has-notes">
    <div id="note-12">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-12" class="journal-link">#12</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4737">Martin Ramshaw</a> <a title="28 Aug 2016 00:48" href="/projects/exiv2/activity?from=2016-08-28">about 5 years</a> ago
      <span id="journal-5475-private_notes" class=""></span>
    </h4>

    <div id="journal-5475-notes" class="wiki"><p>Well, the bug was assigned to Thomas. Tim <strong>could</strong> be short for Thomas.</p>


	<p>Sorry if I came across as snarky, you didn't seem to have actually read<br />the bug report so I felt compelled to prove that I know what I'm doing.</p>


	<p>I think we can agree that the nice thing about *nix is a full set of tools.<br />I have used 'lsof' in the past but it's definitely not high on my list.</p>


	<p>I have been acquainted with Pascal for many years and am very grateful<br />for his PPA and other work. However:</p>
	<pre><code><a class="external" href="http://www.darktable.org/2015/02/on-lens-detection-and-correction/">http://www.darktable.org/2015/02/on-lens-detection-and-correction/</a></code></pre>


	<p>In this article it seems that by getting a lens added to 'exiv2' that<br />LensFun correction will then work.</p>


	<p>Not so.</p>


	<p>From my recent tests, 'ufraw' will do a fuzzy search of the LensFun<br />database and will operate correctly - this does not depend on exiv2.</p>


	<p>'darktable' will do a fuzzy search also but does not get it right.<br />Not sure how or what DT is doing, but as 'ufraw' can work correctly<br />it would seem to be a matter of replicating the 'ufraw' code in DT.<br />I have had a look but got lost in the callbacks. Initially it was<br />an idea of mine to try and find the libexiv2 API, but that seems<br />unnecessary now.</p>


	<p>Likewise 'gimplensfun' and 'digikam' (have not tested these two<br />with the latest exiv2) do not correctly determine the lens either.</p>


	<p>Things could be worse on my part: I could have spent time coming<br />up with a patch to hardcode the various third-party lenses. But I<br />expect this would have been fragile - if not unmaintainable - and<br />not particularly welcome.</p>


	<p>There are good reasons why third-party lens manufacturers will wish<br />to re-use Canon lens ids, so this is a problem that will probably<br />continue to get worse. However the exiv2.ini idea seems a good<br />work-around.</p>


	<p>Congratulations on avoiding the urge to over-engineer the exiv2.ini<br />file. However I suspect that these will not be portable between *nix<br />and Windows due to the '\r\n' versus '\n' issue. But I may be wrong.</p></div>
    </div>
  </div>
  
  <div id="change-5477" class="journal has-notes">
    <div id="note-13">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-13" class="journal-link">#13</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="28 Aug 2016 07:08" href="/projects/exiv2/activity?from=2016-08-28">about 5 years</a> ago
      <span id="journal-5477-private_notes" class=""></span>
    </h4>

    <div id="journal-5477-notes" class="wiki"><p>Lots of useful information here, Martin.  And thank you for your private email.  I did read your notes <code>#6 and #7</code> above, however I didn't understand your message.  So I tried to keep you out of trouble by letting you know about related conversations.</p>


	<p>You're right about the "nix" line-endings.  The code uses library function <em><strong><code>fgets(...)</code></strong></em> to read lines from the .ini file.  On the Mac, that handles UNIX (\n) and Windows (\r\n) and doesn't handle Mac (\r) lines. MSVC, Cygwin and Linux behave the same.</p>


	<p>The src/ini.cpp code can use a local function instead of <em><strong><code>fgets(...)</code></strong></em>.  I'm not going to do anything about this for v0.26 and probably never will.  The "Mac Legacy \r" line-ending is a long buried relic.  I've updated <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Camera accessory overflow file (Closed)" href="/issues/1034">#1034</a> about this and some other caveats concerning the format of that file.  <a class="external" href="http://dev.exiv2.org/issues/1034#note-24">http://dev.exiv2.org/issues/1034#note-24</a></p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/1212.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/1212.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
