<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #1254: Cannot recognize Canon 16-35 f/4 IS L - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="6adxM43HYKsb1md8IILBlarG1TTFMPxk5NorxTvi4ScL6trc/72sq06yeHCfVc2mlVSBTTTTXd4Z+rtNeNsGSA==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #1254: Cannot recognize Canon 16-35 f/4 IS L" href="https://dev.exiv2.org/issues/1254.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #1254</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Cannot recognize Canon 16-35 f/4 IS L</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/4841">Niccolò Belli</a> <a title="14 Nov 2016 14:34" href="/projects/exiv2/activity?from=2016-11-14">about 5 years</a> ago.
        Updated <a title="14 Nov 2016 23:21" href="/projects/exiv2/activity?from=2016-11-14">about 5 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/119">Robin Mills</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">lens</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="28 Apr 2017" href="/versions/52">0.26</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">14 Nov 2016</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value">2.00 h</div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Darktable developers suggested the bug was upstream: <a class="external" href="https://redmine.darktable.org/issues/11315">https://redmine.darktable.org/issues/11315</a><br />I attached the raw file.</p>


	<p>$ pacaur -Ss exiv2 | grep install<br />extra/exiv2 0.25-3 [installato]                                                                                                                                                                                                                              <br />extra/libkexiv2 16.08.3-1 [installato]                                                                                                                                                                                                                       <br />extra/libkexiv2_4 15.08.3-2 [installato]</p>


	<p>OS is Archlinux.</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1109">IMG_0589.CR2</a>    <span class="size">(12.2 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1109/IMG_0589.CR2">IMG_0589.CR2</a>  </td>
  <td></td>
  <td>
      <span class="author">Niccolò Belli, 14 Nov 2016 14:34</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>








</div>




<div id="history">
<h3>History</h3>
  <div id="change-5750" class="journal has-notes has-details">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Nov 2016 15:00" href="/projects/exiv2/activity?from=2016-11-14">about 5 years</a> ago
      <span id="journal-5750-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Category</strong> set to <i>lens</i></li>
       <li><strong>Status</strong> changed from <i>New</i> to <i>Closed</i></li>
       <li><strong>Assignee</strong> set to <i>Robin Mills</i></li>
       <li><strong>Target version</strong> set to <i>0.26</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
       <li><strong>Estimated time</strong> set to <i>1.00 h</i></li>
    </ul>
    <div id="journal-5750-notes" class="wiki"><p>This is not a bug!  Please see <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Detect Sigma 120-300 EX on Canon (Closed)" href="/issues/1252">#1252</a> for a discussion.</p>


	<p>There's a new feature in Exiv2 v0.26 to add the definition of a lens to the file ~/.exiv2 <pre>$ exiv2 -pa --grep lens/i ~/Downloads/IMG_0589.CR2 
Exif.CanonCs.LensType                        Short       1  (0)
Exif.CanonCs.Lens                            Short       3  16.0 - 35.0 mm
Exif.CanonCf.LensAFStopButton                Short       1  2049
Exif.Canon.LensModel                         Ascii      64  

$ exiv2 -pv --grep lens/i ~/Downloads/IMG_0589.CR2 
0x0016 CanonCs      LensType                    Short       1  0   &lt;---- This is your lensID
0x0017 CanonCs      Lens                        Short       3  35 16 1
0x0009 CanonCf      LensAFStopButton            Short       1  2049
0x0095 Canon        LensModel                   Ascii      64  
$ cat ~/.exiv2 
[canon]
# 247=Samyang 14mm f/2.8 AE ED AS IF UMC
# 65535=The lens in issue 1251
0=Canon 16-35 f/4 IS L  &lt;--- ADD Your lens definition here

[nikon]
# 146=Robin's Sigma Lens

[pentax]
# 3 255 0 0=another pentax lens

[minolta]
# 255=a sony lens

[olympus]
# 123=something

$ exiv2 -pa --grep lens/i ~/Downloads/IMG_0589.CR2 
Exif.CanonCs.LensType                        Short       1  Canon 16-35 f/4 IS L  &lt;--- Good, eh?
Exif.CanonCs.Lens                            Short       3  16.0 - 35.0 mm
Exif.CanonCf.LensAFStopButton                Short       1  2049
Exif.Canon.LensModel                         Ascii      64  
$ </pre>Exiv2 v0.26 status is currently <em><strong>Release Candidate</strong></em> and I hope it will ship in 2016.  Darktable will include Exiv2 v0.26 sometime in 2017.</p></div>
    </div>
  </div>
  
  <div id="change-5751" class="journal has-notes">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/3771">Roman Lebedev</a> <a title="14 Nov 2016 15:44" href="/projects/exiv2/activity?from=2016-11-14">about 5 years</a> ago
      <span id="journal-5751-private_notes" class=""></span>
    </h4>

    <div id="journal-5751-notes" class="wiki"><p>Robin Mills wrote:</p>


<blockquote>

	<p>Darktable will include Exiv2 v0.26 sometime in 2017.</p>


</blockquote>

	<p>Hm? We do not include exiv2. We do not bundle it. We use whatever version is present in the system.</p></div>
    </div>
  </div>
  
  <div id="change-5752" class="journal has-notes">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Nov 2016 15:48" href="/projects/exiv2/activity?from=2016-11-14">about 5 years</a> ago
      <span id="journal-5752-private_notes" class=""></span>
    </h4>

    <div id="journal-5752-notes" class="wiki"><p>You are correct.  Darktable uses the system supplied version of Exiv2. That will be updated to v0.26 during 2017.</p></div>
    </div>
  </div>
  
  <div id="change-5753" class="journal has-notes">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4841">Niccolò Belli</a> <a title="14 Nov 2016 15:57" href="/projects/exiv2/activity?from=2016-11-14">about 5 years</a> ago
      <span id="journal-5753-private_notes" class=""></span>
    </h4>

    <div id="journal-5753-notes" class="wiki"><p>You suggested to manually add my lens to the database, does it mean that v0.26 will ship without Canon 16-35 f/4 IS L support out of the box?</p></div>
    </div>
  </div>
  
  <div id="change-5754" class="journal has-notes">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Nov 2016 16:03" href="/projects/exiv2/activity?from=2016-11-14">about 5 years</a> ago
      <span id="journal-5754-private_notes" class=""></span>
    </h4>

    <div id="journal-5754-notes" class="wiki"><p><a class="external" href="http://dev.exiv2.org/projects/exiv2/wiki/Lens_Recognition_in_Exiv2_v026_(and_later)/">http://dev.exiv2.org/projects/exiv2/wiki/Lens_Recognition_in_Exiv2_v026_(and_later)/</a></p></div>
    </div>
  </div>
  
  <div id="change-5755" class="journal has-notes has-details">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Nov 2016 16:09" href="/projects/exiv2/activity?from=2016-11-14">about 5 years</a> ago
      <span id="journal-5755-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Estimated time</strong> changed from <i>1.00 h</i> to <i>2.00 h</i></li>
    </ul>
    <div id="journal-5755-notes" class="wiki"><p>Lens recognition is a problem because most manufacturers do no store metadata to define the lens in the image.</p>


	<p>In your test file, the LensModel stored by the camera is 64 null bytes.  Exiv2 has code to guess which lens is being used.  Not only is this unreliable, it results in many issue reports and work for Team Exiv2.  Additionally, when we add new lens recognition code, it takes time for the update to our code to reach our users.</p>


	<p>To avoid frustration for everybody, I have added the ~/.exiv2 feature.  This enables users to add their lens to the system without a bug report to us and to add it instantly on their computer without a software update.</p></div>
    </div>
  </div>
  
  <div id="change-5756" class="journal has-notes">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4841">Niccolò Belli</a> <a title="14 Nov 2016 16:13" href="/projects/exiv2/activity?from=2016-11-14">about 5 years</a> ago
      <span id="journal-5756-private_notes" class=""></span>
    </h4>

    <div id="journal-5756-notes" class="wiki"><p>This is a <strong>TERRIBLE</strong> news, didn't know the manufacters were so stupid.<br />Just a few questions:<br />1) How does softwares like Lightroom handle such collision issues?<br />2) How does software like Darktable will handle the situation once v0.26 and future versions get released? Will they drop features like automatic lens correction which rely on exiv decoding?</p></div>
    </div>
  </div>
  
  <div id="change-5757" class="journal has-notes">
    <div id="note-8">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-8" class="journal-link">#8</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Nov 2016 18:04" href="/projects/exiv2/activity?from=2016-11-14">about 5 years</a> ago
      <span id="journal-5757-private_notes" class=""></span>
    </h4>

    <div id="journal-5757-notes" class="wiki"><p>I think this is <em><strong>WONDERFUL</strong></em> news.  I've given darktable and other applications a mechanism for the users to register their lenses without waiting for exiv2 to go through a release cycle.</p>


	<p>I wish manufacturers would correctly and uniquely record the lens in the metadata.  I don't know why they don't improve this feature of their cameras.  It may be that most cameras ship in advance of new lenses.  So the camera cannot recognise a new lens that is released after the camera.</p>


	<p>I worked for Adobe for many years in Silicon Valley.  I never worked on anything relating to metadata or LightRoom.</p>


	<p>At the moment, I frequently update Exiv2 with new lenses.  So Exiv2 v0.26 does ship with an up-to-date database of lenses.  We might continue to update the lens recognition code in v0.27 and beyond - however it depends on the response of darktable and other applications to having the ~/.exiv2 feature.</p>


	<p>We have an issue on the agenda for v0.27 to use all 7000 images in Phil's test suite.  This matter isn't dead with v0.26.  It is intended to give it more attention and to improve our RAW support and test.  So, we're not walking away.  The ~/.exiv2 feature is an investment to help everybody.  More work will follow.</p>


	<p>I try very hard to give our users the best tools and features.  If there is a strong demand to continuously add new "built in" lenses, I will try to support that.  However if ~/.exiv2 is a success, demand for us to guess the lens may disappear.  And perhaps darktable will manage the ~/.exiv2 file on behalf of the user.  If an unrecognised lens is used, darktable could alert the user, and update ~/.exiv2 in a very painless manner.</p>


	<p>So --- cheer up --- everything will work out fine!</p></div>
    </div>
  </div>
  
  <div id="change-5759" class="journal has-notes">
    <div id="note-9">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-9" class="journal-link">#9</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4841">Niccolò Belli</a> <a title="14 Nov 2016 23:21" href="/projects/exiv2/activity?from=2016-11-14">about 5 years</a> ago
      <span id="journal-5759-private_notes" class=""></span>
    </h4>

    <div id="journal-5759-notes" class="wiki"><p>Hopefully you will keep updating the built in lenses database, which combined to the new approach would probably be the best solution. Thanks for your detailed answer.</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/1254.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/1254.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
