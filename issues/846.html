<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #846: Porting the Video Code to MSVC (umbrella) - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="6G5xvdSIOjK+ww1Ku4kwSGmnbDoN9SzjYO1B3CGe0v4KI9pSpvL2MuunEkYEXjx7VjU4Q/wWjVmdzdFUYqc1kQ==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #846: Porting the Video Code to MSVC (umbrella)" href="https://dev.exiv2.org/issues/846.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #846</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Porting the Video Code to MSVC (umbrella)</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Sep 2012 00:30" href="/projects/exiv2/activity?from=2012-09-03">about 9 years</a> ago.
        Updated <a title="24 Jul 2013 15:25" href="/projects/exiv2/activity?from=2013-07-24">over 8 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/119">Robin Mills</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">build</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="31 Jul 2013" href="/versions/50">0.24</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">02 Sep 2012</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-80"><tr><td style="width: 80%;" class="closed" title="80%"></td><td style="width: 20%;" class="todo"></td></tr></table><p class="percent">80%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Abhinav</p>


	<p>I'm porting your code to MSVC (32 and 64 bit).  Let's use this issue to track our progress (that's what "umbrella" means)</p>


	<p>Good News:<br />I've got everything to compile and link (32/64 static/DLL Release/Debug)  You're code's very clear and well formatted.  Good Job!</p>


	<p>Ungood News:<br />I've had to throw a lot of casts for (size_t) and (long) into your code.  I'm rather bothered by this.  I think the main issue is that the I/O APIs use long and maybe they should be size_t or possibly uint64_t.  For example: io->read(), io->seek().  For images, I think it would be rather unusual to have a HUGE (>2Gbyte) file, for video this could be common.  However changing the I/O APIs will require lots of changes elsewhere in the code AND will impact user applications.  Ummmm.  I really ought to ask Andreas for this opinion about this.</p>


	<p>From here:<br />I'll probably post a patch here tomorrow to show you what I've done.  It's mid-night here and I'm off to bed.  Tomorrow (Labor Day Holiday), I'll run the test suite on Windows and try the patch on Mac/Linux to see what happens.</p>


	<p>Anyway, I'm wondering how much time you have to work with me on this?  Are you available - or busy with something else?</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/396">shawn_test_result.txt</a>    <span class="size">(8.31 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/396/shawn_test_result.txt">shawn_test_result.txt</a>  </td>
  <td></td>
  <td>
      <span class="author">Shawn Jean, 18 Sep 2012 01:36</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>








</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 2934" href="/projects/exiv2/repository/exiv2/revisions/2934">Revision 2934</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/2934/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="04 Nov 2012 01:02" href="/projects/exiv2/activity?from=2012-11-04">about 9 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p>Fix: <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Porting the Video Code to MSVC (umbrella) (Closed)" href="/issues/846">#846</a>. Fix for video-test errors (about aspectRatio) on MSVC 2003. See <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Porting the Video Code to MSVC (umbrella) (Closed)" href="/issues/846">#846</a> message 20 for discussion.</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-2218" class="journal has-notes">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/3290">Abhinav Badola</a> <a title="03 Sep 2012 12:04" href="/projects/exiv2/activity?from=2012-09-03">about 9 years</a> ago
      <span id="journal-2218-private_notes" class=""></span>
    </h4>

    <div id="journal-2218-notes" class="wiki"><p>Hi Robin,</p>


<blockquote>

	<p>Anyway, I'm wondering how much time you have to work with me on this?  Are you available - or busy with something else?</p>


</blockquote>

	<p>I will try my best to keep up with all the coding that is required in the concerned bug. Honestly, I have no knowledge about porting the code to MSVC environment, but you may guide me through the process, I assure you that I will catch up and learn quickly. <br />Though I wont be able to be available all the time, due to college classes and assignments, but I will try my best to contribute to the code as and when I get time. I am generally free on weekends and I can work on the code during weekends.</p></div>
    </div>
  </div>
  
  <div id="change-2219" class="journal has-notes">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Sep 2012 13:47" href="/projects/exiv2/activity?from=2012-09-03">about 9 years</a> ago
      <span id="journal-2219-private_notes" class=""></span>
    </h4>

    <div id="journal-2219-notes" class="wiki"><p>Thanks for getting back to me.  You don't need to know anything about MSVC.  However I hope you'll be able to review changes I make to your code.  I don't expect to need much of your time.</p>


	<p>I've been looking at this again today.  I can't get the code base to build on Linux/Cygwin/Mac.  I ran my MSVC build (from last night) on the test suite and got hundreds of errors.</p>


	<p>I think I'll do nothing about MSVC for the moment.  It only took 2-3 hours last night to update your code to build and link (both 32 and 64 bit).  I'll put the porting project on hold until the linux (and mac and cygwin) builds are stable and passing the test suite.  When we're rock stable, I'll discuss the 64 bit I/O API with Andreas.  If that's added, I suspect your code will only require minor changes.</p>


	<p>So... I'm glad you are available.  That's good to know.  Rest assured, I don't want much of your time (probably only a few hours).  I think it might be a little time (a month or two) before I return to this matter.</p></div>
    </div>
  </div>
  
  <div id="change-2220" class="journal has-details">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Sep 2012 16:36" href="/projects/exiv2/activity?from=2012-09-03">about 9 years</a> ago
      <span id="journal-2220-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Assignee</strong> changed from <i>Abhinav Badola</i> to <i>Robin Mills</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-2222" class="journal has-notes">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="03 Sep 2012 19:03" href="/projects/exiv2/activity?from=2012-09-03">about 9 years</a> ago
      <span id="journal-2222-private_notes" class=""></span>
    </h4>

    <div id="journal-2222-notes" class="wiki"><p>Abhinav, "porting" here simply means (a) to make the code compile on MSVC and (b) to update the MSVC build scripts. For (a) I expected pretty much exactly what Robin said in his report. The MSVC compiler is more verbose about type conversions than g++ (it issues warnings) and since we have warnings set to errors in the MSVC build environment we need to fix them all. That's a good thing. I don't think there is a need for any Windows specific code, we already have that covered where necessary for this (e.g., IO, charset conversion).</p>


	<p>Robin, I'm fine if you just add casts for now, just please use C++ casts, so we can find them more easily. I've discussed the type correctness issue with Abhinav before, we're aware that this needs work and have started looking at this. Your comment about the IO functions using long instead of size_t also came up I think. It's like this for historic reasons (even some of the underlying C functions use long), I prefer to stick with what we have rather than change the IO interface (that may trigger a tsunami even within the library). That means there will be some casts left eventually (just like elsewhere in the code), as long as we can minimize them and know why we need each of them I'm ok.</p>


	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-2223" class="journal has-notes">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Sep 2012 21:58" href="/projects/exiv2/activity?from=2012-09-03">about 9 years</a> ago
      <span id="journal-2223-private_notes" class=""></span>
    </h4>

    <div id="journal-2223-notes" class="wiki"><p>Andreas:<br />I share your concern about the 64 bit I/O, so let's leave it at 32bit.  I'll do the port again (in a few weeks) with C++ casts and I expect that to be quite straight-forward.</p></div>
    </div>
  </div>
  
  <div id="change-2224" class="journal has-notes">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/3290">Abhinav Badola</a> <a title="05 Sep 2012 10:52" href="/projects/exiv2/activity?from=2012-09-05">about 9 years</a> ago
      <span id="journal-2224-private_notes" class=""></span>
    </h4>

    <div id="journal-2224-notes" class="wiki"><p>All right..!! <br />I am in for the job whenever I am needed.</p></div>
    </div>
  </div>
  
  <div id="change-2231" class="journal has-notes">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Sep 2012 19:58" href="/projects/exiv2/activity?from=2012-09-14">about 9 years</a> ago
      <span id="journal-2231-private_notes" class=""></span>
    </h4>

    <div id="journal-2231-notes" class="wiki"><p>I've updated the project files in the msvc and msvc64 directories SVN:2875.</p>


	<p>msvc:<br />builds and passes the sanity test (runner.bat).<br />doesn't do well on the test suite (cygwin/unix/mac aren't good at present either)</p>


	<p>msvc64:<br />32 bit builds are OK (and pass sanity)<br />64 bit builds do not compile (so cannot be tested)</p>


	<p>The problems with msvc64/64 bit are related to 32/64 bit APIs.</p>


	<p>I have been able to get the code to compile I using many casts (100s of them).  Andreas has requested that we use C++ casts as they are easier to identify in the code (for review and future elimination).  I've had another couple of thoughts about this:<br />1) Introduce 64 bit I/O API's for MSVC only in the header files.<br />- use #if _MSC_VER ... #endif to reveal them to MSVC<br />- put inline functions in the header files to do the downcasting<br />- don't change anything in the C++ files</p>


	<p>2) Use a MACRO to define a cast (or casts).  The exact contents of the cast can be changed without disturbing the code.</p>


	<p>Approach (1) is elegant if can be made to work.  It means that MSVC related changes are local and easily identified.  Changes to the CPP code can be made without having to think "what about MSVC".</p>


	<p>Shawn has offered to work on this task.  Shawn - welcome to the team.</p></div>
    </div>
  </div>
  
  <div id="change-2232" class="journal has-notes">
    <div id="note-8">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-8" class="journal-link">#8</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="18 Sep 2012 00:18" href="/projects/exiv2/activity?from=2012-09-18">about 9 years</a> ago
      <span id="journal-2232-private_notes" class=""></span>
    </h4>

    <div id="journal-2232-notes" class="wiki"><p>Shawn sent me a very nice patch file with changes.  All changes were C++ casts.  A very nice job.   Thank you, Shawn.</p>


	<p>I've reviewed and simplified Shawn's changes by defining MSVC specific 32 bit functions in basicio.hpp (as discussed in #7 above).  This reduced the number of changed files.  It compiles, so I've submitted this SVN:2879.  I'll test it in the next couple of days.</p>


	<p>C:\gnu.video\exiv2\src>svn status <del>q | sort<br />M       asfvideo.cpp        <-</del> Abhinav please review <br />M       basicio.cpp         <-- Shawn's changes<br />M       basicio.hpp         <-- Robin added new seek functions<br />M       jp2image.cpp        <-- Shawn added a cast<br />M       matroskavideo.cpp   <-- Abhinav please review<br />M       quicktimevideo.cpp  <-- Abhinav please review<br />M       riffvideo.cpp       <-- Abhinav please review</p>


	<p>Abhinav:<br />Can you review the changes in your files, please?  There are some changes to offsets in arrays that surprise me.</p>


	<p>Robin</p></div>
    </div>
  </div>
  
  <div id="change-2233" class="journal has-notes has-details">
    <div id="note-9">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-9" class="journal-link">#9</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/3650">Shawn Jean</a> <a title="18 Sep 2012 01:36" href="/projects/exiv2/activity?from=2012-09-18">about 9 years</a> ago
      <span id="journal-2233-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/396">shawn_test_result.txt</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/396/shawn_test_result.txt">shawn_test_result.txt</a> added</li>
    </ul>
    <div id="journal-2233-notes" class="wiki"><p>You guys did a awesome project. Well designed, easy to understand! Quite good to join you.</p>


	<p>After my changies to it, somethings goes wrong with the matroskavideo.cpp. I didn't figure it out. Abhinav could you please review it.</p></div>
    </div>
  </div>
  
  <div id="change-2234" class="journal has-notes">
    <div id="note-10">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-10" class="journal-link">#10</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/3290">Abhinav Badola</a> <a title="18 Sep 2012 11:51" href="/projects/exiv2/activity?from=2012-09-18">about 9 years</a> ago
      <span id="journal-2234-private_notes" class=""></span>
    </h4>

    <div id="journal-2234-notes" class="wiki"><p>Hi Shawn, Robin,</p>


	<p>Right now I am a bit busy with some college assignments.<br />I will definitely review the code by this Thursday.</p></div>
    </div>
  </div>
  
  <div id="change-2235" class="journal has-notes">
    <div id="note-11">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-11" class="journal-link">#11</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/3290">Abhinav Badola</a> <a title="19 Sep 2012 14:01" href="/projects/exiv2/activity?from=2012-09-19">about 9 years</a> ago
      <span id="journal-2235-private_notes" class=""></span>
    </h4>

    <div id="journal-2235-notes" class="wiki"><p>Hi Robin,<br />I was going through the code, and I guess some new casts and function overloading are creating some problem.</p>


	<p>The problem is majorly in basicio.cpp file.<br />I guess it would be compiling on Windows OS, but it is not compiling under Linux OS.</p>


	<p>Here is the error log for further debugging-</p>


	<p>/home/badola/trunk/src/bmpimage.cpp: In function ‘bool Exiv2::isBmpType(Exiv2::BasicIo&#38;, bool)’:                                                                            <br />/home/badola/trunk/src/bmpimage.cpp:161:40: error: call of overloaded ‘seek(int, Exiv2::BasicIo::Position)’ is ambiguous<br />/home/badola/trunk/src/bmpimage.cpp:161:40: note: candidates are:<br />/home/badola/trunk/src/basicio.hpp:172:21: note: virtual int Exiv2::BasicIo::seek(long int, Exiv2::BasicIo::Position)<br />/home/badola/trunk/src/basicio.hpp:181:21: note: virtual int Exiv2::BasicIo::seek(uint64_t, Exiv2::BasicIo::Position)<br />/home/badola/trunk/src/basicio.cpp:262:10: warning: unused parameter ‘src’ [-Wunused-parameter]<br />make<sup><a href="#fn2">2</a></sup>: <b>* [src/CMakeFiles/exiv2lib.dir/bmpimage.cpp.o] Error 1<br />make<sup><a href="#fn2">2</a></sup>: <strong></b> Waiting for unfinished jobs....<br />/home/badola/trunk/src/basicio.cpp: In member function ‘virtual int Exiv2::FileIo::seek(uint64_t, Exiv2::BasicIo::Position)’:<br />/home/badola/trunk/src/basicio.cpp:851:10: error: ‘fseeko’ is not a member of ‘std’<br />/home/badola/trunk/src/basicio.cpp:851:10: note: suggested alternative:<br />/usr/include/stdio.h:766:12: note:   ‘fseeko’<br />/home/badola/trunk/src/basicio.cpp: In member function ‘virtual int Exiv2::MemIo::seek(uint64_t, Exiv2::BasicIo::Position)’:<br />/home/badola/trunk/src/basicio.cpp:1154:16: warning: comparison of unsigned expression < 0 is always false [-Wtype-limits]<br />/home/badola/trunk/src/basicio.cpp:1154:34: warning: comparison between signed and unsigned integer expressions [-Wsign-compare]<br />/home/badola/trunk/src/basicio.cpp: In member function ‘virtual int Exiv2::FileIo::seek(uint64_t, Exiv2::BasicIo::Position)’:<br />/home/badola/trunk/src/basicio.cpp:853:2: warning: control reaches end of non-void function [-Wreturn-type]<br />make<sup><a href="#fn2">2</a></sup>: <b></strong> [src/CMakeFiles/exiv2lib.dir/basicio.cpp.o] Error 1<br />/home/badola/trunk/src/asfvideo.cpp: In member function ‘virtual void Exiv2::AsfVideo::readMetadata()’:<br />/home/badola/trunk/src/asfvideo.cpp:323:34: error: call of overloaded ‘seek(int, Exiv2::BasicIo::Position)’ is ambiguous<br />/home/badola/trunk/src/asfvideo.cpp:323:34: note: candidates are:<br />/home/badola/trunk/src/basicio.hpp:172:21: note: virtual int Exiv2::BasicIo::seek(long int, Exiv2::BasicIo::Position)<br />/home/badola/trunk/src/basicio.hpp:181:21: note: virtual int Exiv2::BasicIo::seek(uint64_t, Exiv2::BasicIo::Position)<br />/home/badola/trunk/src/asfvideo.cpp: In function ‘bool Exiv2::isAsfType(Exiv2::BasicIo&#38;, bool)’:<br />/home/badola/trunk/src/asfvideo.cpp:742:37: error: call of overloaded ‘seek(int, Exiv2::BasicIo::Position)’ is ambiguous<br />/home/badola/trunk/src/asfvideo.cpp:742:37: note: candidates are:<br />/home/badola/trunk/src/basicio.hpp:172:21: note: virtual int Exiv2::BasicIo::seek(long int, Exiv2::BasicIo::Position)<br />/home/badola/trunk/src/basicio.hpp:181:21: note: virtual int Exiv2::BasicIo::seek(uint64_t, Exiv2::BasicIo::Position)<br />make<sup><a href="#fn2">2</a></sup>: <strong></b> [src/CMakeFiles/exiv2lib.dir/asfvideo.cpp.o] Error 1<br />make<sup><a href="#fn1">1</a></sup>: <b></strong> [src/CMakeFiles/exiv2lib.dir/all] Error 2<br />make: *</b> [all] Error 2</p></div>
    </div>
  </div>
  
  <div id="change-2236" class="journal has-notes">
    <div id="note-12">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-12" class="journal-link">#12</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="19 Sep 2012 21:28" href="/projects/exiv2/activity?from=2012-09-19">about 9 years</a> ago
      <span id="journal-2236-private_notes" class=""></span>
    </h4>

    <div id="journal-2236-notes" class="wiki"><p>Abhinav</p>


	<p>Thanks for looking at this so promptly.  You discovered I've broken the Unix before me!  I've submitted SVN: 2880 to fix this.  The code builds OK for me on GCC/cygwin/Linux (and with DevStudio 2005 using msvc and msvc64).  It passes the test suite with much the same results that Shawn reported.</p>


	<p>I'm having no success building with the automake files ( make config ; ./configure ; ....).  I can't get this to work on Mac/Linux/Cygwin.  It complains about can't find exv_conf.h reports 1000's of type issues.</p>


	<p>However it builds OK with cmake (on Linux and Cygwin)<br />  $ cd exiv2 <br />  $ mkdir build <br />  $ cd build <br />  $ cmake .. <br />  $ make</p>


	<p>Are you or Shawn having any difficulty with the automake build?  This has been rock stable for years (although I made a change for cygwin recently).  I'll investigate at the weekend.</p></div>
    </div>
  </div>
  
  <div id="change-2239" class="journal has-notes">
    <div id="note-13">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-13" class="journal-link">#13</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="20 Sep 2012 22:27" href="/projects/exiv2/activity?from=2012-09-20">about 9 years</a> ago
      <span id="journal-2239-private_notes" class=""></span>
    </h4>

    <div id="journal-2239-notes" class="wiki"><p>I've raised an issue <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: autotools build (make config ; ./configure ; make) is broken (Closed)" href="/issues/849">#849</a> about the issue with ./configure.  I fixed it SVN: 2881 &#38; 2882.</p>


As far as I can see, the code's now building and running the test suite on:
	<ul>
	<li>./configure on Linux/Mac/Cygwin</li>
		<li>MSVC/2005 in both msvc and msvc64</li>
		<li>CMake/makefiles Linux/Mac/Cygwin</li>
	</ul>


	<p>I haven't looked at CMake/MSVC since June.  CMake support is still in development - however it our goal to adopt CMake as our only build environment.</p>


	<p>Abhinav:<br />I'm sure you have plenty of course work.  If you're interested in a little software challenge, write a script to "calculate" the dependencies of exv_conf.h.  It wouldn't be difficult, and probably fun.  Use grep to find the includes in every file in the src directory and use tsort to put them into order.  The compiler dependency code does this (and generates the mysterious .d files).  The compiler is a much stronger parser than grep of course.  However the tsort phase will be about the same.  Show it to your professor.  I'm sure he'll be impressed.</p>


	<p>Robin</p></div>
    </div>
  </div>
  
  <div id="change-2243" class="journal has-notes">
    <div id="note-14">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-14" class="journal-link">#14</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/3290">Abhinav Badola</a> <a title="23 Sep 2012 12:13" href="/projects/exiv2/activity?from=2012-09-23">about 9 years</a> ago
      <span id="journal-2243-private_notes" class=""></span>
    </h4>

    <div id="journal-2243-notes" class="wiki"><p>Hi Robin,</p>


<blockquote>

	<p>Abhinav:<br />I'm sure you have plenty of course work.  If you're interested in a little software challenge, write a script to "calculate" the dependencies of exv_conf.h.  It wouldn't be difficult, and probably fun.  Use grep to find the includes in every file in the src directory and use tsort to put them into order.  The compiler dependency code does this (and generates the mysterious .d files).  The compiler is a much stronger parser than grep of course.  However the tsort phase will be about the same.  Show it to your professor.  I'm sure he'll be impressed.</p>


</blockquote>

	<p>As for this script, I think Andreas fix on bug <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: autotools build (make config ; ./configure ; make) is broken (Closed)" href="/issues/849">#849</a> would be sufficient.<br />Is there still a need to develop the script..?</p></div>
    </div>
  </div>
  
  <div id="change-2244" class="journal has-notes">
    <div id="note-15">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-15" class="journal-link">#15</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="23 Sep 2012 18:30" href="/projects/exiv2/activity?from=2012-09-23">about 9 years</a> ago
      <span id="journal-2244-private_notes" class=""></span>
    </h4>

    <div id="journal-2244-notes" class="wiki"><p>Abhinav Badola wrote:</p>


<blockquote>

	<p>Hi Robin,</p>


<blockquote>

	<p>Abhinav:<br />I'm sure you have plenty of course work.  If you're interested in a little software challenge, write a script to "calculate" the dependencies of exv_conf.h.  It wouldn't be difficult, and probably fun.  Use grep to find the includes in every file in the src directory and use tsort to put them into order.  The compiler dependency code does this (and generates the mysterious .d files).  The compiler is a much stronger parser than grep of course.  However the tsort phase will be about the same.  Show it to your professor.  I'm sure he'll be impressed.</p>


</blockquote>

	<p>As for this script, I think Andreas fix on bug <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: autotools build (make config ; ./configure ; make) is broken (Closed)" href="/issues/849">#849</a> would be sufficient.<br />Is there still a need to develop the script..?</p>


</blockquote>

	<p>I only saw this yesterday after I made changes.. What I committed is a pragmatic approach, it should solve the maintenance issue and is as simple as it gets. That is good for the project, but your professor wouldn't be impressed :)</p></div>
    </div>
  </div>
  
  <div id="change-2245" class="journal has-notes">
    <div id="note-16">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-16" class="journal-link">#16</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="23 Sep 2012 19:12" href="/projects/exiv2/activity?from=2012-09-23">about 9 years</a> ago
      <span id="journal-2245-private_notes" class=""></span>
    </h4>

    <div id="journal-2245-notes" class="wiki"><p>There is no need for the script.  Everything is fine with my fix, and Andreas' even better fix.  Dependency analysis is an interesting matter and I was suggesting a little project you might find fun.  However, there is not need for you to bother with this - it was simply a challenge to sharpen your brain!</p>


	<p>The test harness is producing messages concerning the video code and I'd like to ask you to investigate those.  I was surprised that Shawn made changes to array offsets in your code with his submission and perhaps those changes introduced the messages.  Fixing this is important, but not urgent.</p></div>
    </div>
  </div>
  
  <div id="change-2285" class="journal has-notes has-details">
    <div id="note-17">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-17" class="journal-link">#17</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="19 Oct 2012 21:41" href="/projects/exiv2/activity?from=2012-10-19">about 9 years</a> ago
      <span id="journal-2285-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
    </ul>
    <div id="journal-2285-notes" class="wiki"><p>I'm going to mark this as 100% resolved as I believe that MSVC is building the video code in a satisfactory manner.  There is an outstanding matter that the video code is not passing the test suite, however I believe this occurs on all platforms and not only MSVC.  I'll open a different issue about the video test code an assign it to Abhinav.</p></div>
    </div>
  </div>
  
  <div id="change-2287" class="journal has-notes has-details">
    <div id="note-18">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-18" class="journal-link">#18</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="19 Oct 2012 22:03" href="/projects/exiv2/activity?from=2012-10-19">about 9 years</a> ago
      <span id="journal-2287-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Resolved</i></li>
    </ul>
    <div id="journal-2287-notes" class="wiki"><p>I believe this is complete.  I've changed the status to resolved.  This issue won't be closed until the 0.24 release (expect late November 2012)</p></div>
    </div>
  </div>
  
  <div id="change-2317" class="journal has-notes has-details">
    <div id="note-19">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-19" class="journal-link">#19</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Nov 2012 10:58" href="/projects/exiv2/activity?from=2012-11-03">about 9 years</a> ago
      <span id="journal-2317-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Assigned</i></li>
       <li><strong>% Done</strong> changed from <i>100</i> to <i>80</i></li>
    </ul>
    <div id="journal-2317-notes" class="wiki"><p>Thanks to Abhinav, the video test failures have been investigated and resolved.  (Issue: <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Video code is failing the test suite (on all plaforms) (Closed)" href="/issues/862">#862</a>).</p>


	<p>Issues have appeared with DevStudio 2003 builds failing the test suite.  Specifically the aspectRatio in a couple of the test files is being incorrectly calculated and reported.  MSVC/2003 Release and ReleaseDLL are impacted.  All builds with msvc64 builds pass on DevStudio 2005/2008/2010.  I'll investigate this issue as I know that Abhinav does not have the tools to work on this.</p></div>
    </div>
  </div>
  
  <div id="change-2318" class="journal has-notes">
    <div id="note-20">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-20" class="journal-link">#20</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="04 Nov 2012 01:16" href="/projects/exiv2/activity?from=2012-11-04">about 9 years</a> ago
      <span id="journal-2318-private_notes" class=""></span>
    </h4>

    <div id="journal-2318-notes" class="wiki"><p>I've fixed this SVN:2934</p>


	<p>The aspectRatio() member functions in the 4 video classes used floating point comparison to determine xmpData_["Xmp.video.AspectRatio"].  I've replaced this with an integer switch and everything seems OK on msvc and msvc64 build environments.  I'll test it tomorrow on Mac and Linux.</p>


	<p>The code contains the comment (presumably from Abhinav)<br /><pre>
    // TODO - Make a better unified method to handle all cases of Aspect Ratio
</pre><br />We could:</p>


	<ol>
	<li>Push this code into the Image base class to avoid code duplication.</li>
		<li>Use a map&lt;integer,string&gt; to avoid the switch completely.</li>
	</ol>


	<p>I'll don't think I will do either.  Changing the Image base class involves risk to all Image classes.  If this passes on Mac/Linux, I'm going to consider the video/aspectRatio/DevStudio issue fixed.</p></div>
    </div>
  </div>
  
  <div id="change-2393" class="journal has-details">
    <div id="note-21">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-21" class="journal-link">#21</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="23 Jan 2013 21:35" href="/projects/exiv2/activity?from=2013-01-23">almost 9 years</a> ago
      <span id="journal-2393-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Resolved</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-2541" class="journal has-notes has-details">
    <div id="note-22">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-22" class="journal-link">#22</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="24 Jul 2013 15:25" href="/projects/exiv2/activity?from=2013-07-24">over 8 years</a> ago
      <span id="journal-2541-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
    </ul>
    <div id="journal-2541-notes" class="wiki"><p>Fixed in 0.24.</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/846.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/846.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
