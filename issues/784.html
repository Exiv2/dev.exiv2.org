<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #784: Writing Xmp.lr.hierarchicalSubject writes wrong datatype - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="VyUJC/k1OhqItdT+A3txQGvQZPbwPw+8mOaYfYxu6km1aKLki0/2Gt3Ry/K8rH1zVEIwjwHcrgZlxgj1z1cNJg==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #784: Writing Xmp.lr.hierarchicalSubject writes wrong datatype" href="https://dev.exiv2.org/issues/784.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #784</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Writing Xmp.lr.hierarchicalSubject writes wrong datatype</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/2622">Lucas Beeler</a> <a title="02 Aug 2011 16:25" href="/projects/exiv2/activity?from=2011-08-02">over 10 years</a> ago.
        Updated <a title="21 Jun 2015 16:42" href="/projects/exiv2/activity?from=2015-06-21">over 6 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/4035">Alan Pater</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">xmp</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="17 May 2015" href="/versions/51">0.25</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">02 Aug 2011</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Right now, exiv2 writes the Xmp.lr.hierarchicalSubject field as XmpText when it should be an XmpBag. This isn't surprising, being that the Adobe Lightroom schema (which defines Xmp.lr.hierarchicalSubject) isn't supported. So maybe this is a "feature" (support the Lightroom schema) more than a "bug", but it seems like a bug to me. I hack on Shotwell, a popular, open-source photo organizer for GNOME, and because of this issue we can't write out tags that are intelligible to Adobe Lightroom users. This is exceedingly unfortunate, because Lightroom is the most popular pro-level commercial photo organizer in the world. :-(</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/681">784.diff</a>    <span class="size">(2.98 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/681/784.diff">784.diff</a>  </td>
  <td>Add LR support</td>
  <td>
      <span class="author">Alan Pater, 29 Oct 2014 22:17</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/730">lr.typo.patch</a>    <span class="size">(902 Bytes)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/730/lr.typo.patch">lr.typo.patch</a>  </td>
  <td>Typo patch</td>
  <td>
      <span class="author">Alan Pater, 15 Mar 2015 02:48</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/741">exiv2.lr.jpg</a>    <span class="size">(11.9 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/741/exiv2.lr.jpg">exiv2.lr.jpg</a>  </td>
  <td>LR Hierarchical Subject written by exiv2</td>
  <td>
      <span class="author">Alan Pater, 24 Mar 2015 23:33</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/742">exiv2.lr.jpg</a>    <span class="size">(13.3 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/742/exiv2.lr.jpg">exiv2.lr.jpg</a>  </td>
  <td></td>
  <td>
      <span class="author">Alan Pater, 25 Mar 2015 01:42</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/744">lightroom.diff</a>    <span class="size">(936 Bytes)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/744/lightroom.diff">lightroom.diff</a>  </td>
  <td>hierarchicalSubject</td>
  <td>
      <span class="author">Alan Pater, 25 Mar 2015 21:35</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>







<hr />
<div id="relations">
<div class="contextual">
</div>

<p><strong>Related issues</strong></p>

<form data-cm-url="/issues/context_menu" action="/issues/784" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="ovwTsP1KlHvwOLNXaJ+A/YkFDL97k7+29BXc1doK5FVAsbhfjzBYe6VcrFvXSIzOtpdYxopwHgwJNUxdmTMDOg==" />
  <table class="list issues odd-even"><tr id="relation-120" class="issue hascontextmenu issue tracker-2 status-5 priority-4 priority-default closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="1040" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-2 status-5 priority-4 priority-default closed" href="/issues/1040">Feature #1040</a>: MWG-KW schema</td><td class="status">Closed</td><td class="start_date">12 Mar 2015</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr></table>
</form>
<form class="new_relation" id="new-relation-form" style="display: none;" action="/issues/784/relations" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />


<p><select onchange="setPredecessorFieldsVisibility();" name="relation[relation_type]" id="relation_relation_type"><option selected="selected" value="relates">Related to</option>
<option value="duplicates">Is duplicate of</option>
<option value="duplicated">Has duplicate</option>
<option value="blocks">Blocks</option>
<option value="blocked">Blocked by</option>
<option value="precedes">Precedes</option>
<option value="follows">Follows</option>
<option value="copied_to">Copied to</option>
<option value="copied_from">Copied from</option></select>
Issue #<input size="10" type="text" name="relation[issue_to_id]" id="relation_issue_to_id" />
<span id="predecessor_fields" style="display:none;">
Delay: <input size="3" type="text" name="relation[delay]" id="relation_delay" /> days
</span>
<input type="submit" name="commit" value="Add" data-disable-with="Add" />
<a href="#" onclick="$(&quot;#new-relation-form&quot;).hide();; return false;">Cancel</a>
</p>

<script>
//<![CDATA[
observeAutocompleteField('relation_issue_to_id', '/issues/auto_complete?issue_id=784&project_id=exiv2&scope=all')
//]]>
</script>

<script>
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>
</div>

</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 3384" href="/projects/exiv2/repository/exiv2/revisions/3384">Revision 3384</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3384/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="31 Oct 2014 05:52" href="/projects/exiv2/activity?from=2014-10-31">about 7 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p>Issue: <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Writing Xmp.lr.hierarchicalSubject writes wrong datatype (Closed)" href="/issues/784">#784</a>.  Thanks to Alan for the patch.  See topic: <a class="external" href="http://dev.exiv2.org/boards/3/topics/1847">http://dev.exiv2.org/boards/3/topics/1847</a></p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 3643" href="/projects/exiv2/repository/exiv2/revisions/3643">Revision 3643</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3643/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="25 Mar 2015 20:54" href="/projects/exiv2/activity?from=2015-03-25">over 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Writing Xmp.lr.hierarchicalSubject writes wrong datatype (Closed)" href="/issues/784">#784</a> and <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: MWG-KW schema (Closed)" href="/issues/1040">#1040</a>.  Test regression detector.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 3644" href="/projects/exiv2/repository/exiv2/revisions/3644">Revision 3644</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3644/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="25 Mar 2015 22:19" href="/projects/exiv2/activity?from=2015-03-25">over 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Writing Xmp.lr.hierarchicalSubject writes wrong datatype (Closed)" href="/issues/784">#784</a>. Change requested by Alan (typos).</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 3645" href="/projects/exiv2/repository/exiv2/revisions/3645">Revision 3645</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3645/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="25 Mar 2015 23:37" href="/projects/exiv2/activity?from=2015-03-25">over 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Writing Xmp.lr.hierarchicalSubject writes wrong datatype (Closed)" href="/issues/784">#784</a>  Modified the test regression detector submitted in <a class="changeset" title="#784 and #1040.  Test regression detector." href="/projects/exiv2/repository/exiv2/revisions/3643">r3643</a>.  Thank You Alan for your explanation.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 3656" href="/projects/exiv2/repository/exiv2/revisions/3656">Revision 3656</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3656/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/4035">Alan Pater</a> <a title="03 Apr 2015 15:58" href="/projects/exiv2/activity?from=2015-04-03">over 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Writing Xmp.lr.hierarchicalSubject writes wrong datatype (Closed)" href="/issues/784">#784</a> doc template for lr schema</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-1962" class="journal has-notes has-details">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="04 Aug 2011 07:29" href="/projects/exiv2/activity?from=2011-08-04">over 10 years</a> ago
      <span id="journal-1962-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>New</i> to <i>Feedback</i></li>
    </ul>
    <div id="journal-1962-notes" class="wiki"><p>Well, you're right, Exiv2 doesn't know the Lightroom schema yet. But that shouldn't stop you from registering the <code>lr</code> prefix and adding this property with a value of the correct type anyway. Along the lines of the examples here: <a class="external" href="http://www.exiv2.org/example5.html">http://www.exiv2.org/example5.html</a></p>


	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-2946" class="journal has-details">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4035">Alan Pater</a> <a title="29 Oct 2014 22:17" href="/projects/exiv2/activity?from=2014-10-29">about 7 years</a> ago
      <span id="journal-2946-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/681">784.diff</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/681/784.diff">784.diff</a> added</li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-2947" class="journal has-notes has-details">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="31 Oct 2014 05:57" href="/projects/exiv2/activity?from=2014-10-31">about 7 years</a> ago
      <span id="journal-2947-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Feedback</i> to <i>Resolved</i></li>
       <li><strong>Assignee</strong> set to <i>Robin Mills</i></li>
       <li><strong>Target version</strong> set to <i>0.25</i></li>
    </ul>
    <div id="journal-2947-notes" class="wiki"><p>Thank you Alan for the patch.  You're as helpful as always.  I've submitted this <a class="changeset" title="Issue: #784.  Thanks to Alan for the patch.  See topic: http://dev.exiv2.org/boards/3/topics/1847" href="/projects/exiv2/repository/exiv2/revisions/3384">r3384</a>.  Other notes:  <a class="external" href="http://dev.exiv2.org/boards/3/topics/1847">http://dev.exiv2.org/boards/3/topics/1847</a></p></div>
    </div>
  </div>
  
  <div id="change-3211" class="journal has-notes has-details">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4035">Alan Pater</a> <a title="15 Mar 2015 02:48" href="/projects/exiv2/activity?from=2015-03-15">over 6 years</a> ago
      <span id="journal-3211-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/730">lr.typo.patch</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/730/lr.typo.patch">lr.typo.patch</a> added</li>
    </ul>
    <div id="journal-3211-notes" class="wiki"><p>On re-testing my previous patch, I came across a couple of functionally non-trivial typos. Please update with the attached patch.</p>


	<p>"hierarchicalsubject"     should have been       "hierarchicalSubject" <br />"privatertkinfo"          should have been       "privateRTKInfo"</p></div>
    </div>
  </div>
  
  <div id="change-3217" class="journal has-notes has-details">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="15 Mar 2015 22:23" href="/projects/exiv2/activity?from=2015-03-15">over 6 years</a> ago
      <span id="journal-3217-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Assigned</i></li>
    </ul>
    <div id="journal-3217-notes" class="wiki"><p>Thanks, Alan.  I've changed the status to "Assigned" to ensure this gets my attention.  I'll submit your patch in the next few days.</p></div>
    </div>
  </div>
  
  <div id="change-3285" class="journal has-notes">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4035">Alan Pater</a> <a title="24 Mar 2015 22:38" href="/projects/exiv2/activity?from=2015-03-24">over 6 years</a> ago
      <span id="journal-3285-private_notes" class=""></span>
    </h4>

    <div id="journal-3285-notes" class="wiki"><p>Thomas, Robin, can we test this one as well? It's a tiny change.</p></div>
    </div>
  </div>
  
  <div id="change-3286" class="journal has-notes">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/360">Thomas Beutlich</a> <a title="24 Mar 2015 22:47" href="/projects/exiv2/activity?from=2015-03-24">over 6 years</a> ago
      <span id="journal-3286-private_notes" class=""></span>
    </h4>

    <div id="journal-3286-notes" class="wiki"><p>Do you mean the two typo fixes? Patch is OK, but I cannot judge which names are "better".</p></div>
    </div>
  </div>
  
  <div id="change-3287" class="journal has-notes">
    <div id="note-8">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-8" class="journal-link">#8</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="24 Mar 2015 22:49" href="/projects/exiv2/activity?from=2015-03-24">over 6 years</a> ago
      <span id="journal-3287-private_notes" class=""></span>
    </h4>

    <div id="journal-3287-notes" class="wiki"><p>I've lost the plot here, Alan.  (it's been a very long 12-hour day on Exiv2).  Do you have a test JPG to be added to the test suite?</p>


	<p><em>Most of our tests simply run some exiv2 commands on one or more files.  The terminal output is compared to a reference file.  If the output doesn't change we say it has passed.  I think this is simply about typos in the output I only need to run exiv2 -pa bug-784.jpg and add the reference file.</em></p></div>
    </div>
  </div>
  
  <div id="change-3289" class="journal has-notes has-details">
    <div id="note-9">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-9" class="journal-link">#9</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4035">Alan Pater</a> <a title="24 Mar 2015 23:33" href="/projects/exiv2/activity?from=2015-03-24">over 6 years</a> ago
      <span id="journal-3289-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/741">exiv2.lr.jpg</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/741/exiv2.lr.jpg">exiv2.lr.jpg</a> added</li>
    </ul>
    <div id="journal-3289-notes" class="wiki"><p>Here goes. That attached test file has had Xmp.lr.hierarchicalSubject written by this patch to exiv2. The correct spelling of the XMP property is Xmp.lr.hierarchicalSubject</p>


	<p>I have included a copyright notice putting the image in the public domain. That means to me that anyone can do whatever they like with the image.</p>


	<p>The Xmp.lr.privateRTKInfo property does not appear in this image. If I understand correctly, it is a internal property used in Adobe products. My tests with a trial version of Lightroom don't show that property. I've included it in the patch for completeness and because exiftool does. Just don't ask me what it is for! ;-)</p></div>
    </div>
  </div>
  
  <div id="change-3290" class="journal has-notes">
    <div id="note-10">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-10" class="journal-link">#10</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4035">Alan Pater</a> <a title="24 Mar 2015 23:38" href="/projects/exiv2/activity?from=2015-03-24">over 6 years</a> ago
      <span id="journal-3290-private_notes" class=""></span>
    </h4>

    <div id="journal-3290-notes" class="wiki"><p>As far as "which names are better", "hierarchicalSubject" and "privateRTKInfo" agree with exiftool and Adobe products. If the capitalization is different, the data is written to redundant and different properties. "hierarchicalSubject" is correct. "hierarchicalsubject" is wrong.</p></div>
    </div>
  </div>
  
  <div id="change-3291" class="journal has-notes has-details">
    <div id="note-11">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-11" class="journal-link">#11</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4035">Alan Pater</a> <a title="25 Mar 2015 01:42" href="/projects/exiv2/activity?from=2015-03-25">over 6 years</a> ago
      <span id="journal-3291-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/742">exiv2.lr.jpg</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/742/exiv2.lr.jpg">exiv2.lr.jpg</a> added</li>
    </ul>
    <div id="journal-3291-notes" class="wiki"><p>Same sample file after opening and adding tags in Lightroom.</p>


	<p>Lightroom read the hierachical subject tags written by exiv2. Adding another hierarchical tag through Lightroom works correctly.</p>


	<p>$ exiv2 -pa exiv2.lr.jpg | grep Xmp.lr<br />Xmp.lr.hierarchicalSubject                   XmpBag      2  root0|next1|next2, root|1st|2nd</p>


	<p>The "root0|next1|next2" hierarchy was added by exiv2. "root|1st|2nd" was added by Adobe Lightroom.</p>


	<p>My trial version of Lightroom did NOT add the Xmp.lr.privateRTKInfo property.</p></div>
    </div>
  </div>
  
  <div id="change-3298" class="journal has-notes">
    <div id="note-12">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-12" class="journal-link">#12</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4035">Alan Pater</a> <a title="25 Mar 2015 14:38" href="/projects/exiv2/activity?from=2015-03-25">over 6 years</a> ago
      <span id="journal-3298-private_notes" class=""></span>
    </h4>

    <div id="journal-3298-notes" class="wiki"><p>Also regarding the typo and getting back to the title of this report: "Writing Xmp.lr.hierarchicalSubject writes wrong datatype"</p>


	<p>Without the typo fix, that issue remains. Xmp.lr.hierarchical*S*ubject will write the wrong datatype. Xmp.lr.hierarchical*s*ubject will write the correct datatype, but will not be compatible with Adobe and other applications.</p></div>
    </div>
  </div>
  
  <div id="change-3303" class="journal has-notes has-details">
    <div id="note-13">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-13" class="journal-link">#13</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="25 Mar 2015 20:57" href="/projects/exiv2/activity?from=2015-03-25">over 6 years</a> ago
      <span id="journal-3303-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Assignee</strong> changed from <i>Robin Mills</i> to <i>Alan Pater</i></li>
    </ul>
    <div id="journal-3303-notes" class="wiki"><p>Submitted: <a class="changeset" title="Fixes to msvc2003" href="/projects/exiv2/repository/exiv2/revisions/3543">r3543</a></p>


	<p>Alan:<br />I've reported my action in <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: MWG-KW schema (Closed)" href="/issues/1040">#1040</a>.  I hope I've got this correct.  I've assigned this issue to you.  If you're happy, mark it (and <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: MWG-KW schema (Closed)" href="/issues/1040">#1040</a>) as Resolved.  If you're not - assign them back to me for further attention.</p></div>
    </div>
  </div>
  
  <div id="change-3305" class="journal has-notes has-details">
    <div id="note-14">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-14" class="journal-link">#14</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4035">Alan Pater</a> <a title="25 Mar 2015 21:35" href="/projects/exiv2/activity?from=2015-03-25">over 6 years</a> ago
      <span id="journal-3305-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/744">lightroom.diff</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/744/lightroom.diff">lightroom.diff</a> added</li>
       <li><strong>Assignee</strong> changed from <i>Alan Pater</i> to <i>Robin Mills</i></li>
    </ul>
    <div id="journal-3305-notes" class="wiki"><p>Apologies for being so confusing this report. We still need this patch with the correct capitalization applied.</p></div>
    </div>
  </div>
  
  <div id="change-3306" class="journal has-notes">
    <div id="note-15">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-15" class="journal-link">#15</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="25 Mar 2015 22:19" href="/projects/exiv2/activity?from=2015-03-25">over 6 years</a> ago
      <span id="journal-3306-private_notes" class=""></span>
    </h4>

    <div id="journal-3306-notes" class="wiki"><p>Alan</p>


	<p>I've applied your patch (lightroom.diff), built it and ran the test suite.  Nothing seems to have changed.  So I've taken a fresh copy of the code and built it.  Still nothing has changed.  Conclusion:  my test is ineffective.  However I've submitted the change: <a class="changeset" title="#784. Change requested by Alan (typos)." href="/projects/exiv2/repository/exiv2/revisions/3644">r3644</a></p>


	<p>This is the output (both before and after the change): <pre>964 rmills@rmillsmbp:~/gnu/exiv2/trunk/test $ exiv2 -px data/exiv2-bug784.jpg 
Xmp.dc.format                                XmpText    10  image/jpeg
Xmp.dc.rights                                LangAlt     1  lang="x-default" Public Domain. Do whatever you like with this image
Xmp.dc.subject                               XmpBag      6  1st, 2nd, next1, next2, root, root0
Xmp.xmpMM.DocumentID                         XmpText    32  004D48F936062EF5085A81BF96D4C494
Xmp.xmpMM.OriginalDocumentID                 XmpText    32  004D48F936062EF5085A81BF96D4C494
Xmp.xmpMM.InstanceID                         XmpText    44  xmp.iid:f74f0d02-e921-134e-8107-1dda17aad853
Xmp.xmpMM.History                            XmpText     0  type="Seq" 
Xmp.xmpMM.History[1]                         XmpText     0  type="Struct" 
Xmp.xmpMM.History[1]/stEvt:action            XmpText     5  saved
Xmp.xmpMM.History[1]/stEvt:instanceID        XmpText    44  xmp.iid:f74f0d02-e921-134e-8107-1dda17aad853
Xmp.xmpMM.History[1]/stEvt:when              XmpText    25  2015-03-24T20:35:55-05:00
Xmp.xmpMM.History[1]/stEvt:softwareAgent     XmpText    39  Adobe Photoshop Lightroom 4.4 (Windows)
Xmp.xmpMM.History[1]/stEvt:changed           XmpText     9  /metadata
Xmp.xmp.MetadataDate                         XmpText    25  2015-03-24T20:35:55-05:00
Xmp.crs.RawFileName                          XmpText    12  exiv2.lr.jpg
Xmp.lr.hierarchicalSubject                   XmpBag      2  root0|next1|next2, root|1st|2nd
965 rmills@rmillsmbp:~/gnu/exiv2/trunk/test $ </pre>Unfortunately, I don't know anything about this part of the code.  I really haven't a clue what this is about!</p></div>
    </div>
  </div>
  
  <div id="change-3307" class="journal has-details">
    <div id="note-16">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-16" class="journal-link">#16</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="25 Mar 2015 22:23" href="/projects/exiv2/activity?from=2015-03-25">over 6 years</a> ago
      <span id="journal-3307-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Assignee</strong> changed from <i>Robin Mills</i> to <i>Alan Pater</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-3309" class="journal has-notes">
    <div id="note-17">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-17" class="journal-link">#17</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4035">Alan Pater</a> <a title="25 Mar 2015 23:15" href="/projects/exiv2/activity?from=2015-03-25">over 6 years</a> ago
      <span id="journal-3309-private_notes" class=""></span>
    </h4>

    <div id="journal-3309-notes" class="wiki"><p>The difference is when one does not include the xmp type (XmpBag) when writing this property.</p>


	<p><a class="changeset" title="#784 and #1040.  Test regression detector." href="/projects/exiv2/repository/exiv2/revisions/3643">r3643</a> results in the wrong type (XmpText)</p>


	<p>~$ exiv2 -M"add Xmp.lr.hierarchicalSubject root|1st|2nd|3rd|4th|5th" exiv2.lr.r3643.jpg<br /><pre>
Xmp.lr.hierarchicalSubject                   XmpText      24  root|1st|2nd|3rd|4th|5th
</pre>UNLESS one is explicit about the type.</p>


	<p>~$ exiv2 -M"add Xmp.lr.hierarchicalSubject XmpBag root|1st|2nd|3rd|4th|5th" exiv2.lr.r3643.jpg<br /><pre>Xmp.lr.hierarchicalSubject                   XmpBag      1  root|1st|2nd|3rd|4th|5th</pre></p>


	<p><a class="changeset" title="#784. Change requested by Alan (typos)." href="/projects/exiv2/repository/exiv2/revisions/3644">r3644</a> results in the correct type (XmpBag) without have to be explicit.</p>


	<p>~$ exiv2 -M"add Xmp.lr.hierarchicalSubject root|1st|2nd|3rd|4th|5th" exiv2.lr.r3644.jpg<br /><pre>
    Xmp.lr.hierarchicalSubject                   XmpBag      1  root|1st|2nd|3rd|4th|5th
</pre></p></div>
    </div>
  </div>
  
  <div id="change-3310" class="journal has-notes">
    <div id="note-18">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-18" class="journal-link">#18</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="25 Mar 2015 23:30" href="/projects/exiv2/activity?from=2015-03-25">over 6 years</a> ago
      <span id="journal-3310-private_notes" class=""></span>
    </h4>

    <div id="journal-3310-notes" class="wiki"><p>Right.  I'll update the test to<pre>exiv2 -M"add Xmp.lr.hierarchicalSubject root|1st|2nd|3rd|4th|5th" exiv2.lr.r3643.jpg
exiv2 -px exiv2.lr.r3643.jpg</pre>I call a test like this a "Test regression detector" because the test will report an exception if the fix disappears.</p>


	<p>I'll do that now and then I'm off to bed.  It's been another 12 hour day on Exiv2.  <a class="changeset" title="#784  Modified the test regression detector submitted in r3643.  Thank You Alan for your explanat..." href="/projects/exiv2/repository/exiv2/revisions/3645">r3645</a></p></div>
    </div>
  </div>
  
  <div id="change-3314" class="journal has-notes has-details">
    <div id="note-19">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-19" class="journal-link">#19</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4035">Alan Pater</a> <a title="26 Mar 2015 13:30" href="/projects/exiv2/activity?from=2015-03-26">over 6 years</a> ago
      <span id="journal-3314-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Resolved</i></li>
    </ul>
    <div id="journal-3314-notes" class="wiki"><p>Yes, it works as expected now. Thanks!</p></div>
    </div>
  </div>
  
  <div id="change-3630" class="journal has-details">
    <div id="note-20">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-20" class="journal-link">#20</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4035">Alan Pater</a> <a title="08 May 2015 16:21" href="/projects/exiv2/activity?from=2015-05-08">over 6 years</a> ago
      <span id="journal-3630-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-3907" class="journal has-details">
    <div id="note-21">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-21" class="journal-link">#21</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="21 Jun 2015 16:42" href="/projects/exiv2/activity?from=2015-06-21">over 6 years</a> ago
      <span id="journal-3907-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
    </ul>
    
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/784.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/784.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
