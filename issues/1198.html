<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Support #1198: Cannot read XMP metadata from (darktable) JPEG images - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="5N2u+0d2VApm/9Jpy3cEdkT0oPAia7zAvEgVhJJ4qDkGkAUUNQyYCjObzWV0oAhFe2b0idOIHXpBaIUM0UFPVg==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Support #1198: Cannot read XMP metadata from (darktable) JPEG images" href="https://dev.exiv2.org/issues/1198.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Support #1198</h2>

<div class="issue tracker-3 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Cannot read XMP metadata from (darktable) JPEG images</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/3826">Matthieu Volat</a> <a title="24 Jul 2016 18:24" href="/projects/exiv2/activity?from=2016-07-24">over 5 years</a> ago.
        Updated <a title="25 Jul 2016 00:44" href="/projects/exiv2/activity?from=2016-07-25">over 5 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/119">Robin Mills</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">metadata</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="28 Apr 2017" href="/versions/52">0.26</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">24 Jul 2016</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value">3.00 h</div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Hello,</p>


	<p>Using the latest snapshot from the subversion trunk, I have issues with JPEG files (created with darktable development version).</p>


	<p>Using the sample provided:</p>


<pre>
darktable_exported% exiv2 IMGP2518_01.jpg 
Warning: JPEG format error, rc = 5
File name       : IMGP2518_01.jpg
File size       : 90571 Bytes
MIME type       : image/jpeg
Image size      : 0 x 0
IMGP2518_01.jpg: No Exif data found in the file
</pre>

	<p>I tried to trace a bit this error, it seems that XMP section is read whitout issue, but nothing more. Metadata can be displayed with exiftool (which seems to use exiv2 to retrieve XMP section?), so I guess this is not a format issue.</p>


	<p>Here's a small JPEG files exhibiting the error.</p>


	<p>Thanks a lot for your work!</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1020">IMGP2518_01.jpg</a>    <span class="size">(88.4 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1020/IMGP2518_01.jpg">IMGP2518_01.jpg</a>  </td>
  <td></td>
  <td>
      <span class="author">Matthieu Volat, 24 Jul 2016 18:24</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>








</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 4352" href="/projects/exiv2/repository/exiv2/revisions/4352">Revision 4352</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4352/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="25 Jul 2016 00:38" href="/projects/exiv2/activity?from=2016-07-25">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-3 status-5 priority-4 priority-default closed" title="Support: Cannot read XMP metadata from (darktable) JPEG images (Closed)" href="/issues/1198">#1198</a>.  Fixed issue with http I/O failing a test file.</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-5211" class="journal has-notes has-details">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4035">Alan Pater</a> <a title="24 Jul 2016 19:15" href="/projects/exiv2/activity?from=2016-07-24">over 5 years</a> ago
      <span id="journal-5211-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Tracker</strong> changed from <i>Bug</i> to <i>Support</i></li>
    </ul>
    <div id="journal-5211-notes" class="wiki"><p>Try: <br /><pre>
~$ exiv2 -pa IMGP2518_01.jpg
</pre><br />That should show you all the XMP metadata.</p>


	<p>By the way, exiftool does NOT use exiv2 to read and display XMP data.</p></div>
    </div>
  </div>
  
  <div id="change-5212" class="journal has-notes">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/3826">Matthieu Volat</a> <a title="24 Jul 2016 19:27" href="/projects/exiv2/activity?from=2016-07-24">over 5 years</a> ago
      <span id="journal-5212-private_notes" class=""></span>
    </h4>

    <div id="journal-5212-notes" class="wiki"><p>Indeed, it still give me a warning:<br /><pre>
Warning: JPEG format error, rc = 5
</pre></p>


	<p>But it seems to be a darktable issue as I realize that exiftool don't print that much more information (no shutter speed, aperture settings, etc).</p>


	<p>I'll check on that side, sorry for the misleaded report!</p></div>
    </div>
  </div>
  
  <div id="change-5213" class="journal has-notes has-details">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="24 Jul 2016 19:37" href="/projects/exiv2/activity?from=2016-07-24">over 5 years</a> ago
      <span id="journal-5213-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>New</i> to <i>Assigned</i></li>
       <li><strong>Assignee</strong> set to <i>Robin Mills</i></li>
       <li><strong>Target version</strong> set to <i>0.26</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>20</i></li>
       <li><strong>Estimated time</strong> set to <i>2.00 h</i></li>
    </ul>
    <div id="journal-5213-notes" class="wiki"><p>There's something unusual about this file.  It does have XMP metadata, however it doesn't have Exif metadata.  This is causing pain that I would not expect.  I've successfully opened your file with v0.25.  So there's something in the trunk code that's refusing to open the file.  I will investigate.</p></div>
    </div>
  </div>
  
  <div id="change-5215" class="journal has-notes has-details">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="24 Jul 2016 20:15" href="/projects/exiv2/activity?from=2016-07-24">over 5 years</a> ago
      <span id="journal-5215-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Closed</i></li>
       <li><strong>% Done</strong> changed from <i>20</i> to <i>100</i></li>
    </ul>
    <div id="journal-5215-notes" class="wiki"><p>Gentlemen:</p>


	<p>I think that file is OK on trunk and v0.25.  If I copy the file down with curl, here's what I see:<pre>585 rmills@rmillsmbp:~/gnu/exiv2/trunk $ curl -O http://dev.exiv2.org/attachments/download/1020/IMGP2518_01.jpg
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 90571    0 90571    0     0   272k      0 --:--:-- --:--:-- --:--:--  272k
586 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pa IMGP2518_01.jpg &gt;/dev/null
Warning: JPEG format error, rc = 5
587 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>The message about JPEG format error is trying to say "There's <strong>no</strong> Exif data in this file".  Here's the proof:<pre>587 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pS IMGP2518_01.jpg
STRUCTURE OF JPEG FILE: IMGP2518_01.jpg
 address | marker     | length  | data
       2 | 0xd8 SOI   |       0 
       4 | 0xe0 APP0  |      16 | JFIF.....,.,....
      22 | 0xe1 APP1  |   10575 | http://ns.adobe.com/xap/1.0/.&lt;?x  &lt;---- XMP data
   10599 | 0xe2 APP2  |    8980 | rRGB XYZ ...........'acspAPPL..
   19583 | 0xe2 APP2  |    8980 | ICC_PROFILE.....#.lcms....mntrRG  &lt;--- ICC profile
   28565 | 0xdb DQT   |      67 
   28634 | 0xdb DQT   |      67 
   28703 | 0xc0 SOF0  |      17 
   28722 | 0xc4 DHT   |      30 
   28754 | 0xc4 DHT   |      77 
   28833 | 0xc4 DHT   |      28 
   28863 | 0xc4 DHT   |      54 
   28919 | 0xda SOS   |      12 
588 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>Compare that to a test JPG file:<pre>588 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pS test/data/Reagan.jpg 
STRUCTURE OF JPEG FILE: test/data/Reagan.jpg
 address | marker     | length  | data
       2 | 0xd8 SOI   |       0 
       4 | 0xe0 APP0  |      16 | JFIF.....,.,....
      22 | 0xe1 APP1  |    5671 | Exif..MM.*......................  &lt;--- Exif data
    5695 | 0xed APP13 |    9594 | Photoshop 3.0.8BIM..........Z...  &lt;--- IPTC data
   15291 | 0xe1 APP1  |    7062 | http://ns.adobe.com/xap/1.0/.&lt;?x  &lt;--- XMP data
   22355 | 0xe2 APP2  |    3160 | ICC_PROFILE......HLino....mntrRG  &lt;--- ICC profile
   25517 | 0xee APP14 |      14 | Adobe.d@......
   25533 | 0xdb DQT   |     132 
   25667 | 0xc0 SOF0  |      17 
   25686 | 0xdd DRI   |       4 
   25692 | 0xc4 DHT   |     418 
   26112 | 0xda SOS   |      12 
589 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>The message about "JPEG format" can be eliminated by only requesting XMP with the option: <strong><code>-px</code></strong>.</p>


	<p>However there is a little oddity here when the file is read by HTTP instead of the from the local file system:<pre>589 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 http://dev.exiv2.org/attachments/download/1020/IMGP2518_01.jpg
Exiv2 exception in print action for file http://dev.exiv2.org/attachments/download/1020/IMGP2518_01.jpg:
Failed to read image data
590 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>That's obviously an issue with the HTTP I/O code and irrelevant to this discussion.</p>


	<p>Returning to the issue report itself, the command: <pre>$ exiv2 MGP2518_01.jpg</pre>is very terse and only reports a summary of the metadata.  Alan is quite correct in saying that the option: <strong><code>-pa</code></strong> should be used to reveal all metadata.</p>


	<p>Alan is also correct in saying the exiftool does not use exiv2 - however we are on very friendly terms with Phil who masterminds that awesome tool.</p></div>
    </div>
  </div>
  
  <div id="change-5216" class="journal has-notes">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/3826">Matthieu Volat</a> <a title="24 Jul 2016 20:32" href="/projects/exiv2/activity?from=2016-07-24">over 5 years</a> ago
      <span id="journal-5216-private_notes" class=""></span>
    </h4>

    <div id="journal-5216-notes" class="wiki"><p>Thanks a lot, at least, I know my metadata issues are on the file creation side.</p></div>
    </div>
  </div>
  
  <div id="change-5217" class="journal has-notes has-details">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="25 Jul 2016 00:44" href="/projects/exiv2/activity?from=2016-07-25">over 5 years</a> ago
      <span id="journal-5217-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Estimated time</strong> changed from <i>2.00 h</i> to <i>3.00 h</i></li>
    </ul>
    <div id="journal-5217-notes" class="wiki"><p>Fixed issue with http i/o incorrectly refusing to open Matthieu's test file.</p>


	<p>I'm very pleased to have found this.  I've been aware for some time that the HTTP I/O sometimes refuses to open some files.  It's in the semantics of seek() when you request past EOF.  The implementation refuses, however the implementation of file i/o does a reopen and sets EOF.  Fixed <a class="changeset" title="#1198.  Fixed issue with http I/O failing a test file." href="/projects/exiv2/repository/exiv2/revisions/4352">r4352</a>.</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/1198.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/1198.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
