<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Feature #917: Modify exiv2/actions.cpp return -3/253 when no metadata has been found. - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="SpiShGeHp8Szy93EjbhUR2Ye37WCeq+w+fFk+YiKHAKo1TlrFf1rxOavwsgyb1h0WYyLzHOZDgoE0fRxy7P7bQ==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Feature #917: Modify exiv2/actions.cpp return -3/253 when no metadata has been found." href="https://dev.exiv2.org/issues/917.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Feature #917</h2>

<div class="issue tracker-2 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Modify exiv2/actions.cpp return -3/253 when no metadata has been found.</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="11 Aug 2013 13:43" href="/projects/exiv2/activity?from=2013-08-11">over 8 years</a> ago.
        Updated <a title="16 Sep 2016 07:25" href="/projects/exiv2/activity?from=2016-09-16">about 5 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/53">Andreas Huggel</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">design</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="28 Apr 2017" href="/versions/52">0.26</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">11 Aug 2013</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value">2.00 h</div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>See discussion:<br /><a class="external" href="http://dev.exiv2.org/boards/3/topics/1582">http://dev.exiv2.org/boards/3/topics/1582</a></p>


	<p>Additionally:<br />1) we should print the error message when we set the error. We should not require -v (verbose) to be set to get this error message.<br />2) when -g (grep) has been used, we should not set an error if no tag matches</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/708">0917_supportregexp.patch</a>    <span class="size">(3.76 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/708/0917_supportregexp.patch">0917_supportregexp.patch</a>  </td>
  <td></td>
  <td>
      <span class="author">Thomas Schmidt, 09 Jan 2015 22:49</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/709">0917_returnvaluesanderror.patch</a>    <span class="size">(2.24 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/709/0917_returnvaluesanderror.patch">0917_returnvaluesanderror.patch</a>  </td>
  <td></td>
  <td>
      <span class="author">Thomas Schmidt, 13 Jan 2015 23:05</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>







<hr />
<div id="relations">
<div class="contextual">
</div>

<p><strong>Related issues</strong></p>

<form data-cm-url="/issues/context_menu" action="/issues/917" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="QZ/tDvhLAAfdtKeoj7zeSC325e+fqrPSdtwRBX5GxQij0kbhijHMB4jQuKQwa9J7EmSxlm5JEmiL/IGNPX8iZw==" />
  <table class="list issues odd-even"><tr id="relation-118" class="issue hascontextmenu issue tracker-2 status-5 priority-4 priority-default closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="1024" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-2 status-5 priority-4 priority-default closed" href="/issues/1024">Feature #1024</a>: Provide regular expression support for the exiv2 -g feature</td><td class="status">Closed</td><td class="start_date">10 Jan 2015</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr><tr id="relation-132" class="issue hascontextmenu issue tracker-1 status-5 priority-4 priority-default closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="918" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-1 status-5 priority-4 priority-default closed" href="/issues/918">Bug #918</a>: non-zero exit code when extracting thumbnails</td><td class="status">Closed</td><td class="start_date">25 Aug 2013</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr></table>
</form>
<form class="new_relation" id="new-relation-form" style="display: none;" action="/issues/917/relations" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />


<p><select onchange="setPredecessorFieldsVisibility();" name="relation[relation_type]" id="relation_relation_type"><option selected="selected" value="relates">Related to</option>
<option value="duplicates">Is duplicate of</option>
<option value="duplicated">Has duplicate</option>
<option value="blocks">Blocks</option>
<option value="blocked">Blocked by</option>
<option value="precedes">Precedes</option>
<option value="follows">Follows</option>
<option value="copied_to">Copied to</option>
<option value="copied_from">Copied from</option></select>
Issue #<input size="10" type="text" name="relation[issue_to_id]" id="relation_issue_to_id" />
<span id="predecessor_fields" style="display:none;">
Delay: <input size="3" type="text" name="relation[delay]" id="relation_delay" /> days
</span>
<input type="submit" name="commit" value="Add" data-disable-with="Add" />
<a href="#" onclick="$(&quot;#new-relation-form&quot;).hide();; return false;">Cancel</a>
</p>

<script>
//<![CDATA[
observeAutocompleteField('relation_issue_to_id', '/issues/auto_complete?issue_id=917&project_id=exiv2&scope=all')
//]]>
</script>

<script>
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>
</div>

</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 3566" href="/projects/exiv2/repository/exiv2/revisions/3566">Revision 3566</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3566/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Jan 2015 11:19" href="/projects/exiv2/activity?from=2015-01-14">almost 7 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Modify exiv2/actions.cpp return -3/253 when no metadata has been found. (Closed)" href="/issues/917">#917</a>.  Thank you Thomas for the patch.  Very much appreciated.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 3567" href="/projects/exiv2/repository/exiv2/revisions/3567">Revision 3567</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3567/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Jan 2015 11:44" href="/projects/exiv2/activity?from=2015-01-14">almost 7 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Modify exiv2/actions.cpp return -3/253 when no metadata has been found. (Closed)" href="/issues/917">#917</a>.  Changing the condition for reporting an error.  We should not report an error for missing metadata when the user uses [-g match]+</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 3901" href="/projects/exiv2/repository/exiv2/revisions/3901">Revision 3901</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3901/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="27 Aug 2015 09:12" href="/projects/exiv2/activity?from=2015-08-27">about 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Modify exiv2/actions.cpp return -3/253 when no metadata has been found. (Closed)" href="/issues/917">#917</a>: Tweaks to the utility -p&lt;x&gt; return codes and info messages.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 3904" href="/projects/exiv2/repository/exiv2/revisions/3904">Revision 3904</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3904/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="27 Aug 2015 09:32" href="/projects/exiv2/activity?from=2015-08-27">about 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Modify exiv2/actions.cpp return -3/253 when no metadata has been found. (Closed)" href="/issues/917">#917</a>: Updated test results.</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-2603" class="journal has-notes">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="11 Aug 2013 18:34" href="/projects/exiv2/activity?from=2013-08-11">over 8 years</a> ago
      <span id="journal-2603-private_notes" class=""></span>
    </h4>

    <div id="journal-2603-notes" class="wiki"><p>Both current behaviors 1) and 2) are designed to meet the needs of both, users of the command line program - they can set -v to see some extra messages - and scripts - it is more concise to check the return value in a script than to parse the program's standard error output and it is easier if the program doesn't generate a lot of unneeded output. In addition, the behavior of the -g (grep) option follows that of the grep command, which also returns a non-zero value if it can't find what you're looking for. I guess one could argue what the default behavior should be (i.e., whether the program should output the -v messages by default and have a switch to suppress them instead), but I wouldn't be surprised if you can find an equal number of supporters for each of these options...</p></div>
    </div>
  </div>
  
  <div id="change-2604" class="journal has-notes">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="12 Aug 2013 13:27" href="/projects/exiv2/activity?from=2013-08-12">over 8 years</a> ago
      <span id="journal-2604-private_notes" class=""></span>
    </h4>

    <div id="journal-2604-notes" class="wiki"><p>Thanks for adding your comments, Andreas.</p>


	<p>Are you saying that you think we should not do anything about this?</p>


	<p>It's possible to make a case that the existing behavior is correct and requires no change.  Having discussed the matter in Topic 1582, Torsten has stated that he can work-around the current behavior.</p>


	<p>If you consider that we should do nothing, then please close this issue/feature as "Rejected".</p></div>
    </div>
  </div>
  
  <div id="change-3084" class="journal has-notes has-details">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="09 Jan 2015 11:20" href="/projects/exiv2/activity?from=2015-01-09">almost 7 years</a> ago
      <span id="journal-3084-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Assignee</strong> changed from <i>Robin Mills</i> to <i>Thomas Schmidt</i></li>
    </ul>
    <div id="journal-3084-notes" class="wiki"><p>Thomas</p>


	<p>May I ask you to have a look at this please?  This is a "gray one" in which the existing behaviour is neither right nor wrong.  I don't remember the details here, however you can see my thoughts when I opened this issue in response to topic 1582.</p>


	<p>If you would like a bigger challenge, it would be good to make the -g option respect regular expressions. <strong>However do not use boost</strong>.  The build consequences of boost outweigh the benefits of -g regular-expression.  If you know/find decent public domain code for regular-expressions, can you add it to utils.cpp and use it to support the -g option?</p>


	<p>Robin</p></div>
    </div>
  </div>
  
  <div id="change-3087" class="journal has-notes has-details">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4313">Thomas Schmidt</a> <a title="09 Jan 2015 22:49" href="/projects/exiv2/activity?from=2015-01-09">almost 7 years</a> ago
      <span id="journal-3087-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/708">0917_supportregexp.patch</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/708/0917_supportregexp.patch">0917_supportregexp.patch</a> added</li>
    </ul>
    <div id="journal-3087-notes" class="wiki"><p>On Linux, the GNU regex.h library seems to be available. I created a patch that will add support for regular-expressions in -g (attached), but I'm not sure if that compiles on all platforms...</p></div>
    </div>
  </div>
  
  <div id="change-3094" class="journal has-notes has-details">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4313">Thomas Schmidt</a> <a title="13 Jan 2015 23:05" href="/projects/exiv2/activity?from=2015-01-13">almost 7 years</a> ago
      <span id="journal-3094-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/709">0917_returnvaluesanderror.patch</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/709/0917_returnvaluesanderror.patch">0917_returnvaluesanderror.patch</a> added</li>
       <li><strong>Assignee</strong> changed from <i>Thomas Schmidt</i> to <i>Robin Mills</i></li>
    </ul>
    <div id="journal-3094-notes" class="wiki"><p>Patch attached for the following behavior:</p>


	<p>o Return code is only an error (-3 i.e. 253) if none of the requested meta data type is present: when all types are requested (-pa), any type suffices. When a specific type (e.g. IPTC, -pi) is requested, some data of its type must be present.</p>


	<p>o If tag filters are given, no error is returned when no key matches.</p>


	<p>o Error "No (Exif|IPTC|XMP) data found in the file" is reported without giving -v argument, but only if no data of another requested type is present.</p></div>
    </div>
  </div>
  
  <div id="change-3095" class="journal has-notes">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Jan 2015 11:23" href="/projects/exiv2/activity?from=2015-01-14">almost 7 years</a> ago
      <span id="journal-3095-private_notes" class=""></span>
    </h4>

    <div id="journal-3095-notes" class="wiki"><p><a class="changeset" title="#917.  Thank you Thomas for the patch.  Very much appreciated." href="/projects/exiv2/repository/exiv2/revisions/3566">r3566</a> Thank you very much to Thomas for working on this and providing the patch.</p>


	<p>I've modified Thomas code slightly and hope not to have introduced a bug.  If I have, I'll take ownership and fix it.  I've also updated test files which are impacted.  The test file output is modified because it now (correctly in my opinion) reports when no metadata is available to match the request.</p>


	<p>Thomas: you have been extremely help on <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Modify exiv2/actions.cpp return -3/253 when no metadata has been found. (Closed)" href="/issues/917">#917</a> and <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Provide regular expression support for the exiv2 -g feature (Closed)" href="/issues/1024">#1024</a>.  Thank You very much for getting involved with Exiv2.</p></div>
    </div>
  </div>
  
  <div id="change-3096" class="journal has-notes has-details">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Jan 2015 11:40" href="/projects/exiv2/activity?from=2015-01-14">almost 7 years</a> ago
      <span id="journal-3096-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Resolved</i></li>
       <li><strong>Assignee</strong> changed from <i>Robin Mills</i> to <i>Thomas Schmidt</i></li>
    </ul>
    <div id="journal-3096-notes" class="wiki"><p>I'm going to mark this as 'Resolved" as it builds and passes the test suite on the build server.  <a class="external" href="http://exiv2.dyndns.org:8080/job/Exiv2-trunk/1835/">http://exiv2.dyndns.org:8080/job/Exiv2-trunk/1835/</a></p>


	<p>I've also changed the Assignee to Thomas Schmidt to ensure he is credited with this fix when the v0.25 release notes are compiled.  Thank You, Thomas for working on this.</p></div>
    </div>
  </div>
  
  <div id="change-3097" class="journal has-notes">
    <div id="note-8">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-8" class="journal-link">#8</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Jan 2015 13:02" href="/projects/exiv2/activity?from=2015-01-14">almost 7 years</a> ago
      <span id="journal-3097-private_notes" class=""></span>
    </h4>

    <div id="journal-3097-notes" class="wiki"><p>Fix submitted: <a class="changeset" title="#917.  Thank you Thomas for the patch.  Very much appreciated." href="/projects/exiv2/repository/exiv2/revisions/3566">r3566</a> and <a class="changeset" title="#917.  Changing the condition for reporting an error.  We should not report an error for missing ..." href="/projects/exiv2/repository/exiv2/revisions/3567">r3567</a>.</p>


	<p>I've added this to try to persuade Redmine to associate those submissions with this issue.</p></div>
    </div>
  </div>
  
  <div id="change-3440" class="journal has-notes has-details">
    <div id="note-9">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-9" class="journal-link">#9</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="18 Apr 2015 07:46" href="/projects/exiv2/activity?from=2015-04-18">over 6 years</a> ago
      <span id="journal-3440-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Assigned</i></li>
    </ul>
    <div id="journal-3440-notes" class="wiki"><p>I'm going to reopen this because I'm rather unhappy with a consequence of the fix.  The most common report I request with exiv2 is -pa = print all.  However, if there is no IPTC metadata, a message is written to stderr, however the return code is set to 0.<pre>581 rmills@rmillsmbp:~/gnu/exiv2/trunk/test $ exiv2 -pa ~/R.jpg | wc
/Users/rmills/R.jpg: (No IPTC data found in the file)
     177     837   12153
582 rmills@rmillsmbp:~/gnu/exiv2/trunk/test $ echo $?
0
583 rmills@rmillsmbp:~/gnu/exiv2/trunk/test $ </pre>This is rather inconsistent.  If we write to stderr, we should set a return code that is != 0.  And equally, if we set a return code != 0, we should always write to stderr.</p>


	<p>I am very happy with the return code of 0.  I think the semantics of -pa are "give me all you can find" and no message "(No IPTC data found in the file)" should be reported by default.  The options -pa --verbose should report "No IPTC data found in the file" and set a return code of -3/253.  I'd also like to see us return -3 (and not 253).  The man page src/exiv2.1 should be updated with a section "EXIT STATUS" and the return codes documented as recommended here: <a class="external" href="https://wiki.archlinux.org/index.php/Man_page">https://wiki.archlinux.org/index.php/Man_page</a></p>


	<p>There are other related matters here.  The man page documents -pa as being the same as -Pkyct and -pt as -PEkyct.  There's something inconsistent about this (and may simply be a man page error).  We should also add the option -pe to report only Exif data (to correspond to options -pi and -px which report IPTC and XMP respectively.</p>


	<p>When we do this, we're going to change return codes and error messages.  We'll need to update the reference files in the test file.  This usually only involves copying output files from test/tmp/ to test/data.  For example, if bugfixes.sh reports something you understand, you can silence him with: <pre>cp tmp/bugfixes-test.out-stripped data/bugfixes-test.out</pre>Here's a summary:</p>


	<ol>
	<li>We should set a return code != 0 if we write to stderr</li>
		<li>We should always return a code != 0 if we write to stderr</li>
		<li>Fix odd codes such as 253 to be -3</li>
		<li>Add option -pe to only report Exif metadata</li>
		<li>Change semantics of -pa to be silent when the file does not contain any metadata sections (Exif, IPTC, XMP)</li>
		<li>Change semantics of -pa --verbose to complain when a metadata section is missing (and set return != 0)</li>
		<li>Add a section <em>EXIT STATUS</em> to the man page</li>
		<li>Review if the man page -pa == -Pkyct is true</li>
		<li>Update the man page about -pe (both Command Summary and Options)</li>
		<li>Clean up the reference files in the test suite</li>
	</ol>


	<p>I'll leave this assigned to Thomas S.  Thomas, if you're too busy to work on this, please assign it to me and I'll take care of it.</p></div>
    </div>
  </div>
  
  <div id="change-3558" class="journal has-details">
    <div id="note-10">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-10" class="journal-link">#10</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="28 Apr 2015 12:49" href="/projects/exiv2/activity?from=2015-04-28">over 6 years</a> ago
      <span id="journal-3558-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Assignee</strong> changed from <i>Thomas Schmidt</i> to <i>Robin Mills</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-3675" class="journal has-notes has-details">
    <div id="note-11">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-11" class="journal-link">#11</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="09 May 2015 08:10" href="/projects/exiv2/activity?from=2015-05-09">over 6 years</a> ago
      <span id="journal-3675-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Target version</strong> changed from <i>0.25</i> to <i>0.26</i></li>
    </ul>
    <div id="journal-3675-notes" class="wiki"><p>This behaviour has been in exiv2 for years.  There is insufficient time in v0.25 to undertake this work.  Punted to v0.26.</p></div>
    </div>
  </div>
  
  <div id="change-3766" class="journal has-details">
    <div id="note-12">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-12" class="journal-link">#12</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="23 May 2015 08:42" href="/projects/exiv2/activity?from=2015-05-23">over 6 years</a> ago
      <span id="journal-3766-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Assignee</strong> deleted (<del><i>Robin Mills</i></del>)</li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-4128" class="journal has-notes has-details">
    <div id="note-13">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-13" class="journal-link">#13</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="27 Aug 2015 09:09" href="/projects/exiv2/activity?from=2015-08-27">about 6 years</a> ago
      <span id="journal-4128-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Assignee</strong> set to <i>Andreas Huggel</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>50</i></li>
    </ul>
    <div id="journal-4128-notes" class="wiki"><blockquote>

	<p>1. We should set a return code != 0 if we write to stderr<br />2. We should always return a code != 0 if we write to stderr</p>


</blockquote>

	<p>That's difficult to implement and not practical imho. (The library may write to stderr without the utility knowing.)</p>


<blockquote>

	<p>3. Fix odd codes such as 253 to be -3</p>


</blockquote>

	<p>I don't know how to do that. It may be better to return small <strong>positive</strong> values instead.</p>


<blockquote>

	<p>4. Add option -pe to only report Exif metadata</p>


</blockquote>

	<p>There are several options to only report Exif metadata: -pt, -pv and -ph. Maybe we should rename -pt to -pe.</p>


<blockquote>

	<p>5. Change semantics of -pa to be silent when the file does not contain any metadata sections (Exif, IPTC, XMP)<br />6. Change semantics of -pa --verbose to complain when a metadata section is missing (and set return != 0)</p>


</blockquote>

	<p>Changed back to original: silent without -v, inform about absence of metadata with -v. In accordance with the "give me all you can find" comment I also see this as just an info message, not a complaint (warning or error), thus it now returns 0 in either case.</p>


<blockquote>

	<p>7. Add a section <em>EXIT STATUS</em> to the man page<br />8. Review if the man page -pa == -Pkyct is true</p>


</blockquote>

	<p>Yes, it is.</p>


<blockquote>

	<p>9. Update the man page about -pe (both Command Summary and Options)<br />10. Clean up the reference files in the test suite</p>


</blockquote>

	<p>Further, with -g or -K, exiv2 now returns 1 if no matching tags were found. That's in-line with UNIX grep.</p></div>
    </div>
  </div>
  
  <div id="change-4836" class="journal has-notes">
    <div id="note-14">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-14" class="journal-link">#14</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4643">Nigel Winterbottom</a> <a title="13 Mar 2016 12:26" href="/projects/exiv2/activity?from=2016-03-13">over 5 years</a> ago
      <span id="journal-4836-private_notes" class=""></span>
    </h4>

    <div id="journal-4836-notes" class="wiki"><p>This bug just bit me because I'm chaining actions in a find command. Of course the non-zero exit code of exiv2 prevents later actions happening. MY usage case has not been discussed above and can be summarised thus:</p>


<pre>
$ exiv2 -V
exiv2 0.22 001600 (32 bit build)
Copyright (C) 2004-2011 Andreas Huggel.
[snipped]

nigel@D8300:~$ exiv2 -v -Pv -g Exif.Image.Model ~/Pictures/CIMG4496.JPG 
File 1/1: /home/nigel/Pictures/CIMG4496.JPG
EX-Z40 
/home/nigel/Pictures/CIMG4496.JPG: No IPTC data found in the file
/home/nigel/Pictures/CIMG4496.JPG: No XMP data found in the file
nigel@D8300:~$ echo $?
253
nigel@D8300:~$
</pre>

	<p>Note I'm making no specific request to examine IPTC or XMP data.</p>


	<p>I'm on Ubuntu 12.04LTS and was quite prepared to build the latest from source but see 0.25 does not include any fix. Please include my usage in any further test cases.</p>


	<p>I'm going to try the perl module exiftool now - I hope it supports file renames because I have clashing file names across different Casio models and ultimately that's what I need to do.</p></div>
    </div>
  </div>
  
  <div id="change-4837" class="journal has-notes">
    <div id="note-15">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-15" class="journal-link">#15</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="13 Mar 2016 13:17" href="/projects/exiv2/activity?from=2016-03-13">over 5 years</a> ago
      <span id="journal-4837-private_notes" class=""></span>
    </h4>

    <div id="journal-4837-notes" class="wiki"><p>Thank you for your feedback on this matter.  I see you are using v0.22 which is rather elderly version of exiv2.  Perhaps you could try/test our daily build to see if you have a use case that defeats our fix.  You can collect it from:  <a class="external" href="http://exiv2.dyndns.org:8080/userContent/builds/Categorized/Platform/linux/">http://exiv2.dyndns.org:8080/userContent/builds/Categorized/Platform/linux/</a></p>


	<p>If you do find a flaw in our fix, I'll be happy to both repair it and and add a regression detector to our test suite.</p>


	<p>Thank You for using exiv2.</p></div>
    </div>
  </div>
  
  <div id="change-4842" class="journal has-notes">
    <div id="note-16">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-16" class="journal-link">#16</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Mar 2016 13:15" href="/projects/exiv2/activity?from=2016-03-14">over 5 years</a> ago
      <span id="journal-4842-private_notes" class=""></span>
    </h4>

    <div id="journal-4842-notes" class="wiki"><p>Your use-case appears to be fixed on the trunk:<pre>1071 rmills@rmillsmbp:~/clanmills $ exiv2 -v -Pv -g Exif.Image.Model http://clanmills.com/Stonehenge.jpg
File 1/1: http://clanmills.com/Stonehenge.jpg
NIKON D5300
1072 rmills@rmillsmbp:~/clanmills $ echo $?
0
1073 rmills@rmillsmbp:~/clanmills $ cd ~/temp ; curl -O http://clanmills.com/Stonehenge.jpg
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 6599k  100 6599k    0     0  1658k      0  0:00:03  0:00:03 --:--:-- 1934k
1074 rmills@rmillsmbp:~/temp $ exiv2 -di Stonehenge.jpg 
1075 rmills@rmillsmbp:~/temp $ exiv2 -dx Stonehenge.jpg 
1076 rmills@rmillsmbp:~/temp $ exiv2 -v -Pv -g Exif.Image.Model Stonehenge.jpg
File 1/1: Stonehenge.jpg
NIKON D5300
Stonehenge.jpg: No IPTC data found in the file
Stonehenge.jpg: No XMP data found in the file
1077 rmills@rmillsmbp:~/temp $ echo $?
0
1078 rmills@rmillsmbp:~/temp $ </pre></p></div>
    </div>
  </div>
  
  <div id="change-5599" class="journal has-notes has-details">
    <div id="note-17">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-17" class="journal-link">#17</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="16 Sep 2016 07:25" href="/projects/exiv2/activity?from=2016-09-16">about 5 years</a> ago
      <span id="journal-5599-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Closed</i></li>
       <li><strong>% Done</strong> changed from <i>50</i> to <i>100</i></li>
    </ul>
    <div id="journal-5599-notes" class="wiki"><p>I believe this is closed.</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/917.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/917.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
