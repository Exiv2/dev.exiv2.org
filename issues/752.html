<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #752: Crash when writing Exif.Image.Software - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="wRF0NP9WVKD2oz1/FrlLS3UAs9kmYB3i4LlDCgud+kkjXN/bjSyYoKPHInOpbkd4SpLnoNeDvFgdmdOCSKQdJg==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #752: Crash when writing Exif.Image.Software" href="https://dev.exiv2.org/issues/752.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #752</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Crash when writing Exif.Image.Software</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/555">Jim Nelson</a> <a title="21 Jan 2011 15:02" href="/projects/exiv2/activity?from=2011-01-21">almost 11 years</a> ago.
        Updated <a title="03 May 2012 17:15" href="/projects/exiv2/activity?from=2012-05-03">over 9 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/53">Andreas Huggel</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">exif</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="14 Feb 2011" href="/versions/48">0.21.1</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">21 Jan 2011</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Using the attached photo, Exiv2 0.20 and 0.21 (and <a class="changeset" title="Updated config.guess, config.sub" href="/projects/exiv2/repository/exiv2/revisions/2429">r2429</a>) will crash when writing anything to the Exif.Image.Software field:</p>


	<p>$ exiv2 -M"set Exif.Image.Software MyApp" img_1330.jpg<br />exiv2: tiffcomposite.cpp:1152: virtual uint32_t Exiv2::Internal::TiffDirectory::doWrite(Exiv2::Internal::IoWrapper&#38;, Exiv2::ByteOrder, int32_t, uint32_t, uint32_t, uint32_t&#38;): Assertion `sv == d' failed.<br />Aborted</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/227">img_1330.jpg</a>    <span class="size">(4.8 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/227/img_1330.jpg">img_1330.jpg</a>  </td>
  <td></td>
  <td>
      <span class="author">Jim Nelson, 21 Jan 2011 15:02</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/230">bug752-exiv2-0.20.patch</a>    <span class="size">(6.16 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/230/bug752-exiv2-0.20.patch">bug752-exiv2-0.20.patch</a>  </td>
  <td>Patch for 0.20 (binary compatible)</td>
  <td>
      <span class="author">Andreas Huggel, 31 Jan 2011 19:32</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>








</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 2435" href="/projects/exiv2/repository/exiv2/revisions/2435">Revision 2435</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/2435/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="30 Jan 2011 04:28" href="/projects/exiv2/activity?from=2011-01-30">almost 11 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Crash when writing Exif.Image.Software (Closed)" href="/issues/752">#752</a>: Do not decode duplicate binary array tags.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 2441" href="/projects/exiv2/repository/exiv2/revisions/2441">Revision 2441</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/2441/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="31 Jan 2011 23:11" href="/projects/exiv2/activity?from=2011-01-31">almost 11 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p>[0.21.1] Merged fix for <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Crash when writing Exif.Image.Software (Closed)" href="/issues/752">#752</a> from the trunk (c2435).</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-1852" class="journal has-notes">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="23 Jan 2011 05:38" href="/projects/exiv2/activity?from=2011-01-23">almost 11 years</a> ago
      <span id="journal-1852-private_notes" class=""></span>
    </h4>

    <div id="journal-1852-notes" class="wiki"><p>This is an interesting case. The image has a corrupted Canon makernote with 2 CanonCs composite tags. Exiv2 decodes both (although the data in the second one doesn't make any sense) but when it comes to writing, it tries to pack all CanonCs components back into only one composite tag and somehow gets confused in the process.</p></div>
    </div>
  </div>
  
  <div id="change-1855" class="journal has-notes has-details">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="30 Jan 2011 04:30" href="/projects/exiv2/activity?from=2011-01-30">almost 11 years</a> ago
      <span id="journal-1855-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>New</i> to <i>Resolved</i></li>
       <li><strong>Assignee</strong> set to <i>Andreas Huggel</i></li>
       <li><strong>Target version</strong> set to <i>0.22</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
    </ul>
    <div id="journal-1855-notes" class="wiki"><p>The second binary array is no longer decoded now.</p></div>
    </div>
  </div>
  
  <div id="change-1856" class="journal has-notes">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="30 Jan 2011 04:33" href="/projects/exiv2/activity?from=2011-01-30">almost 11 years</a> ago
      <span id="journal-1856-private_notes" class=""></span>
    </h4>

    <div id="journal-1856-notes" class="wiki"><pre>
$ exiv2 -M"set Exif.Image.Software MyApp" img_1330.jpg
Warning: Not decoding duplicate binary array tag 0x0001, group Canon, idx 28
Warning: Not decoding duplicate binary array tag 0x0001, group Canon, idx 28
$ exiv2 -g Exif.Image.Software -pa img_1330.jpg 
Warning: Not decoding duplicate binary array tag 0x0001, group Canon, idx 28
Exif.Image.Software                          Ascii       6  MyApp
</pre></div>
    </div>
  </div>
  
  <div id="change-1859" class="journal has-notes has-details">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="31 Jan 2011 19:32" href="/projects/exiv2/activity?from=2011-01-31">almost 11 years</a> ago
      <span id="journal-1859-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/230">bug752-exiv2-0.20.patch</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/230/bug752-exiv2-0.20.patch">bug752-exiv2-0.20.patch</a> added</li>
    </ul>
    <div id="journal-1859-notes" class="wiki"><p>The <a href="http://dev.exiv2.org/projects/exiv2/repository/revisions/2435/diff?format=diff&#38;rev_to=2434" class="external">patch for 0.21</a> can be downloaded from the repository. The resulting library remains binary compatible with 0.21.</p>


	<p>A binary compatible patch for 0.20 is attached too.</p></div>
    </div>
  </div>
  
  <div id="change-1867" class="journal has-details">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="08 Feb 2011 06:59" href="/projects/exiv2/activity?from=2011-02-08">almost 11 years</a> ago
      <span id="journal-1867-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Target version</strong> changed from <i>0.22</i> to <i>0.21.1</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-2141" class="journal has-details">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="03 May 2012 17:15" href="/projects/exiv2/activity?from=2012-05-03">over 9 years</a> ago
      <span id="journal-2141-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
    </ul>
    
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/752.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/752.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
