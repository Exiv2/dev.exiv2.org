<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #850: test harness does not run on CMake builds - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="UD38//FDvYB84WpTjLCdLcByTQoXfIrNYWEZWSQdT6eycFcQgzlxgCmFdV8zZ5Ee/+AZc+afK3ecQYnRZySoyA==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #850: test harness does not run on CMake builds" href="https://dev.exiv2.org/issues/850.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #850</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>test harness does not run on CMake builds</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="22 Sep 2012 15:51" href="/projects/exiv2/activity?from=2012-09-22">about 9 years</a> ago.
        Updated <a title="24 Jul 2013 15:22" href="/projects/exiv2/activity?from=2013-07-24">over 8 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/119">Robin Mills</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">testing</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="31 Jul 2013" href="/versions/50">0.24</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">22 Sep 2012</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-80"><tr><td style="width: 80%;" class="closed" title="80%"></td><td style="width: 20%;" class="todo"></td></tr></table><p class="percent">80%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>CMake builds executables in two directories build/src and build/samples.  The test harness uses the environment string EXIV2_BINDIR to locate executables.</p>


	<p>I build with CMake as follows:</p>


	<p>$ cd exiv2<br />$ mkdir build ; pushd build ; cmake .. ; make ; popd<br />$ pushd build/samples # copy the sampes executables to src bin<br />$ for i in $(ls -1 | egrep -v \\. | egrep -v Make); do cp $i ../src ; done<br />$ popd<br />$ cd test<br />$ make test EXIV2_BINDIR=$PWD/../build/src</p>


	<p>There are a couple of possible fixes:<br />1) Modify the test suite to respect EXIV2_PATH= colon separated directory search path<br />2) Modify the CMake code to build the samples into src (or copy them once they are built)</p>


	<p>I prefer solution 1.  Volker made a very nice job of adding the EXIV2_BINDIR feature to the test suite.  I'd like to see the "common" code in the test shell scripts put into "library.so" and sourced into the scripts.</p>
  </div>
</div>







</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 2935" href="/projects/exiv2/repository/exiv2/revisions/2935">Revision 2935</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/2935/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="04 Nov 2012 11:51" href="/projects/exiv2/activity?from=2012-11-04">about 9 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p>Issue: <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: test harness does not run on CMake builds (Closed)" href="/issues/850">#850</a>.  test scripts refactored.  Common code collected into functions.source.  Thanks to Shawn for his contribution.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 2942" href="/projects/exiv2/repository/exiv2/revisions/2942">Revision 2942</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/2942/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="10 Nov 2012 00:02" href="/projects/exiv2/activity?from=2012-11-10">about 9 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p>Issue: <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: test harness does not run on CMake builds (Closed)" href="/issues/850">#850</a>.  More test script refactoring. See SVN: 2935.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 2943" href="/projects/exiv2/repository/exiv2/revisions/2943">Revision 2943</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/2943/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="10 Nov 2012 12:24" href="/projects/exiv2/activity?from=2012-11-10">about 9 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p>Issue: <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: test harness does not run on CMake builds (Closed)" href="/issues/850">#850</a>.  Windows/cygwin fixes to SVN:2942</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 2945" href="/projects/exiv2/repository/exiv2/revisions/2945">Revision 2945</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/2945/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="11 Nov 2012 15:00" href="/projects/exiv2/activity?from=2012-11-11">about 9 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p>Issue: <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: test harness does not run on CMake builds (Closed)" href="/issues/850">#850</a>.  Removed function runTestCase() dependancy on variable datapath.</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-2319" class="journal has-notes has-details">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="04 Nov 2012 12:08" href="/projects/exiv2/activity?from=2012-11-04">about 9 years</a> ago
      <span id="journal-2319-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Category</strong> set to <i>testing</i></li>
       <li><strong>Target version</strong> set to <i>0.24</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>80</i></li>
    </ul>
    <div id="journal-2319-notes" class="wiki"><p>Fix submitted: SVN#2935.  Thanks to Shawn for his contribution to this effort.</p>


	<p>The test scripts have been refactored.  All bash functions have been put into functions.source and included into the test scripts with "source functions.source" at the start of each script.  functions.source includes new functions such as 'runTest' 'copyTestFile' 'copyTestFiles' and 'prepareTest'.</p>


	<p>I've tried to reduce every script to the code that is unique to that script and leave the house keeping details to functions.source.</p>


	<p>More simplification concerning result and difference analysis is possible.</p>


	<p>The test script 'crw-test.sh' remains unchanged.  It requires the program 'crwparse' (&lt;exiv2-dir&gt;/src/crwparse.cpp) which isn't build.  crwparse.cpp should be moved to &lt;exiv2-dir&gt;/samples.  Attempts to build crwparse caused linker errors.  I'm not going to do anything concerning about crwparse as this is off topic.</p>


	<p>I'd like very much to thank Shawn in China for his contribution to this issue.  Shawn has just joined the team and it's a tough challenge to work remotely with an old Scotsman in English! Thanks Shawn for making the effort and working on this with me.</p></div>
    </div>
  </div>
  
  <div id="change-2374" class="journal has-details">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="15 Jan 2013 19:55" href="/projects/exiv2/activity?from=2013-01-15">almost 9 years</a> ago
      <span id="journal-2374-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Resolved</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-2536" class="journal has-notes has-details">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="24 Jul 2013 15:22" href="/projects/exiv2/activity?from=2013-07-24">over 8 years</a> ago
      <span id="journal-2536-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
    </ul>
    <div id="journal-2536-notes" class="wiki"><p>Fixed in 0.24.</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/850.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/850.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
