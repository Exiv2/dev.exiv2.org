<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Patch #853: CMake: more flexible zlib detection - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="+nXHQJZGxZtpOFqzKeokveWyNZxq2DRQ1AwIl88afyoYOGyv5DwJmzxcRb+WPSiO2iBh5Zs7leopLJgfjCOYRQ==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Patch #853: CMake: more flexible zlib detection" href="https://dev.exiv2.org/issues/853.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Patch #853</h2>

<div class="issue tracker-4 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>CMake: more flexible zlib detection</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/2456">Daniel Kaneider</a> <a title="06 Oct 2012 05:38" href="/projects/exiv2/activity?from=2012-10-06">about 9 years</a> ago.
        Updated <a title="24 Jul 2013 15:21" href="/projects/exiv2/activity?from=2013-07-24">over 8 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/119">Robin Mills</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">build</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="31 Jul 2013" href="/versions/50">0.24</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">06 Oct 2012</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-90"><tr><td style="width: 90%;" class="closed" title="90%"></td><td style="width: 10%;" class="todo"></td></tr></table><p class="percent">90%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Hi,</p>


	<p>the zLib path is pretty hard-coded into cmake, although the FindZLib would consider more options. Especially I don't want to relay on a directory 'zlib-1.2.7', since we link various libraries against zlib and are already using the 1.2.7.1 version.</p>


	<p>Therefore my patch uses the cmake strategy to find zlib, and as a fall-back the old zlib path is used. In this way I can call CMake on the exiv2 project by calling for e.g.:<br /><pre>
cmake.exe -G "Visual Studio 11 Win64" -DZLIB_ROOT=..\zlib-1.2.7-dev;..\zlib-1.2.7-dev\Release .
</pre></p>


	<p>The script was tested with in-source exiv2 build on Win8, VS 2012 and CMake 2.8.9. Btw. the applied patch is against the 2890 svn version.</p>


	<p>Best,<br />Daniel</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/398">exiv2FlexZlib.patch</a>    <span class="size">(1.6 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/398/exiv2FlexZlib.patch">exiv2FlexZlib.patch</a>  </td>
  <td></td>
  <td>
      <span class="author">Daniel Kaneider, 06 Oct 2012 05:38</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>








</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 2893" href="/projects/exiv2/repository/exiv2/revisions/2893">Revision 2893</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/2893/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="06 Oct 2012 14:49" href="/projects/exiv2/activity?from=2012-10-06">about 9 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p>Fix.  Issue: <a class="issue tracker-4 status-5 priority-4 priority-default closed" title="Patch: CMake: more flexible zlib detection (Closed)" href="/issues/853">#853</a>.  More flexible way to detect and use existing Zlib libraries.  Thanks Daniel for providing this patch.</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-2255" class="journal has-notes has-details">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="06 Oct 2012 06:00" href="/projects/exiv2/activity?from=2012-10-06">about 9 years</a> ago
      <span id="journal-2255-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>New</i> to <i>Assigned</i></li>
       <li><strong>Assignee</strong> set to <i>Robin Mills</i></li>
       <li><strong>Priority</strong> changed from <i>High</i> to <i>Normal</i></li>
    </ul>
    <div id="journal-2255-notes" class="wiki"><p>Thank you very much indeed for this.  And for the patch on <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Please support std::wstring in exiv2 path access (Closed)" href="/issues/851">#851</a>.</p>


	<p>It is very helpful indeed that you provide a solution for the issue that you have encountered.  I'm still learning CMake and rather puzzled by FIND_LIBRARY on Windows.</p>


	<p>You'll notice that in TODO-CMAKE, I've listed "Revisit searching for zlib, expat and iconv".  I think you're pointing me in the right direction.  In README-CMAKE, Gilles said "Use them only if you're prepared to fix them.".  That's exactly what you've done and I appreciate your contribution.</p>


	<p>I'll review this later in the weekend and submit.</p>


	<p>If you have other thoughts and ideas about our CMake support, I will be very happy to accept your assistance and acknowledge your contribution.</p></div>
    </div>
  </div>
  
  <div id="change-2258" class="journal has-notes">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/133">Robin Mills</a> <a title="06 Oct 2012 23:23" href="/projects/exiv2/activity?from=2012-10-06">about 9 years</a> ago
      <span id="journal-2258-private_notes" class=""></span>
    </h4>

    <div id="journal-2258-notes" class="wiki"><p>I've make 3 commits today for your fixes for <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Exiv2 doesn&#39;t compile using cmake scripts (Closed)" href="/issues/844">#844</a>, <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: CMake error on Win8/VS2012 with XMP (patch included) (Closed)" href="/issues/852">#852</a> and <a class="issue tracker-4 status-5 priority-4 priority-default closed" title="Patch: CMake: more flexible zlib detection (Closed)" href="/issues/853">#853</a>.  Thank you for your contribution.  I've also built the code with CMake on Linux/Mac/Cygwin and they all built and pass the test suite.  So your fixes and suggestions have not caused issues to appear on non-MSVC builds.</p>


	<p>I also used CMake to build on DevStudio 2010 Win64 and that didn't work.  I haven't thought about MSVC/CMake since June, and it's time to give this more attention.  From your comments, I believe you have MSVC/CMake working OK with DevStudio/2012.  I will investigate the issues I encountered during this next week.  It could be simply that I haven't followed my own instructions!</p>


	<p>Thank you once more for taking the time to bring this to my attention and for providing patches.  Your contribution is appreciated.</p></div>
    </div>
  </div>
  
  <div id="change-2259" class="journal has-notes">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/2456">Daniel Kaneider</a> <a title="07 Oct 2012 02:39" href="/projects/exiv2/activity?from=2012-10-07">about 9 years</a> ago
      <span id="journal-2259-private_notes" class=""></span>
    </h4>

    <div id="journal-2259-notes" class="wiki"><p>Thanks for your fast response!</p>


	<p>CMake is quite a good tool, especially for Unix based systems. On Windows still many things don't work as smoothly as expected.</p>


	<p>With the current exiv2 version I get the exiv2 and exiv2lib sub-projects compiled, with a bunch of errors. This means I get various .exe, .lib and .dll files, but some post-build events give some errors. I'm satisfied with that result, getting my files I need, but you are right. It doesn't work as it should. <br />The current point for MSVC is that no tests build. IMHO the testsuite might build and run on Linux, but it's not done correctly. I've already seen the source of this problems, but those might require bigger patches...</p>


	<p>Since Windows is very strict regarding C++, from my experience it is the first platform to break compilation.</p></div>
    </div>
  </div>
  
  <div id="change-2271" class="journal has-notes has-details">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="13 Oct 2012 23:13" href="/projects/exiv2/activity?from=2012-10-13">about 9 years</a> ago
      <span id="journal-2271-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Resolved</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>90</i></li>
    </ul>
    <div id="journal-2271-notes" class="wiki"><p>Daniel</p>


	<p>Thanks again for all your splendid work on CMake/msvc.  I'm going to mark this matter as resolved.  Unless something arises from this, it'll be marked closed when at the end of the 0.24 development cycle.</p></div>
    </div>
  </div>
  
  <div id="change-2534" class="journal has-notes has-details">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="24 Jul 2013 15:21" href="/projects/exiv2/activity?from=2013-07-24">over 8 years</a> ago
      <span id="journal-2534-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
    </ul>
    <div id="journal-2534-notes" class="wiki"><p>Fixed in 0.24.</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/853.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/853.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
