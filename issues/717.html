<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #717: Writing Exif.Image.ImageDescription in ORF file corrupts file - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="CDXa6NgK3gz6g5pTl+bkCzrUbhQQLjRqf7frevpNyeLqeHEHqnASDK/nhV8oMeg4BUY6beHNldCCl3vyuXQujQ==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #717: Writing Exif.Image.ImageDescription in ORF file corrupts file" href="https://dev.exiv2.org/issues/717.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #717</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Writing Exif.Image.ImageDescription in ORF file corrupts file</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/937">Wouter Portegijs</a> <a title="31 Jul 2010 04:06" href="/projects/exiv2/activity?from=2010-07-31">over 11 years</a> ago.
        Updated <a title="22 Nov 2010 18:31" href="/projects/exiv2/activity?from=2010-11-22">almost 11 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value">-</div></div><div class="category attribute"><div class="label">Category:</div><div class="value">miscellaneous</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="01 Dec 2010" href="/versions/46">0.21</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">31 Jul 2010</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>After using macports on snowleopard to install v0.20 I finally could add the filename into the exif information, however when doing so with:<br />exiv2 -k -M "set Exif.Image.ImageDescription Ascii <em>7252283.ORF</em>__________________" _7152208.ORF<br />Changed the picture color in quicklook, a cyan cast. When opened in olympus viewer2 you only get to see the small preview.<br />I tried before with only the filename but that did not work so in the end I also tried keeping the length of the field the same, which did not help. I also tried with another photo but the result is the same.<br />Now my knowledge is severally limited into what goes wrong so I hope someone else could shine a light here.<br />I attached the original file and the difference of the exif info extracted with <br />exiv2 -u -p a _7152208.ORF >7152208.exif<br />and a second time after changing the imagedescription and then diff into the attached file.</p>


	<p>If more info is needed I will try and supply it.</p>


	<p>thnx in advance</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/189">_7152208.ORF</a>    <span class="size">(8.9 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/189/_7152208.ORF">_7152208.ORF</a>  </td>
  <td>the original image file</td>
  <td>
      <span class="author">Wouter Portegijs, 31 Jul 2010 04:06</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/190">7152208.exifdifference</a>    <span class="size">(1.04 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/190/7152208.exifdifference">7152208.exifdifference</a>  </td>
  <td>the difference in exif info</td>
  <td>
      <span class="author">Wouter Portegijs, 31 Jul 2010 04:06</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/193">difference.exif</a>    <span class="size">(1.64 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/193/difference.exif">difference.exif</a>  </td>
  <td>exif diff from 13 characters to 17 characters</td>
  <td>
      <span class="author">Wouter Portegijs, 06 Aug 2010 09:11</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>








</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 2304" href="/projects/exiv2/repository/exiv2/revisions/2304">Revision 2304</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/2304/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="07 Aug 2010 04:19" href="/projects/exiv2/activity?from=2010-08-07">over 11 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Writing Exif.Image.ImageDescription in ORF file corrupts file (Closed)" href="/issues/717">#717</a>: Retain TIFF IFD type when writing, removed unnecessary ValueType constructors.</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-1701" class="journal has-notes">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="01 Aug 2010 09:21" href="/projects/exiv2/activity?from=2010-08-01">over 11 years</a> ago
      <span id="journal-1701-private_notes" class=""></span>
    </h4>

    <div id="journal-1701-notes" class="wiki"><p>Using the current trunk, I get minimal differences between the before and after Exif data.<br />I suspect this is a duplicate of <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: exiv2 0.20 is corrupting ORF files from E-PL1 (Closed)" href="/issues/711">#711</a>.<br />Can you please test with Exiv2 from SVN and confirm?</p>


	<p>Thanks,<br />Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1702" class="journal has-notes">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/937">Wouter Portegijs</a> <a title="05 Aug 2010 01:23" href="/projects/exiv2/activity?from=2010-08-05">over 11 years</a> ago
      <span id="journal-1702-private_notes" class=""></span>
    </h4>

    <div id="journal-1702-notes" class="wiki"><p>I will try and install the svn this coming week but I am not 100% sure if I will succeed since I installed the v0.20 via macports.. And thus I need to figure out how to install from svn on a mac first.</p>


	<p>The svn command is not a problem though .... I know that one, it is more related to the configuring and making that i have some doubt in succeeding.</p></div>
    </div>
  </div>
  
  <div id="change-1703" class="journal has-notes">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/937">Wouter Portegijs</a> <a title="05 Aug 2010 12:31" href="/projects/exiv2/activity?from=2010-08-05">over 11 years</a> ago
      <span id="journal-1703-private_notes" class=""></span>
    </h4>

    <div id="journal-1703-notes" class="wiki"><p>Ok made some time 2day.<br />I did not get it to behave with macports ... so in the end I just did the make config ./configure and make<br />However Does the svn version still reply v0.20 when asked exiv2 -V ?<br />If so I think I am using the svn version now.... Otherwise you have to explain me how after/during compiling the v0.20 exiv2 file got into the src dir.</p>


	<p>Anyway there is an improvement? the difference between the exif info with the svn version is now this:</p>


<blockquote>

	<p>6c6<br />< Exif.Image.ImageDescription                  Ascii      32  OLYMPUS DIGITAL CAMERA         <br />---</p>


<blockquote>

	<p>Exif.Image.ImageDescription                  Ascii      32  <em>7252283.ORF</em>__________________</p>


</blockquote>

</blockquote>

	<p>This we expected and wanted ;)</p>


<blockquote>

	<p>34c34<br />< Exif.Photo.MakerNote                         Undefined 651928  (Binary value suppressed)<br />---</p>


<blockquote>

	<p>Exif.Photo.MakerNote                         Undefined 553310  (Binary value suppressed)</p>


</blockquote>

</blockquote>

	<p>this was not intended .... I guess . Anyway the picture after the change still has the cyan cast over it.</p>


	<p>Now I tried to change that field a couple of more times and at some point a whole bunch of fields are changed.</p></div>
    </div>
  </div>
  
  <div id="change-1704" class="journal has-notes">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="06 Aug 2010 01:47" href="/projects/exiv2/activity?from=2010-08-06">over 11 years</a> ago
      <span id="journal-1704-private_notes" class=""></span>
    </h4>

    <div id="journal-1704-notes" class="wiki"><p>Yes, the version in SVN is still 0.20 and from the remaining differences it looks like you're running the SVN version now. Congratulations! :)</p>


	<p>So in Quicklook (the Apple viewer, right?) it still has the cyan cast. I should be able to try this myself at home tonight.<br />Did you also check the image in Olympus viewer2? Does it still only show the thumbnail view? (I don't have this program)</p>


<blockquote>

	<p>Now I tried to change that field a couple of more times and at some point a whole bunch of fields are changed.</p>


</blockquote>

	<p>More differences are expected if you make the field larger than it was before. In this case Exiv2 will re-write the entire TIFF structure and offset-fields will change. That's expected and doesn't by itself have an impact on the metadata or the image. I would need to see the differences in order to tell if that's what happened.</p>


	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1705" class="journal has-notes has-details">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/937">Wouter Portegijs</a> <a title="06 Aug 2010 09:11" href="/projects/exiv2/activity?from=2010-08-06">over 11 years</a> ago
      <span id="journal-1705-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/193">difference.exif</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/193/difference.exif">difference.exif</a> added</li>
    </ul>
    <div id="journal-1705-notes" class="wiki"><blockquote>

	<p>So in Quicklook (the Apple viewer, right?) it still has the cyan cast. I should be able to try this myself at home tonight.</p>


</blockquote>

	<p>Quicklook is hitting the spacebar in the finder. Preview is the apple viewer kinda, but they have both the same behaviour</p>


<blockquote>

	<p>Did you also check the image in Olympus viewer2? Does it still only show the thumbnail view? (I don't have this program)</p>


</blockquote>

	<p>Forgot about that but I checked and it show still only the small preview.<br />I tried picasso also which shows the picture but in the system log this pops up<br />06-08-10 17:50:52    [0x0-0x317317].com.google.picasa<sup><a href="#fn23243">23243</a></sup>    /Users/wouter/_7152208.ORF: Unexpected end of file</p>


<blockquote><blockquote>

	<p>Now I tried to change that field a couple of more times and at some point a whole bunch of fields are changed.</p>


</blockquote>

	<p>More differences are expected if you make the field larger than it was before. In this case Exiv2 will re-write the entire TIFF structure and offset-fields will change. That's expected and doesn't by itself have an impact on the metadata or the image. I would need to see the differences in order to tell if that's what happened.</p>


</blockquote>

	<p><del>I did not enlarge the field I just redid the same command a couple of times...<br />./exiv2 -k -M "set Exif.Image.ImageDescription Ascii _7252283.ORF" _7152208.ORF<br />and again and again. Just to see what would happen.</del> Actually I just tried again and it does not seem to happen anymore indeed only after making bigger again from 13 characters to 17 characters gives more difference. see attached diff file</p></div>
    </div>
  </div>
  
  <div id="change-1706" class="journal has-notes has-details">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="07 Aug 2010 04:44" href="/projects/exiv2/activity?from=2010-08-07">over 11 years</a> ago
      <span id="journal-1706-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Category</strong> set to <i>miscellaneous</i></li>
       <li><strong>Status</strong> changed from <i>New</i> to <i>Resolved</i></li>
       <li><strong>Target version</strong> set to <i>0.21</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
    </ul>
    <div id="journal-1706-notes" class="wiki"><p>Can you try again with the latest version from SVN, <a class="changeset" title="#717: Retain TIFF IFD type when writing, removed unnecessary ValueType constructors." href="/projects/exiv2/repository/exiv2/revisions/2304">r2304</a> and confirm if that works for you as it does here and also retest with the Olympus software please?</p>


	<p>Exiv2 changed TIFF IFD offset types to normal LONG types (which are much more common for this purpose). That is fixed, Exiv2 now leaves those types alone and on my Mac Quicklook is happy.</p>


	<p>(And I learnt that hitting the spacebar in Finder shows a preview :)</p>


	<p>Thanks for reporting this issue.</p></div>
    </div>
  </div>
  
  <div id="change-1709" class="journal has-notes">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/937">Wouter Portegijs</a> <a title="11 Aug 2010 08:39" href="/projects/exiv2/activity?from=2010-08-11">over 11 years</a> ago
      <span id="journal-1709-private_notes" class=""></span>
    </h4>

    <div id="journal-1709-notes" class="wiki"><p>I was to slow it seems like.... the svn gave me revision 2309 so tried that ;)<br />The cast is indeed gone and within the olympus viewer2 application the picture seems to behave as expected as well.</p>


	<p>So thnx for fixing it.</p></div>
    </div>
  </div>
  
  <div id="change-1800" class="journal has-details">
    <div id="note-8">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-8" class="journal-link">#8</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="22 Nov 2010 18:31" href="/projects/exiv2/activity?from=2010-11-22">almost 11 years</a> ago
      <span id="journal-1800-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
    </ul>
    
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/717.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/717.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
