<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #1148: XMP Rights field padded with spaces - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="r2tVKgOAASUWb17d5/2zpBqsl+4G9k+fs00Z1QkSm/JNJv7FcfrNJUMLQdFYKr+XJT7Dl/cV7iVObYldSit8nQ==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #1148: XMP Rights field padded with spaces" href="https://dev.exiv2.org/issues/1148.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #1148</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>XMP Rights field padded with spaces</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/4598">John Huggins</a> <a title="08 Jan 2016 02:07" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago.
        Updated <a title="01 Feb 2016 11:36" href="/projects/exiv2/activity?from=2016-02-01">almost 6 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/119">Robin Mills</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">xmp</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="28 Apr 2017" href="/versions/52">0.26</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">08 Jan 2016</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value">10.00 h</div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>I have a jpg file 2014-2.jpg (attached) where the XMP "Rights" value is</p>


	<p>&lt;dc:rights&gt;<br /> &lt;rdf:Alt&gt;<br />   &lt;rdf:li xml:lang="x-default"&gt;2014 John Scot Huggins, All Rights Reserved&lt;/rdf:li&gt;<br /> &lt;/rdf:Alt&gt;<br />&lt;/dc:rights&gt;</p>


	<p>If I run exiv2 -pa 2014-2.jpg I get this in the relevant line (some spaces removed for clarity)...</p>
	<pre><code>Xmp.dc.rights   LangAlt 1 lang="x-default" 2014 John Scot Huggins, All Rights Reserved</code></pre>


	<p>Great.</p>


	<p>If I run exiv2 -ex 2014-2.jpg I find this in the 2014-2.exv file...</p>
	<pre><code>&amp;lt;dc:rights&amp;gt; &amp;lt;rdf:Alt&amp;gt; &amp;lt;rdf:li xml:lang="x-default"&amp;gt;2014 John Scot Huggins, All Rights Reserved&amp;lt;/rdf:li&amp;gt; &amp;lt;/rdf:Alt&amp;gt; &amp;lt;/dc:rights&amp;gt;</code></pre>


	<p>Also great.</p>


	<p>If I run exiv2 -eX 2014-2.jpg I find this in the 2014-2.xmp file (some spaces removed)...</p>
	<pre><code>&amp;lt;dc:rights&amp;gt;<br />    &amp;lt;rdf:Alt&amp;gt;<br />     &amp;lt;rdf:li xml:lang="x-default"&amp;gt;                                                      &amp;lt;/rdf:li&amp;gt;<br />    &amp;lt;/rdf:Alt&amp;gt;<br />   &amp;lt;/dc:rights&amp;gt;</code></pre>


	<p>...but not the spaces between the li tags which seem to be spaced padding for what should be the copyright message.</p>


	<p>All the other fields appear to be moving through the translations fine, but the one containing copyright information from the original embedded XML tag seems to have turned to spaces.</p>


	<p>Might I be doing something wrong?</p>


	<p>I am using 0.25 on Ubuntu, compiled from fresh source, but the older 0.19 version that came with my install of Ubuntu does the same thing.</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/879">2014-2.jpg</a>    <span class="size">(7.7 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/879/2014-2.jpg">2014-2.jpg</a>  </td>
  <td>Picture with the XMP in question</td>
  <td>
      <span class="author">John Huggins, 08 Jan 2016 02:07</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/880">phst.png</a>    <span class="size">(145 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/880/phst.png">phst.png</a>  </td>
  <td>Desired workflow flowchart</td>
  <td>
      <span class="author">John Huggins, 08 Jan 2016 15:19</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>







<hr />
<div id="relations">
<div class="contextual">
</div>

<p><strong>Related issues</strong></p>

<form data-cm-url="/issues/context_menu" action="/issues/1148" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="T4oOWeMAHLxByZ6dsel6hQXhmteCsZgR3Oy/8MUogrKtx6W2kXrQvBStgZEOPna2OnPOrnNSOashzC94hhFl3Q==" />
  <table class="list issues odd-even"><tr id="relation-201" class="issue hascontextmenu issue tracker-2 status-5 priority-4 priority-default closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="1057" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-2 status-5 priority-4 priority-default closed" href="/issues/1057">Feature #1057</a>: Implement target/modifier - (stdin/stdout) for exiv2 options -i (insert) and -e (extract)</td><td class="status">Closed</td><td class="start_date">17 Apr 2015</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr></table>
</form>
<form class="new_relation" id="new-relation-form" style="display: none;" action="/issues/1148/relations" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />


<p><select onchange="setPredecessorFieldsVisibility();" name="relation[relation_type]" id="relation_relation_type"><option selected="selected" value="relates">Related to</option>
<option value="duplicates">Is duplicate of</option>
<option value="duplicated">Has duplicate</option>
<option value="blocks">Blocks</option>
<option value="blocked">Blocked by</option>
<option value="precedes">Precedes</option>
<option value="follows">Follows</option>
<option value="copied_to">Copied to</option>
<option value="copied_from">Copied from</option></select>
Issue #<input size="10" type="text" name="relation[issue_to_id]" id="relation_issue_to_id" />
<span id="predecessor_fields" style="display:none;">
Delay: <input size="3" type="text" name="relation[delay]" id="relation_delay" /> days
</span>
<input type="submit" name="commit" value="Add" data-disable-with="Add" />
<a href="#" onclick="$(&quot;#new-relation-form&quot;).hide();; return false;">Cancel</a>
</p>

<script>
//<![CDATA[
observeAutocompleteField('relation_issue_to_id', '/issues/auto_complete?issue_id=1148&project_id=exiv2&scope=all')
//]]>
</script>

<script>
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>
</div>

</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 4174" href="/projects/exiv2/repository/exiv2/revisions/4174">Revision 4174</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4174/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Jan 2016 12:24" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: XMP Rights field padded with spaces (Closed)" href="/issues/1148">#1148</a>.  Fixed formatting error in jpgimage/-pS code.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4175" href="/projects/exiv2/repository/exiv2/revisions/4175">Revision 4175</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4175/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="09 Jan 2016 10:54" href="/projects/exiv2/activity?from=2016-01-09">almost 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: XMP Rights field padded with spaces (Closed)" href="/issues/1148">#1148</a> Fixed Todo: Should use XMP packet if there are no XMP modification commands</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4176" href="/projects/exiv2/repository/exiv2/revisions/4176">Revision 4176</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4176/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="09 Jan 2016 12:25" href="/projects/exiv2/activity?from=2016-01-09">almost 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: XMP Rights field padded with spaces (Closed)" href="/issues/1148">#1148</a> Correction to <a class="changeset" title="#1148 Fixed Todo: Should use XMP packet if there are no XMP modification commands" href="/projects/exiv2/repository/exiv2/revisions/4175">r4175</a> to fix test suite breaker.  We can only use the -pX short cut when option -eXx is used.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4220" href="/projects/exiv2/repository/exiv2/revisions/4220">Revision 4220</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4220/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="09 Mar 2016 07:51" href="/projects/exiv2/activity?from=2016-03-09">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Implement target/modifier - (stdin/stdout) for exiv2 options -i (insert) and -e (extract) (Closed)" href="/issues/1057">#1057</a>, <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: exiv2 -iX &lt;file.jpg&gt; deletes Makernote (Closed)" href="/issues/1064">#1064</a>, <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Add options -pS and -dI to application exiv2 (Closed)" href="/issues/922">#922</a>, <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: XMP Rights field padded with spaces (Closed)" href="/issues/1148">#1148</a>.  Work in progress.  This is a composite patch of several matters in development.  None are totally complete at this time.</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-4642" class="journal has-notes">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4598">John Huggins</a> <a title="08 Jan 2016 02:09" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago
      <span id="journal-4642-private_notes" class=""></span>
    </h4>

    <div id="journal-4642-notes" class="wiki"><p>Obviously I didn't format the carets correctly, but the problem is reasonably apparent even with the lt gt stuff.  Sorry about that.</p></div>
    </div>
  </div>
  
  <div id="change-4643" class="journal has-notes has-details">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Jan 2016 06:41" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago
      <span id="journal-4643-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>New</i> to <i>Assigned</i></li>
       <li><strong>Assignee</strong> set to <i>Robin Mills</i></li>
       <li><strong>Priority</strong> changed from <i>High</i> to <i>Normal</i></li>
       <li><strong>Target version</strong> set to <i>0.26</i></li>
    </ul>
    <div id="journal-4643-notes" class="wiki"><p>John</p>


	<p>Can I ask you to fix the carets to help me understand the issue.  Can I also ask you to use -pX which extracts the XMP from the image.  -pX is "raw".  It locates the XMP and copies it to stdout verbatim.</p></div>
    </div>
  </div>
  
  <div id="change-4644" class="journal has-notes">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Jan 2016 10:41" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago
      <span id="journal-4644-private_notes" class=""></span>
    </h4>

    <div id="journal-4644-notes" class="wiki"><p>I have a jpg file 2014-2.jpg (attached) where the XMP "Rights" value is:<pre>&lt;dc:rights&gt;
&lt;rdf:Alt&gt;
  &lt;rdf:li xml:lang="x-default"&gt;2014 John Scot Huggins, All Rights Reserved&lt;/rdf:li&gt;
&lt;/rdf:Alt&gt;
&lt;/dc:rights&gt;</pre>If I run exiv2 -pa 2014-2.jpg I get this in the relevant line (some spaces removed for clarity)...</p>
	<pre><code>Xmp.dc.rights   LangAlt 1 lang="x-default" 2014 John Scot Huggins, All Rights Reserved</code></pre>


	<p>Great. If I run exiv2 -ex 2014-2.jpg I find this in the 2014-2.exv file...<br /><pre> &lt;dc:rights&gt; &lt;rdf:Alt&gt; &lt;rdf:li xml:lang="x-default"&gt;2014 John Scot Huggins, All Rights Reserved&lt;/rdf:li&gt; &lt;/rdf:Alt&gt; &lt;/dc:rights&gt;</pre>Also great. If I run exiv2 -eX 2014-2.jpg I find this in the 2014-2.xmp file (some spaces removed)...<pre>&lt;dc:rights&gt;
   &lt;rdf:Alt&gt;
    &lt;rdf:li xml:lang="x-default"&gt;                                                      &lt;/rdf:li&gt;
   &lt;/rdf:Alt&gt;
  &lt;/dc:rights&gt;</pre>...but not the spaces between the li tags which seem to be spaced padding for what should be the copyright message.</p>


	<p>All the other fields appear to be moving through the translations fine, but the one containing copyright information from the original embedded XML tag seems to have turned to spaces.  Might I be doing something wrong?</p>


	<p>I am using 0.25 on Ubuntu, compiled from fresh source, but the older 0.19 version that came with my install of Ubuntu does the same thing.</p></div>
    </div>
  </div>
  
  <div id="change-4645" class="journal has-notes has-details">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Jan 2016 12:12" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago
      <span id="journal-4645-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>0</i> to <i>10</i></li>
       <li><strong>Estimated time</strong> set to <i>10.00 h</i></li>
    </ul>
    <div id="journal-4645-notes" class="wiki"><p>I may discuss this with Alan Pater, our XMP Engineer, as I'm wondering if the xml lang="x-default" is somehow implicated.  I'm surprised by this behaviour and instantly think <em><strong>bug</strong></em>.  I'll have to crawl through the code to see what's going on.  Let's ignore -pa as you are happy with that.  Here's my way of looking at this in pure XML.</p>


	<p>1) Extract and reformat the 'raw' XML:<pre>$ exiv2 -pX ~/Downloads/2014-2.jpg | xmllint --pretty 1 - &gt; ~/temp/raw.xmp</pre>2) Extract XML with -eX:<pre>$ exiv2 -eX --force --verbose ~/Downloads/2014-2.jpg ; xmllint --pretty 1 ~/Downloads/2014-2.xmp &gt; ~/temp/eX.xmp</pre>They are not the same!<pre>$ ls -alt ~/temp/*.xmp
-rw-r--r--+ 1 rmills  staff  4854  8 Jan 11:09 /Users/rmills/temp/eX.xmp
-rw-r--r--+ 1 rmills  staff  4178  8 Jan 10:56 /Users/rmills/temp/raw.xmp
$ </pre>3) Extract the Xmp section from the image into a .exv, and then extract the XML from the .exv:<pre>$ exiv2 -ex --force --verbose ~/Downloads/2014-2.jpg 
File 1/1: /Users/rmills/Downloads/2014-2.jpg
Writing XMP data from /Users/rmills/Downloads/2014-2.jpg to /Users/rmills/Downloads/2014-2.exv
$ exiv2 -pX ~/Downloads/2014-2.exv | xmllint --pretty 1 - &gt; ~/temp/exv.xmp
$ ls -alt ~/temp/*.xmp
-rw-r--r--+ 1 rmills  staff  3332  8 Jan 11:15 /Users/rmills/temp/exv.xmp
-rw-r--r--+ 1 rmills  staff  4854  8 Jan 11:09 /Users/rmills/temp/eX.xmp
-rw-r--r--+ 1 rmills  staff  4178  8 Jan 10:56 /Users/rmills/temp/raw.xmp
$ </pre>Oh dear, different again.  There's something to investigate here.</p>


	<p>I'm very familiar with -pX because I wrote it!  I was a little surprised that it worked on the .exv file, because -pX is documented to only work on JPG, TIFF and PNG.  So, I inspected the structure of the .exv file with -pS:<pre>$ exiv2 -pS ~/Downloads/2014-2.exv
STRUCTURE OF JPEG FILE: /Users/rmills/Downloads/2014-2.exv
 address | marker     | length  | data
       2 | 0x1        |       0 
       9 | 0xe1 APP1  |    5000 | http://ns.adobe.com/xap/1.0/.&lt;?x
    5011 | 0xd9 EOI  
$ </pre>Ah yes, a .exv file is a JPG with no image - only metadata.  Good.</p>


	<p>However, I didn't write -eX (extract to .xmp) or -ex (extract xmp to .exv), so I will to have to investigate.  The quick fix it to re-engineer the -eX and -ex code to use -pX.  However, I'm going to investigate how/why the three extracts are different and believe the XMPsdk which is compiled into exiv2 is responsible.  With -pX, the XMP is extracted directly from the image file without using XMPsdk.  For both -ex and -eX, the XMP is fed to XMPsdk and subsequently extracted.  When this happens, namespaces may be correctly added/removed and the formatting may be quite different.  For example, the ordering of xml attributes can be different.  However, the integrity of your data should be perfect.</p>


	<p>There is an English-English expression <em><strong>Great Scott</strong></em> which is something like <em>Eureka</em> (a reference to Scott of Antarctic, I believe).  When I use the command "grep Scott" on the xmp files, I get:<pre>$ grep Scot ~/temp/*.xmp
/Users/rmills/temp/eX.xmp:    &lt;rdf:Description xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" 
...
exif:SubjectDistanceRange="0" exif:GPSVersionID="2.3.0.0"&gt;
/Users/rmills/temp/eX.xmp:          &lt;rdf:li&gt;John Scott Huggins&lt;/rdf:li&gt;

/Users/rmills/temp/exv.xmp:    &lt;rdf:Description xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" 
...
...
MicrosoftPhoto:Rating="99"&gt;
/Users/rmills/temp/exv.xmp:          &lt;rdf:li&gt;John Scott Huggins&lt;/rdf:li&gt;
/Users/rmills/temp/exv.xmp:          &lt;rdf:li xml:lang="x-default"&gt;2014 John Scot Huggins, All Rights Reserved&lt;/rdf:li&gt;

/Users/rmills/temp/raw.xmp:      &lt;photoshop:Credit&gt;John Scott Huggins&lt;/photoshop:Credit&gt;
/Users/rmills/temp/raw.xmp:      &lt;photoshop:CaptionWriter&gt;John Scott Huggins&lt;/photoshop:CaptionWriter&gt;
/Users/rmills/temp/raw.xmp:          &lt;rdf:li&gt;John Scott Huggins&lt;/rdf:li&gt;
/Users/rmills/temp/raw.xmp:          &lt;rdf:li xml:lang="x-default"&gt;2014 John Scot Huggins, All Rights Reserved&lt;/rdf:li&gt;
$</pre> Incidentally, I'm surprised to see that your name is occasionally spelt Scot and mostly Scott.</p>


	<p>You'll be aware that I set the priority of this issue to "Normal" as I usually deal with issues within a couple of days.  If you urgently need a fix, I can easily modify the code for -eX and -ex to use -pX and thereby all three versions will be identical and free of artefacts from XMPsdk.  However as this issue has been in the code for years, it doesn't feel urgent to me and I would prefer to investigate why they are different and then decide on a remedy.  If you have a very urgent need to have this fixed, please let me know.</p></div>
    </div>
  </div>
  
  <div id="change-4646" class="journal has-notes has-details">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4598">John Huggins</a> <a title="08 Jan 2016 15:19" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago
      <span id="journal-4646-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/880">phst.png</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/880/phst.png">phst.png</a> added</li>
    </ul>
    <div id="journal-4646-notes" class="wiki"><p>Thanks for the attention gents.  My middle name is actually Scott, but I changed the spelling to 'Scot' only in the XMP sidecar file for the "Copyright" value managed by Photo Mechanic in my photo archive to help track what is going where.</p>


	<p>To get a sense of the desired workflow, see attached phst.png.  The online photo system upload procedure (with the yellow background) has a convenient two step process during the picture upload process.  The image files are in limbo between upload and actual importation into the photo archive.  As the online photo system thus far only understands IPTC, but everything else in my process is comfortably in the XMP camp, I am using the limbo step to perform a little meta tag manipulation (with green background) before the final importation process.</p>


	<p>Really the whole goal here is to get what Photo Mechanic manages as the term "Copyright" in its meta information management system to be the thing that shows up on the web site under the term "Copyright."  I almost have this working well, but, of course, the one bug I find is with the value copyright in the XMP context.</p>


	<p>Thanks for your help.</p>


	<p>John</p></div>
    </div>
  </div>
  
  <div id="change-4647" class="journal has-notes">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Jan 2016 15:25" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago
      <span id="journal-4647-private_notes" class=""></span>
    </h4>

    <div id="journal-4647-notes" class="wiki"><p>John</p>


	<p>Your message arrived when I was about push 'Submit'.  I read'll your message (and look at your drawing) in a moment.</p>


<hr />


	<p>OK.  A bit more analysis:</p>


	<p>1) Extract the 'raw' XML and inspect it:<pre>$ exiv2 -pX 2014-2.jpg | xmllint --pretty 1 -</pre>The xml is <strong>good</strong> with 43 bytes:<pre>      &lt;dc:rights&gt;
        &lt;rdf:Alt&gt;
          &lt;rdf:li xml:lang="x-default"&gt;2014 John Scot Huggins, All Rights Reserved&lt;/rdf:li&gt;
        &lt;/rdf:Alt&gt;
      &lt;/dc:rights&gt;</pre>2) Extract with -eX and inspect it:<pre>$ exiv2 -eX --force --verbose 2014-2.jpg  
File 1/1: 2014-2.jpg
Writing Exif data from 2014-2.jpg to ./2014-2.xmp
Writing XMP data from 2014-2.jpg to ./2014-2.xmp
$</pre>The XML is <strong>bad</strong> with 37 bytes:<pre>    &lt;dc:rights&gt;
    &lt;rdf:Alt&gt;
     &lt;rdf:li xml:lang="x-default"&gt;                                                      &lt;/rdf:li&gt;
    &lt;/rdf:Alt&gt;
   &lt;/dc:rights&gt;</pre>3) Extract with -ex (or -ea) to .exv, extract the XML from .exv with -pX:<pre>$ exiv2 -ex --force --verbose 2014-2.jpg
File 1/1: 2014-2.jpg
Writing XMP data from 2014-2.jpg to ./2014-2.exv
$ exiv2 -pX 2014-2.exv | xmllint --pretty 1 -</pre>The xml is <strong>good</strong> with 43 bytes:<pre>      &lt;dc:rights&gt;
        &lt;rdf:Alt&gt;
          &lt;rdf:li xml:lang="x-default"&gt;2014 John Scot Huggins, All Rights Reserved&lt;/rdf:li&gt;
        &lt;/rdf:Alt&gt;
      &lt;/dc:rights&gt;</pre></p>


	<p><em><strong>Conclusions:</strong></em></p>


	<p>We are on the same page.  We agree that:</p>


	<p>1) Something is wrong with -eX that is causing the copyright to be blanked.<br />2) The data was successfully read from the image into XMPsdk, because it's being correctly presented by -pa : <pre>$ exiv2 -pa 2014-2.jpg  | grep John
Exif.Image.Artist                            Ascii      19  John Scott Huggins
Xmp.photoshop.Credit                         XmpText    18  John Scott Huggins
Xmp.photoshop.CaptionWriter                  XmpText    18  John Scott Huggins
Xmp.dc.creator                               XmpSeq      1  John Scott Huggins
Xmp.dc.rights                                LangAlt     1  lang="x-default" 2014 John Scot Huggins, All Rights Reserved
$ </pre>It's curious that the blank string is a different length from the good string!</p>


	<p>I'll now focus my attention on -eX.  I hope I can find and fix this today.  I don't think I've ever worked in that part of the code, so wish me luck!</p></div>
    </div>
  </div>
  
  <div id="change-4648" class="journal has-notes">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Jan 2016 16:09" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago
      <span id="journal-4648-private_notes" class=""></span>
    </h4>

    <div id="journal-4648-notes" class="wiki"><p>Thanks for the drawing.  Very nice.  I can more or less follow your plot and see where exiv2 fits into the scheme of things.</p>


	<p>There's a rule in life which English people call <em>"jam side downwards"</em>.  If a slice of bread and jam slips off the table, it will always land on the jam side to ensure the maximum mess.  It might even land on <em><strong>the dog!</strong></em></p>


	<p>In your case, the most important metadata element is what Photo Mechanic calls "Copyright" which is XMP:<pre>&lt;dc:rights&gt; .... &lt;/dc:rights&gt;</pre>which is (of course) field that appears to be <em><strong>broken</strong></em> when you use exiv2 -eX</p>


	<p>You now have two work-arounds - itemised above as (1) <em><strong>exiv2 -pX</strong></em> and (3) <em><strong>exiv2 -ex</strong></em>  I will investigate (2) <em><strong>exiv2 -eX</strong></em> and let you know what I discover (and hopefully fix).</p>


	<p>I think you'll find that (1) <em><strong>exiv2 -pX</strong></em> is a good solution as the XMP/xml can be piped directly from the image to any file of your choosing.  When you use exiv2 -ex and exiv2 -eX, there is an intermediate file which may (or may not) be convenient.</p>


<hr />


	<p><em>Incidentally, there is a feature <strong>to be added in v0.26</strong> to redirect extract/import data to/from stdout/stdin <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: ICC Profile in APP2 segment. (Closed)" href="/issues/1074">#1074</a>.  <strong>I haven't implemented this yet</strong>, however it's intended to work as follows:<pre>$ exiv2 -eX- foo.jpg</pre>will not write to foo.xmp, instead it will write to stdout.  And a command such as:<pre>$ exiv2 -iX- foo.jpg</pre>will not import from foo.xmp, instead it will read from stdin.  My intended use case for this is to selectively copy metadata from one image to another.  For example, to copy the ICC profile from one image to another, the command will be:<pre>$ exiv2 -eC- foo.jpg | exiv2 -iC- another.tiff</pre>The command to copy the ICC profile from one image to many images will be the following beautiful and elegant command:<pre>$ exiv2 -eC- foo.jpg | exiv2 -iCi a.tiff b.png c.jpg ...</pre></em></p>


	<p>Thank You for using Exiv2.</p>


	<p><img src="http://exiv2.org/Exiv2Logo.png" alt="" /></p></div>
    </div>
  </div>
  
  <div id="change-4650" class="journal has-notes">
    <div id="note-8">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-8" class="journal-link">#8</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4598">John Huggins</a> <a title="08 Jan 2016 16:42" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago
      <span id="journal-4650-private_notes" class=""></span>
    </h4>

    <div id="journal-4650-notes" class="wiki"><p>The stdin/stdout capability is precisely what I was hoping for.  Not finding an way to do this at the moment, I do the steps in the green box of my flow chart using bash managing a temporary 2014-2.xmp file.  Right now I just copy the 2014-2.xmp to several files matching the derivative file names and then use exiv2 to insert data into each with full control of what each file gets with an exiv2 command with specific options for each.  A little clunky, but then again bash makes this a reasonable process.</p>


	<p>While the stdin/stdout aspect is certainly the way to go, I need to be sure the appropriate 'translation' occurs when writing XMP data to both XMP and IPTC of the original file.  I think I read in the docs when using the .xmp file as source, a proper translation to IPTC occurs when adding to a file.</p></div>
    </div>
  </div>
  
  <div id="change-4651" class="journal has-notes">
    <div id="note-9">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-9" class="journal-link">#9</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4035">Alan Pater</a> <a title="08 Jan 2016 16:58" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago
      <span id="journal-4651-private_notes" class=""></span>
    </h4>

    <div id="journal-4651-notes" class="wiki"><p>Looks like you guys have got it figured out for the most part!</p>


	<p>I'll just step in and ask if a request has been submitted to PhotoStore asking them to follow the MWG guidelines?</p>
	<pre><code><a class="external" href="http://www.metadataworkinggroup.org/pdf/mwg_guidance.pdf#page=42">http://www.metadataworkinggroup.org/pdf/mwg_guidance.pdf#page=42</a></code></pre></div>
    </div>
  </div>
  
  <div id="change-4652" class="journal has-notes">
    <div id="note-10">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-10" class="journal-link">#10</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Jan 2016 17:05" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago
      <span id="journal-4652-private_notes" class=""></span>
    </h4>

    <div id="journal-4652-notes" class="wiki"><p>I really like bash.  The syntax is ugly because bash scripting was layered on top of the unix command shell.  However it is polished, robust and omni-present tool.  Every Engineer should learn bash thoroughly.</p>


	<p>Alan Pater is our XMP Engineer.  Alan's not a C++ guy, he's a work-flow/metadata Engineer and understands the mysterious IPTC<->Exif<->XMP conversions.  He has something very big and important happening in his life/business, so let's only consult him when/if we are stuck.</p>


	<p>Alan:  I've just realised that you've been reading this.  Thanks for getting involved.  I think we'll get this one fixed today.</p></div>
    </div>
  </div>
  
  <div id="change-4653" class="journal has-notes">
    <div id="note-11">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-11" class="journal-link">#11</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4598">John Huggins</a> <a title="08 Jan 2016 18:30" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago
      <span id="journal-4653-private_notes" class=""></span>
    </h4>

    <div id="journal-4653-notes" class="wiki"><p>Alan Pater wrote:</p>


<blockquote>

	<p>Looks like you guys have got it figured out for the most part!</p>


	<p>I'll just step in and ask if a request has been submitted to PhotoStore asking them to follow the MWG guidelines?</p>


	<p><a class="external" href="http://www.metadataworkinggroup.org/pdf/mwg_guidance.pdf#page=42">http://www.metadataworkinggroup.org/pdf/mwg_guidance.pdf#page=42</a></p>


</blockquote>

	<p>Thanks much for this.  I should try to follow this standard myself to make sure my goals are not unrealistic and because standards are "good."  A request to read XMP has been forwarded to Ktools, but I'm glad to see someone made a document with solid suggestions on how to survive in the new age, especially when more than one format (IPTC, XML, etc.) exist at the same moment within an image.  It's like the old saying... If you have one clock, you know what time it is, where if you have more than one, you are never sure.</p>


	<p>In Ktools' defense, I did find some commented out XML parsing code in their files that is clearly a hint of the future of decoding XMP directly so I know they have been thinking about it.  Photostore is a pretty old program (2004 or so birth), but is still in development... and precisely what I desire in a stock photo online presence.</p>


	<p>In more defense of Ktools Photostore, I will say despite their inability to handle XMP natively (for whatever reason - probably just haven't caught up with the modern ways), they have a large body of well polished PHP code that works astonishingly well.  Thus the reason I'm bothering to iron out a few wrinkles (based on my own personal requirements) with the back-end scripting with exiv2.  It's kind of amazing they left this nice processing-gap between upload and import providing the opportunity to tweak the files.  Life doesn't usually work that way.</p>


	<p>In the end, I hope to have a solution that allows me to tag my main archive just once, and only once, with my preferred tools, and have that data flow to various targets automatically.  Thanks to exiv2 and this bug tracking system, I am likely less than a week away from meta data nirvana... until the standards change again of course... or I, knowing my luck thus far, stumble on a bug in bash or something :|</p>


	<p>Cheers</p></div>
    </div>
  </div>
  
  <div id="change-4656" class="journal has-notes">
    <div id="note-12">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-12" class="journal-link">#12</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Jan 2016 20:24" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago
      <span id="journal-4656-private_notes" class=""></span>
    </h4>

    <div id="journal-4656-notes" class="wiki"><p>John</p>


	<p>It's been a long day.  It's 8:23pm here in England.  We're building/remodelling our house and I've had to spend quite a lot of time on that today.  Time for some beer.  I'll continue on your issue tomorrow.  <a class="external" href="http://clanmills.com/Homepages/2015/Christmas.shtml">http://clanmills.com/Homepages/2015/Christmas.shtml</a></p>


	<p>You might find a bug in bash.  I'll be surprised.  I recently found a bug in grep.  Unbelievable - but true. <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: exiv2 output is inconsistent and seemingly random 1% of the time (Closed)" href="/issues/1105">#1105</a> <a class="external" href="http://dev.exiv2.org/issues/1105">http://dev.exiv2.org/issues/1105</a></p>


	<p>Standards are a good thing.  However the computer industry prefers competition.  Why do we need Exif, XMP, IPTC, ICC and on and on.  Oh, ascii data representation: XML and JSON.  Unix shells - bash, csh, ksh.  Data containers: TIFF, PDF and many others.  The fattest book on my book shelf is "Graphics File Formats" - 1500 pages of duplication, quirkiness and overlapping nonsense.  As the saying goes "I love Standards - there are so many to choose from!".</p>


	<p>In the Exiv2 project, our aim is to provide a "one stop shop for metadata".  We have XMP/IPTC/Exif under one roof on Mac/Linux/Windows.  We're adding some ICC and PDF support in v0.26.  If the engineers from Adobe, Apple, Google and Microsoft joined Exiv2, we could have a wonderful metadata engine.  We could all do less work and achieve more!</p></div>
    </div>
  </div>
  
  <div id="change-4657" class="journal has-details">
    <div id="note-13">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-13" class="journal-link">#13</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Jan 2016 20:24" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago
      <span id="journal-4657-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>10</i> to <i>50</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-4659" class="journal has-notes has-details">
    <div id="note-14">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-14" class="journal-link">#14</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="09 Jan 2016 11:35" href="/projects/exiv2/activity?from=2016-01-09">almost 6 years</a> ago
      <span id="journal-4659-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>50</i> to <i>60</i></li>
    </ul>
    <div id="journal-4659-notes" class="wiki"><p>John</p>


	<p>Mostly good news.  I've got a partial fix (explained below).</p>


	<p>I read your original email to Andreas about the server being down and you said something about:</p>


<blockquote>

	<p>While trying to find out if I can apply the meta information from a<br />single template XML file to several jpg images with noncorresponding<br />file names ...</p>


</blockquote>

	<p>Are you aware of the -mfilename syntax?  This enables you to use a file to store commands.  So, if you have a file "template.cmd" with your copyright notice, you could apply it to every tiff in a directory with: <pre>$ exiv2 -mtemplate.cmd *.tiff</pre>To every file in a tree:<pre>$ find . -name "*.tiff" -exec exiv2 -m{$PWD}/template.cmd {} \;</pre></p>


	<p>I recently modified:<code>-mfilename</code> to respect <code>-m-</code> meaning <em>stdin</em>  And added option -pV which is almost identical to -pv and adds 'set ' in front. <a class="external" href="http://dev.exiv2.org/boards/3/topics/2329">http://dev.exiv2.org/boards/3/topics/2329</a>  and <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Enable piping of selective copy of metadata between images  (Closed)" href="/issues/1137">#1137</a>  You could use this to extract metadata from a file and push it to another.  In the discussion with Nick (the user in that discussion), he wanted to copy GPS data and here's the example that is now in our test suite:<pre>$ exiv2 -PkV --grep GPSL http://dev.exiv2.org/attachments/download/805/DSC_7154.jpg | exiv2 -m- foo.jpg</pre></p>


	<p>You might find those features useful on your journey to Metadata Nirvana <em>wherever that might be</em> !  Be sure to send me a Post Card when you get there as I'm due a vacation to celebrate my 65th birthday on Monday week (January 18).  I'm pinned down with the construction project at home.</p>


<hr />


	<p>Partial Fix submitted: <a class="changeset" title="#1148 Fixed Todo: Should use XMP packet if there are no XMP modification commands" href="/projects/exiv2/repository/exiv2/revisions/4175">r4175</a>.  Would you believe it, there was a comment in the code:<pre>//Todo: Should use XMP packet if there are no XMP modification commands</pre>So, I changed that to:<pre>            // #1148 use XMP packet if there are no XMP modification commands
            if ( Params::instance().modifyCmds_.size() == 0 ) {
                // http://www.cplusplus.com/reference/ostream/ostream/ostream/
                std::filebuf fb;
                fb.open (target,std::ios::out);
                std::ostream os(&#38;fb);
                sourceImage-&gt;printStructure(os,Exiv2::kpsXMP);
                fb.close();
                return 0;
            } else {
                targetImage-&gt;setXmpData(sourceImage-&gt;xmpData());
            }</pre>And that makes good on my promise above:</p>


<blockquote>

	<p>The quick fix is to re-engineer the -eX code to use -pX</p>


</blockquote>

	<p>However, I'm not done for a couple of reasons:</p>


	<p>1) The test suite has thrown lots of exceptions which I will have to investigate<br />Most will be the format of the code in the side-car<br />However there are messages about "Exiv2 exception in insert action".  Ummm.  Got to investigate, although I'm almost certain I know what has caused that and how to fix it.  Hopefully that will be cleaned up this morning.</p>


	<p>2) This fix doesn't address the issue that &lt;dc:rights&gt;...&lt;dc:rights&gt;has been blanked out.  This fix does not change -eX when there are modification commands in addition to -eX.</p></div>
    </div>
  </div>
  
  <div id="change-4662" class="journal has-notes has-details">
    <div id="note-15">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-15" class="journal-link">#15</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="09 Jan 2016 13:41" href="/projects/exiv2/activity?from=2016-01-09">almost 6 years</a> ago
      <span id="journal-4662-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>60</i> to <i>80</i></li>
    </ul>
    <div id="journal-4662-notes" class="wiki"><p>First the <strong>Good News</strong>: I've fixed the test suite: <a class="changeset" title="#1148 Correction to r4175 to fix test suite breaker.  We can only use the -pX short cut when opti..." href="/projects/exiv2/repository/exiv2/revisions/4176">r4176</a>.</p>


	<p>Even <strong>Better News</strong>:  I know why the copyright is being blanked out.  You have it in the Exif and Xmp metadata:<pre>599 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pa --grep right/i 2014-2.jpg 
Exif.Image.Copyright                         Ascii      55                                                        
Exif.NikonPc.Brightness                      Byte        1  Normal
Xmp.xmpRights.Marked                         XmpText     4  True
Xmp.xmpRights.WebStatement                   XmpText    27  http://huggins.photography/
Xmp.xmpRights.UsageTerms                     LangAlt     1  lang="x-default" For consideration only, no reproduction without prior permission.
Xmp.dc.rights                                LangAlt     1  lang="x-default" 2014 John Scot Huggins, All Rights Reserved
$ </pre>When you open that file, the library populates the XMPsdk from the file.  Then, it performs mysterious conversions.  Exif.Image.Copyright -> dc:rights.  Then you write out a side car with the blanks.  The fix is to remove Exif.Image.Copyright and all will be well.<pre>$ exiv2 -M'del Exif.Image.Copyright' foo.jpg; exiv2 -eXx foo.jpg</pre></p>


	<p>And now a little <em><strong>unhappy news</strong></em>: We cannot only use the code in <strong><code>$ exiv2 -pX foo.jpg</code></strong> as a substitute for the command:<pre>$ exiv2 -eXx file ...</pre>And the reason is documented in man (1) exiv2.  The <strong><code>-eX</code></strong> option says:<pre>X  :  Insert  metadata  from an XMP sidecar file &lt;file&gt;.xmp. The
      remaining insert targets determine what metadata to insert  from
      the  sidecar  file.  Possible  are  Exif,  IPTC  and XMP and the
      default is all of these. Note that the inserted  XMP  properties
      include those converted to Exif and IPTC.</pre><em><strong>Worse</strong></em> we cannot use the <strong><code>-pX</code></strong> code an alternative to <strong><code>-eXx</code></strong>.</p>


	<p>The <strong><code>-pX</code></strong> code reads the XMP directly from the image.<br />The <strong><code>-eXx</code></strong> code reads the XMP and the Exif and IPTC data from the image.  Does various conversions IPTC->XMP and Exif->XMP.  Then it writes a XMP sidecar which contains all those conversions.</p>


	<p>To avoid all this Exif/IPTC conversion code, I will a new tgt modifier X, so the command: <pre>$ exiv2 -eXX</pre>Will extract the raw XMP from the image and write it to the sidecar.  I'm going to have lunch and go the movies this afternoon with my wife.  I'll add the -eXX option this evening and we're done on this one.</p></div>
    </div>
  </div>
  
  <div id="change-4666" class="journal has-notes">
    <div id="note-16">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-16" class="journal-link">#16</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4598">John Huggins</a> <a title="09 Jan 2016 16:31" href="/projects/exiv2/activity?from=2016-01-09">almost 6 years</a> ago
      <span id="journal-4666-private_notes" class=""></span>
    </h4>

    <div id="journal-4666-notes" class="wiki"><p>Understood on all counts.  Thanks for your time.</p></div>
    </div>
  </div>
  
  <div id="change-4667" class="journal has-notes">
    <div id="note-17">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-17" class="journal-link">#17</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4598">John Huggins</a> <a title="09 Jan 2016 17:39" href="/projects/exiv2/activity?from=2016-01-09">almost 6 years</a> ago
      <span id="journal-4667-private_notes" class=""></span>
    </h4>

    <div id="journal-4667-notes" class="wiki"><p>Some success to report given all I've learned on this thread.  This script...</p>


<pre>
#!/bin/bash

# obtain XML meta tags from primary imaage and store in .xmp sidecar file
/usr/local/bin/exiv2 -pX $1.jpg &gt; $1.xmp

# copy the xmp file to the derivative file root names.xmp
cp $1.xmp icon_$1.xmp
cp $1.xmp sample_$1.xmp
cp $1.xmp thumb_$1.xmp

# strip the tags from the primary and derivative images
/usr/local/bin/exiv2 -d a $1.jpg
/usr/local/bin/exiv2 -d a icon_$1.jpg
/usr/local/bin/exiv2 -d a sample_$1.jpg
/usr/local/bin/exiv2 -d a thumb_$1.jpg

# insert XML back into primary image along with the IPTC for Ktools to use
/usr/local/bin/exiv2 -iixX $1.jpg

# insert only XML into the derivative images
/usr/local/bin/exiv2 -ixX icon_$1.jpg
/usr/local/bin/exiv2 -ixX sample_$1.jpg
/usr/local/bin/exiv2 -ixX thumb_$1.jpg

# delet the xmp sidecar files
rm *$1.xmp
</pre>

	<p>...is now performing my goals quite well as can be seen in the final (temporary) web display of this handsome beast...</p>
	<pre><code><a class="external" href="http://huggins.photography/media.details.php?mediaID=104">http://huggins.photography/media.details.php?mediaID=104</a></code></pre>


	<p>The appropriate data is stored in the Photostore database and the various derivative images are tagged precisely the way I want them to be.  The only caveat is the original image has both IPTC and XMP data (just so Photostore can read them), but now they are totally in sync (with IPTC a copy of the primary XMP data).</p>


	<p>So the meat and potatoes works.  Now I just have to figure out how to get Photostore to run the script after upload, but that's not a problem with exiv2.</p>


	<p>There are probably 100 better ways of doing this, but it's nice to have something that works.</p></div>
    </div>
  </div>
  
  <div id="change-4668" class="journal has-notes">
    <div id="note-18">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-18" class="journal-link">#18</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="09 Jan 2016 21:52" href="/projects/exiv2/activity?from=2016-01-09">almost 6 years</a> ago
      <span id="journal-4668-private_notes" class=""></span>
    </h4>

    <div id="journal-4668-notes" class="wiki"><p>This is good news.  Well done, John.  There's more than one way to do anything.  And for sure, getting code to work is step 1 in a process of refinement.  For example, I'd use loops to shorten your code.  Something like:<pre>for i in "$1.jpg" "icon_$1.jpg" "sample_$1.jpg" "thumb_$1.jpg"; do
    /usr/local/bin/exiv2 -d a "$i" 
done</pre></p>


	<p>Here's the bill for help you have been given. I'd like you to visit OpenHub.net and register (it's free).<br />On the Exiv2 page, click <em><strong>I use this</strong></em>.  Give the Exiv2 project a great rating <em><strong>and/or</strong></em> a review <em><strong>and/or</strong></em> give me kudos.</p>


	<p>Exiv2: <a class="external" href="https://www.openhub.net/p/exiv2">https://www.openhub.net/p/exiv2</a><br />Clanmills: <a class="external" href="https://www.openhub.net/p/exiv2/contributors/60065117754297">https://www.openhub.net/p/exiv2/contributors/60065117754297</a></p>


	<p>I'm not going to submit the code for -eXX today.  I've written it and surprised that it is more complicated than expected.  It's 9:51pm.  I'll sleep on this and do something about it tomorrow.</p>


	<p>I'm not sure I understand why you have to run code on Photostore.  Does their uploader remove metadata?  Anyway, if it's not the concern of exiv2, I don't need to know.</p></div>
    </div>
  </div>
  
  <div id="change-4676" class="journal has-notes">
    <div id="note-19">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-19" class="journal-link">#19</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4598">John Huggins</a> <a title="11 Jan 2016 16:55" href="/projects/exiv2/activity?from=2016-01-11">almost 6 years</a> ago
      <span id="journal-4676-private_notes" class=""></span>
    </h4>

    <div id="journal-4676-notes" class="wiki"><p>Robin Mills wrote:</p>


<blockquote>

	<p>Here's the bill for help you have been given. I'd like you to visit OpenHub.net and register (it's free).<br />On the Exiv2 page, click <em><strong>I use this</strong></em>.  Give the Exiv2 project a great rating <em><strong>and/or</strong></em> a review <em><strong>and/or</strong></em> give me kudos.</p>


	<p>Exiv2: <a class="external" href="https://www.openhub.net/p/exiv2">https://www.openhub.net/p/exiv2</a><br />Clanmills: <a class="external" href="https://www.openhub.net/p/exiv2/contributors/60065117754297">https://www.openhub.net/p/exiv2/contributors/60065117754297</a></p>


</blockquote>

	<p>Will do as soon as I figure out a way to get an account without verification via phone or github.</p>


<blockquote>

	<p>I'm not going to submit the code for -eXX today.  I've written it and surprised that it is more complicated than expected.  It's 9:51pm.  I'll sleep on this and do something about it tomorrow.</p>


	<p>I'm not sure I understand why you have to run code on Photostore.  Does their uploader remove metadata?  Anyway, if it's not the concern of exiv2, I don't need to know.</p>


</blockquote>

	<p>The photostore upload process leaves the original file intact, but does strip metadata from the three derivative files it generates for thumbs, samples, etc.  The second step of the process is to import them into the gallery structure.  It is here the meta tags in the original file are examined to populate the details of the photo.  As of today, it appears photostore only reads IPTC.  With the exiv2 script I have now, my orginal and the derivative images are tagged with XMP and have IPTC copy added to the original file (just so photostore gets the information into its database.</p>


	<p>Convoluted?  Yes.  Ideal?  No, but it seems to work.</p>


	<p>John</p></div>
    </div>
  </div>
  
  <div id="change-4778" class="journal has-details">
    <div id="note-20">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-20" class="journal-link">#20</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="01 Feb 2016 11:36" href="/projects/exiv2/activity?from=2016-02-01">almost 6 years</a> ago
      <span id="journal-4778-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Closed</i></li>
       <li><strong>% Done</strong> changed from <i>80</i> to <i>100</i></li>
    </ul>
    
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/1148.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/1148.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
