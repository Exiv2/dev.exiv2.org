<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #657: Nef Metadata edit with Digikam make impossible to open it with captureNX or ViewNX - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="VAzrkSdESVoYI+OwEhp7QfHxU2A81X/GreST/M+G/i+2QUB+VT6FWk1H/LytzXdyzmMHGc023nxQxAN0jL8ZQA==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #657: Nef Metadata edit with Digikam make impossible to open it with captureNX or ViewNX" href="https://dev.exiv2.org/issues/657.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #657</h2>

<div class="issue tracker-1 status-5 priority-5 priority-high3 closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Nef Metadata edit with Digikam make impossible to open it with captureNX or ViewNX</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/291">Nicolas Boulesteix</a> <a title="20 Nov 2009 11:27" href="/projects/exiv2/activity?from=2009-11-20">about 12 years</a> ago.
        Updated <a title="30 Dec 2009 07:50" href="/projects/exiv2/activity?from=2009-12-30">almost 12 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">High</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value">-</div></div><div class="category attribute"><div class="label">Category:</div><div class="value">exif</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="30 Dec 2009" href="/versions/44">0.19</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">20 Nov 2009</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Hi,</p>


	<p>Gilles Caulier suggest me to open a new issue after a post in Digikam User list.</p>


	<p>there is the original message :</p>


	<p>"I have edit metadata of a lot of NEF files, obtained directly from the  <br />camera, with Digikam 1.0 beta5(repository version of Ubuntu 9.10).<br />But I'am unable to open their in CaptureNX v2.2.2 (a black picture appear  <br />and processing continue without end) nor with ViewNX v1.5 (Unsuppported  <br />filetype message is given when i try to view the RAW picture).</p>


	<p>As for the previous issue of exiv2 (<a class="issue tracker-1 status-5 priority-6 priority-high2 closed" title="Bug: Exiv2 corrupts certain NEF images when writing to them (digiKam bug 193228) (Closed)" href="/issues/636">#636</a>), i try to install Exiv2 from SVN  <br />and to type in a terminal:</p>


	<p>exiv2 -M'set Exif.MakerNote.ByteOrder II' (with the path to my corrupt  <br />file), but with no result.</p>


	<p>I search for a new Exiv2 issue about NEF but i don't found any, so i post  <br />two versions of a nef file of wich one with the K at the filename end is  <br />unopenable with nikon softwares.</p>


	<p><a class="external" href="http://photonoxx.free.fr/digikamNX2/nb-photos-20090715-142043.nef">http://photonoxx.free.fr/digikamNX2/nb-photos-20090715-142043.nef</a></p>


	<p><a class="external" href="http://photonoxx.free.fr/digikamNX2/nb-photos-20090715-142043K.nef">http://photonoxx.free.fr/digikamNX2/nb-photos-20090715-142043K.nef</a></p>


	<p>My components info in digikam are followings</p>


	<p>digiKam version 1.0.0-beta5<br />Exiv2 can write to Jp2: Yes<br />Exiv2 can write to Jpeg: Yes<br />Exiv2 can write to Pgf: No<br />Exiv2 can write to Png: Yes<br />Exiv2 can write to Tiff: Yes<br />Exiv2 supports XMP metadata: Yes<br />LibCImg: 130<br />LibExiv2: 0.18.2<br />LibJPEG: 62<br />LibJasper: 1.900.1<br />LibKDE: 4.3.2 (KDE 4.3.2)<br />LibKExiv2: 0.6.0<br />LibKdcraw: 0.5.0<br />LibLCMS: 118<br />LibPGF: 6.09.33<br />LibPNG: 1.2.37<br />LibQt: 4.5.2<br />LibRaw: 0.7.2<br />LibTIFF: LIBTIFF, Version 3.8.2 Copyright (c) 1988-1996 Sam Leffler  <br />Copyright (c) 1991-1996 Silicon Graphics, Inc.<br />Marble widget: 0.8.1<br />Parallelized demosaicing: Yes<br />LibGphoto2: 2.4.6<br />LibKipi: 0.4.0"</p>


	<p>It's strange because I already use digikam and Exiv2 to edit metadata without problems...</p>


	<p>So, if anybody have an idea about that I'll be very gratefull</p>


	<p>Nicolas</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/115">nb-photos-20090715-142043.nef</a>    <span class="size">(8.14 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/115/nb-photos-20090715-142043.nef">nb-photos-20090715-142043.nef</a>  </td>
  <td>sample Nef directly obtained from camera (openable with CaptureNX)</td>
  <td>
      <span class="author">Nicolas Boulesteix, 20 Nov 2009 11:27</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/116">nb-photos-20090715-142043K.nef</a>    <span class="size">(8.14 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/116/nb-photos-20090715-142043K.nef">nb-photos-20090715-142043K.nef</a>  </td>
  <td>sample Nef after exiv2 metadata edit (unopenable)</td>
  <td>
      <span class="author">Nicolas Boulesteix, 20 Nov 2009 11:27</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/117">bug657.patch</a>    <span class="size">(1.14 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/117/bug657.patch">bug657.patch</a>  </td>
  <td>Rename tag Exif.Nikon3.0x008d from ColorMode to ColorHue</td>
  <td>
      <span class="author">Andreas Huggel, 23 Nov 2009 23:13</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/118">DSC_2854digikam_with_ColorHue.NEF</a>    <span class="size">(7.05 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/118/DSC_2854digikam_with_ColorHue.NEF">DSC_2854digikam_with_ColorHue.NEF</a>  </td>
  <td>digiKam modified image with Exif.Nikon3.0x008d added</td>
  <td>
      <span class="author">Andreas Huggel, 24 Nov 2009 01:37</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>








</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 1931" href="/projects/exiv2/repository/exiv2/revisions/1931">Revision 1931</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/1931/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="24 Nov 2009 07:01" href="/projects/exiv2/activity?from=2009-11-24">almost 12 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-5 priority-high3 closed" title="Bug: Nef Metadata edit with Digikam make impossible to open it with captureNX or ViewNX (Closed)" href="/issues/657">#657</a>: Fixed tag name of Exif.Nikon3.0x008d to ColorHue.</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-1375" class="journal has-notes">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/291">Nicolas Boulesteix</a> <a title="21 Nov 2009 03:01" href="/projects/exiv2/activity?from=2009-11-21">almost 12 years</a> ago
      <span id="journal-1375-private_notes" class=""></span>
    </h4>

    <div id="journal-1375-notes" class="wiki"><p>I just try to copy exif data from original file to unopenable one with exiftool with this command line :</p>
	<pre><code>exiftool -exif:all= -tagsfromfile nb-photos-20090715-142043.nef -exif:all nb-photos-20090715-142043K.nef</code></pre>


	<p>And it appears that unopenable NEF became openable again with CaptureNX and apparently keep other metadatas.</p>


	<p>So it seems it's may be an exif matters, I hope it's help you.</p>


	<p>Nicolas</p></div>
    </div>
  </div>
  
  <div id="change-1376" class="journal has-notes">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/291">Nicolas Boulesteix</a> <a title="21 Nov 2009 14:54" href="/projects/exiv2/activity?from=2009-11-21">almost 12 years</a> ago
      <span id="journal-1376-private_notes" class=""></span>
    </h4>

    <div id="journal-1376-notes" class="wiki"><p>It seems the solution above doesn't work for NEF which was already modified by CaptureNX and after metadata edited by exiv2.</p>


	<p>So I hope a solution could be found.</p>


	<p>Thanks</p>


	<p>Nicolas</p></div>
    </div>
  </div>
  
  <div id="change-1377" class="journal has-notes">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="22 Nov 2009 23:47" href="/projects/exiv2/activity?from=2009-11-22">almost 12 years</a> ago
      <span id="journal-1377-private_notes" class=""></span>
    </h4>

    <div id="journal-1377-notes" class="wiki"><p>The corrupt picture has an incomplete makernote. In particular, there is no whitebalance info in the makernote anymore. The image data seems to be intact. Exiv2 typically doesn't discard this information without being instructed to do so.</p>


	<p>I'm also not clear about what exactly was done to the sample images attached. Even the first one, nb-photos-20090715-142043.nef, looks like it has been edited: It contains IPTC data, a user comment and GPS coordinates. The second one looks like it was edited not only with digiKam but also with ViewNX: it has a Exif.Image.Software tag that contains "ViewNX 1.5 W" and a Exif.Image.ProcessingSoftware tag with "digiKam-1.0.0-beta5".</p>


	<p>Can you provide a sample right before editing it with digiKam and the edited image right after saving it with digiKam. We need to be sure that all the differences in these pictures are caused by digiKam.</p>


	<p>Then we would at least have narrowed the possible culprits to exiv2 and digiKam+Co. To prove that this is really an exiv2 bug, it is best if the corruption can be reproduced with just exiv2 alone, e.g., like in the description of bug <a class="issue tracker-1 status-5 priority-6 priority-high2 closed" title="Bug: Exiv2 corrupts certain NEF images when writing to them (digiKam bug 193228) (Closed)" href="/issues/636">#636</a>.</p>


	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1378" class="journal has-notes">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/291">Nicolas Boulesteix</a> <a title="23 Nov 2009 01:00" href="/projects/exiv2/activity?from=2009-11-23">almost 12 years</a> ago
      <span id="journal-1378-private_notes" class=""></span>
    </h4>

    <div id="journal-1378-notes" class="wiki"><p>Yes,</p>


	<p>Sylvain Crouzillat notice the same thing yesterday on the digikam userlist. I'm apologize for that (I should verify before uploading finally), may be for this picture I made too many test and lost makernote (I don't know how), but I try the solution for <a class="issue tracker-1 status-5 priority-6 priority-high2 closed" title="Bug: Exiv2 corrupts certain NEF images when writing to them (digiKam bug 193228) (Closed)" href="/issues/636">#636</a> with other files unsuccesly.</p>


	<p>I'm uploading on my web filestorage three files, the RAW from the memory card, one with five star rating applying by Digikam, one other five star rating applying by ViewNx.</p>


	<p>I have installed evix2 from SVN, and it seems to be take without rebuilding Digikam as XMP core version is 4.4.0 and was before 4.1.0, but the digikam version still unopenable for me with capture NX.</p>


	<p>I'm a little puzzled because Sylvain Crouzillat use the mostly same version of digikam and exiv2 0.18.2 on Mandriva 10 and he doesn't have this matter.</p>


	<p>Here are the 3 files URL :</p>


	<p><a class="external" href="http://photonoxx.free.fr/digikamNX2/DSC_2854.NEF">http://photonoxx.free.fr/digikamNX2/DSC_2854.NEF</a><br /><a class="external" href="http://photonoxx.free.fr/digikamNX2/DSC_2854digikam.NEF">http://photonoxx.free.fr/digikamNX2/DSC_2854digikam.NEF</a><br /><a class="external" href="http://photonoxx.free.fr/digikamNX2/DSC_2854viewnx.NEF">http://photonoxx.free.fr/digikamNX2/DSC_2854viewnx.NEF</a></p>


	<p>I hope this time it was better for you, and sorry again for the previous file. In fact it come from an already edited picture edited with digikam on Ubuntu 9.04 (openable with captureNX), and more recently geotagged under 9.10 (and became unopenable), and I effectively try to tag it under viewNX thinking may be it'll overwrite metadata change (but no).</p>


	<p>Thanks</p>


	<p>Nicolas</p></div>
    </div>
  </div>
  
  <div id="change-1379" class="journal has-notes">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/76">Gilles Caulier</a> <a title="23 Nov 2009 01:06" href="/projects/exiv2/activity?from=2009-11-23">almost 12 years</a> ago
      <span id="journal-1379-private_notes" class=""></span>
    </h4>

    <div id="journal-1379-notes" class="wiki"><p>Nicolas Boulesteix wrote:</p>


<blockquote>

	<p>Yes,</p>


	<p>Sylvain Crouzillat notice the same thing yesterday on the digikam userlist. I'm apologize for that (I should verify before uploading finally), may be for this picture I made too many test and lost makernote (I don't know how), but I try the solution for <a class="issue tracker-1 status-5 priority-6 priority-high2 closed" title="Bug: Exiv2 corrupts certain NEF images when writing to them (digiKam bug 193228) (Closed)" href="/issues/636">#636</a> with other files unsuccesly.</p>


	<p>I'm uploading on my web filestorage three files, the RAW from the memory card, one with five star rating applying by Digikam, one other five star rating applying by ViewNx.</p>


	<p>I have installed evix2 from SVN, and it seems to be take without rebuilding Digikam as XMP core version is 4.4.0 and was before 4.1.0, but the digikam version still unopenable for me with capture NX.</p>


	<p>I'm a little puzzled because Sylvain Crouzillat use the mostly same version of digikam and exiv2 0.18.2 on Mandriva 10 and he doesn't have this matter.</p>


	<p>Here are the 3 files URL :</p>


	<p><a class="external" href="http://photonoxx.free.fr/digikamNX2/DSC_2854.NEF">http://photonoxx.free.fr/digikamNX2/DSC_2854.NEF</a><br /><a class="external" href="http://photonoxx.free.fr/digikamNX2/DSC_2854digikam.NEF">http://photonoxx.free.fr/digikamNX2/DSC_2854digikam.NEF</a><br /><a class="external" href="http://photonoxx.free.fr/digikamNX2/DSC_2854viewnx.NEF">http://photonoxx.free.fr/digikamNX2/DSC_2854viewnx.NEF</a></p>


	<p>I hope this time it was better for you, and sorry again for the previous file. In fact it come from an already edited picture edited with digikam on Ubuntu 9.04 (openable with captureNX), and more recently geotagged under 9.10 (and became unopenable), and I effectively try to tag it under viewNX thinking may be it'll overwrite metadata change (but no).</p>


	<p>Thanks</p>


	<p>Nicolas</p>


</blockquote>

	<p>An important pointer there, is core of libkexiv2 interface for digiKam, used to update metadata using Exiv2. Look code from this method :</p>


	<p><a class="external" href="http://lxr.kde.org/source/KDE/kdegraphics/libs/libkexiv2/libkexiv2/kexiv2.cpp#397">http://lxr.kde.org/source/KDE/kdegraphics/libs/libkexiv2/libkexiv2/kexiv2.cpp#397</a></p>


	<p>... perhaps something is wrong there...</p>


	<p>Note : I recommend to try with libkexiv2 from trunk (1.0.0). digiKam &#38; co need to be recompiled in this case...</p>


	<p>Gilles Caulier</p></div>
    </div>
  </div>
  
  <div id="change-1380" class="journal has-notes">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/291">Nicolas Boulesteix</a> <a title="23 Nov 2009 06:54" href="/projects/exiv2/activity?from=2009-11-23">almost 12 years</a> ago
      <span id="journal-1380-private_notes" class=""></span>
    </h4>

    <div id="journal-1380-notes" class="wiki"><p>Hi,</p>


	<p>I have may be something new !</p>


	<p>I have build and  instal Exiv2, Kdegraphics libs, Digikam and Kipiplugins from SVN. The first test give the same matter, but continuing tests, I notice the MakerNotes:colorhue is missing from the edited NEF.</p>


	<p>In the original file, this tag is set with the value "MODE3" (case sensitive), and if I set with exiftool an other value like "mode3" or anything else than <abbr title="1,2,or 3">MODE</abbr>, the file can't be opened by CaptureNX, if i set back <abbr title="1,2,or 3">MODE</abbr> value, CaptureNX succed to open it !!</p>


	<p>I try to add this tag to a digikam edited Nef file, but exiftool seems to don't wan't to create this particular, but if I'm copying it from the original file, I succeed to open it again in CaptureNX.</p>


	<p>Now, I have no idea from where come this matter, and I have to verify on other file if it's working or if if it works only for this particular file.</p>


	<p>Kind regards</p>


	<p>Nicolas</p></div>
    </div>
  </div>
  
  <div id="change-1381" class="journal has-notes">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="23 Nov 2009 22:02" href="/projects/exiv2/activity?from=2009-11-23">almost 12 years</a> ago
      <span id="journal-1381-private_notes" class=""></span>
    </h4>

    <div id="journal-1381-notes" class="wiki"><p>Ok, I ignore the original sample images and concentrate on the new ones.</p>


	<p>Nicolas, you're right, the Exif.Nikon3.ColorMode tag is missing from the makernote of the digiKam-modified image, and this is the only relevant difference in the two makernotes.</p>


<blockquote>

	<p>I try to add this tag to a digikam edited Nef file, but exiftool seems to don't wan't to create this particular</p>


</blockquote>

	<p>Try this:<br /><pre>
exiv2 -M'set Exif.Nikon3.ColorMode MODE3' DSC_2854digikam.NEF
</pre></p>


	<p>If I understand correctly, you're saying with this tag added it works again? I can't verify this here because I don't have the Nikon software that you use and ufraw is able to display the image with and without that tag.</p>


	<p>Gilles, looking at the pointer to libkexiv2 source, this is not the place where this tag goes missing AFAICS. It rather seems that <code>d->exifMetadata()</code> doesn't contain this tag anymore in this function.</p>


	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1382" class="journal has-notes">
    <div id="note-8">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-8" class="journal-link">#8</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="23 Nov 2009 22:27" href="/projects/exiv2/activity?from=2009-11-23">almost 12 years</a> ago
      <span id="journal-1382-private_notes" class=""></span>
    </h4>

    <div id="journal-1382-notes" class="wiki"><p>Correction: The original image, DSC_2854.NEF, has <strong>two</strong> Exif.Nikon3.ColorMode tags, the one edited by digiKam has only <strong>one</strong> such tag left:</p>


<pre>
$ exiv2 -pa DSC_2854.NEF | grep ColorMode
Exif.Nikon3.ColorMode                        Ascii       6  COLOR
Exif.Nikon3.ColorMode                        Ascii       9  MODE3   
$ exiv2 -pa DSC_2854digikam.NEF | grep ColorMode
Exif.Nikon3.ColorMode                        Ascii       6  COLOR
</pre>

	<p>So Nicolas, instead of the command I gave earlier, use this to test if you can fix the edited images:<br /><pre>
exiv2 -M'add Exif.Nikon3.ColorMode MODE3' DSC_2854digikam.NEF
</pre><br />(just <strong><code>add</code></strong> instead of <strong><code>set</code></strong> the tag)</p></div>
    </div>
  </div>
  
  <div id="change-1383" class="journal has-notes has-details">
    <div id="note-9">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-9" class="journal-link">#9</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="23 Nov 2009 23:13" href="/projects/exiv2/activity?from=2009-11-23">almost 12 years</a> ago
      <span id="journal-1383-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/117">bug657.patch</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/117/bug657.patch">bug657.patch</a> added</li>
    </ul>
    <div id="journal-1383-notes" class="wiki"><p>There is more to it. Exiv2 indeed has a bug: The two tags mentioned above have different tag numbers, but Exiv2 uses the same tag name for both:</p>


<pre>
$ exiv2 -Pkyctx DSC_2854.NEF | grep ColorMode
0x0003 Exif.Nikon3.ColorMode                        Ascii       6  COLOR
0x008d Exif.Nikon3.ColorMode                        Ascii       9  MODE3   
</pre>

	<p>Adding a tag as I suggested above therefore still won't have the desired effect, it just adds a duplicate of Exif.Nikon3.0x0003. Instead you need to use the actual tag number in the command:</p>


<pre>
exiv2 -M'add Exif.Nikon3.0x008d Ascii MODE3' DSC_2854digikam.NEF
</pre>

	<p>A patch to fix Exiv2 is also attached. It just renames the tag to ColorHue. Can you please test if digiKam works correctly with a patched version of exiv2?</p>


	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1384" class="journal has-notes">
    <div id="note-10">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-10" class="journal-link">#10</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/291">Nicolas Boulesteix</a> <a title="23 Nov 2009 23:15" href="/projects/exiv2/activity?from=2009-11-23">almost 12 years</a> ago
      <span id="journal-1384-private_notes" class=""></span>
    </h4>

    <div id="journal-1384-notes" class="wiki"><p>Ok, Thanks I'n going to test that but something is slightly strange.</p>


	<p>With the tag ouptput of exiftool, I don't have two tags named ColorMode on a right file but only one with the value "COLOR" and another tag named ColorHue with the value "MODE3".</p>


	<p>here an example output for the makernotes group for an openable picture</p>


<pre>
[MakerNotes] MakerNoteVersion: 2.10
[MakerNotes] ColorMode: Color
[MakerNotes] Quality: Raw
[MakerNotes] WhiteBalance: Auto
[MakerNotes] FocusMode: AF-C
[MakerNotes] FlashSetting: Normal
[MakerNotes] FlashType: 
[MakerNotes] WhiteBalanceFineTune: 0
[MakerNotes] WB_RBLevels: 1.5078125 1.6015625 1 1
[MakerNotes] ProgramShift: 0
[MakerNotes] ExposureDifference: 0
[MakerNotes] PreviewImageStart: 13130
[MakerNotes] PreviewImageLength: 110790
[MakerNotes] FlashExposureComp: 0
[MakerNotes] ISOSetting: 100
[MakerNotes] FlashExposureBracketValue: 0.0
[MakerNotes] ExposureBracketValue: 0
[MakerNotes] CropHiSpeed: Off (3904x2616 cropped to 3904x2616 at pixel 0,0)
[MakerNotes] SerialNumber: 
[MakerNotes] ColorSpace: sRGB
[MakerNotes] ToneComp: Auto
[MakerNotes] LensType: G
[MakerNotes] Lens: 17-70mm f/2.8-4.5
[MakerNotes] FlashMode: Did Not Fire
[MakerNotes] AFAreaMode: Dynamic Area
[MakerNotes] AFPoint: Mid-right
[MakerNotes] AFPointsInFocus: Mid-right
[MakerNotes] ShootingMode: Single-Frame
[MakerNotes] AutoBracketRelease: Manual Release
[MakerNotes] ContrastCurve: (Binary data 4160 bytes, use -b option to extract)
[MakerNotes] ColorHue: Mode1
[MakerNotes] LightSource: Natural
[MakerNotes] ShotInfoVersion: 0207
[MakerNotes] VibrationReduction: Off
[MakerNotes] HueAdjustment: 0
[MakerNotes] NEFCompression: Lossy (type 1)
[MakerNotes] NoiseReduction: Off
[MakerNotes] LinearizationTable: (Binary data 1412 bytes, use -b option to extract)
[MakerNotes] WB_RGGBLevels: 386 256 256 410
[MakerNotes] LensDataVersion: 0201
[MakerNotes] ExitPupilPosition: 85.3 mm
[MakerNotes] AFAperture: 4.0
[MakerNotes] FocusPosition: 0x11
[MakerNotes] FocusDistance: 0.63 m
[MakerNotes] LensIDNumber: 127
[MakerNotes] LensFStops: 6.00
[MakerNotes] MinFocalLength: 17.3 mm
[MakerNotes] MaxFocalLength: 71.3 mm
[MakerNotes] MaxApertureAtMinFocal: 2.8
[MakerNotes] MaxApertureAtMaxFocal: 4.5
[MakerNotes] MCUVersion: 28
[MakerNotes] EffectiveMaxAperture: 4.0
[MakerNotes] RawImageCenter: 1952 1308
[MakerNotes] SensorPixelSize: 6.05 x 6.05 um
[MakerNotes] ImageCount: 100
[MakerNotes] DeletedImageCount: 0
[MakerNotes] ShutterCount: 100
[MakerNotes] FlashInfoVersion: 0101
[MakerNotes] ExternalFlashFirmware: n/a
[MakerNotes] ExternalFlashFlags: (none)
[MakerNotes] FlashCommanderMode: Off
[MakerNotes] FlashControlMode: Off
[MakerNotes] FlashGroupAControlMode: Off
[MakerNotes] FlashGroupBControlMode: Off
[MakerNotes] FlashGroupAExposureComp: 0
[MakerNotes] FlashGroupBExposureComp: 0
[MakerNotes] ImageOptimization: Normal
[MakerNotes] MultiExposureVersion: 0100
[MakerNotes] MultiExposureMode: Off
[MakerNotes] MultiExposureShots: 0
[MakerNotes] MultiExposureAutoGain: Off
[MakerNotes] HighISONoiseReduction: Off
</pre>

	<p>I test your command but it's don't work. In fact, Exiftool output only one value for colorMode tag and exiv2 output the two values, but exiftool don't output the missing ColorHue tag (on exiftool web site it's visible in Nikon tag and it tag_id is 0x008d and the colorMode tag have 0x0003 ID.</p>


	<p>I try to change your command and replace ColorMode by ColorHue but it's not recognized.</p>


	<p>Nicolas</p>


	<p>Andreas Huggel wrote:</p>


<blockquote>

	<p>Correction: The original image, DSC_2854.NEF, has <strong>two</strong> Exif.Nikon3.ColorMode tags, the one edited by digiKam has only <strong>one</strong> such tag left:</p>


	<p>[...]</p>


	<p>So Nicolas, instead of the command I gave earlier, use this to test if you can fix the edited images:<br />[...]<br />(just <strong><code>add</code></strong> instead of <strong><code>set</code></strong> the tag)</p>


</blockquote></div>
    </div>
  </div>
  
  <div id="change-1385" class="journal has-notes">
    <div id="note-11">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-11" class="journal-link">#11</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="23 Nov 2009 23:37" href="/projects/exiv2/activity?from=2009-11-23">almost 12 years</a> ago
      <span id="journal-1385-private_notes" class=""></span>
    </h4>

    <div id="journal-1385-notes" class="wiki"><p>Looks like my second correction made it just 2min earlier :) Have a look at my post above your last one...</p>


	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1386" class="journal has-notes">
    <div id="note-12">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-12" class="journal-link">#12</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/291">Nicolas Boulesteix</a> <a title="24 Nov 2009 01:00" href="/projects/exiv2/activity?from=2009-11-24">almost 12 years</a> ago
      <span id="journal-1386-private_notes" class=""></span>
    </h4>

    <div id="journal-1386-notes" class="wiki"><p>Andreas Huggel wrote:</p>


<blockquote>

	<p>Looks like my second correction made it just 2min earlier :) Have a look at my post above your last one...</p>


	<p>Andreas</p>


</blockquote>

	<p>:)))</p>


	<p>Yes indeed, It mays work, but actually I'm at office with no linux avaible :/</p>


	<p>On the othetr hand, if you upload here a modified version of DSC_2854digikam.nef, I can test if it's openable with CaptureNX (which I have installed on my workstation).</p>


	<p>I'll test all the rest this evening as quickly I'll can do.</p>


	<p>Have I just to apply the patch or have I to rebuild Digikam too ?</p>


	<p>For additional informations, Sylvain Crouzillat give me a method to rescue a part of my corrupted files, but after testing some case are not resolved (pictures which have been edited by CaptureNX with new work version inside and edited after by Digikam for metadata).</p>


	<p>The Sylvain's method consist of adding a modification which set a new ColorHue tag, but it's not visible on the makernotes (it's made in an up-level, I don't know if you know, but CaptureNX embed any modification made on a picture on the same file, and you can have many different version of picture treatment in the file, and in this case it's the same thing, CaptureNX create a new version with MODE3 setting and it's why it's don't work with already "versioned" files)... So I'm hopeful of this patch.</p>


	<p>Thanks</p>


	<p>Amicably, Nicolas</p></div>
    </div>
  </div>
  
  <div id="change-1387" class="journal has-notes has-details">
    <div id="note-13">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-13" class="journal-link">#13</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="24 Nov 2009 01:37" href="/projects/exiv2/activity?from=2009-11-24">almost 12 years</a> ago
      <span id="journal-1387-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/118">DSC_2854digikam_with_ColorHue.NEF</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/118/DSC_2854digikam_with_ColorHue.NEF">DSC_2854digikam_with_ColorHue.NEF</a> added</li>
    </ul>
    <div id="journal-1387-notes" class="wiki"><blockquote>

	<p>On the othetr hand, if you upload here a modified version of DSC_2854digikam.nef, I can test if it's openable with CaptureNX (which I have installed on my workstation).</p>


</blockquote>

	<p>File is attached. It was created like this:</p>


<pre>
$ mv DSC_2854digikam.NEF DSC_2854digikam_with_ColorHue.NEF
$ exiv2 -M'add Exif.Nikon3.0x008d Ascii MODE3' DSC_2854digikam_with_ColorHue.NEF
</pre>

	<p>Can you open it with CaptureNX?</p>


<blockquote>

	<p>Have I just to apply the patch or have I to rebuild Digikam too ?</p>


</blockquote>

	<p>Just apply the patch and install (replacing the existing shared library). Of course that only works if libkexiv2 is dynamically linked with exiv2.</p>


	<p>Good luck :)<br />Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1388" class="journal has-notes">
    <div id="note-14">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-14" class="journal-link">#14</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/291">Nicolas Boulesteix</a> <a title="24 Nov 2009 01:58" href="/projects/exiv2/activity?from=2009-11-24">almost 12 years</a> ago
      <span id="journal-1388-private_notes" class=""></span>
    </h4>

    <div id="journal-1388-notes" class="wiki"><p>Andreas Huggel wrote:</p>


<blockquote><blockquote>

	<p>On the othetr hand, if you upload here a modified version of DSC_2854digikam.nef, I can test if it's openable with CaptureNX (which I have installed on my workstation).</p>


</blockquote>

	<p>File is attached. It was created like this:</p>


	<p>[...]</p>


	<p>Can you open it with CaptureNX?</p>


<blockquote>

	<p>Have I just to apply the patch or have I to rebuild Digikam too ?</p>


</blockquote>

	<p>Just apply the patch and install (replacing the existing shared library). Of course that only works if libkexiv2 is dynamically linked with exiv2.</p>


	<p>Good luck :)<br />Andreas</p>


</blockquote>

	<p>Thanks for the file, but finally I have downloaded the Windows version of exiv2... I don't think about it before oops :>/</p>


	<p>I just replace >'< by >"< in the command line (probably due to windows format ?) and I try to open the resulting file in CaptureNX and.... it's work !!</p>


	<p>I'll make more test this evening, particularly for kind of pictures which didn't work with the Sylvain's method.</p>


	<p>For the patch, do I just to make it executable and launch it ?</p>


	<p>Thanks again,</p>


	<p>Hopefully, Nicolas</p></div>
    </div>
  </div>
  
  <div id="change-1389" class="journal has-notes">
    <div id="note-15">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-15" class="journal-link">#15</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="24 Nov 2009 02:11" href="/projects/exiv2/activity?from=2009-11-24">almost 12 years</a> ago
      <span id="journal-1389-private_notes" class=""></span>
    </h4>

    <div id="journal-1389-notes" class="wiki"><blockquote><blockquote><blockquote>

	<p>Have I just to apply the patch or have I to rebuild Digikam too ?</p>


</blockquote>

	<p>Just apply the patch and install (replacing the existing shared library). Of course that only works if libkexiv2 is dynamically linked with exiv2.</p>


</blockquote>

	<p>For the patch, do I just to make it executable and launch it ?</p>


</blockquote>

	<p>You need to apply the patch (or change that one line of code manually), re-compile the exiv2 library and re-install it.<br />Then digiKam, or rather libkexiv2, should load the new version when it starts.</p>


	<p>Now that this looks like a way to fix the broken images, I'm very interested if the patch fixes the problem in digiKam, i.e., prevents digiKam from deleting the ColorHue tag in the first place.</p>


	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1390" class="journal has-notes">
    <div id="note-16">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-16" class="journal-link">#16</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/291">Nicolas Boulesteix</a> <a title="24 Nov 2009 02:26" href="/projects/exiv2/activity?from=2009-11-24">almost 12 years</a> ago
      <span id="journal-1390-private_notes" class=""></span>
    </h4>

    <div id="journal-1390-notes" class="wiki"><p>Andreas Huggel wrote:</p>


<blockquote><blockquote><blockquote><blockquote>

	<p>Have I just to apply the patch or have I to rebuild Digikam too ?</p>


</blockquote>

	<p>Just apply the patch and install (replacing the existing shared library). Of course that only works if libkexiv2 is dynamically linked with exiv2.</p>


</blockquote>

	<p>For the patch, do I just to make it executable and launch it ?</p>


</blockquote>

	<p>You need to apply the patch (or change that one line of code manually), re-compile the exiv2 library and re-install it.<br />Then digiKam, or rather libkexiv2, should load the new version when it starts.</p>


	<p>Now that this looks like a way to fix the broken images, I'm very interested if the patch fixes the problem in digiKam, i.e., prevents digiKam from deleting the ColorHue tag in the first place.</p>


	<p>Andreas</p>


</blockquote>

	<p>May be you'll begin to think I lost my neurons but where have I to apply the patch ? Whole system or in svn path of exiv2 ? Excuse me, but I never do this before, so I will appreciate a simple "walthrough" lol.</p>


	<p>yes this looks like a way to fix broken images :)))</p>


	<p>I'm nearly in the mood for being sick just to go back home and test this (but there's non hope for that ;))</p>


	<p>Nicolas</p></div>
    </div>
  </div>
  
  <div id="change-1391" class="journal has-notes">
    <div id="note-17">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-17" class="journal-link">#17</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="24 Nov 2009 03:24" href="/projects/exiv2/activity?from=2009-11-24">almost 12 years</a> ago
      <span id="journal-1391-private_notes" class=""></span>
    </h4>

    <div id="journal-1391-notes" class="wiki"><p>No problem :)</p>


	<p>The patch needs to be applied to the Exiv2 source code. Since you said you compiled Exiv2 from SVN and digiKam loaded that version, just use that again.</p>


	<p>Copy the patch file from the comment above to the Exiv2 src/ directory and change to the src/ directory. Then run these commands (or something similar, if I screwed up):</p>


<pre>
$ patch -p0 &lt; bug657.patch
$ cd ..
$ make; make install
</pre>

	<p>That's all. If you can see a ColorHue tag somewhere in digiKam now, it is using the modified version. If the patch command fails for some reason, just look at the bug657.patch file, open nikonmn.cpp in an editor and make the small change manually.</p>


	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1392" class="journal has-notes">
    <div id="note-18">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-18" class="journal-link">#18</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="24 Nov 2009 07:49" href="/projects/exiv2/activity?from=2009-11-24">almost 12 years</a> ago
      <span id="journal-1392-private_notes" class=""></span>
    </h4>

    <div id="journal-1392-notes" class="wiki"><p>I've checked-in the change with <a class="changeset" title="#657: Fixed tag name of Exif.Nikon3.0x008d to ColorHue." href="/projects/exiv2/repository/exiv2/revisions/1931">r1931</a>. So instead of using the patch command above, you can simply run svn update.</p></div>
    </div>
  </div>
  
  <div id="change-1393" class="journal has-notes">
    <div id="note-19">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-19" class="journal-link">#19</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/291">Nicolas Boulesteix</a> <a title="24 Nov 2009 11:57" href="/projects/exiv2/activity?from=2009-11-24">almost 12 years</a> ago
      <span id="journal-1393-private_notes" class=""></span>
    </h4>

    <div id="journal-1393-notes" class="wiki"><p>The first test are all good, Digikam show the ColorHue tag info if it exists, and I try to edit metadata with digikam on an uncorrupted pictures and CaptureNX open it after being edited.</p>


	<p>I take a basic photo (not previously modified by CaptureNX before corrupted) and I apply the command line to add the ColorHue tag, and I open it with CaptureNX.</p>


	<p>The dark thing in the good news, is, apparently, the photo already modified by CaptureNX before being corrupted don't benefit of the command line, with a little nuance.</p>


	<p>If the modify involves Camera parameters, rescue seems workinh.<br />If the modify involves more advanced features, like BW conversion, U-point, etc... for the first files I try to patch, restoration seems to fail.</p>


	<p>The good news is, I test to modify a NEF file with CaptureNX advanced features and after edit metadata with digikam, and the file still openable.</p>


	<p>So the last matter which stay open for me (except what I don't test for the moment) is to rescue this kind of RAW.</p>


	<p>I continue the tests</p>


	<p>Thanks for this patch</p>


	<p>Nicolas</p></div>
    </div>
  </div>
  
  <div id="change-1394" class="journal has-notes">
    <div id="note-20">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-20" class="journal-link">#20</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/291">Nicolas Boulesteix</a> <a title="24 Nov 2009 13:09" href="/projects/exiv2/activity?from=2009-11-24">almost 12 years</a> ago
      <span id="journal-1394-private_notes" class=""></span>
    </h4>

    <div id="journal-1394-notes" class="wiki"><p>May be i can precise a little... I don't make expansive test, but the difficulty to restore a photo can affect only CaptureNX 1 modified pictures... or may be the matter come from earlier issue I didn't yet notice.</p></div>
    </div>
  </div>
  
  <div id="change-1395" class="journal has-notes">
    <div id="note-21">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-21" class="journal-link">#21</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="24 Nov 2009 18:00" href="/projects/exiv2/activity?from=2009-11-24">almost 12 years</a> ago
      <span id="journal-1395-private_notes" class=""></span>
    </h4>

    <div id="journal-1395-notes" class="wiki"><p>Good. So this little patch fixes the original issue and we have a way to fix images corrupted by digiKam due to this issue.</p>


	<p>If I understand correctly, the remaining problem is that you haven't found a way yet to fix other corrupted images. But it is not clear how these images got corrupted in the first place. As such this is not an Exiv2 bug at this stage.</p>


	<p>In order to keep things simple, I'd like to close this bug now. For the remaining problem, please provide a corrupted image and try to find out the steps to corrupt it. I'll have a look at the image to see if it can be fixed. Please open another bug for this discussion or post to the forum (and once we understand where the corruption came from, we can still open a new bug if necessary).</p>


	<p>Let me know if you're ok with that, or if I misunderstood something.</p>


	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1396" class="journal has-notes">
    <div id="note-22">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-22" class="journal-link">#22</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/291">Nicolas Boulesteix</a> <a title="24 Nov 2009 23:15" href="/projects/exiv2/activity?from=2009-11-24">almost 12 years</a> ago
      <span id="journal-1396-private_notes" class=""></span>
    </h4>

    <div id="journal-1396-notes" class="wiki"><p>Yes, i'm perfectly ok with that thanks !</p>


	<p>Just a last answer, now to fix pictures I think the best command line is the one with "set" argument and not "add", but is there an option to prevent overwrite in case where the tag already exists ? And can I use now "ColorHue" instead of 0x008d in the command ?</p>


	<p>Thanks</p>


	<p>Nicolas</p></div>
    </div>
  </div>
  
  <div id="change-1397" class="journal has-notes has-details">
    <div id="note-23">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-23" class="journal-link">#23</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="25 Nov 2009 00:12" href="/projects/exiv2/activity?from=2009-11-25">almost 12 years</a> ago
      <span id="journal-1397-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Category</strong> set to <i>exif</i></li>
       <li><strong>Status</strong> changed from <i>New</i> to <i>Resolved</i></li>
       <li><strong>Target version</strong> set to <i>0.19</i></li>
    </ul>
    <div id="journal-1397-notes" class="wiki"><blockquote>

	<p>now to fix pictures I think the best command line is the one with "set" argument and not "add", but is there an option to prevent overwrite in case where the tag already exists ?</p>


</blockquote>

	<p>There is no option to prevent overwriting, you'd have to write a script that checks if the tag is there before setting it. In this context "set" is better since it will overwrite an existing tag and not add a duplicate.</p>


<blockquote>

	<p>And can I use now "ColorHue" instead of 0x008d in the command ?</p>


</blockquote>

	<p>Yes, with the patched version you can.</p>


	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1398" class="journal has-notes">
    <div id="note-24">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-24" class="journal-link">#24</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/291">Nicolas Boulesteix</a> <a title="25 Nov 2009 03:25" href="/projects/exiv2/activity?from=2009-11-25">almost 12 years</a> ago
      <span id="journal-1398-private_notes" class=""></span>
    </h4>

    <div id="journal-1398-notes" class="wiki"><p>Nicolas Boulesteix wrote:</p>


<blockquote>

	<p>May be i can precise a little... I don't make expansive test, but the difficulty to restore a photo can affect only CaptureNX 1 modified pictures... or may be the matter come from earlier issue I didn't yet notice.</p>


</blockquote>

	<p>To conclude, I'm fairly sure the still corrupted files was in fact corrupted by <a class="issue tracker-1 status-5 priority-6 priority-high2 closed" title="Bug: Exiv2 corrupts certain NEF images when writing to them (digiKam bug 193228) (Closed)" href="/issues/636">#636</a> issues and escaped to notice up to now.</p>


	<p>Applying both command line (ColorHue and ByteOrder) seems to fix the files.</p>


	<p>Nicolas</p></div>
    </div>
  </div>
  
  <div id="change-1431" class="journal has-details">
    <div id="note-25">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-25" class="journal-link">#25</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="27 Dec 2009 17:03" href="/projects/exiv2/activity?from=2009-12-27">almost 12 years</a> ago
      <span id="journal-1431-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-1463" class="journal has-details">
    <div id="note-26">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-26" class="journal-link">#26</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="30 Dec 2009 07:50" href="/projects/exiv2/activity?from=2009-12-30">almost 12 years</a> ago
      <span id="journal-1463-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
    </ul>
    
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/657.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/657.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
