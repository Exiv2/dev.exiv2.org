<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #701: Nikon capture nx won&#39;t save a raw file which was metadata manipulated from svn exiv2 - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="UOQaNrtplTcYb+RmnKJCNTCAEuMip/a9dJ5neO2rB6CyqbHZyRNZN00L+2ojdU4GDxJGmtNEVweJvvfwrpLgzw==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #701: Nikon capture nx won&#39;t save a raw file which was metadata manipulated from svn exiv2" href="https://dev.exiv2.org/issues/701.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #701</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Nikon capture nx won&#39;t save a raw file which was metadata manipulated from svn exiv2</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/535">Frank Hommes</a> <a title="03 May 2010 08:16" href="/projects/exiv2/activity?from=2010-05-03">over 11 years</a> ago.
        Updated <a title="29 May 2010 10:43" href="/projects/exiv2/activity?from=2010-05-29">over 11 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value">-</div></div><div class="category attribute"><div class="label">Category:</div><div class="value">tiff parser</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="30 May 2010" href="/versions/45">0.20</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">03 May 2010</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>I can't save my pictures using nikon capture nx when I manipulate the metadata with exiv2. I don't know where the problem is, if it's a capture nx problem or an exiv2 problem.</p>


	<p>I'm using the newest exiv2 with digikam 1.3</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/171">metadata_exiftool.mie</a>    <span class="size">(17.6 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/171/metadata_exiftool.mie">metadata_exiftool.mie</a>  </td>
  <td></td>
  <td>
      <span class="author">Frank Hommes, 04 May 2010 02:42</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/172">metadata_exiv2.mie</a>    <span class="size">(14.9 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/172/metadata_exiv2.mie">metadata_exiv2.mie</a>  </td>
  <td></td>
  <td>
      <span class="author">Frank Hommes, 04 May 2010 02:42</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/174">metadata.txt</a>    <span class="size">(13.7 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/174/metadata.txt">metadata.txt</a>  </td>
  <td></td>
  <td>
      <span class="author">Frank Hommes, 19 May 2010 07:29</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/175">metadata_broken_file_with_applied_fix.txt</a>    <span class="size">(13.7 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/175/metadata_broken_file_with_applied_fix.txt">metadata_broken_file_with_applied_fix.txt</a>  </td>
  <td></td>
  <td>
      <span class="author">Frank Hommes, 19 May 2010 10:14</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>







<hr />
<div id="relations">
<div class="contextual">
</div>

<p><strong>Related issues</strong></p>

<form data-cm-url="/issues/context_menu" action="/issues/701" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="ed/67NkBJVCNIReywz1b9JGwB6jPUx8xKkt/Qd4Oub6bklEDq3vpUNhFCL586lfHriJT0T6wvovXa+/JnTde0Q==" />
  <table class="list issues odd-even"><tr id="relation-72" class="issue hascontextmenu issue tracker-2 status-5 priority-4 priority-default closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="668" /></td><td class="subject" style="width: 50%">Blocks Exiv2 - <a class="issue tracker-2 status-5 priority-4 priority-default closed" href="/issues/668">Feature #668</a>: &quot;TIFF-safe&quot; setExifData variant</td><td class="status">Closed</td><td class="start_date">03 Jan 2010</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr></table>
</form>
<form class="new_relation" id="new-relation-form" style="display: none;" action="/issues/701/relations" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />


<p><select onchange="setPredecessorFieldsVisibility();" name="relation[relation_type]" id="relation_relation_type"><option selected="selected" value="relates">Related to</option>
<option value="duplicates">Is duplicate of</option>
<option value="duplicated">Has duplicate</option>
<option value="blocks">Blocks</option>
<option value="blocked">Blocked by</option>
<option value="precedes">Precedes</option>
<option value="follows">Follows</option>
<option value="copied_to">Copied to</option>
<option value="copied_from">Copied from</option></select>
Issue #<input size="10" type="text" name="relation[issue_to_id]" id="relation_issue_to_id" />
<span id="predecessor_fields" style="display:none;">
Delay: <input size="3" type="text" name="relation[delay]" id="relation_delay" /> days
</span>
<input type="submit" name="commit" value="Add" data-disable-with="Add" />
<a href="#" onclick="$(&quot;#new-relation-form&quot;).hide();; return false;">Cancel</a>
</p>

<script>
//<![CDATA[
observeAutocompleteField('relation_issue_to_id', '/issues/auto_complete?issue_id=701&project_id=exiv2&scope=all')
//]]>
</script>

<script>
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>
</div>

</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 2219" href="/projects/exiv2/repository/exiv2/revisions/2219">Revision 2219</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/2219/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="12 May 2010 09:27" href="/projects/exiv2/activity?from=2010-05-12">over 11 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Nikon capture nx won&#39;t save a raw file which was metadata manipulated from svn exiv2 (Closed)" href="/issues/701">#701</a>: Sort Sub-IFDs by group before writing, as the order may not be correct after copying image tags.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 2225" href="/projects/exiv2/repository/exiv2/revisions/2225">Revision 2225</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/2225/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="17 May 2010 07:22" href="/projects/exiv2/activity?from=2010-05-17">over 11 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p>Branch for a hacked version of exiv2 to repair Nikon D90 images which were corrupted due to bug <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Nikon capture nx won&#39;t save a raw file which was metadata manipulated from svn exiv2 (Closed)" href="/issues/701">#701</a>. Use at your own risk!</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 2226" href="/projects/exiv2/repository/exiv2/revisions/2226">Revision 2226</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/2226/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="18 May 2010 09:43" href="/projects/exiv2/activity?from=2010-05-18">over 11 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Nikon capture nx won&#39;t save a raw file which was metadata manipulated from svn exiv2 (Closed)" href="/issues/701">#701</a>: Hack to change the order of subdirs. This can be used to fix corrupted images.</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-1612" class="journal has-notes">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="03 May 2010 08:40" href="/projects/exiv2/activity?from=2010-05-03">over 11 years</a> ago
      <span id="journal-1612-private_notes" class=""></span>
    </h4>

    <div id="journal-1612-notes" class="wiki"><p>What metadata manipulations have you done with exiv2?<br />Can you provide an example and step-by-step explanation (as simple as possible)?<br />Do you get any error or warning message from capture nx when you work with exiv2-manipulated images?</p></div>
    </div>
  </div>
  
  <div id="change-1613" class="journal has-notes">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/535">Frank Hommes</a> <a title="03 May 2010 09:12" href="/projects/exiv2/activity?from=2010-05-03">over 11 years</a> ago
      <span id="journal-1613-private_notes" class=""></span>
    </h4>

    <div id="journal-1613-notes" class="wiki"><p>I just did some tests:</p>


	<p>I took an older nef image from my camera which is not effected by this bug. This image can be changed within capture nx and then saved as a nef. Capture nx only saves my changes without destrying any data. Saving works without a problem.</p>


	<p>Second I took a picture and changed the rating with digkam and saved it to the raw file. I can load this file in capture nx but when I try to save it, it will give me an error (no specific one... Just Error 7...).<br />Third when I add a keyword the same happens. I can load it but saving as a nef doesn't work anymore.</p>


	<p>Anyway, I can still save the picture from capture nx with all changes to a jpg or tiff. But just not nef, which is most important I guess.</p>


	<p>I hope this explanation is better.</p></div>
    </div>
  </div>
  
  <div id="change-1615" class="journal has-notes">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="03 May 2010 18:49" href="/projects/exiv2/activity?from=2010-05-03">over 11 years</a> ago
      <span id="journal-1615-private_notes" class=""></span>
    </h4>

    <div id="journal-1615-notes" class="wiki"><p>Can you take an image that works, then add the Rating tag using only the exiv2 command-line tool, then try again with Capture NX?<br />If Capture NX can't write to the image anymore, can you repeat this test with exiftool instead of exiv2?<br />If that also results in an image which capture nx doesn't like to write to, then repeat the test with exiv2 again but instead of adding the Rating tag, modify an existing ASCII text tag and make it longer than it is. E.g., a description or software tag, but not make or model.</p>


	<p>Thanks in advance.<br />Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1616" class="journal has-notes has-details">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/535">Frank Hommes</a> <a title="04 May 2010 02:42" href="/projects/exiv2/activity?from=2010-05-04">over 11 years</a> ago
      <span id="journal-1616-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/171">metadata_exiftool.mie</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/171/metadata_exiftool.mie">metadata_exiftool.mie</a> added</li>
       <li><strong>File</strong> <a href="/attachments/172">metadata_exiv2.mie</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/172/metadata_exiv2.mie">metadata_exiv2.mie</a> added</li>
    </ul>
    <div id="journal-1616-notes" class="wiki"><p>Ok, I also did additional experiments.<br />When I change a picture with capture nx then exiv2 gives me the following error when I try to change the rating with the command tool:<br />freanki@tristan:~/win/pics/temp$ exiv2 -M'set Exif.Image.Rating 5' 20100115-122401_changed_by_nikon_exiv2_rating_does_not_work.nef <br />Error: Directory Unknown with 32944 entries considered invalid; not read.<br />Error: Directory Unknown with 32944 entries considered invalid; not read.</p>


	<p>From now on I took the original picture which came from the camera as nef:<br />- original pic changed with exiv2 command tool: can't save afterwards<br />- original pic changed with exiftool command tool: WORKS!</p>


	<p>So now I tried to extract the metadata from the file changed with exiftool and write it to the file changed with exiv2 tools. I got the following error:<br />freanki@tristan:~/win/pics/temp$ exiftool -tagsFromFile metadata_exiv2.mie 20100115-122401_exiv2_rating_changed_new_metadata.nef <br />Error: [minor] SubIFD entry 15 has zero count - 20100115-122401_exiv2_rating_changed_new_metadata.nef<br />    0 image files updated<br />    1 files weren't updated due to errors</p>


	<p>I attached the different metadata extracted from exiftools. Maybe it helps to find the problem.</p></div>
    </div>
  </div>
  
  <div id="change-1620" class="journal has-notes">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="07 May 2010 08:57" href="/projects/exiv2/activity?from=2010-05-07">over 11 years</a> ago
      <span id="journal-1620-private_notes" class=""></span>
    </h4>

    <div id="journal-1620-notes" class="wiki"><p>Frank, can you please do a quick test with the latest SVN version. I'd be very happy if this problem also disappeared...</p></div>
    </div>
  </div>
  
  <div id="change-1621" class="journal has-notes">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/535">Frank Hommes</a> <a title="07 May 2010 10:12" href="/projects/exiv2/activity?from=2010-05-07">over 11 years</a> ago
      <span id="journal-1621-private_notes" class=""></span>
    </h4>

    <div id="journal-1621-notes" class="wiki"><p>I already tried it but waited for your suggestion here since it didn't help.</p>


	<p>I took the original picture, changed the rating with the new exiv but it still could not be saved...</p></div>
    </div>
  </div>
  
  <div id="change-1622" class="journal has-notes">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/535">Frank Hommes</a> <a title="08 May 2010 02:26" href="/projects/exiv2/activity?from=2010-05-08">over 11 years</a> ago
      <span id="journal-1622-private_notes" class=""></span>
    </h4>

    <div id="journal-1622-notes" class="wiki"><p>oh, and of course it worked with the old version of exiv...</p>


	<p>I tried to read out the metadata from the original and the changed file but there is no error I see... Just 8 more SubIFD1 entries.</p></div>
    </div>
  </div>
  
  <div id="change-1623" class="journal has-notes">
    <div id="note-8">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-8" class="journal-link">#8</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/535">Frank Hommes</a> <a title="08 May 2010 10:08" href="/projects/exiv2/activity?from=2010-05-08">over 11 years</a> ago
      <span id="journal-1623-private_notes" class=""></span>
    </h4>

    <div id="journal-1623-notes" class="wiki"><p>Oh and the latest patch solved the following error:</p>


<blockquote>

	<p>freanki@tristan:~/win/pics/temp$ exiftool -tagsFromFile metadata_exiv2.mie 20100115-122401_exiv2_rating_changed_new_metadata.nef<br />Error: [minor] SubIFD entry 15 has zero count - 20100115-122401_exiv2_rating_changed_new_metadata.nef<br />0 image files updated<br />1 files weren't updated due to errors</p>


</blockquote>

	<p>But I still haven't found a way to get my pictures to work with capture nx 2 :(<br />It's a pity because I used to do it this way and wasn't expecting such an error... yeah, my mistake I know...</p>


	<p>All my affords to fix the exif data with exiftool, like copy them from original to the altered one, don't work...</p>


	<p>I guess it has something to do with the end of the file because Nikon writes all changes to the nef (I'm doing with programs like capture nx) to the end of it. I can still read the pictures and save them as jpgs...</p></div>
    </div>
  </div>
  
  <div id="change-1624" class="journal has-notes">
    <div id="note-9">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-9" class="journal-link">#9</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/535">Frank Hommes</a> <a title="09 May 2010 00:01" href="/projects/exiv2/activity?from=2010-05-09">over 11 years</a> ago
      <span id="journal-1624-private_notes" class=""></span>
    </h4>

    <div id="journal-1624-notes" class="wiki"><p>Oh, I just noticed another thing in capture nx.</p>


	<p>When I work on a raw file that is corrupted because of svn-exiv then there is no panel which should show the settings I choose with the camera like white-balance and stuff like that!<br />I read on several pages that modifying some areas of the exifdata like the model would destroy the camerainformation needed for some rawconverters to develop the image (but I guess you already know that).<br />Shall I send you an example image?</p></div>
    </div>
  </div>
  
  <div id="change-1625" class="journal has-notes">
    <div id="note-10">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-10" class="journal-link">#10</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="09 May 2010 02:00" href="/projects/exiv2/activity?from=2010-05-09">over 11 years</a> ago
      <span id="journal-1625-private_notes" class=""></span>
    </h4>

    <div id="journal-1625-notes" class="wiki"><blockquote>

	<p>Shall I send you an example image?</p>


</blockquote>

	<p>Yes, can you send me one original file that, when edited with exiv2, shows the reported behaviour?<br />I can modify it myself.</p>


	<p>Thanks,<br />Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1628" class="journal has-notes">
    <div id="note-11">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-11" class="journal-link">#11</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="11 May 2010 07:45" href="/projects/exiv2/activity?from=2010-05-11">over 11 years</a> ago
      <span id="journal-1628-private_notes" class=""></span>
    </h4>

    <div id="journal-1628-notes" class="wiki"><p>Exiv2 trunk reverses the order of the sub-images! That must be another side-effect of <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: &quot;TIFF-safe&quot; setExifData variant (Closed)" href="/issues/668">#668</a>...</p></div>
    </div>
  </div>
  
  <div id="change-1629" class="journal has-notes">
    <div id="note-12">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-12" class="journal-link">#12</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/535">Frank Hommes</a> <a title="11 May 2010 10:16" href="/projects/exiv2/activity?from=2010-05-11">over 11 years</a> ago
      <span id="journal-1629-private_notes" class=""></span>
    </h4>

    <div id="journal-1629-notes" class="wiki"><p>Can it be fixed? And if it gets fixed, will it be possible to repair my files?</p></div>
    </div>
  </div>
  
  <div id="change-1630" class="journal has-notes">
    <div id="note-13">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-13" class="journal-link">#13</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="12 May 2010 09:34" href="/projects/exiv2/activity?from=2010-05-12">over 11 years</a> ago
      <span id="journal-1630-private_notes" class=""></span>
    </h4>

    <div id="journal-1630-notes" class="wiki"><p>Can you please try if it works <a class="changeset" title="#701: Sort Sub-IFDs by group before writing, as the order may not be correct after copying image ..." href="/projects/exiv2/repository/exiv2/revisions/2219">r2219</a>? I hope this fixes the reported problem. But it won't help with files which are already corrupted. Do you have many of these? I'll have to come up with a special repair tool for that if really necessary.</p></div>
    </div>
  </div>
  
  <div id="change-1631" class="journal has-notes">
    <div id="note-14">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-14" class="journal-link">#14</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/535">Frank Hommes</a> <a title="13 May 2010 02:14" href="/projects/exiv2/activity?from=2010-05-13">over 11 years</a> ago
      <span id="journal-1631-private_notes" class=""></span>
    </h4>

    <div id="journal-1631-notes" class="wiki"><p>I tried <a class="changeset" title="#701: Sort Sub-IFDs by group before writing, as the order may not be correct after copying image ..." href="/projects/exiv2/repository/exiv2/revisions/2219">r2219</a> but it's still not working. Seems to be another bug :(</p>


	<p>Actually I have quite some pictures where I would be happy if they could be rescued. Next time I will only work on copys with svn-versions, sorry I forgot that...</p></div>
    </div>
  </div>
  
  <div id="change-1632" class="journal has-notes">
    <div id="note-15">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-15" class="journal-link">#15</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="13 May 2010 05:40" href="/projects/exiv2/activity?from=2010-05-13">over 11 years</a> ago
      <span id="journal-1632-private_notes" class=""></span>
    </h4>

    <div id="journal-1632-notes" class="wiki"><p>Here, the result of <br /><pre>
$ exiv2-0.19 -M'set Exif.Image.Rating 5' original.nef
</pre><br />and<br /><pre>
$ exiv2-r2219 -M'set Exif.Image.Rating 5' original.nef
</pre><br />is exactly the same image. Byte for byte. So if exiv2-0.19 works then the current trunk must work too.<br />Unless something is wrong with my tests. I'll redo them. Can you also redo yours?</p></div>
    </div>
  </div>
  
  <div id="change-1633" class="journal has-notes">
    <div id="note-16">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-16" class="journal-link">#16</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/535">Frank Hommes</a> <a title="13 May 2010 06:52" href="/projects/exiv2/activity?from=2010-05-13">over 11 years</a> ago
      <span id="journal-1633-private_notes" class=""></span>
    </h4>

    <div id="journal-1633-notes" class="wiki"><p>Seems to be a mistake on my side :)<br />Somehow the original picture must have gotten corrupted...</p>


	<p>I can confirm now that it works. I will do additional checks later since I can edit the picture but the rating is not shown but it could be the other metadata capture nx is using... We will see :)</p></div>
    </div>
  </div>
  
  <div id="change-1634" class="journal has-notes">
    <div id="note-17">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-17" class="journal-link">#17</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="13 May 2010 07:10" href="/projects/exiv2/activity?from=2010-05-13">over 11 years</a> ago
      <span id="journal-1634-private_notes" class=""></span>
    </h4>

    <div id="journal-1634-notes" class="wiki"><p>Good :) I repeated my tests too, the result is still the same.</p></div>
    </div>
  </div>
  
  <div id="change-1635" class="journal has-notes">
    <div id="note-18">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-18" class="journal-link">#18</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/535">Frank Hommes</a> <a title="14 May 2010 05:37" href="/projects/exiv2/activity?from=2010-05-14">over 11 years</a> ago
      <span id="journal-1635-private_notes" class=""></span>
    </h4>

    <div id="journal-1635-notes" class="wiki"><p>Would you do that repair tool?</p>


	<p>I will take more care in the future with svn-versions...</p></div>
    </div>
  </div>
  
  <div id="change-1636" class="journal has-notes">
    <div id="note-19">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-19" class="journal-link">#19</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="16 May 2010 19:38" href="/projects/exiv2/activity?from=2010-05-16">over 11 years</a> ago
      <span id="journal-1636-private_notes" class=""></span>
    </h4>

    <div id="journal-1636-notes" class="wiki"><p>Yes, I'll give it a try. Just need to find some time.</p></div>
    </div>
  </div>
  
  <div id="change-1638" class="journal has-notes">
    <div id="note-20">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-20" class="journal-link">#20</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/76">Gilles Caulier</a> <a title="16 May 2010 23:52" href="/projects/exiv2/activity?from=2010-05-16">over 11 years</a> ago
      <span id="journal-1638-private_notes" class=""></span>
    </h4>

    <div id="journal-1638-notes" class="wiki"><blockquote>

	<p>I'm using the newest exiv2 with digikam 1.3</p>


</blockquote>

	<p>Just to be sure, go to "Help/Components Info" from digiKam menu to see which version of Exiv2 and libkexiv2 you use with digiKam &#38; co...</p>


	<p>Gilles Caulier</p></div>
    </div>
  </div>
  
  <div id="change-1639" class="journal has-notes">
    <div id="note-21">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-21" class="journal-link">#21</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="19 May 2010 06:23" href="/projects/exiv2/activity?from=2010-05-19">over 11 years</a> ago
      <span id="journal-1639-private_notes" class=""></span>
    </h4>

    <div id="journal-1639-notes" class="wiki"><p>Frank,</p>


	<p>You can try the following steps to fix your broken images. But I strongly recommend you make a backup of the corrupted images first. (Yes, the corrupted ones :) Essentially, the "repair-tool" is a hacked version of exiv2 which changes the order of the first two sub-directories of an image during an "intrusive" write operation. For that you need to delete or add a tag or modify one in such a way that the new value requires more space than the old one (e.g., by making an Ascii value longer). If you run this on a good image, it will get corrupted. (But you should be able to reverse the effect by running it again.) The tool only works on images with exactly two sub-directories, like the one you provided as a sample. It will throw an error if the image has more than two. In this case, I'll have to study the image. Hopefully there are no such cases.</p>


	<p>These are the steps:</p>


	<ul>
	<li>Get the hacked version of exiv2: In the exiv2 top-directory, issue the command <code>svn switch svn://dev.exiv2.org/svn/branches/repairbug701</code>, then build as usual. The resulting <code>exiv2</code> binary in <code>src/</code> is the "repair-tool". Change to the <code>src/</code> directory. Do not install this exiv2 version or use it with digiKam or any other application...</li>
	</ul>


	<ul>
	<li>Run something like <code>./exiv2 -M'del Exif.Image.Rating' corrupted-image.nef</code>. (This is just an example, you can add or delete or modify any tag, just make sure that if you modify a tag, the new value is larger than the old one.) Do this with one or two images first and test, before you run it on all.</li>
	</ul>


	<ul>
	<li>Once the images are fixed, you should switch back to the trunk by running <code>svn switch svn://dev.exiv2.org/svn/trunk</code> in the top-directory of your exiv2 tree.</li>
	</ul>


	<p>Good luck and let me know how it goes...<br />Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1640" class="journal has-notes has-details">
    <div id="note-22">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-22" class="journal-link">#22</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/535">Frank Hommes</a> <a title="19 May 2010 07:29" href="/projects/exiv2/activity?from=2010-05-19">over 11 years</a> ago
      <span id="journal-1640-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/174">metadata.txt</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/174/metadata.txt">metadata.txt</a> added</li>
    </ul>
    <div id="journal-1640-notes" class="wiki"><p>Andreas,</p>


	<p>thanks very much for taking some time to help me with my corrupted pictures.</p>


	<p>I tried your steps but:<br />freanki@tristan:~/progs/src/trunk/build/src$ ./exiv2 -M"set Exif.Photo.UserComment charset=Ascii This might repair the picture" ~/win/pics/temp/20100426-102416.nef</p>


	<p>resulted in a corrupted images which can't be loaded anymore by capture nx. Running it over again, restored the image the way it was before.</p>


	<p>I attached the output of: exiv2 -pa 20100426-102416.nef > metadata.txt on this report since I don't know how many directories it has and I hope you can see it there.</p>


	<p>Frank</p></div>
    </div>
  </div>
  
  <div id="change-1641" class="journal has-notes">
    <div id="note-23">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-23" class="journal-link">#23</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="19 May 2010 09:30" href="/projects/exiv2/activity?from=2010-05-19">over 11 years</a> ago
      <span id="journal-1641-private_notes" class=""></span>
    </h4>

    <div id="journal-1641-notes" class="wiki"><p>metadata.txt shows that the image is broken - Exif.SubImage1.NewSubfileType says 'Primary image' and that for SubImage2 indicates a thumbnail in the second sub-directory. It should be the other way around.</p>


	<p>Could it be that something went wrong in the first step?</p>


	<p>Can you try this instead: Check-out the branch somewhere and build the repair tool from scratch, something like this:</p>


<pre>
$ svn co svn://dev.exiv2.org/svn/branches/repairbug701
$ cd repairbug701
$ make config; ./configure --disable-shared; make -j3
$ cd src
$ ./exiv2 -M....
</pre>

	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1642" class="journal has-notes has-details">
    <div id="note-24">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-24" class="journal-link">#24</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/535">Frank Hommes</a> <a title="19 May 2010 10:14" href="/projects/exiv2/activity?from=2010-05-19">over 11 years</a> ago
      <span id="journal-1642-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/175">metadata_broken_file_with_applied_fix.txt</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/175/metadata_broken_file_with_applied_fix.txt">metadata_broken_file_with_applied_fix.txt</a> added</li>
    </ul>
    <div id="journal-1642-notes" class="wiki"><p>Oh thats total right.<br />The metadata is of the file which was broken in the first place without the fix. I posted the metadata because you said: "The tool only works on images with exactly two sub-directories, like the one you provided as a sample. It will throw an error if the image has more than two. In this case, I'll have to study the image." <br />So I thought the original might have had two such directories. I attached the metadata of the broken file with the applied fix which won't start in capture nx.</p>


	<p>I will try your other idea tomorrow and see if the outcome is the same because I'm in a hurry right now.</p>


	<p>Frank</p></div>
    </div>
  </div>
  
  <div id="change-1643" class="journal has-notes">
    <div id="note-25">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-25" class="journal-link">#25</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/535">Frank Hommes</a> <a title="20 May 2010 14:30" href="/projects/exiv2/activity?from=2010-05-20">over 11 years</a> ago
      <span id="journal-1643-private_notes" class=""></span>
    </h4>

    <div id="journal-1643-notes" class="wiki"><p>yes, it's the same error.</p></div>
    </div>
  </div>
  
  <div id="change-1644" class="journal has-notes">
    <div id="note-26">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-26" class="journal-link">#26</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="20 May 2010 23:18" href="/projects/exiv2/activity?from=2010-05-20">over 11 years</a> ago
      <span id="journal-1644-private_notes" class=""></span>
    </h4>

    <div id="journal-1644-notes" class="wiki"><blockquote>

	<p>yes, it's the same error.</p>


</blockquote>

	<p>That's not good and not enough info to say any more. Can you send me a picture which doesn't work and I'll try with that here. Maybe it's different from the image I tested with.</p>


	<p>I'll be away this weekend and will only get to look into this next week.</p>


	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1646" class="journal has-notes has-details">
    <div id="note-27">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-27" class="journal-link">#27</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="25 May 2010 19:28" href="/projects/exiv2/activity?from=2010-05-25">over 11 years</a> ago
      <span id="journal-1646-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Category</strong> set to <i>tiff parser</i></li>
       <li><strong>Status</strong> changed from <i>New</i> to <i>Resolved</i></li>
       <li><strong>Target version</strong> set to <i>0.20</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
    </ul>
    <div id="journal-1646-notes" class="wiki"><p>The "repair tool" is still not working. Will have another look at that after the 0.20 release.</p></div>
    </div>
  </div>
  
  <div id="change-1677" class="journal has-details">
    <div id="note-28">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-28" class="journal-link">#28</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="29 May 2010 10:43" href="/projects/exiv2/activity?from=2010-05-29">over 11 years</a> ago
      <span id="journal-1677-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
    </ul>
    
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/701.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/701.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
