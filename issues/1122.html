<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Patch #1122: Lens Detection with Teleconverter - Sigma 150-500mm f/5-6.3 APO DG OS HSM again - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="a8Vw4ESMnQfD+F0jkLEaMJmdMT0Pb1YN/0Bj02wq2v6JiNsPNvZRB5acQi8vZhYDpg9lRP6M97cCYPNbLxM9kQ==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Patch #1122: Lens Detection with Teleconverter - Sigma 150-500mm f/5-6.3 APO DG OS HSM again" href="https://dev.exiv2.org/issues/1122.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Patch #1122</h2>

<div class="issue tracker-4 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Lens Detection with Teleconverter - Sigma 150-500mm f/5-6.3 APO DG OS HSM again</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/3970">Steve Fosdick</a> <a title="29 Sep 2015 21:29" href="/projects/exiv2/activity?from=2015-09-29">about 6 years</a> ago.
        Updated <a title="08 Nov 2015 18:41" href="/projects/exiv2/activity?from=2015-11-08">about 6 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/119">Robin Mills</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">makernote</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="28 Apr 2017" href="/versions/52">0.26</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">29 Sep 2015</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>When coupled with the Canon 2x teleconverter the Sigma 150-500mm f/5-6.3 APO DG OS HSM is once again not detected.  The numeric ID reported is 173 which is also used by some other lenses.  Simply adding a new tag entry for 173 with this lens name is not sufficient as the minimum and maximum focal lengths in the EXIF are scaled to account for the TC, i.e. reported as 300-1000 rather than 150-500.  As far as I can see this is the first lens + TC combination to appear in an ID conflict.</p>


	<p>For now, I have introduced a hack that deals with this specific combination and I attach a patch.  I will see if I can think of something a little more generic and, if I do, will submit that too.</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/842">hack.patch</a>    <span class="size">(2.7 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/842/hack.patch">hack.patch</a>  </td>
  <td></td>
  <td>
      <span class="author">Steve Fosdick, 29 Sep 2015 21:29</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/843">generic.patch</a>    <span class="size">(5.92 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/843/generic.patch">generic.patch</a>  </td>
  <td></td>
  <td>
      <span class="author">Steve Fosdick, 29 Sep 2015 21:57</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/844">sigma_150-500 2x_test.jpg</a>    <span class="size">(3.31 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/844/sigma_150-500%202x_test.jpg">sigma_150-500 2x_test.jpg</a>  </td>
  <td>Test Picture for Sigma 150-500mm f/5-6.3 APO DG OS HSM + 2x</td>
  <td>
      <span class="author">Steve Fosdick, 01 Oct 2015 23:38</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>








</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 3971" href="/projects/exiv2/repository/exiv2/revisions/3971">Revision 3971</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3971/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="30 Sep 2015 08:21" href="/projects/exiv2/activity?from=2015-09-30">about 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-4 status-5 priority-4 priority-default closed" title="Patch: Lens Detection with Teleconverter - Sigma 150-500mm f/5-6.3 APO DG OS HSM again (Closed)" href="/issues/1122">#1122</a>  Thank You, Steve for the patch.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 3972" href="/projects/exiv2/repository/exiv2/revisions/3972">Revision 3972</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3972/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="02 Oct 2015 08:40" href="/projects/exiv2/activity?from=2015-10-02">about 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-4 status-5 priority-4 priority-default closed" title="Patch: Lens Detection with Teleconverter - Sigma 150-500mm f/5-6.3 APO DG OS HSM again (Closed)" href="/issues/1122">#1122</a>  Adding regression detector to the test suite.  Thank You, Steve, for the test image.</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-4306" class="journal has-notes has-details">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/3970">Steve Fosdick</a> <a title="29 Sep 2015 21:57" href="/projects/exiv2/activity?from=2015-09-29">about 6 years</a> ago
      <span id="journal-4306-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/843">generic.patch</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/843/generic.patch">generic.patch</a> added</li>
    </ul>
    <div id="journal-4306-notes" class="wiki"><p>Here is a second patch, this time more generic.  This works by repeating the search by focal length with the focal length scaled down.</p></div>
    </div>
  </div>
  
  <div id="change-4307" class="journal has-notes has-details">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="29 Sep 2015 22:29" href="/projects/exiv2/activity?from=2015-09-29">about 6 years</a> ago
      <span id="journal-4307-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>New</i> to <i>Assigned</i></li>
       <li><strong>Target version</strong> set to <i>0.26</i></li>
    </ul>
    <div id="journal-4307-notes" class="wiki"><p>Thanks, Steve.  I'll take a look at that tomorrow.</p></div>
    </div>
  </div>
  
  <div id="change-4308" class="journal has-notes has-details">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="30 Sep 2015 08:30" href="/projects/exiv2/activity?from=2015-09-30">about 6 years</a> ago
      <span id="journal-4308-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Resolved</i></li>
       <li><strong>Assignee</strong> set to <i>Robin Mills</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
    </ul>
    <div id="journal-4308-notes" class="wiki"><p>Patch 'generic.patch' submitted <a class="changeset" title="#1122  Thank You, Steve for the patch." href="/projects/exiv2/repository/exiv2/revisions/3971">r3971</a>.  Thank You, Steve for working on this and providing the patch.</p>


	<p>Steve:<br />I've only recently taken on support for Maker Notes, so I'm not familiar with this code.  What you've done <em>"smells right"</em> and hasn't broken our test suite.  So I've submitted your generic patch.</p>


	<p>Do you have any images that we can add to our test suite for any/all of the 173 lensID lenses?  These are listed in src/canonmn.cpp:<pre>        { 173, "Canon EF 180mm Macro f/3.5L"                                }, // 0
        { 173, "Sigma 180mm EX HSM Macro f/3.5"                             }, // 1
        { 173, "Sigma APO Macro 150mm f/3.5 EX DG IF HSM"                   }, // 2
        { 173, "Sigma 150-500mm f/5-6.3 APO DG OS HSM + 2x"                 }, // 3</pre>I don't want to burden Niels who has recently retired from Exiv2 to attend college in addition to his very demanding job.  If any issue surfaces surrounding this, I might ask him to help.  For the moment, I'll set the status to 100% resolved.</p></div>
    </div>
  </div>
  
  <div id="change-4313" class="journal has-notes has-details">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/3970">Steve Fosdick</a> <a title="01 Oct 2015 23:38" href="/projects/exiv2/activity?from=2015-10-01">about 6 years</a> ago
      <span id="journal-4313-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/844">sigma_150-500 2x_test.jpg</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/844/sigma_150-500%202x_test.jpg">sigma_150-500 2x_test.jpg</a> added</li>
    </ul>
    <div id="journal-4313-notes" class="wiki"><p>Of the three lenses I only have the Sigma 150-500 so I attach an image taken with this and the 2x converter.  Without the converter this lens uses ID 174.</p></div>
    </div>
  </div>
  
  <div id="change-4314" class="journal has-notes">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="02 Oct 2015 08:51" href="/projects/exiv2/activity?from=2015-10-02">about 6 years</a> ago
      <span id="journal-4314-private_notes" class=""></span>
    </h4>

    <div id="journal-4314-notes" class="wiki"><p>Thank You, Steve for the image.  A very nice photo.  I've extracted the metadata to the file test/data/exiv2-bug1122.exv and updated test/bugfixes.sh to read your file.  <a class="changeset" title="#1122  Adding regression detector to the test suite.  Thank You, Steve, for the test image." href="/projects/exiv2/repository/exiv2/revisions/3972">r3972</a></p>


	<p>The reason to extract the metadata is to save space in the test suite.  I did this with the following commands:<pre>603 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -ea http://dev.exiv2.org/attachments/download/844/sigma_150-500%202x_test.jpg
604 rmills@rmillsmbp:~/gnu/exiv2/trunk $ mv sigma_150-500%202x_test.exv test/data/exiv2-bug1122.exv </pre></p></div>
    </div>
  </div>
  
  <div id="change-4442" class="journal has-notes has-details">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Nov 2015 18:41" href="/projects/exiv2/activity?from=2015-11-08">about 6 years</a> ago
      <span id="journal-4442-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
    </ul>
    <div id="journal-4442-notes" class="wiki"><p>I'm going to set the status of this to closed.  It has been 100% resolved for some time without further incident.</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/1122.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/1122.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
