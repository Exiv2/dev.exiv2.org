<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Feature #640: method is missing in Exiv2 to get list of known XMP namespaces - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="CPSKVqHHaorFKXQ8kgbMcRzRjffrwjE/hgBBDaMCs2PquSG5072mipBNazAt0cBCI0PZjhohkIV7INGF4DtUDA==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Feature #640: method is missing in Exiv2 to get list of known XMP namespaces" href="https://dev.exiv2.org/issues/640.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Feature #640</h2>

<div class="issue tracker-2 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>method is missing in Exiv2 to get list of known XMP namespaces</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/87">mikolaj -</a> <a title="18 Jul 2009 10:06" href="/projects/exiv2/activity?from=2009-07-18">over 12 years</a> ago.
        Updated <a title="08 Nov 2015 18:40" href="/projects/exiv2/activity?from=2015-11-08">about 6 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/119">Robin Mills</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">xmp</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="28 Apr 2017" href="/versions/52">0.26</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">18 Jul 2009</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value">10.00 h</div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>If application query for an XMP namespace that exiv2 don't know (for ex.<br />IPTC Ext with Exiv2 0.18.2), we have an assertion and application (digiKam in this case) crash.</p>


<hr />


<blockquote>

	<p>1. I have latest exiv2 (svn ver. 1862) with latest additions of IPTC Ext and<br />PLUS namespaces and I don't see them in list of XMP tags - recompiled kexiv2<br />and digikam also. Leftovers from older compilations? Note: generally I am on<br />4.3 branch but switched only kdegrahics/libs to trunk and compiles OK (with<br />including of new feature in digiKam).</p>


</blockquote>

	<p>Because, only with XMP, the list of namespace are not provided by<br />EXIV2. I need to know which namespace i want to list exactly.</p>


	<p><a class="external" href="http://lxr.kde.org/source/KDE/kdegraphics/libs/libkexiv2/libkexiv2/kexiv2xmp.cpp#936">http://lxr.kde.org/source/KDE/kdegraphics/libs/libkexiv2/libkexiv2/kexiv2xmp.cpp#936</a></p>


	<p>Note : if i query for an XMP namespace that exiv2 don't know (for ex.<br />IPTC Ext with Exiv2 0.18.2), we have an assertion and digiKam crash...</p>


	<p>In fact, a method is missing in Exiv2 to get list of know XMP namespace...<br />--------------------------------------</p>
  </div>
</div>






<hr />
<div id="relations">
<div class="contextual">
</div>

<p><strong>Related issues</strong></p>

<form data-cm-url="/issues/context_menu" action="/issues/640" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="q0tkM7h7yRjUmbriBLLrl2uOC7fQl5PG8qstbYftzlpJBs/cygEFGIH9pe67ZeekVBxfziF0MnwPi73lxNQpNQ==" />
  <table class="list issues odd-even"><tr id="relation-176" class="issue hascontextmenu issue tracker-1 status-5 priority-4 priority-default closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="1113" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-1 status-5 priority-4 priority-default closed" href="/issues/1113">Bug #1113</a>: Crash in Exiv2 0.25</td><td class="status">Closed</td><td class="start_date">31 Aug 2015</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr><tr id="relation-179" class="issue hascontextmenu issue tracker-1 status-5 priority-4 priority-default closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="1116" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-1 status-5 priority-4 priority-default closed" href="/issues/1116">Bug #1116</a>: Issues with namespace &#39;video&#39;</td><td class="status">Closed</td><td class="start_date">08 Sep 2015</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr></table>
</form>
<form class="new_relation" id="new-relation-form" style="display: none;" action="/issues/640/relations" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />


<p><select onchange="setPredecessorFieldsVisibility();" name="relation[relation_type]" id="relation_relation_type"><option selected="selected" value="relates">Related to</option>
<option value="duplicates">Is duplicate of</option>
<option value="duplicated">Has duplicate</option>
<option value="blocks">Blocks</option>
<option value="blocked">Blocked by</option>
<option value="precedes">Precedes</option>
<option value="follows">Follows</option>
<option value="copied_to">Copied to</option>
<option value="copied_from">Copied from</option></select>
Issue #<input size="10" type="text" name="relation[issue_to_id]" id="relation_issue_to_id" />
<span id="predecessor_fields" style="display:none;">
Delay: <input size="3" type="text" name="relation[delay]" id="relation_delay" /> days
</span>
<input type="submit" name="commit" value="Add" data-disable-with="Add" />
<a href="#" onclick="$(&quot;#new-relation-form&quot;).hide();; return false;">Cancel</a>
</p>

<script>
//<![CDATA[
observeAutocompleteField('relation_issue_to_id', '/issues/auto_complete?issue_id=640&project_id=exiv2&scope=all')
//]]>
</script>

<script>
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>
</div>

</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 3891" href="/projects/exiv2/repository/exiv2/revisions/3891">Revision 3891</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3891/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="24 Aug 2015 09:45" href="/projects/exiv2/activity?from=2015-08-24">about 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p>exiv2 -vV lists registered Namespaces.  <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: method is missing in Exiv2 to get list of known XMP namespaces (Closed)" href="/issues/640">#640</a> and topic 2169 <a class="external" href="http://dev.exiv2.org/boards/3/topics/2169">http://dev.exiv2.org/boards/3/topics/2169</a></p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 3914" href="/projects/exiv2/repository/exiv2/revisions/3914">Revision 3914</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3914/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="29 Aug 2015 16:43" href="/projects/exiv2/activity?from=2015-08-29">about 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: method is missing in Exiv2 to get list of known XMP namespaces (Closed)" href="/issues/640">#640</a> <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: adobe xmp namespace (Closed)" href="/issues/751">#751</a>  Fix to test suit to prevent crash in exiv2json -x test/data/BlueSquare.xmp (see <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: adobe xmp namespace (Closed)" href="/issues/751">#751</a> for discussion)</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 3916" href="/projects/exiv2/repository/exiv2/revisions/3916">Revision 3916</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3916/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="29 Aug 2015 20:00" href="/projects/exiv2/activity?from=2015-08-29">about 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: method is missing in Exiv2 to get list of known XMP namespaces (Closed)" href="/issues/640">#640</a> and # 751.  Fixing linux build-breaker.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 3925" href="/projects/exiv2/repository/exiv2/revisions/3925">Revision 3925</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3925/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Sep 2015 20:51" href="/projects/exiv2/activity?from=2015-09-03">about 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: method is missing in Exiv2 to get list of known XMP namespaces (Closed)" href="/issues/640">#640</a> Modified XmpParser::getRegisteredNamespaces to use Exiv2::Dictionary.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 3931" href="/projects/exiv2/repository/exiv2/revisions/3931">Revision 3931</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3931/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Sep 2015 13:01" href="/projects/exiv2/activity?from=2015-09-08">about 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: method is missing in Exiv2 to get list of known XMP namespaces (Closed)" href="/issues/640">#640</a> Public API to reveal all namespaces known to Exiv2 and XMPsdk is XmpProperties::registeredNamespaces(Exiv2::Dictionary&#38;)</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 3932" href="/projects/exiv2/repository/exiv2/revisions/3932">Revision 3932</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3932/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Sep 2015 13:15" href="/projects/exiv2/activity?from=2015-09-08">about 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: method is missing in Exiv2 to get list of known XMP namespaces (Closed)" href="/issues/640">#640</a>.  Correction to <a class="changeset" title="#640 Public API to reveal all namespaces known to Exiv2 and XMPsdk is XmpProperties::registeredNa..." href="/projects/exiv2/repository/exiv2/revisions/3931">r3931</a>.</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-4084" class="journal has-details">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="23 Aug 2015 16:16" href="/projects/exiv2/activity?from=2015-08-23">about 6 years</a> ago
      <span id="journal-4084-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Target version</strong> set to <i>53</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-4109" class="journal has-notes has-details">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="24 Aug 2015 09:45" href="/projects/exiv2/activity?from=2015-08-24">about 6 years</a> ago
      <span id="journal-4109-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Category</strong> set to <i>xmp</i></li>
       <li><strong>Status</strong> changed from <i>New</i> to <i>Closed</i></li>
       <li><strong>Assignee</strong> set to <i>Robin Mills</i></li>
       <li><strong>Target version</strong> changed from <i>53</i> to <i>0.26</i></li>
    </ul>
    <div id="journal-4109-notes" class="wiki"><p><a class="changeset" title="exiv2 -vV lists registered Namespaces.  #640 and topic 2169 http://dev.exiv2.org/boards/3/topics/..." href="/projects/exiv2/repository/exiv2/revisions/3891">r3891</a> I've updated the output of exiv2 --verbose --version to include a list of registered namespaces.  The code in version.cpp/namespaceDumper() is a callback from XMPsdk to dump the registered namespace.  A variant of that code may be used to dynamically enumerate the XMPsdk namespace registry.</p></div>
    </div>
  </div>
  
  <div id="change-4137" class="journal has-notes has-details">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="28 Aug 2015 19:57" href="/projects/exiv2/activity?from=2015-08-28">about 6 years</a> ago
      <span id="journal-4137-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Closed</i> to <i>Feedback</i></li>
       <li><strong>Assignee</strong> changed from <i>Robin Mills</i> to <i>Andreas Huggel</i></li>
    </ul>
    <div id="journal-4137-notes" class="wiki"><p>I have changed my mind about this.  I revisited samples/exiv2json.cpp and discovered that it's not possible to determine the registered namespaces from an application.</p>


	<p><a class="changeset" title="#960 added API: static void Exiv2::XMPParser::getRegisteredNamespaces(std::map&lt;std::string,std::s..." href="/projects/exiv2/repository/exiv2/revisions/3912">r3912</a> added the API:<pre>static void Exiv2::XMPParser::getRegisteredNamespaces(std::map&lt;std::string,std::string&gt;&#38;);</pre>I've modified samples/exiv2json.cpp to report the namespaces in use.  I've modified src/version.cpp to use getRegisteredNamespaces.</p>


	<p>I'm assigning this to Andreas for comment and feedback about the API.</p>


	<p>TODO:<br />Just before checking this in, I discovered an exception in test 1054 "Caught Exiv2 exception 'XMP Toolkit error 9: Fatal namespace map problem'".  Infuriatingly, it's only in the release version with the file ./test/data/BlueSquare.xmp  Before I spend time to fix this, I'd appreciate feedback on the API.</p></div>
    </div>
  </div>
  
  <div id="change-4144" class="journal has-notes">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="29 Aug 2015 20:28" href="/projects/exiv2/activity?from=2015-08-29">about 6 years</a> ago
      <span id="journal-4144-private_notes" class=""></span>
    </h4>

    <div id="journal-4144-notes" class="wiki"><p>I've found and fixed the issue with test 1054.  I've discussed the fix in <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: adobe xmp namespace (Closed)" href="/issues/751">#751</a>.</p></div>
    </div>
  </div>
  
  <div id="change-4192" class="journal has-notes">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="04 Sep 2015 08:12" href="/projects/exiv2/activity?from=2015-09-04">about 6 years</a> ago
      <span id="journal-4192-private_notes" class=""></span>
    </h4>

    <div id="journal-4192-notes" class="wiki"><p>Sorry, this took me longer than it should have.</p>


	<p>We have a static class that provides access to metadata reference information for each type of metadata. These classes are <a href="http://www.exiv2.org/doc/classExiv2_1_1ExifTags.html" class="external"><code>Exiv2::ExifTags</code></a>, <a href="http://www.exiv2.org/doc/classExiv2_1_1IptcData.html" class="external"><code>Exiv2::IptcDataSets</code></a> and <br /><a href="http://www.exiv2.org/doc/classExiv2_1_1XmpProperties.html" class="external"><code>Exiv2::XmpProperties</code></a>. (The high-level class-design is outlined in the <a href="http://www.exiv2.org/doc/index.html" class="external">API doc intro</a>. )</p>


	<p>A new library API to return a list of known XMP namespaces and prefixes is such reference data, so I'd add it to <code>Exiv2::XmpProperties</code>, re-using as many of the existing types from there as possible, rather than re-inventing new ones, following the guideline that a smaller API is a better API.</p>


	<p>In this class, there is already a (public) registry <code>nsRegistry_</code>, but we currently only use it for custom namespaces. I'm wondering if we should (could?) add the built-in namespaces to this registry as well (initializing it in <code>XmpParser::initialize()</code>)? The registry is public, so that would solve this issue.</p></div>
    </div>
  </div>
  
  <div id="change-4193" class="journal has-notes">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="04 Sep 2015 10:46" href="/projects/exiv2/activity?from=2015-09-04">about 6 years</a> ago
      <span id="journal-4193-private_notes" class=""></span>
    </h4>

    <div id="journal-4193-notes" class="wiki"><p>I've tried to implement this and it doesn't work out very well.  The obstacle is calling XmpParser::initialize() which requires a lock.  By defining a new API Exiv2::XmpParser::getRegisteredNamespace(), we call initialize() correctly and invisibly.</p>


	<p>My other concern is how cumbersome things become.  Iterating the nsRegistry_ is troublesome.  Accessing the prefix/uri involves code something like (*it).second.ns_  (everything I tried crashed).  It's so much easier to iterate an Exiv2::Dictionary.</p>


	<p>I realise that, in principle, there is more information potentially available via XmpNsInfo.xmpPropertyInfo_, however I don't believe these structures are populated.  My feeling is that your proposal, although elegant, adds complexity for no purpose.  XmpParser::initialize call SXMPMeta::DumpNamespaces to update nsRegistry_.  So, I believe we can do this your way and mine!</p>


	<p>However my primary concern is how to invisibly and correctly call XmpParser:: initialize().</p></div>
    </div>
  </div>
  
  <div id="change-4194" class="journal has-notes">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="06 Sep 2015 10:33" href="/projects/exiv2/activity?from=2015-09-06">about 6 years</a> ago
      <span id="journal-4194-private_notes" class=""></span>
    </h4>

    <div id="journal-4194-notes" class="wiki"><p>Shouldn't have mentioned <code>nsRegistry_</code>, that was really just 'wondering'. The feedback was supposed to just be:</p>


	<p>1. API - I feel this belongs in class <code>XmpProperties</code>, for the reasons given. <br />2. Implementation - the simpler the better, I'm not really worried about that.</p>


	<p>So I played a bit, trying to implement a trivial version - and opened a can of worms:</p>


<pre>
Index: include/exiv2/properties.hpp
===================================================================
--- include/exiv2/properties.hpp    (revision 3927)
+++ include/exiv2/properties.hpp    (working copy)
@@ -224,6 +224,9 @@
         // DATA
         static NsRegistry nsRegistry_;          //!&lt; Namespace registry

+        typedef std::vector&lt;std::pair&lt;const char*, const char*&gt; &gt; NsList;
+        static void registeredNamespaces(NsList&#38; nsList);
+
     }; // class XmpProperties

     /*!
Index: src/properties.cpp
===================================================================
--- src/properties.cpp    (revision 3927)
+++ src/properties.cpp    (working copy)
@@ -2391,6 +2391,14 @@
         return xn;
     }

+    void XmpProperties::registeredNamespaces(NsList&#38; nsList)
+    {
+        nsList.clear();
+        for (unsigned int i = 0; i &lt; EXV_COUNTOF(xmpNsInfo); ++i) {
+            nsList.push_back(std::make_pair(xmpNsInfo[i].prefix_, xmpNsInfo[i].ns_));
+        }
+    }
+
     void XmpProperties::printProperties(std::ostream&#38; os, const std::string&#38; prefix)
     {
         const XmpPropertyInfo* pl = propertyList(prefix);
</pre>

	<p>Simple, straightforward, and works well at first glance. But compared to <code>$ exiv2 -vV | grep xmlns</code>, it produces less output. At the same time, it contains several entries that <code>$ exiv2 -vV | grep xmlns</code> doesn't have!</p>


	<p>So, besides the discussion of 1. and 2. above, we've uncovered that the XMP namespaces known by Exiv2 and its internal XMPSDK are not in sync.</p>


	<p>To fix that, we'd have to register namespaces that Exiv2 knows and XMPSDK doesn't in XMPSDK, and vice versa, probably, add namespaces that XMPSDK knows but Exiv2 doesn't to our lists in properties.cpp.</p>


	<p>Here's the difference between the output of this simple function (<code><</code>) and <code>exiv2 -vV</code> (<code>></code>):</p>


<pre>
2c2,3
&lt; xmlns=audio:http://www.audio
---
&gt; xmlns=album:http://ns.adobe.com/album/1.0/
&gt; xmlns=asf:http://ns.adobe.com/asf/1.0/
3a5,6
&gt; xmlns=bmsp:http://ns.adobe.com/StockPhoto/1.0/
&gt; xmlns=creatorAtom:http://ns.adobe.com/creatorAtom/1.0/
6a10
&gt; xmlns=DICOM:http://ns.adobe.com/DICOM/
14d17
&lt; xmlns=Iptc4xmpExt:http://iptc.org/std/Iptc4xmpExt/2008-02-29/
16c19,21
&lt; xmlns=iptc:http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/
---
&gt; xmlns=iX:http://ns.adobe.com/iX/1.0/
&gt; xmlns=jp2k:http://ns.adobe.com/jp2k/1.0/
&gt; xmlns=jpeg:http://ns.adobe.com/jpeg/1.0/
25a31,36
&gt; xmlns=pdfaExtension:http://www.aiim.org/pdfa/ns/extension/
&gt; xmlns=pdfaField:http://www.aiim.org/pdfa/ns/field#
&gt; xmlns=pdfaid:http://www.aiim.org/pdfa/ns/id/
&gt; xmlns=pdfaProperty:http://www.aiim.org/pdfa/ns/property#
&gt; xmlns=pdfaSchema:http://www.aiim.org/pdfa/ns/schema#
&gt; xmlns=pdfaType:http://www.aiim.org/pdfa/ns/type#
26a38,39
&gt; xmlns=pdfx:http://ns.adobe.com/pdfx/1.3/
&gt; xmlns=pdfxid:http://www.npes.org/pdfx/ns/id/
28a42,43
&gt; xmlns=png:http://ns.adobe.com/png/1.0/
&gt; xmlns=rdf:http://www.w3.org/1999/02/22-rdf-syntax-ns#
33a49
&gt; xmlns=stMfs:http://ns.adobe.com/xap/1.0/sType/ManifestItem#
37,38c53,54
&lt; xmlns=video:http://www.video
&lt; xmlns=xapG:http://ns.adobe.com/xap/1.0/g/
---
&gt; xmlns=wav:http://ns.adobe.com/xmp/wav/1.0/
&gt; xmlns=xml:http://www.w3.org/XML/1998/namespace
40a57
&gt; xmlns=xmpG:http://ns.adobe.com/xap/1.0/g/
44a62
&gt; xmlns=xmpNote:http://ns.adobe.com/xmp/note/
45a64
&gt; xmlns=xmpT:http://ns.adobe.com/xap/1.0/t/
</pre></div>
    </div>
  </div>
  
  <div id="change-4207" class="journal has-notes has-details">
    <div id="note-8">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-8" class="journal-link">#8</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Sep 2015 13:14" href="/projects/exiv2/activity?from=2015-09-08">about 6 years</a> ago
      <span id="journal-4207-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>0</i> to <i>90</i></li>
       <li><strong>Estimated time</strong> set to <i>10.00 h</i></li>
    </ul>
    <div id="journal-4207-notes" class="wiki"><p>As always, Andreas, you have very good ideas.  I've put the public API into XmpProperties::registeredNamespaces(Exiv2::Dictionary&#38;).</p>


	<p>I have "demoted" the API XmpParser::registeredNamespaces() to be private and made XmpProperties a <em>friend class</em> of XmpParser.  This enables XmpProperties::registeredNamespaces to call XmpParser::registerNs before calling XmpParser::registeredNamespaces().  So the sync between Exiv2 and XMPsdk is achieved seamlessly.  The output of exiv2 correctly shows libexiv2 namespaces such as video and audio.  XMPsdk namespaces such as png are also listed.<pre>510 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -vV -g audio -g video -g png
exiv2 0.25 001900 (64 bit build)
enable_video=0
xmlns=audio:http://www.audio
xmlns=png:http://ns.adobe.com/png/1.0/
xmlns=video:http://www.video
511 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>I have update the code in src/version.cpp and samples/exiv2json.cpp to use XmpProperties::registeredNamespace.  exiv2json now correctly lists all namespaces in use.<pre>516 rmills@rmillsmbp:~/gnu/exiv2/trunk $ bin/exiv2json -x http://dev.exiv2.org/attachments/download/805/DSC_7154.jpg
{
    "Xmp": {
        "xmp": {
            "Rating": "0",
            "ModifyDate": "2015-07-16T20:25:28+01:00" 
        },
        "dc": {
            "description": {
                "lang": {
                    "x-default": "Classic View" 
                }
            }
        },
        "xmlns": {
            "dc": "http:\/\/purl.org\/dc\/elements\/1.1\/",
            "xmp": "http:\/\/ns.adobe.com\/xap\/1.0\/" 
        }
    }
}
517 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre></p></div>
    </div>
  </div>
  
  <div id="change-4208" class="journal has-notes">
    <div id="note-9">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-9" class="journal-link">#9</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4035">Alan Pater</a> <a title="08 Sep 2015 14:38" href="/projects/exiv2/activity?from=2015-09-08">about 6 years</a> ago
      <span id="journal-4208-private_notes" class=""></span>
    </h4>

    <div id="journal-4208-notes" class="wiki"><p>With these changes we are also listing XMPSDK namespaces that are not supported by exiv2.</p>


	<p>Is that not a separate feature then listing namespaces known to exiv2?</p></div>
    </div>
  </div>
  
  <div id="change-4209" class="journal has-notes">
    <div id="note-10">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-10" class="journal-link">#10</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Sep 2015 17:07" href="/projects/exiv2/activity?from=2015-09-08">about 6 years</a> ago
      <span id="journal-4209-private_notes" class=""></span>
    </h4>

    <div id="journal-4209-notes" class="wiki"><p>Is there such a thing as an XMPsdk namespace that is not supported by exiv2?</p>


	<p>If we register the namespace (in this case cm),  we can use it.  If XMPsdk knows it (xmpBJ), we can use it.  <pre>$ curl  --silent -O http://dev.exiv2.org/attachments/download/805/DSC_7154.jpg
$ exiv2 -M"reg cm http://clanmills.com/exiv2/1.0" -M"set Xmp.cm.title robin" -M"set Xmp.xmpBJ.bubble jet" DSC_7154.jpg
$ bin/exiv2json -x DSC_7154.jpg
{
    "Xmp": {
        "xmp": {
            "Rating": "0",
            "ModifyDate": "2015-07-16T20:25:28+01:00" 
        },
        "cm": {
            "title": "robin" 
        },
        "xmpBJ": {
            "bubble": "jet" 
        },
        "dc": {
            "description": {
                "lang": {
                    "x-default": "Classic View" 
                }
            }
        },
        "xmlns": {
            "cm": "http:\/\/clanmills.com\/exiv2\/1.0\/",
            "dc": "http:\/\/purl.org\/dc\/elements\/1.1\/",
            "xmp": "http:\/\/ns.adobe.com\/xap\/1.0\/",
            "xmpBJ": "http:\/\/ns.adobe.com\/xap\/1.0\/bj\/" 
        }
    }
}
$ </pre>If neither XMPsdk nor Exiv2 knows the namespace, we throw an exception.<pre>540 rmills@rmillsmbp:~/gnu/exiv2 $ exiv2 -M"set Xmp.alan.title Pater" DSC_7154.jpg
-M option 1: Invalid key `Xmp.alan.title'
exiv2: Error parsing -M option arguments
Usage: exiv2 [ options ] [ action ] file ...

Manipulate the Exif metadata of images.
$ </pre>If we register, the namespace, all is good.<pre>$ exiv2 -M"reg alan http://clanmills.com/alan/1.0" -M"set Xmp.alan.title Pater" DSC_7154.jpg
$ </pre>Everything has been stored nicely in DSC_7154.jpg.<pre>$ bin/exiv2json -x DSC_7154.jpg
{
    "Xmp": {
        "xmp": {
            "Rating": "0",
            "ModifyDate": "2015-07-16T20:25:28+01:00" 
        },
        "cm": {
            "title": "robin" 
        },
        "xmpBJ": {
            "bubble": "jet" 
        },
        "alan": {
            "title": "Pater" 
        },
        "dc": {
            "description": {
                "lang": {
                    "x-default": "Classic View" 
                }
            }
        },
        "xmlns": {
            "alan": "http:\/\/clanmills.com\/alan\/1.0\/",
            "cm": "http:\/\/clanmills.com\/exiv2\/1.0\/",
            "dc": "http:\/\/purl.org\/dc\/elements\/1.1\/",
            "xmp": "http:\/\/ns.adobe.com\/xap\/1.0\/",
            "xmpBJ": "http:\/\/ns.adobe.com\/xap\/1.0\/bj\/" 
        }
    }
}
$</pre>The code in SXMPMeta::DumpNamespaces (which is called by XmpProperties::registeredNamespaces) guarantees every ns/uri pair we define is either unique to Exiv2 or has the same definition as XMPsdk.  This is discussed in <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: adobe xmp namespace (Closed)" href="/issues/751">#751</a>.</p>


	<p>However, we seem to have namespaces in exiv2 which are not correctly supported and I suspect this is because exiv2 has not correctly registered all its namespaces! <pre>544 rmills@rmillsmbp:~/gnu/exiv2 $ exiv2 -M"set Xmp.video.def abc" DSC_7154.jpg
Error: XMP Toolkit error 101: Unregistered schema namespace URI
Error: Failed to encode XMP metadata.
545 rmills@rmillsmbp:~/gnu/exiv2 $ exiv2 -vV -g video
exiv2 0.25 001900 (64 bit build)
enable_video=0
xmlns=video:http://www.video
546 rmills@rmillsmbp:~/gnu/exiv2 $ </pre>Should work, but doesn't.<pre>$ 548 rmills@rmillsmbp:~/gnu/exiv2 $ trunk/bin/exiv2json DSC_7154.jpg 
Caught Exiv2 exception 'XMP Toolkit error 9: Fatal namespace map problem'
$</pre>Let's register and use it:<pre>$ exiv2 -M"reg video http://www.video" -M"set Xmp.video.def abc" DSC_7154.jpg
$</pre>He says he's happy.  However he's not.  <pre>$ bin/exiv2json -x DSC_7154.jpg 
Caught Exiv2 exception 'XMP Toolkit error 9: Fatal namespace map problem'
$ </pre>The XMP is good:<pre>$ exiv2 -px DSC_7154.jpg
Xmp.xmp.Rating                               XmpText     1  0
Xmp.xmp.ModifyDate                           XmpText    25  2015-07-16T20:25:28+01:00
Xmp.video.def                                XmpText     3  abc
Xmp.dc.description                           LangAlt     1  lang="x-default" Classic View
$ </pre>I don't think this is serious.  The library isn't registering namespaces with XMPsdk correctly.  I think we need to open a different issue to investigate this finding concerning 'video' as we've wandered way off topic.</p></div>
    </div>
  </div>
  
  <div id="change-4211" class="journal has-notes">
    <div id="note-11">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-11" class="journal-link">#11</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Sep 2015 17:48" href="/projects/exiv2/activity?from=2015-09-08">about 6 years</a> ago
      <span id="journal-4211-private_notes" class=""></span>
    </h4>

    <div id="journal-4211-notes" class="wiki"><p>I've opened a new issue <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Issues with namespace &#39;video&#39; (Closed)" href="/issues/1116">#1116</a> to investigate my discoveries about namespace 'video' above.</p></div>
    </div>
  </div>
  
  <div id="change-4213" class="journal has-notes">
    <div id="note-12">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-12" class="journal-link">#12</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4035">Alan Pater</a> <a title="08 Sep 2015 20:22" href="/projects/exiv2/activity?from=2015-09-08">about 6 years</a> ago
      <span id="journal-4213-private_notes" class=""></span>
    </h4>

    <div id="journal-4213-notes" class="wiki"><p>Robin Mills wrote:</p>


<blockquote>

	<p>Is there such a thing as an XMPsdk namespace that is not supported by exiv2?</p>


	<p>If we register the namespace (in this case cm),  we can use it.</p>


</blockquote>

	<p>Okay, bad wording on my part. I should have said that we are listing namespaces that are not <strong>known</strong> to exiv2.</p>


	<p>I think the original request is for a way to get a list of namespaces that exiv2 already knows about.</p></div>
    </div>
  </div>
  
  <div id="change-4216" class="journal has-notes">
    <div id="note-13">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-13" class="journal-link">#13</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="09 Sep 2015 04:11" href="/projects/exiv2/activity?from=2015-09-09">about 6 years</a> ago
      <span id="journal-4216-private_notes" class=""></span>
    </h4>

    <div id="journal-4216-notes" class="wiki"><p>I think the namespaces known by Exiv2 and its own internal XMPSDK should be in sync.</p>


	<p>Copied from <a class="external" href="http://dev.exiv2.org/issues/1116#note-3">http://dev.exiv2.org/issues/1116#note-3</a>: I wanted to fix that: those namespaces that Exiv2 knows and XMP-SDK doesn't just need to be registered there (I think), but those that XMP-SDK has and Exiv2 doesn't, will require a bit more thought and work. For the current implementation of XmpProperties::registerNamespaces(), registering the missing namespaces in XMP-SDK in XmpParser::initialize() should suffice.</p></div>
    </div>
  </div>
  
  <div id="change-4218" class="journal has-notes has-details">
    <div id="note-14">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-14" class="journal-link">#14</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="09 Sep 2015 10:12" href="/projects/exiv2/activity?from=2015-09-09">about 6 years</a> ago
      <span id="journal-4218-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Feedback</i> to <i>Resolved</i></li>
       <li><strong>Assignee</strong> changed from <i>Andreas Huggel</i> to <i>Robin Mills</i></li>
       <li><strong>% Done</strong> changed from <i>90</i> to <i>100</i></li>
    </ul>
    <div id="journal-4218-notes" class="wiki"><p>Done.  I'll mark this Resolved/100%.  If nothing else raises, it will be marked 'Closed' prior to shipping v0.26.</p></div>
    </div>
  </div>
  
  <div id="change-4440" class="journal has-notes has-details">
    <div id="note-15">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-15" class="journal-link">#15</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Nov 2015 18:40" href="/projects/exiv2/activity?from=2015-11-08">about 6 years</a> ago
      <span id="journal-4440-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Subject</strong> changed from <i>method is missing in Exiv2 to get list of know XMP namespace</i> to <i>method is missing in Exiv2 to get list of known XMP namespaces</i></li>
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
    </ul>
    <div id="journal-4440-notes" class="wiki"><p>I'm going to set the status of this to closed.  It has been 100% resolved for some time without further incident.</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/640.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/640.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
