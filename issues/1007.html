<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #1007: exiv2 0.24 Build error on blackfin arch - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="YZtASRB16xivs7d+jT8PGzA9s1vSW3m0HP69IUYt2SyD1uumYg8nGPrXqHIy6AMoD6/nIiO42A7h3i2pBRQ+Qw==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #1007: exiv2 0.24 Build error on blackfin arch" href="https://dev.exiv2.org/issues/1007.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #1007</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>exiv2 0.24 Build error on blackfin arch</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/4284">Nicolas Serafini</a> <a title="03 Dec 2014 14:02" href="/projects/exiv2/activity?from=2014-12-03">almost 7 years</a> ago.
        Updated <a title="21 Jun 2015 16:39" href="/projects/exiv2/activity?from=2015-06-21">over 6 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/119">Robin Mills</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">build</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="17 May 2015" href="/versions/51">0.25</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">03 Dec 2014</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>exiv2 0.24 is included as a package into buildroot and we have a build error on a blackfin arch with the blackfin uclinux 2014R1 toolchain.</p>


	<p>The build output is here <a class="external" href="http://autobuild.buildroot.net/results/09d/09d9b525eeee458247e10a7948070c00bbabb964/build-end.log">http://autobuild.buildroot.net/results/09d/09d9b525eeee458247e10a7948070c00bbabb964/build-end.log</a></p>


	<p>It seems that the inclusion of link.h in version.cpp line 119 create this error. Perhaps there is a problem into the toolchain because the error comes from some other included files in "link.h" but if I remove the inclusion of "link.h" all seems to work fine even with another toolchain (linaro 2014.07).</p>


	<p>Do we really need to include this file ?</p>
  </div>
</div>







</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 3397" href="/projects/exiv2/repository/exiv2/revisions/3397">Revision 3397</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3397/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Dec 2014 19:49" href="/projects/exiv2/activity?from=2014-12-03">almost 7 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: exiv2 0.24 Build error on blackfin arch (Closed)" href="/issues/1007">#1007</a>.  Thank You, Nicolas for reporting this and identifying the fix.</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-3003" class="journal has-notes">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4284">Nicolas Serafini</a> <a title="03 Dec 2014 14:06" href="/projects/exiv2/activity?from=2014-12-03">almost 7 years</a> ago
      <span id="journal-3003-private_notes" class=""></span>
    </h4>

    <div id="journal-3003-notes" class="wiki"><p>oups it's linaro 2014.09 and not 2014.07</p></div>
    </div>
  </div>
  
  <div id="change-3004" class="journal has-notes has-details">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Dec 2014 15:08" href="/projects/exiv2/activity?from=2014-12-03">almost 7 years</a> ago
      <span id="journal-3004-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Tracker</strong> changed from <i>Bug</i> to <i>Support</i></li>
       <li><strong>Status</strong> changed from <i>New</i> to <i>Assigned</i></li>
       <li><strong>Assignee</strong> set to <i>Robin Mills</i></li>
       <li><strong>Target version</strong> set to <i>0.25</i></li>
    </ul>
    <div id="journal-3004-notes" class="wiki"><p>Ah, there's something in your distribution of linux that causing version.cpp to fail to compile.</p>


	<p>I think your distribution either doesn't include link.h, or is remarkably different from that included in Ubuntu and Fedora, which are my linux test/build distros.</p>


<pre>
#elif defined(__linux__)
# include &lt;unistd.h&gt;
// http://syprog.blogspot.com/2011/12/listing-loaded-shared-objects-in-linux.html
# include "link.h" 
# include &lt;dlfcn.h&gt;
  struct something
  {
    void*  pointers[3];
    struct something* ptr;
  };
  struct lmap
  {
    void*    base_address;   /* Base address of the shared object */
    char*    path;           /* Absolute file name (path) of the shared object */
    void*    not_needed1;    /* Pointer to the dynamic section of the shared object */
    struct lmap *next, *prev;/* chain of loaded objects */
  };
#endif

...

#elif defined(__linux__)
    // http://stackoverflow.com/questions/606041/how-do-i-get-the-path-of-a-process-in-unix-linux
    char proc[100];
    char path[500];
    sprintf(proc,"/proc/%d/exe", getpid());
    int l = readlink (proc, path,sizeof(path)-1);
    if (l&gt;0) {
        path[l]=0;
        libs.push_back(path);
    } else {
        libs.push_back("unknown");
    }

    // http://syprog.blogspot.com/2011/12/listing-loaded-shared-objects-in-linux.html
    struct lmap*      pl;
    void*             ph = dlopen(NULL, RTLD_NOW);
    struct something* p  = (struct something*) ph;

    p  = p-&gt;ptr;
    pl = (struct lmap*)p-&gt;ptr;

    while ( pl )
    {
        libs.push_back(pl-&gt;path);
        pl = pl-&gt;next;
    }
#endif

</pre>

	<p>The purpose of this code is to enumerate libraries being used by exiv2.  This is inspected by our test suite to be validate we are using the correct libraries.  Here's the output from gubuntu:<br /><pre>
1001 rmills@rmillsmbp-kubuntu:~ $ which exiv2
/usr/local/bin/exiv2
1002 rmills@rmillsmbp-kubuntu:~ $ exiv2 -v -V
exiv2 0.24 001800 (64 bit build)
Copyright (C) 2004-2013 Andreas Huggel.

This program is free software; you can redistribute it and/or
...
Boston, MA 02110-1301 USA
exiv2=0.24.0
platform=linux
compiler=G++
bits=64
dll=1
debug=0
version=4.8.2
date=Oct  7 2014
time=21:39:32
svn=3372
executable=/usr/local/bin/exiv2
library=/usr/local/lib/libexiv2.so.13
library=/usr/lib/x86_64-linux-gnu/libstdc++.so.6
library=/lib/x86_64-linux-gnu/libgcc_s.so.1
library=/lib/x86_64-linux-gnu/libc.so.6
library=/usr/local/lib/libz.so.1
library=/usr/local/lib/libexpat.so.1
library=/lib/x86_64-linux-gnu/libdl.so.2
library=/lib/x86_64-linux-gnu/libm.so.6
library=/lib64/ld-linux-x86-64.so.2
1003 rmills@rmillsmbp-kubuntu:~ $
</pre></p>


	<p>I'm not sure what  blackfin arch with the blackfin 2014.09 is.  Presumably, I can google, download and create a virtual machine to run this.  Any pointers?</p>


	<p>The code has been constructed to deal with GCC/Clang/Windows/Cygwin/Mac/Linux/GNU platforms and I'm quite certain that it can be modified to deal with your distribution.  However, it will involve a change to the CMake*.txt files or version.cpp.  I don't think we're going to be able to fix this from the build command line.  Does this create difficulties for you?</p></div>
    </div>
  </div>
  
  <div id="change-3005" class="journal has-notes">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4284">Nicolas Serafini</a> <a title="03 Dec 2014 16:27" href="/projects/exiv2/activity?from=2014-12-03">almost 7 years</a> ago
      <span id="journal-3005-private_notes" class=""></span>
    </h4>

    <div id="journal-3005-notes" class="wiki"><p>Thanks for your response.</p>


	<p>Blackfin is a processor from analog devices on which we build a full linux distribution. It's possible that the toolchain used has a bug because the build crash into a file from the libC (uclibc) used by the toolchain.</p>


	<p>But I have just tested to compile on my desktop after removing the line <code>#include "link.h"</code> at line 119 and it work's fine without.</p>


<pre>
nse@nse-ubuntu ~/temp/exiv2-0.24/bin » ./exiv2 -v -V                                                                                                                                                                        127 ↵
exiv2 0.24 001800 (64 bit build)
Copyright (C) 2004-2013 Andreas Huggel.

This program is free software; you can redistribute it and/or
...
Boston, MA 02110-1301 USA
exiv2=0.24.0
platform=linux
compiler=G++
bits=64
dll=1
debug=0
version=4.8.2
date=Dec  3 2014
time=16:20:29
executable=/home/nse/temp/exiv2-0.24/bin/exiv2
library=/home/nse/temp/exiv2-0.24/src/libexiv2.so.13
library=/usr/lib/x86_64-linux-gnu/libstdc++.so.6
library=/lib/x86_64-linux-gnu/libgcc_s.so.1
library=/lib/x86_64-linux-gnu/libc.so.6
library=/lib/x86_64-linux-gnu/libdl.so.2
library=/lib/x86_64-linux-gnu/libexpat.so.1
library=/lib/x86_64-linux-gnu/libm.s
</pre></div>
    </div>
  </div>
  
  <div id="change-3006" class="journal has-notes">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Dec 2014 17:24" href="/projects/exiv2/activity?from=2014-12-03">almost 7 years</a> ago
      <span id="journal-3006-private_notes" class=""></span>
    </h4>

    <div id="journal-3006-notes" class="wiki"><p>Nicolas:</p>


	<p>Can you suggest how I can hide link.h from your build.  Something like:</p>


<pre>
#elif defined(__linux__)
# include &lt;unistd.h&gt;
// http://syprog.blogspot.com/2011/12/listing-loaded-shared-objects-in-linux.html
# ifndef __ Blackfin__
#  include "link.h" 
# endif
# include &lt;dlfcn.h&gt;
</pre>

	<p>I will submit your recommendation to the trunk and you'll be future proofed.</p>


	<p>If you're OK with this, I'd like to mark this resolved.  Let me know.</p>


	<p>Robin</p></div>
    </div>
  </div>
  
  <div id="change-3007" class="journal has-notes">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4284">Nicolas Serafini</a> <a title="03 Dec 2014 18:37" href="/projects/exiv2/activity?from=2014-12-03">almost 7 years</a> ago
      <span id="journal-3007-private_notes" class=""></span>
    </h4>

    <div id="journal-3007-notes" class="wiki"><p>No I don't want an architecture flag to exclude this header. If the toolchain has a bug when this header is included it's from the toolchain maintainer to fix this.</p>


	<p>For the exiv2 part I think the inclusion of link.h is not needed on any linux distribution.</p>


	<p>I have build two times using cmake and configure a version for my Desktop on ubuntu without the include of link.h and it works.</p>


	<p>In version.cpp no symbol from the link.h header is used. <br />version.cpp create only a minimal link_map structure and the web page from where the example come doesn't specify the need to include this header.</p>


	<p>For me the patch is</p>


<pre>
#elif defined(__linux__)
# include &lt;unistd.h&gt;
// http://syprog.blogspot.com/2011/12/listing-loaded-shared-objects-in-linux.html
# include &lt;dlfcn.h&gt;
</pre></div>
    </div>
  </div>
  
  <div id="change-3008" class="journal has-notes has-details">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Dec 2014 19:52" href="/projects/exiv2/activity?from=2014-12-03">almost 7 years</a> ago
      <span id="journal-3008-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Tracker</strong> changed from <i>Support</i> to <i>Bug</i></li>
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Resolved</i></li>
    </ul>
    <div id="journal-3008-notes" class="wiki"><p>Fix submitted <a class="changeset" title="#1007.  Thank You, Nicolas for reporting this and identifying the fix." href="/projects/exiv2/repository/exiv2/revisions/3397">r3397</a>.  Thank You, Nicolas, both for reporting this and for the fix.  Much Appreciated.</p></div>
    </div>
  </div>
  
  <div id="change-3662" class="journal has-details">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 May 2015 16:32" href="/projects/exiv2/activity?from=2015-05-08">over 6 years</a> ago
      <span id="journal-3662-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-3801" class="journal has-details">
    <div id="note-8">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-8" class="journal-link">#8</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="21 Jun 2015 16:39" href="/projects/exiv2/activity?from=2015-06-21">over 6 years</a> ago
      <span id="journal-3801-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
    </ul>
    
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/1007.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/1007.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
