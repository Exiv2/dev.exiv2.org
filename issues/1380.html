<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #1380: Iptc.Application2.DateCreated and Iptc.Application2.TimeCreated date formats are different in read/write - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="gOETodyb6wXSLllWSDiJKEJ2ggUnL85CmjW4YinSsuNirLhOruEnBYdKRlr374UbfeTWfNbMb/hnFSjqautVjA==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #1380: Iptc.Application2.DateCreated and Iptc.Application2.TimeCreated date formats are different in read/write" href="https://dev.exiv2.org/issues/1380.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #1380</h2>

<div class="issue tracker-1 status-1 priority-4 priority-default details">
    <div class="next-prev-links contextual">
      « Previous |
        <span class="position">
          <a href="/issues?f%5B%5D=status_id&amp;op%5Bstatus_id%5D=o&amp;page=1&amp;per_page=25&amp;set_filter=1&amp;sort=updated_on%3Adesc%2Cid%3Adesc&amp;v%5Bstatus_id%5D%5B%5D=">1 of 78</a>
        </span> |
      <a title="#1379" accesskey="n" href="/issues/1379">Next »</a>
    </div>

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Iptc.Application2.DateCreated and Iptc.Application2.TimeCreated date formats are different in read/write</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/4017">Jehan Pagès</a> <a title="14 Nov 2020 23:59" href="/projects/exiv2/activity?from=2020-11-14">about 1 year</a> ago.
        Updated <a title="15 Nov 2020 01:09" href="/projects/exiv2/activity?from=2020-11-15">about 1 year</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">New</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value">-</div></div><div class="category attribute"><div class="label">Category:</div><div class="value">-</div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">14 Nov 2020</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-0"><tr><td style="width: 100%;" class="todo"></td></tr></table><p class="percent">0%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Version of Exiv2: 0.27.3 (and tested HEAD of 0.27-maintenance branch too)</p>


	<ol>
	<li>Description of problem</li>
	</ol>


	<p>A date and time can be written with Exiv2 in IPTC (tags Iptc.Application2.DateCreated and Iptc.Application2.TimeCreated respectively) using a specific format "2020-11-15" and "HH:MM:SS-HH:MM" but when read back (still with Exiv2), it expects another format ("20201115" and "HHMMSS:HHMM" which corresponds to what you wrote here: <a class="external" href="https://exiv2.org/iptc.html">https://exiv2.org/iptc.html</a>) resulting in following errors being returned: "Unsupported date format" and "Unsupported time format".</p>


	<p>Note that if I try to set instead with "20201115" and "HHMMSS:HHMM" format instead, then I get the same errors but this time when setting the IPTC tag. It really seems like the API is not consistent on write and read.</p>


	<ol>
	<li>More info</li>
	</ol>


	<p>Looking quickly into exiv2 code, for instance in `src/value.cpp`, I can see that DateValue::read(const byte* buf, long len, ByteOrder /*byteOrder*/) definitely expects a string of 8-byte string with format "%4d%2d%2d" (similarly for TimeValue::read()). This is the code we hit when we previously set date/time in another format (also with exiv2, I remind) hence get kerUnsupportedDateFormat and kerUnsupportedTimeFormat errors.</p>


	<p>But now when I set a new tag, Iptcdatum::setValue(const std::string&#38; value) calls DateValue::read(const std::string&#38; buf) which has the format "%4d-%d-%d".</p>


	<p>So basically you have 2 versions of read() for DateValue and TimeValue, and they do something different. And as it turns out, we hit one of the version when writing a new tag, the other when reading tags from existing files. Therefore Exiv2 fails to read some tags it created itself.</p>


	<p>src/pngimage.cpp</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1262">0001-More-robust-date-and-time-format-read.patch</a>    <span class="size">(4.94 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1262/0001-More-robust-date-and-time-format-read.patch">0001-More-robust-date-and-time-format-read.patch</a>  </td>
  <td>Patch</td>
  <td>
      <span class="author">Jehan Pagès, 15 Nov 2020 01:08</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>








</div>




<div id="history">
<h3>History</h3>
  <div id="change-6373" class="journal has-notes">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4017">Jehan Pagès</a> <a title="15 Nov 2020 01:08" href="/projects/exiv2/activity?from=2020-11-15">about 1 year</a> ago
      <span id="journal-6373-private_notes" class=""></span>
    </h4>

    <div id="journal-6373-notes" class="wiki"><p>So actually I thought I might as well just fix this myself. My solution is to have more robust code by accepting both formats (for date and time). Maybe some variants may not be technically right according to specs, but since they are so easily distinguishable, it's probably better to accept them all and simply parse them accordingly.</p>


	<p>Also this will allow existing code using the current implementation to not suddenly break because format changed in one or another function.</p>


	<p>So anyway, attached is the patch.</p></div>
    </div>
  </div>
  
  <div id="change-6374" class="journal has-notes has-details">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4017">Jehan Pagès</a> <a title="15 Nov 2020 01:09" href="/projects/exiv2/activity?from=2020-11-15">about 1 year</a> ago
      <span id="journal-6374-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/1262">0001-More-robust-date-and-time-format-read.patch</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/1262/0001-More-robust-date-and-time-format-read.patch">0001-More-robust-date-and-time-format-read.patch</a> added</li>
    </ul>
    <div id="journal-6374-notes" class="wiki"><p>Oups, previous comment failed to attach the patch somehow. Retrying.</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/1380.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/1380.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
