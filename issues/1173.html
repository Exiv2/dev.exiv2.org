<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #1173: Shared library on Mac OS X has incorrect name - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="yyd1Sh5vqa5OaVQD/DQMxhhr6MMRJ/AKeCX3hxyg3SMpat6lbBVlrhsNSw9D4wD1J/m8uuDEUbCFBWcPX5k6TA==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #1173: Shared library on Mac OS X has incorrect name" href="https://dev.exiv2.org/issues/1173.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #1173</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Shared library on Mac OS X has incorrect name</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/4652">Ilya Kulakov</a> <a title="31 Mar 2016 02:01" href="/projects/exiv2/activity?from=2016-03-31">over 5 years</a> ago.
        Updated <a title="01 Apr 2016 18:22" href="/projects/exiv2/activity?from=2016-04-01">over 5 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/119">Robin Mills</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">build</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="28 Apr 2017" href="/versions/52">0.26</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">31 Mar 2016</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value">1.00 h</div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>For some reason, install name of the shared library (e.g. returned by `otool -D`) uses name of the SONAME (e.g. libexiv2.14.dylib) instead of a full name (e.g. libexiv2.14.0.0.dylib).</p>


	<p>This is incorrect, because install name should match real name of the library, not a name of its SONAME symlink.</p>
  </div>
</div>







</div>




<div id="history">
<h3>History</h3>
  <div id="change-4906" class="journal has-notes has-details">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="31 Mar 2016 09:21" href="/projects/exiv2/activity?from=2016-03-31">over 5 years</a> ago
      <span id="journal-4906-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>New</i> to <i>Assigned</i></li>
       <li><strong>Target version</strong> set to <i>0.26</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>30</i></li>
       <li><strong>Estimated time</strong> set to <i>2.00 h</i></li>
    </ul>
    <div id="journal-4906-notes" class="wiki"><p>We're going to have to discuss this a little more to be "on the same page".  So, to help me decide what to do, may I ask the question.  <em><strong>Why are you concerned about this?  Is there a real problem to be solved?</strong></em></p>


	<p>I have built and installed exiv2 with the autotools and CMake.  They behave a differently.</p>


	<p>Let's define how libraries/install_name and apps should be installed and linked.  I have looked at curl as installed by Apple in /usr/lib.  <pre>513 rmills@rmillsmbp:/usr/lib $ ls -alt | grep curl
-rwxr-xr-x    1 root      wheel    785312 12 Mar 08:36 libcurl.4.dylib
lrwxr-xr-x    1 root      wheel        15  1 Oct 13:47 libcurl.3.dylib -&gt; libcurl.4.dylib
lrwxr-xr-x    1 root      wheel        15  1 Oct 13:47 libcurl.dylib -&gt; libcurl.4.dylib
514 rmills@rmillsmbp:/usr/lib $ otool -L libcurl.4.dylib 
libcurl.4.dylib:
    /usr/lib/libcurl.4.dylib (compatibility version 7.0.0, current version 8.0.0)
    /System/Library/Frameworks/Security.framework/Versions/A/Security (compatibility version 1.0.0, current version 57332.0.0)
    /System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation (compatibility version 150.0.0, current version 1231.0.0)
    /System/Library/Frameworks/LDAP.framework/Versions/A/LDAP (compatibility version 1.0.0, current version 2.4.0)
    /System/Library/Frameworks/Kerberos.framework/Versions/A/Kerberos (compatibility version 5.0.0, current version 6.0.0)
    /usr/lib/libz.1.dylib (compatibility version 1.0.0, current version 1.2.5)
    /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1225.0.0)
515 rmills@rmillsmbp:/usr/lib $ otool -L ../bin/curl
../bin/curl:
    /usr/lib/libcurl.4.dylib (compatibility version 7.0.0, current version 8.0.0)
    /usr/lib/libz.1.dylib (compatibility version 1.0.0, current version 1.2.5)
    /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1225.0.0)
516 rmills@rmillsmbp:/usr/lib $ </pre>When I build exiv2 with the autotools (./configure), we replicate this pattern of files/links and install_name. <pre>522 rmills@rmillsmbp:/usr/local/lib $ ls -alt *exiv2* 
-rw-r--r--  1 root  admin  2470136 31 Mar 09:43 libexiv2.14.dylib
-rw-r--r--  1 root  admin  5086480 31 Mar 09:43 libexiv2.a
lrwxr-xr-x  1 root  admin       17 31 Mar 09:43 libexiv2.dylib -&gt; libexiv2.14.dylib
-rw-r--r--  1 root  admin     1088 31 Mar 09:43 libexiv2.la
523 rmills@rmillsmbp:/usr/local/lib $ otool -L libexiv2.14.dylib 
libexiv2.14.dylib:
    /usr/local/lib/libexiv2.14.dylib (compatibility version 15.0.0, current version 15.0.0)
    /usr/local/lib/libintl.8.dylib (compatibility version 10.0.0, current version 10.2.0)
    /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1226.10.1)
    /usr/lib/libiconv.2.dylib (compatibility version 7.0.0, current version 7.0.0)
    /usr/local/lib/libz.1.dylib (compatibility version 1.0.0, current version 1.2.8)
    /usr/local/lib/libexpat.1.dylib (compatibility version 8.0.0, current version 8.0.0)
    /System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation (compatibility version 150.0.0, current version 1258.1.0)
    /usr/lib/libc++.1.dylib (compatibility version 1.0.0, current version 120.1.0)
524 rmills@rmillsmbp:/usr/local/lib $ otool -L ../bin/exiv2
../bin/exiv2:
    /usr/local/lib/libexiv2.14.dylib (compatibility version 15.0.0, current version 15.0.0)
    /usr/local/lib/libintl.8.dylib (compatibility version 10.0.0, current version 10.2.0)
    /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1226.10.1)
    /usr/lib/libiconv.2.dylib (compatibility version 7.0.0, current version 7.0.0)
    /usr/local/lib/libz.1.dylib (compatibility version 1.0.0, current version 1.2.8)
    /usr/local/lib/libexpat.1.dylib (compatibility version 8.0.0, current version 8.0.0)
    /usr/lib/libc++.1.dylib (compatibility version 1.0.0, current version 120.1.0)
525 rmills@rmillsmbp:/usr/local/lib $ </pre>When I build and install exiv2 with CMake, I see:<pre>591 rmills@rmillsmbp:/usr/local/lib $ ls -alt *exiv2*
lrwxr-xr-x  1 root  admin       21 31 Mar 05:00 libexiv2.14.dylib -&gt; libexiv2.14.0.0.dylib
lrwxr-xr-x  1 root  admin       17 31 Mar 05:00 libexiv2.dylib -&gt; libexiv2.14.dylib
-rwxr-xr-x  1 root  admin  4779248 31 Mar 04:52 libexiv2.14.0.0.dylib
592 rmills@rmillsmbp:/usr/local/lib $ otool -L libexiv2.14.0.0.dylib 
libexiv2.14.0.0.dylib:
    @rpath/libexiv2.14.dylib (compatibility version 14.0.0, current version 14.0.0)
    /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1226.10.1)
    /opt/local/lib/libexpat.1.dylib (compatibility version 8.0.0, current version 8.0.0)
    /opt/local/lib/libz.1.dylib (compatibility version 1.0.0, current version 1.2.8)
    /opt/local/lib/libiconv.2.dylib (compatibility version 8.0.0, current version 8.1.0)
    /usr/lib/libc++.1.dylib (compatibility version 1.0.0, current version 120.1.0)
593 rmills@rmillsmbp:/usr/local/lib $ otool -L ../bin/exiv2
../bin/exiv2:
    @rpath/libexiv2.14.dylib (compatibility version 14.0.0, current version 14.0.0)
    /usr/lib/libc++.1.dylib (compatibility version 1.0.0, current version 120.1.0)
    /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1226.10.1)
594 rmills@rmillsmbp:/usr/local/lib $ </pre>He looks a bit confused to me.  The install_name in /usr/local/bin/exiv2 has been correctly copied from the library: <em><strong><code>@rpath/libexiv2.14.dylib</code></strong></em>  The issue is that the install_name in the library itself is wrong.  libexiv2.14.dylib is a link and not the library itself.</p>


	<p>So can we agree that this issue only applies to the CMake build?  There are two possible fixes:</p>


	<ol>
	<li>He should have created the library in the file /usr/local/lib/libexiv2.14.dylib and created a symbolic link to that file from /usr/local/lib/libexiv2.14.0.0.dylib.  This would replicate the Apple/curl pattern.</li>
		<li>He can create the library in the file /usr/local/lib/libexiv2.14.0.0.dylib, however the install_name in that library should be <em><strong><code>@rpath/libexiv2.14.0.0.dylib</code></strong></em></li>
	</ol>


	<p>Curiously, I notice that CMake has installed the library with the wrong time stamp.  It's off by 7 hours!  He's determined to be in Cupertino or something which is 8 hours from my machine in England and convoluted by day-light saving or something.</p>


	<p>I feel this might be a bug in CMake.  I recall that a user requested a change to our CMake/rpath support.  When I make a change to our CMake files to give you happiness, this will cause somebody else to complain.  So that brings me back to the questions:  <em><strong>Why are you concerned about this?  Is there a real problem to be solved?</strong></em></p></div>
    </div>
  </div>
  
  <div id="change-4915" class="journal has-notes">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4652">Ilya Kulakov</a> <a title="01 Apr 2016 17:31" href="/projects/exiv2/activity?from=2016-04-01">over 5 years</a> ago
      <span id="journal-4915-private_notes" class=""></span>
    </h4>

    <div id="journal-4915-notes" class="wiki"><p>Robin,</p>


	<p>You're perfectly correct that the issue only exists in CMake build.</p>


	<p>1. I think the name of the library should be libexiv2.14.0.0.dylib because it's a full name and libexiv2.14.dylib should be a symlink which may optionally point to something like libexiv2.14.0.1.dylib or libexiv2.14.1.0.dylib. The reasoning is that symlink with compatiblity name (SONAME) should point to the actual version, but libraries themselves should exist under their real names. Otherwise you simply cannot have multiple compatible versions of the same library installed simultaneously<br />2. The install name of the library should indeed be real name of library's file</p>


	<p>I'm concerned about this, because install_name must match real name of the library, otherwise when you link against this library, wrong library identifier will be embedded in the binary.</p></div>
    </div>
  </div>
  
  <div id="change-4916" class="journal has-notes">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4652">Ilya Kulakov</a> <a title="01 Apr 2016 17:35" href="/projects/exiv2/activity?from=2016-04-01">over 5 years</a> ago
      <span id="journal-4916-private_notes" class=""></span>
    </h4>

    <div id="journal-4916-notes" class="wiki"><p>Actually, I take my words back: it's not required: many libraries in /usr/lib does not do that.</p>


	<p>Moreover, the behavior is rather inconsistent. Looks like it can be any way, and it's up to a developer to choose how to do that.</p></div>
    </div>
  </div>
  
  <div id="change-4917" class="journal has-notes has-details">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="01 Apr 2016 18:22" href="/projects/exiv2/activity?from=2016-04-01">over 5 years</a> ago
      <span id="journal-4917-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Closed</i></li>
       <li><strong>% Done</strong> changed from <i>30</i> to <i>100</i></li>
       <li><strong>Estimated time</strong> changed from <i>2.00 h</i> to <i>1.00 h</i></li>
    </ul>
    <div id="journal-4917-notes" class="wiki"><p>Thanks for getting me back to me about this.  I could easily add something to CMake to execute <strong><code>install_name_tool</code></strong> to fix this (to conform with option 1 above).  I'm in the last few weeks before code complete for v0.26.  At this stage in the release cycle I prefer to only submit essential changes.  So, I'm going to close this.</p>


	<p>I wonder if this is a bug in CMake.  If you have time, maybe you could investigate with a simple "hello world" application and "hello world" library.</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/1173.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/1173.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
