<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #1147: writeMetadata overwrites files without the +w bit - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="FZ+jfPspdi6WN0d/DS0GdGVq9Gvtgn/VEpSJYQPeRg730giTiVO6LsNTWHOy+gpHWvigEhxh3m/vtBnpQOehYQ==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #1147: writeMetadata overwrites files without the +w bit" href="https://dev.exiv2.org/issues/1147.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #1147</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>writeMetadata overwrites files without the +w bit</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/4596">Dan Fandrich</a> <a title="01 Jan 2016 20:57" href="/projects/exiv2/activity?from=2016-01-01">almost 6 years</a> ago.
        Updated <a title="10 Jan 2016 09:45" href="/projects/exiv2/activity?from=2016-01-10">almost 6 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/119">Robin Mills</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">basicio</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="28 Apr 2017" href="/versions/52">0.26</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">01 Jan 2016</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value">5.00 h</div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Exiv2::JpegBase::writeMetadata will overwrite a read-only file instead of returning an error message. If ro.jpg is a read only JPEG file (e.g. mode 444) with EXIF tags, the attached program will show the error message:</p>


	<p>ro.jpg: Failed to open file (w+b): Permission denied (errno = 13)</p>


	<p>in ver. 0.24 (as expected) but will silently overwrite the file in ver. 0.25 (unexpected and dangerous).</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/877">ro.cpp</a>    <span class="size">(374 Bytes)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/877/ro.cpp">ro.cpp</a>  </td>
  <td></td>
  <td>
      <span class="author">Dan Fandrich, 01 Jan 2016 20:56</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/878">musl-ro-write.c</a>    <span class="size">(247 Bytes)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/878/musl-ro-write.c">musl-ro-write.c</a>  </td>
  <td></td>
  <td>
      <span class="author">Dan Fandrich, 02 Jan 2016 08:07</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>








</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 4159" href="/projects/exiv2/repository/exiv2/revisions/4159">Revision 4159</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4159/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="02 Jan 2016 10:58" href="/projects/exiv2/activity?from=2016-01-02">almost 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: writeMetadata overwrites files without the +w bit (Closed)" href="/issues/1147">#1147</a>  Report uid, euid and gid in exiv2 --verbose --version</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4160" href="/projects/exiv2/repository/exiv2/revisions/4160">Revision 4160</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4160/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="02 Jan 2016 12:15" href="/projects/exiv2/activity?from=2016-01-02">almost 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: writeMetadata overwrites files without the +w bit (Closed)" href="/issues/1147">#1147</a>.  Correction to <a class="changeset" title="#1147  Report uid, euid and gid in exiv2 --verbose --version" href="/projects/exiv2/repository/exiv2/revisions/4159">r4159</a> for linux build breaker (linux doesn't have include uuid/uuid.h)</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4161" href="/projects/exiv2/repository/exiv2/revisions/4161">Revision 4161</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4161/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="02 Jan 2016 12:41" href="/projects/exiv2/activity?from=2016-01-02">almost 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: writeMetadata overwrites files without the +w bit (Closed)" href="/issues/1147">#1147</a>.  Correction for Cygwin/MinGW build-breaker in <a class="changeset" title="#1147  Report uid, euid and gid in exiv2 --verbose --version" href="/projects/exiv2/repository/exiv2/revisions/4159">r4159</a>.  Don't compile the uid/euid/gid code on any windows build.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4162" href="/projects/exiv2/repository/exiv2/revisions/4162">Revision 4162</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4162/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="02 Jan 2016 12:54" href="/projects/exiv2/activity?from=2016-01-02">almost 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: writeMetadata overwrites files without the +w bit (Closed)" href="/issues/1147">#1147</a>.  Fixed a typo.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4163" href="/projects/exiv2/repository/exiv2/revisions/4163">Revision 4163</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4163/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Jan 2016 12:10" href="/projects/exiv2/activity?from=2016-01-03">almost 6 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: writeMetadata overwrites files without the +w bit (Closed)" href="/issues/1147">#1147</a> Fixed travis build-breaker.</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-4618" class="journal has-notes has-details">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="01 Jan 2016 21:18" href="/projects/exiv2/activity?from=2016-01-01">almost 6 years</a> ago
      <span id="journal-4618-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Assignee</strong> set to <i>Robin Mills</i></li>
       <li><strong>Target version</strong> set to <i>0.26</i></li>
    </ul>
    <div id="journal-4618-notes" class="wiki"><p>Interesting find.  I instantly wonder if Memory Mapping is the culprit.  Perhaps he knows nothing about the UNIX file system permission bits.  I'll investigate tomorrow.  If you want to help, you could:</p>


	<p>1 unset MM in exv_conf.h and rebuild.<br />2 identify the platforms involved.</p>


	<p>Happy New Year.</p></div>
    </div>
  </div>
  
  <div id="change-4619" class="journal has-notes">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4596">Dan Fandrich</a> <a title="01 Jan 2016 22:05" href="/projects/exiv2/activity?from=2016-01-01">almost 6 years</a> ago
      <span id="journal-4619-private_notes" class=""></span>
    </h4>

    <div id="journal-4619-notes" class="wiki"><p>Sorry, I forgot to mention it before: this was on Linux 4.1.13 x86_64 with MUSL 1.1. It occurs to me now that the working case with exiv2 0.24 was built against glibc 2.20, so the libc difference might actually be an issue rather than the exiv2 version. I'll try building 0.25 against glibc when I get a chance.</p></div>
    </div>
  </div>
  
  <div id="change-4620" class="journal has-notes">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4596">Dan Fandrich</a> <a title="01 Jan 2016 22:25" href="/projects/exiv2/activity?from=2016-01-01">almost 6 years</a> ago
      <span id="journal-4620-private_notes" class=""></span>
    </h4>

    <div id="journal-4620-notes" class="wiki"><p>I was able to quickly build the test program against exiv2 0.25 with glibc 2.20, and it works correctly (Permission denied). So, the problem looks related to MUSL or exiv2's use of it.</p></div>
    </div>
  </div>
  
  <div id="change-4621" class="journal has-notes has-details">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="01 Jan 2016 23:22" href="/projects/exiv2/activity?from=2016-01-01">almost 6 years</a> ago
      <span id="journal-4621-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Category</strong> set to <i>basicio</i></li>
       <li><strong>Status</strong> changed from <i>New</i> to <i>Assigned</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>30</i></li>
       <li><strong>Estimated time</strong> set to <i>3.00 h</i></li>
    </ul>
    <div id="journal-4621-notes" class="wiki"><p>I'd never heard of MUSL until now.  Ah, there's always something to discover and learn in Software.</p>


	<p>The trunk seems to be OK on both Mac (10.11.2) and Linux (Kubuntu 15.04)<pre>$ uname -a
Linux rmillsmbp-k1504 4.2.0-22-generic #27-Ubuntu SMP Thu Dec 17 22:57:08 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux
$ cp /media/psf/Home/temp/Stonehenge.jpg .
$ sudo chmod 0000 Stonehenge.jpg 
$ ls -alt Stonehenge.jpg 
---------- 1 rmills rmills 6757827 Jan  1 22:49 Stonehenge.jpg
$ exiv2 -pa --grep Comment/i Stonehenge.jpg 
Exiv2 exception in print action for file Stonehenge.jpg:
Stonehenge.jpg: Failed to open the data source: Permission denied (errno = 13)
$ chmod +r Stonehenge.jpg 
$ exiv2 -pa --grep Comment/i Stonehenge.jpg 
Exif.Photo.UserComment                       Undefined  44                                      
$ ls -alt Stonehenge.jpg 
-r--r--r-- 1 rmills rmills 6757827 Jan  1 22:49 Stonehenge.jpg
$ exiv2 -M"set Exif.Photo.UserComment Happy New Year" Stonehenge.jpg 
Exiv2 exception in modify action for file Stonehenge.jpg:
Stonehenge.jpg: Failed to open file (a+b): Permission denied (errno = 13)
$ chmod 0644 Stonehenge.jpg 
$ exiv2 -M"set Exif.Photo.UserComment Happy New Year" Stonehenge.jpg 
$ exiv2 -pa --grep Comment/i Stonehenge.jpg 
Exif.Photo.UserComment                       Undefined  22  Happy New Year
$ 
$ 
$ 
$ cp /Home/Downloads/ro.cpp .
$ g++ ro.cpp -lexiv2 -o ro
$ ls -alt Stonehenge.jpg 
-rw-r--r-- 1 rmills rmills 6757827 Jan  1 22:51 Stonehenge.jpg
$ chmod 0400 Stonehenge.jpg 
$ ls -alt Stonehenge.jpg 
-r-------- 1 rmills rmills 6757827 Jan  1 22:51 Stonehenge.jpg
$ cp Stonehenge.jpg ro.jpg
$ ls -alt ro.jpg
-r-------- 1 rmills rmills 6757827 Jan  1 23:05 ro.jpg
$ ./ro
ro.jpg: Failed to open file (a+b): Permission denied (errno = 13)
$ </pre>Can you help me pin down the exact configuration required to reproduce this.  Please add the following couple of lines to your code.  This will dump a load of information both about the build and the libraries which have been loaded at run-time:<pre>    exv_grep_keys_t keys;
    Exiv2::dumpLibraryInfo(std::cout,keys);</pre>Incidentally, these two lines of code can be executed by the command: <pre> $ exiv2 --verbose --version </pre>However please add the code to ro.cpp because it will list the run-time libraries in use by ro(.exe) which may be different from those loaded by exiv2(.exe).  If exiv2(.exe) is OK, and ro(.exe) is not safe, it has to be something at runtime and you can see the libraries actually in use.</p>


	<p>If you don't find an answer, send me output from your modified ro.cpp and I'll have a look at it in the morning. Very optimistic that we'll resolve this tomorrow.</p></div>
    </div>
  </div>
  
  <div id="change-4622" class="journal has-notes">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4596">Dan Fandrich</a> <a title="02 Jan 2016 07:15" href="/projects/exiv2/activity?from=2016-01-02">almost 6 years</a> ago
      <span id="journal-4622-private_notes" class=""></span>
    </h4>

    <div id="journal-4622-notes" class="wiki"><p>This is the output:</p>


	<p>exiv2=0.25.0<br />platform=linux<br />compiler=G++<br />bits=64<br />dll=1<br />debug=0<br />version=5.2.0<br />date=Nov 10 2015<br />time=15:38:37<br />svn=0<br />ssh=0<br />curl=0<br />id=$Id: version.cpp 3800 2015-05-08 22:26:36Z robinwmills $<br />executable=/root/ro<br />library=/usr/lib/libstdc++.so.6<br />library=/usr/lib/libgcc_s.so.1<br />library=/lib/ld-musl-x86_64.so.1<br />library=<br />library=/lib/libz.so.1<br />library=/usr/lib/libexpat.so.1<br />have_regex=1<br />have_strerror_r=1<br />have_gmtime_r=1<br />have_inttypes=1<br />have_libintl=0<br />have_lensdata=1<br />have_iconv=1<br />have_memory=1<br />have_memset=1<br />have_lstat=1<br />have_stdbool=1<br />have_stdint=1<br />have_stdlib=1<br />have_strlib=0<br />have_strchr=1<br />have_strerror=1<br />have_strerror_r=1<br />have_strings_h=0<br />have_strtol=1<br />have_mmap=1<br />have_munmap=1<br />have_sys_stat=1<br />have_timegm=1<br />have_unistd_h=0<br />have_sys_mman=1<br />have_libz=0<br />have_xmptoolkit=1<br />have_bool=1<br />have_strings=1<br />have_sys_types=1<br />have_unistd=1<br />have_unicode_path=0<br />enable_video=0<br />enable_webready=0</p>


	<p>Running 'exiv2 -M"set Exif.Photo.UserComment Happy New Year" ro.jpg' results in no error and the ro.jpg file gaining a new EXIF tag.</p></div>
    </div>
  </div>
  
  <div id="change-4623" class="journal has-notes">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4596">Dan Fandrich</a> <a title="02 Jan 2016 07:30" href="/projects/exiv2/activity?from=2016-01-02">almost 6 years</a> ago
      <span id="journal-4623-private_notes" class=""></span>
    </h4>

    <div id="journal-4623-notes" class="wiki"><p>I built exiv2 0.25 from source and commented the mmap/munmap lines from exv_conf.h, but it still failed. Since the problem shows up with the exiv2 command-line I'm using that to test now:</p>


	<p>exiv2=0.25.0<br />platform=linux<br />compiler=G++<br />bits=64<br />dll=1<br />debug=0<br />version=5.3.0<br />date=Jan  2 2016<br />time=07:22:43<br />svn=0<br />ssh=0<br />curl=0<br />id=$Id: version.cpp 3800 2015-05-08 22:26:36Z robinwmills $<br />executable=/root/exiv2-0.25/install/usr/local/bin/exiv2<br />library=/usr/lib/libstdc++.so.6<br />library=/usr/lib/libgcc_s.so.1<br />library=/lib/ld-musl-x86_64.so.1<br />library=<br />library=/lib/libz.so.1<br />library=/usr/lib/libexpat.so.1<br />have_regex=1<br />have_strerror_r=1<br />have_gmtime_r=1<br />have_inttypes=1<br />have_libintl=0<br />have_lensdata=1<br />have_iconv=1<br />have_memory=1<br />have_memset=1<br />have_lstat=1<br />have_stdbool=1<br />have_stdint=1<br />have_stdlib=1<br />have_strlib=0<br />have_strchr=1<br />have_strerror=1<br />have_strerror_r=1<br />have_strings_h=0<br />have_strtol=1<br />have_mmap=0<br />have_munmap=0<br />have_sys_stat=1<br />have_timegm=1<br />have_unistd_h=0<br />have_sys_mman=1<br />have_libz=0<br />have_xmptoolkit=1<br />have_bool=1<br />have_strings=1<br />have_sys_types=1<br />have_unistd=1<br />have_unicode_path=0<br />enable_video=0<br />enable_webready=0</p></div>
    </div>
  </div>
  
  <div id="change-4624" class="journal has-notes has-details">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4596">Dan Fandrich</a> <a title="02 Jan 2016 08:07" href="/projects/exiv2/activity?from=2016-01-02">almost 6 years</a> ago
      <span id="journal-4624-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/878">musl-ro-write.c</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/878/musl-ro-write.c">musl-ro-write.c</a> added</li>
    </ul>
    <div id="journal-4624-notes" class="wiki"><p>I did some more tests and discovered the attached program fails with MUSL as well, so it looks like a pure MUSL issue.</p></div>
    </div>
  </div>
  
  <div id="change-4625" class="journal has-notes">
    <div id="note-8">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-8" class="journal-link">#8</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4596">Dan Fandrich</a> <a title="02 Jan 2016 08:29" href="/projects/exiv2/activity?from=2016-01-02">almost 6 years</a> ago
      <span id="journal-4625-private_notes" class=""></span>
    </h4>

    <div id="journal-4625-notes" class="wiki"><p>Now I'm embarrassed. My MUSL tests were all run in a container and as the root user, and I've just now discovered that root can write to files even though they don't have the write bit set. This was news to me. Sorry about the noise.</p></div>
    </div>
  </div>
  
  <div id="change-4626" class="journal has-notes has-details">
    <div id="note-9">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-9" class="journal-link">#9</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="02 Jan 2016 09:34" href="/projects/exiv2/activity?from=2016-01-02">almost 6 years</a> ago
      <span id="journal-4626-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Closed</i></li>
       <li><strong>% Done</strong> changed from <i>30</i> to <i>100</i></li>
    </ul>
    <div id="journal-4626-notes" class="wiki"><p>Well done, Dan.  I wake up and read this and you've solved it.  Good Job.  Thanks for working hard and getting to the bottom of this.</p></div>
    </div>
  </div>
  
  <div id="change-4627" class="journal has-notes">
    <div id="note-10">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-10" class="journal-link">#10</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="02 Jan 2016 11:02" href="/projects/exiv2/activity?from=2016-01-02">almost 6 years</a> ago
      <span id="journal-4627-private_notes" class=""></span>
    </h4>

    <div id="journal-4627-notes" class="wiki"><p><a class="changeset" title="#1147  Report uid, euid and gid in exiv2 --verbose --version" href="/projects/exiv2/repository/exiv2/revisions/4159">r4159</a>  Added code to src/version.cpp to report uid/euid/gid:<pre>781 rmills@rmillsmbp:~/gnu/exiv2/trunk $ echo "I am " $(whoami) ; id ; exiv2 -vVg id
I am  rmills
uid=501(rmills) gid=20(staff) groups=20(staff),402(com.apple.sharepoint.group.1),701...
...
uid=501
euid=501
gid=20
...
$ sudo bash -c 'echo "I am " $(whoami) ; id ; exiv2 -vVg id'
I am  root
uid=0(root) gid=0(wheel) groups=0(wheel),403(com.apple.sharepoint.group.2),402(com.apple.sharepoint.group.1),...
...
uid=0
euid=0
gid=0
$ </pre></p></div>
    </div>
  </div>
  
  <div id="change-4654" class="journal has-notes">
    <div id="note-11">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-11" class="journal-link">#11</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/360">Thomas Beutlich</a> <a title="08 Jan 2016 18:50" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago
      <span id="journal-4654-private_notes" class=""></span>
    </h4>

    <div id="journal-4654-notes" class="wiki"><p>Robin,</p>


	<p>Happy New Year to you, your wife and all the best for your spare-time projects.</p>


	<p>In <a class="changeset" title="#1147.  Fixed a typo." href="/projects/exiv2/repository/exiv2/revisions/4162">r4162</a> you changed the <code>_WIN32</code> macro to <code>WIN32</code>, however <code>_WIN32</code> is correct for the Windows OS. I use it this way for all my C/C++ projects. See <a class="external" href="https://sourceforge.net/p/predef/wiki/OperatingSystems/">https://sourceforge.net/p/predef/wiki/OperatingSystems/</a> -> Windows</p>


	<p>Thomas</p></div>
    </div>
  </div>
  
  <div id="change-4655" class="journal has-notes">
    <div id="note-12">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-12" class="journal-link">#12</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Jan 2016 19:58" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago
      <span id="journal-4655-private_notes" class=""></span>
    </h4>

    <div id="journal-4655-notes" class="wiki"><p>Yes.  Happy New Year to you.</p>


	<p>This is a good observation.  I used _WIN32 when I added the code on the Mac.  It broke the MSVC build and I changed it to WIN32 and that was fine.  I'm not sure that I define either WIN32 or _WIN32, I think it might appear in the code from the platform.  So, I haven't changed _WIN32, I replaced the use of the undefined _WIN32 with WIN32 because it worked!</p>


	<p>Are you suggesting that I review and modify every reference to WIN32 with _WIN32 and make sure it is defined?</p></div>
    </div>
  </div>
  
  <div id="change-4658" class="journal has-notes has-details">
    <div id="note-13">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-13" class="journal-link">#13</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Jan 2016 20:50" href="/projects/exiv2/activity?from=2016-01-08">almost 6 years</a> ago
      <span id="journal-4658-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Closed</i> to <i>Resolved</i></li>
       <li><strong>% Done</strong> changed from <i>100</i> to <i>90</i></li>
       <li><strong>Estimated time</strong> changed from <i>3.00 h</i> to <i>5.00 h</i></li>
    </ul>
    <div id="journal-4658-notes" class="wiki"><p>I'm reopening this to continue the discussion with Thomas.</p></div>
    </div>
  </div>
  
  <div id="change-4670" class="journal has-notes has-details">
    <div id="note-14">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-14" class="journal-link">#14</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="10 Jan 2016 09:45" href="/projects/exiv2/activity?from=2016-01-10">almost 6 years</a> ago
      <span id="journal-4670-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
       <li><strong>% Done</strong> changed from <i>90</i> to <i>100</i></li>
    </ul>
    <div id="journal-4670-notes" class="wiki"><p>As Thomas hasn't bothered to answer my question and there is no bug here, this matter is being closed again.</p>


	<p>Thomas:  If you want something done about this, please deal with it as I am busy and have about 500 hours of work planned for v0.26.  <a class="external" href="http://dev.exiv2.org/projects/exiv2/news">http://dev.exiv2.org/projects/exiv2/news</a></p>


	<p>I suspect that changing this will consume several hours.  Of course this isn't difficult - however there will be unexpected consequences which take time to investigate and resolve.</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/1147.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/1147.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
