<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Feature #1199: WebP file support - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="r4jT3PyR/SdqhHtmOfdFH/fiYZ5+hxEx5Jtr7IE6S9FNxXgzjusxJz/gZGqGIEksyHA1549ksIsZu/tkwgOsvg==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Feature #1199: WebP file support" href="https://dev.exiv2.org/issues/1199.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Feature #1199</h2>

<div class="issue tracker-2 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>WebP file support</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="31 Jul 2016 20:36" href="/projects/exiv2/activity?from=2016-07-31">over 5 years</a> ago.
        Updated <a title="25 Aug 2016 16:53" href="/projects/exiv2/activity?from=2016-08-25">about 5 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/4722">Ben Touchette</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">image format</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="28 Apr 2017" href="/versions/52">0.26</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">31 Jul 2016</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value">50.00 h</div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Created a patch to add support for the WebP file format. Created and tested with svn/0.25 using GIMP WebP plugin. <a class="external" href="https://github.com/draekko/gimp-webp">https://github.com/draekko/gimp-webp</a> (requires gimp 2.9.4+)</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1022">exiv2.patch</a>    <span class="size">(20.4 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1022/exiv2.patch">exiv2.patch</a>  </td>
  <td></td>
  <td>
      <span class="author">Ben Touchette, 31 Jul 2016 20:36</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1023">Moongirl.jpg</a>    <span class="size">(69.8 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1023/Moongirl.jpg">Moongirl.jpg</a>  </td>
  <td></td>
  <td>
      <span class="author">Robin Mills, 01 Aug 2016 12:37</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1024">Stonehenge.webp</a>    <span class="size">(1.85 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1024/Stonehenge.webp">Stonehenge.webp</a>  </td>
  <td></td>
  <td>
      <span class="author">Robin Mills, 08 Aug 2016 15:00</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1025">Stonehenge.jpg</a>    <span class="size">(6.45 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1025/Stonehenge.jpg">Stonehenge.jpg</a>  </td>
  <td></td>
  <td>
      <span class="author">Robin Mills, 08 Aug 2016 15:00</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1026">Stonehenge.webp</a>    <span class="size">(3.64 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1026/Stonehenge.webp">Stonehenge.webp</a>  </td>
  <td>Stonehenge test file.</td>
  <td>
      <span class="author">Ben Touchette, 09 Aug 2016 00:45</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1027">Desk2016-08-09.jpg</a>    <span class="size">(57.7 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1027/Desk2016-08-09.jpg">Desk2016-08-09.jpg</a>  </td>
  <td></td>
  <td>
      <span class="author">Robin Mills, 09 Aug 2016 10:04</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1028">Stonehenge2.webp</a>    <span class="size">(1.86 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1028/Stonehenge2.webp">Stonehenge2.webp</a>  </td>
  <td></td>
  <td>
      <span class="author">Robin Mills, 09 Aug 2016 10:09</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1030">exiv2-160810-3.diff</a>    <span class="size">(19.2 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1030/exiv2-160810-3.diff">exiv2-160810-3.diff</a>  </td>
  <td></td>
  <td>
      <span class="author">Ben Touchette, 10 Aug 2016 16:17</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1031">exiv2-height-160810.diff</a>    <span class="size">(10.7 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1031/exiv2-height-160810.diff">exiv2-height-160810.diff</a>  </td>
  <td></td>
  <td>
      <span class="author">Ben Touchette, 10 Aug 2016 22:29</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1032">Stonehenge3.webp</a>    <span class="size">(1.88 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1032/Stonehenge3.webp">Stonehenge3.webp</a>  </td>
  <td></td>
  <td>
      <span class="author">Robin Mills, 11 Aug 2016 10:11</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1033">Stonehenge-with-icc.webp</a>    <span class="size">(183 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1033/Stonehenge-with-icc.webp">Stonehenge-with-icc.webp</a>  </td>
  <td>Stonehenge test file with converted colorspace and ICC profile added.</td>
  <td>
      <span class="author">Ben Touchette, 13 Aug 2016 14:57</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1037">Stonehenge-with-icc-exif-xmp.webp</a>    <span class="size">(177 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1037/Stonehenge-with-icc-exif-xmp.webp">Stonehenge-with-icc-exif-xmp.webp</a>  </td>
  <td></td>
  <td>
      <span class="author">Ben Touchette, 18 Aug 2016 10:51</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>







<hr />
<div id="relations">
<div class="contextual">
</div>

<p><strong>Related issues</strong></p>

<form data-cm-url="/issues/context_menu" action="/issues/1199" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="uLcm01oNiUIbKFgiyWn+tA16/Ah05nxDzvNp7Qw41y5a+o08KHdFQk5MRy52vvKHMuiocYUF3fkz0/llTwEwQQ==" />
  <table class="list issues odd-even"><tr id="relation-238" class="issue hascontextmenu issue tracker-2 status-5 priority-4 priority-default closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="1211" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-2 status-5 priority-4 priority-default closed" href="/issues/1211">Feature #1211</a>: Support Development of WebP</td><td class="status">Closed</td><td class="start_date">21 Aug 2016</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr></table>
</form>
<form class="new_relation" id="new-relation-form" style="display: none;" action="/issues/1199/relations" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />


<p><select onchange="setPredecessorFieldsVisibility();" name="relation[relation_type]" id="relation_relation_type"><option selected="selected" value="relates">Related to</option>
<option value="duplicates">Is duplicate of</option>
<option value="duplicated">Has duplicate</option>
<option value="blocks">Blocks</option>
<option value="blocked">Blocked by</option>
<option value="precedes">Precedes</option>
<option value="follows">Follows</option>
<option value="copied_to">Copied to</option>
<option value="copied_from">Copied from</option></select>
Issue #<input size="10" type="text" name="relation[issue_to_id]" id="relation_issue_to_id" />
<span id="predecessor_fields" style="display:none;">
Delay: <input size="3" type="text" name="relation[delay]" id="relation_delay" /> days
</span>
<input type="submit" name="commit" value="Add" data-disable-with="Add" />
<a href="#" onclick="$(&quot;#new-relation-form&quot;).hide();; return false;">Cancel</a>
</p>

<script>
//<![CDATA[
observeAutocompleteField('relation_issue_to_id', '/issues/auto_complete?issue_id=1199&project_id=exiv2&scope=all')
//]]>
</script>

<script>
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>
</div>

</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 4355" href="/projects/exiv2/repository/exiv2/revisions/4355">Revision 4355</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4355/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Aug 2016 14:33" href="/projects/exiv2/activity?from=2016-08-08">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> WebP Support (work in progress).  Thank You to Ben for the patch.  Thanks to Gilles for encouragement.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4360" href="/projects/exiv2/repository/exiv2/revisions/4360">Revision 4360</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4360/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="10 Aug 2016 17:39" href="/projects/exiv2/activity?from=2016-08-10">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a>  Thank you to Ben for the patch.  This corrects various matters and adds a first stab at WebPImage::printStructure()</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4361" href="/projects/exiv2/repository/exiv2/revisions/4361">Revision 4361</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4361/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="10 Aug 2016 19:13" href="/projects/exiv2/activity?from=2016-08-10">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> WebPImage::printStructure() refactored to match implentation style of other image handlers.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4363" href="/projects/exiv2/repository/exiv2/revisions/4363">Revision 4363</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4363/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="11 Aug 2016 10:12" href="/projects/exiv2/activity?from=2016-08-11">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a>  Patch from Ben.  <a class="external" href="http://dev.exiv2.org/issues/1199#note-37">http://dev.exiv2.org/issues/1199#note-37</a></p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4366" href="/projects/exiv2/repository/exiv2/revisions/4366">Revision 4366</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4366/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="11 Aug 2016 19:07" href="/projects/exiv2/activity?from=2016-08-11">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> Fixed exiv2 -pR/-pC/-pX Stonehenge2.webp to report exif/ICC/XMP</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4367" href="/projects/exiv2/repository/exiv2/revisions/4367">Revision 4367</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4367/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="11 Aug 2016 19:47" href="/projects/exiv2/activity?from=2016-08-11">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> Fixed crash with iptc by disabling it, updated decodeChunk to do better header checks, added hexdump function.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4368" href="/projects/exiv2/repository/exiv2/revisions/4368">Revision 4368</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4368/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="12 Aug 2016 11:46" href="/projects/exiv2/activity?from=2016-08-12">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> (as was discussed) moved WebPImage::debugPrintHex to Internal::binaryToHex</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4369" href="/projects/exiv2/repository/exiv2/revisions/4369">Revision 4369</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4369/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="13 Aug 2016 02:23" href="/projects/exiv2/activity?from=2016-08-13">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> removed warnings in stringToHex, enabled iptc support for WebPImage.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4371" href="/projects/exiv2/repository/exiv2/revisions/4371">Revision 4371</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4371/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="13 Aug 2016 13:28" href="/projects/exiv2/activity?from=2016-08-13">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> Fixing build breaker introduced by <a class="changeset" title="#1199 removed warnings in stringToHex, enabled iptc support for WebPImage." href="/projects/exiv2/repository/exiv2/revisions/4369">r4369</a></p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4372" href="/projects/exiv2/repository/exiv2/revisions/4372">Revision 4372</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4372/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="13 Aug 2016 20:37" href="/projects/exiv2/activity?from=2016-08-13">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> update to binaryToHex, should remove compile warnings and fix extra space padding.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4373" href="/projects/exiv2/repository/exiv2/revisions/4373">Revision 4373</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4373/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="13 Aug 2016 21:26" href="/projects/exiv2/activity?from=2016-08-13">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> Fixing MSVC build breaker involving long/uint64_t conflict.  Minor changes to behaviour of Internal::binaryToHex()</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4376" href="/projects/exiv2/repository/exiv2/revisions/4376">Revision 4376</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4376/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Aug 2016 06:37" href="/projects/exiv2/activity?from=2016-08-14">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a>.  Fixing msvc/64 build breakers (more size/long/uintXX_t conflicts).</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4377" href="/projects/exiv2/repository/exiv2/revisions/4377">Revision 4377</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4377/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Aug 2016 07:25" href="/projects/exiv2/activity?from=2016-08-14">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a>  Adding webp tests (work in progress, more tests will be added).</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4378" href="/projects/exiv2/repository/exiv2/revisions/4378">Revision 4378</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4378/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="14 Aug 2016 11:42" href="/projects/exiv2/activity?from=2016-08-14">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> fixed handling deleting data, and adding iptc when injecting</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4384" href="/projects/exiv2/repository/exiv2/revisions/4384">Revision 4384</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4384/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/360">Thomas Beutlich</a> <a title="15 Aug 2016 20:00" href="/projects/exiv2/activity?from=2016-08-15">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p>refs <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a>: Fix iclude</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4397" href="/projects/exiv2/repository/exiv2/revisions/4397">Revision 4397</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4397/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="17 Aug 2016 12:44" href="/projects/exiv2/activity?from=2016-08-17">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> Updated exiv2.1 to add WEBP to format list.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4398" href="/projects/exiv2/repository/exiv2/revisions/4398">Revision 4398</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4398/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="17 Aug 2016 15:50" href="/projects/exiv2/activity?from=2016-08-17">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a>.  Correction to <a class="changeset" title="#1199  Adding webp tests (work in progress, more tests will be added)." href="/projects/exiv2/repository/exiv2/revisions/4377">r4377</a> (webp tests).  Also fixed test output changes introduced by Thomas' changes r4379-<a class="changeset" title="Update Canon FileInfo RawJpgSize to match ExifTool" href="/projects/exiv2/repository/exiv2/revisions/4396">r4396</a></p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4399" href="/projects/exiv2/repository/exiv2/revisions/4399">Revision 4399</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4399/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="17 Aug 2016 18:12" href="/projects/exiv2/activity?from=2016-08-17">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> update .pot file to add webpimage.cpp</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4400" href="/projects/exiv2/repository/exiv2/revisions/4400">Revision 4400</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4400/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="17 Aug 2016 19:58" href="/projects/exiv2/activity?from=2016-08-17">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> WebP support.  Changes to test suite.  See <a class="external" href="http://dev.exiv2.org/issues/1199#note-79">http://dev.exiv2.org/issues/1199#note-79</a> for discussion.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4402" href="/projects/exiv2/repository/exiv2/revisions/4402">Revision 4402</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4402/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="17 Aug 2016 20:19" href="/projects/exiv2/activity?from=2016-08-17">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> updated date in exiv2.1</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4403" href="/projects/exiv2/repository/exiv2/revisions/4403">Revision 4403</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4403/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="18 Aug 2016 10:10" href="/projects/exiv2/activity?from=2016-08-18">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> removed convenience converstion for iptc to xmp, apps should handle it directly since webp doesnt support iptc.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4404" href="/projects/exiv2/repository/exiv2/revisions/4404">Revision 4404</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4404/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="18 Aug 2016 10:47" href="/projects/exiv2/activity?from=2016-08-18">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> removed exif header padding on metadata writes.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4409" href="/projects/exiv2/repository/exiv2/revisions/4409">Revision 4409</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4409/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="18 Aug 2016 20:04" href="/projects/exiv2/activity?from=2016-08-18">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a>  Fixing exiv2 -dC image-path to delete ICC profile.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4411" href="/projects/exiv2/repository/exiv2/revisions/4411">Revision 4411</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4411/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="19 Aug 2016 00:54" href="/projects/exiv2/activity?from=2016-08-19">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> fixed -de -dc options, add -iC option to insert icc profiles</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4412" href="/projects/exiv2/repository/exiv2/revisions/4412">Revision 4412</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4412/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="19 Aug 2016 07:08" href="/projects/exiv2/activity?from=2016-08-19">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> Adding tests for -dC -de -dx</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4413" href="/projects/exiv2/repository/exiv2/revisions/4413">Revision 4413</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4413/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="19 Aug 2016 10:10" href="/projects/exiv2/activity?from=2016-08-19">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a>.  Adding tests for -iC.  Fixed bug in -pC.  Test code added for -ix and -ie, however I don't think the options are working correctly.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4414" href="/projects/exiv2/repository/exiv2/revisions/4414">Revision 4414</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4414/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="19 Aug 2016 10:16" href="/projects/exiv2/activity?from=2016-08-19">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a>.  Cosmetic corrections to <a class="changeset" title="#1199.  Adding tests for -iC.  Fixed bug in -pC.  Test code added for -ix and -ie, however I don&#39;..." href="/projects/exiv2/repository/exiv2/revisions/4413">r4413</a></p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4416" href="/projects/exiv2/repository/exiv2/revisions/4416">Revision 4416</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4416/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="19 Aug 2016 18:59" href="/projects/exiv2/activity?from=2016-08-19">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> Test suite changes and associate fixes to the code.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4417" href="/projects/exiv2/repository/exiv2/revisions/4417">Revision 4417</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4417/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="20 Aug 2016 00:33" href="/projects/exiv2/activity?from=2016-08-20">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> Fixed issue with -ix, wasnt padding odd sized chunks for exif/xmp.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4418" href="/projects/exiv2/repository/exiv2/revisions/4418">Revision 4418</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4418/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="20 Aug 2016 09:43" href="/projects/exiv2/activity?from=2016-08-20">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> Fix WebP printStructure(), readMetadata() and doWriteMetadata() to handle payload padding byte.  Extended webp-test to cover -iX, -ix and -ie</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4419" href="/projects/exiv2/repository/exiv2/revisions/4419">Revision 4419</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4419/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="20 Aug 2016 12:42" href="/projects/exiv2/activity?from=2016-08-20">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> minor code update, updated comments, added constants for headers, bit definitions, and misc.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4420" href="/projects/exiv2/repository/exiv2/revisions/4420">Revision 4420</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4420/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="20 Aug 2016 13:11" href="/projects/exiv2/activity?from=2016-08-20">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> fixed typo from cut/paste in previous commit causing exif flag not to be set for VP8X chunk.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4421" href="/projects/exiv2/repository/exiv2/revisions/4421">Revision 4421</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4421/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="20 Aug 2016 14:11" href="/projects/exiv2/activity?from=2016-08-20">over 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> Spit'n'polish on the loops in printStructure(), metadataRead() and doWriteMetadata().  Added tests with even byte count for ICCP and XMP Chunks.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4426" href="/projects/exiv2/repository/exiv2/revisions/4426">Revision 4426</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4426/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="22 Aug 2016 20:54" href="/projects/exiv2/activity?from=2016-08-22">about 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> Fixing webp-test.sh.  Use <del>iXX to inject XMP into file without XMP</del>>Exif/IPTC conversion</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4444" href="/projects/exiv2/repository/exiv2/revisions/4444">Revision 4444</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4444/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="27 Aug 2016 17:36" href="/projects/exiv2/activity?from=2016-08-27">about 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> Fixing build-breaker when -DDEBUG is used.</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4575" href="/projects/exiv2/repository/exiv2/revisions/4575">Revision 4575</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4575/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="27 Sep 2016 19:21" href="/projects/exiv2/activity?from=2016-09-27">about 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> and <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Bug Hunt for v0.26 (Closed)" href="/issues/1230">#1230</a> webpImage::printStructure().  Reporting Offset == 0 on Tiger (32bit).</p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 4576" href="/projects/exiv2/repository/exiv2/revisions/4576">Revision 4576</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/4576/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="27 Sep 2016 19:26" href="/projects/exiv2/activity?from=2016-09-27">about 5 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Bug Hunt for v0.26 (Closed)" href="/issues/1230">#1230</a> and <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: WebP file support (Closed)" href="/issues/1199">#1199</a> Correction to <a class="changeset" title="#1199 and #1230 webpImage::printStructure().  Reporting Offset == 0 on Tiger (32bit)." href="/projects/exiv2/repository/exiv2/revisions/4575">r4575</a></p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-5221" class="journal has-notes has-details">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="01 Aug 2016 12:37" href="/projects/exiv2/activity?from=2016-08-01">over 5 years</a> ago
      <span id="journal-5221-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/1023">Moongirl.jpg</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/1023/Moongirl.jpg">Moongirl.jpg</a> added</li>
       <li><strong>Tracker</strong> changed from <i>Bug</i> to <i>Feature</i></li>
       <li><strong>Category</strong> set to <i>image format</i></li>
       <li><strong>Status</strong> changed from <i>New</i> to <i>Assigned</i></li>
       <li><strong>Assignee</strong> set to <i>Robin Mills</i></li>
       <li><strong>Target version</strong> set to <i>0.28</i></li>
    </ul>
    <div id="journal-5221-notes" class="wiki"><p>Ben</p>


	<p>I'm on vacation on a motor boat in Finland.  I'll look at your patch next weekend when I get home.</p>


	<p>WebP is scheduled to be added in v0.27.  <a class="issue tracker-2 status-1 priority-4 priority-default" title="Feature: Add support for webm video format. (New)" href="/issues/1048">#1048</a>.  I downloaded the SDK from Google about 18 months ago.  I think it's fairly easy to use that to add webp support to Exiv2.</p>


	<p>I don't have time at the moment look at your patch.  If this introduces a complex build dependency on GIMP, it will not be accepted.</p>


	<p><img src="/attachments/download/1023/Moongirl.jpg" alt="" /></p></div>
    </div>
  </div>
  
  <div id="change-5222" class="journal has-notes">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="01 Aug 2016 13:23" href="/projects/exiv2/activity?from=2016-08-01">over 5 years</a> ago
      <span id="journal-5222-private_notes" class=""></span>
    </h4>

    <div id="journal-5222-notes" class="wiki"><p>I wasn't in a rush :)</p>


	<p>I didn't want to add a dependency on libwebp. It has no dependencies and is self contained. I only tested it with the plug-in to make sure it worked through gexiv2 as i was working on that for said plugin at the time and from the exiv2 on the commandline.</p>


	<p>Have a good one.</p></div>
    </div>
  </div>
  
  <div id="change-5223" class="journal has-notes">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="01 Aug 2016 13:36" href="/projects/exiv2/activity?from=2016-08-01">over 5 years</a> ago
      <span id="journal-5223-private_notes" class=""></span>
    </h4>

    <div id="journal-5223-notes" class="wiki"><p>Ah, this sounds good.  I'll have a look at this at the weekend.  Beautiful day in the Finnish Archipelago.</p></div>
    </div>
  </div>
  
  <div id="change-5224" class="journal has-details">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="01 Aug 2016 13:36" href="/projects/exiv2/activity?from=2016-08-01">over 5 years</a> ago
      <span id="journal-5224-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Target version</strong> changed from <i>0.28</i> to <i>0.26</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-5225" class="journal has-notes">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="01 Aug 2016 15:35" href="/projects/exiv2/activity?from=2016-08-01">over 5 years</a> ago
      <span id="journal-5225-private_notes" class=""></span>
    </h4>

    <div id="journal-5225-notes" class="wiki"><p>Lucky, i need a year off from life just to recuperate.</p>


	<p>As for the patch it does borrow a lot of code from the other file formats that were already in there so feel free to change anything that needs to be changed or that i got wrong. It's only important that it works and gets included eventually.</p>


	<p>:)</p></div>
    </div>
  </div>
  
  <div id="change-5228" class="journal has-notes">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="08 Aug 2016 10:39" href="/projects/exiv2/activity?from=2016-08-08">over 5 years</a> ago
      <span id="journal-5228-private_notes" class=""></span>
    </h4>

    <div id="journal-5228-notes" class="wiki"><p>Wondering if you had the opportunity to look at the patch?</p></div>
    </div>
  </div>
  
  <div id="change-5229" class="journal has-notes">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/76">Gilles Caulier</a> <a title="08 Aug 2016 11:04" href="/projects/exiv2/activity?from=2016-08-08">over 5 years</a> ago
      <span id="journal-5229-private_notes" class=""></span>
    </h4>

    <div id="journal-5229-notes" class="wiki"><p>The patch sound well written (not tested).</p>


	<p>I vote to integrate this patch for next release. code is not too much intrusive and easy to check. I would integrate quickly webp support in digiKam. This imply to have propers metadata R/W support...</p>


	<p>Gilles Caulier</p></div>
    </div>
  </div>
  
  <div id="change-5230" class="journal has-notes has-details">
    <div id="note-8">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-8" class="journal-link">#8</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Aug 2016 12:32" href="/projects/exiv2/activity?from=2016-08-08">over 5 years</a> ago
      <span id="journal-5230-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>0</i> to <i>10</i></li>
       <li><strong>Estimated time</strong> set to <i>15.00 h</i></li>
    </ul>
    <div id="journal-5230-notes" class="wiki"><p>I looked at the patch on Wednesday while I was in Finland.  I like that you're using BasicIo to perform the I/O.  In fact it's a prerequisite for any image handler to be consistent with our other image handlers.  When I looked at Google's libwebp code, I concluded that it may have to be rewritten to work with BasicIo.  BasicIo support is essential to exiv2 to provide support for http and other types of I/O.</p>


	<p>To integrate your patch into libexiv2, I will have to add test files and build support for CMake/Visual Studio/Autotools.  Exiv2 has two totally different file parsers <strong><em><code>image-&gt;readMetadata()</code></em></strong> (which have been there forever) and <strong><em><code>image-&gt;printStructure()</code></em></strong> which I wrote to debug image files.  It's not essential, however desirable, to include <strong><em><code>image-&gt;printStructure()</code></em></strong> in webpimage.cpp.</p>


	<p>I'm running late on v0.26 already.  I don't have a lot to do for v0.26 (about 50 hours), however I do a life with other matters which require my time.  So Gilles is entitled to his vote and I think it is desirable to include this in Exiv2 v0.26.  If Gilles would like to provide the build, test and printStructure() support, he can submit the patch.</p>


	<p>However, I know that Gilles has a family and other stuff to occupy his time in August.  If you or Gilles can't do this additional work, I don't want to promise to deal with this while I still have outstanding v0.26 work to finish.</p></div>
    </div>
  </div>
  
  <div id="change-5231" class="journal has-notes">
    <div id="note-9">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-9" class="journal-link">#9</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="08 Aug 2016 12:35" href="/projects/exiv2/activity?from=2016-08-08">over 5 years</a> ago
      <span id="journal-5231-private_notes" class=""></span>
    </h4>

    <div id="journal-5231-notes" class="wiki"><p>I'll see what i can do unless Gilles beats me to it :)</p></div>
    </div>
  </div>
  
  <div id="change-5232" class="journal has-notes">
    <div id="note-10">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-10" class="journal-link">#10</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/76">Gilles Caulier</a> <a title="08 Aug 2016 13:34" href="/projects/exiv2/activity?from=2016-08-08">over 5 years</a> ago
      <span id="journal-5232-private_notes" class=""></span>
    </h4>

    <div id="journal-5232-notes" class="wiki"><p>For the build structure, Only Cmake is on my mind.</p>


	<p>Do not ask me to support MSVC, it's a waste of time. For whole digiKam now (800.000 lines of code + all shared libs as Qt5 + KF5) we use MXE cross compiler which can provide shared/static 32/64 bits targets, including installer... If you look into MXE project, you will see that Exiv2 is already supported as well and work like a charm.</p>


	<p><a class="external" href="http://mxe.cc/">http://mxe.cc/</a></p>


	<p>Advantages : Only one OS to compile : Linux. No need Windows + MSVC. No risk of virus. No need extra MSVC runtime... etc. To debug, all GDB based IDE work fine. The target can be linked with a MSVC client application.</p>


	<p>But, it's another subject.</p>


	<p>For the test code, Ben, we need Webp test images + some code to check basic operations to read/write data structures in Exif and XMP. Of course this code must check results to complete tests. You will find test code samples for other image formats in test subdir, mostly written in bash. In test/data, we host image samples. I'm sure that one script already check this kind of basic operation for other formats, so take a look and add webp support.</p>


	<p>If this test stage pass with webp, well this will be a good point to include your patch in next Exiv2 release.</p>


	<p>Q : how did you complete some tests currently to validate your patch ?</p>


	<p>Gilles Caulier</p></div>
    </div>
  </div>
  
  <div id="change-5233" class="journal has-notes">
    <div id="note-11">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-11" class="journal-link">#11</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="08 Aug 2016 13:43" href="/projects/exiv2/activity?from=2016-08-08">over 5 years</a> ago
      <span id="journal-5233-private_notes" class=""></span>
    </h4>

    <div id="journal-5233-notes" class="wiki"><p>A bit more work than i thought, i'll see what i can do.</p>


	<p>@Gilles I downloaded several images (with and without animation) and manually added the icc profile, exif and xmp data since they were all missing those. Then i ran them through the code (standalone exiv2 program and through the gimp plug-in i was working on). I'd have to create my own test images since those aren't licensed for that kind of redistribution.</p>


	<p>@Robin whats the cut-off date (approximately) so i can figure out if i can possibly do it in time :)</p></div>
    </div>
  </div>
  
  <div id="change-5234" class="journal has-notes has-details">
    <div id="note-12">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-12" class="journal-link">#12</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Aug 2016 15:00" href="/projects/exiv2/activity?from=2016-08-08">over 5 years</a> ago
      <span id="journal-5234-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/1024">Stonehenge.webp</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/1024/Stonehenge.webp">Stonehenge.webp</a> added</li>
       <li><strong>File</strong> <a href="/attachments/1025">Stonehenge.jpg</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/1025/Stonehenge.jpg">Stonehenge.jpg</a> added</li>
    </ul>
    <div id="journal-5234-notes" class="wiki"><p>I've submitted your patch <a class="changeset" title="#1199 WebP Support (work in progress).  Thank You to Ben for the patch.  Thanks to Gilles for enc..." href="/projects/exiv2/repository/exiv2/revisions/4355">r4355</a>.  I agree with Gilles, this looks well written.</p>


	<p>I'm submitted the build change for CMake/Visual Studio/Autotools.  I've only tested autotools on MacOS-X.  I'll inspect the buildserver log files later.</p>


	<p>It's essential to support Visual Studio.  DigiKam lives in the CMake world, however "native" Visual Studio in important to other users of Exiv2.</p>


	<p>Currently Exiv2 supports Exif, IPTC and XMP metadata.  Support for ICC profiles has been added in v0.26 (although not yet complete).  I think suitable test images can be created with cwebp which ships with libwebp.  This isn't a comprehensive test for your code, however it's an essential starting point.  Here's the progess so far:<pre>1061 rmills@rmillsmbp:~/temp $ curl -O http://clanmills.com/Stonehenge.jpg ; ls -alt Stonehenge.jpg
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 6599k  100 6599k    0     0  1298k      0  0:00:05  0:00:05 --:--:-- 1459k
-rw-r--r--+ 1 rmills  staff  6757827  8 Aug 15:52 Stonehenge.jpg
1062 rmills@rmillsmbp:~/temp $ cwebp Stonehenge.jpg -o Stonehenge.webp
Saving file 'Stonehenge.webp'
File:      Stonehenge.jpg
Dimension: 6000 x 4000
Output:    1936490 bytes Y-U-V-All-PSNR 38.52 45.95 46.86   39.94 dB
block count:  intra4: 61816
              intra16: 31934  (-&gt; 34.06%)
              skipped block: 15202 (16.22%)
bytes used:  header:            370  (0.0%)
             mode-partition: 302819  (15.6%)
 Residuals bytes  |segment 1|segment 2|segment 3|segment 4|  total
    macroblocks:  |       5%|      21%|      22%|      50%|   93750
      quantizer:  |      36 |      34 |      29 |      19 |
   filter level:  |      11 |       8 |       6 |       8 |
1063 rmills@rmillsmbp:~/temp $ od -a Stonehenge.webp | head -2
0000000    R   I   F   F   b  8c  gs nul   W   E   B   P   V   P   8  sp
0000020    V  8c  gs nul   ?  nl  94  9d soh   *   p etb   ?  si   &gt;  91
1064 rmills@rmillsmbp:~/temp $ exiv2 --verbose --version -g svn -g date -g time
exiv2 0.25 001900 (64 bit build)
date=Aug  8 2016
time=15:42:57
svn=4354
have_gmtime_r=1
have_timegm=1
xmlns=mediapro:http://ns.iview-multimedia.com/mediapro/1.0/
1065 rmills@rmillsmbp:~/temp $ exiv2 -pa Stonehenge.webp 
1
2
1066 rmills@rmillsmbp:~/temp $ </pre>When we run <em><strong><code>$ exiv2 -pa Stonehenge.webp</code></strong></em>, it calls IsWebPType() and creates the WebPImage instance. WebPImage::readMetadata() and which calls WebPImage::decodeChunks() is called.  And there the story ends.  The metadata structures have not been created.  I'm sure there's not much wrong here, however I don't have time at the moment to debug this.</p>


	<p>The output <em><strong>1</strong></em> and <em><strong>2</strong></em> are coming from output prompts I have added to WebPImage::readMetadata() and WebPImage::decodeChunks().  I didn't intend to submit those lines - you should remove them of course.</p>


	<p>I don't know that we have a "cut off" date.  When v0.26 is feature complete, the code will be tested and tweaked for release by Andreas.  I'm rather busy at the moment and hoped to have Exiv2 v0.26 ready by the end of June.  Having missed the June date, I am caught up in other projects such as vacation and finishing the total remodel of our home.</p>


	<p>Here are the next steps as I see it:</p>


	<p>1) I'll support the build stuff. CMake/Visual Studio/Autotools will be working by 2016-08-09 12:00 UTC.  The buildserver will be building and passing this by 2016-08-10 12:00 UTC.<br />2) Can you sync/build the trunk and debug WebPImage::decodeChunks()</p>


	<p>Once we have the code working, we can discuss:</p>


	<p>3) Test Harness and test files<br />4) Functionality (Exif, IPTC, XMP and ICC support)<br />5) Stuff we haven't thought of yet!</p></div>
    </div>
  </div>
  
  <div id="change-5235" class="journal has-details">
    <div id="note-13">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-13" class="journal-link">#13</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Aug 2016 15:01" href="/projects/exiv2/activity?from=2016-08-08">over 5 years</a> ago
      <span id="journal-5235-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>10</i> to <i>20</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-5236" class="journal has-notes">
    <div id="note-14">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-14" class="journal-link">#14</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="08 Aug 2016 17:41" href="/projects/exiv2/activity?from=2016-08-08">over 5 years</a> ago
      <span id="journal-5236-private_notes" class=""></span>
    </h4>

    <div id="journal-5236-notes" class="wiki"><p>Lol, it's just that the 50 hours comment made it sound imminent hence my asking if there was a deadline. As for the test, weird it worked here (famous development last words), must have omitted something by mistake when submitting. As for the rest sure, sounds like a deal. I'll get to it later today hopefully or tomorrow to see what is missing. For the ICC profiles i saw but couldn't get it working due to errors when testing it with gimp so put it aside for now and went to using the libwebp to add/remove it (for now) in the plugin and left it out for the patch.</p></div>
    </div>
  </div>
  
  <div id="change-5237" class="journal has-notes">
    <div id="note-15">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-15" class="journal-link">#15</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="08 Aug 2016 17:44" href="/projects/exiv2/activity?from=2016-08-08">over 5 years</a> ago
      <span id="journal-5237-private_notes" class=""></span>
    </h4>

    <div id="journal-5237-notes" class="wiki"><p>Also i wasn't sure about the IPTC stuff as webp doesn't support it so i have it try and copy it xmp. Hopefully thats the right way to handle that and since gimp has several bugs 2.9 witht i wasn't sure it was going into the webp file properly i need to recheck that as well with the command line app.</p></div>
    </div>
  </div>
  
  <div id="change-5238" class="journal has-notes">
    <div id="note-16">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-16" class="journal-link">#16</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/76">Gilles Caulier</a> <a title="08 Aug 2016 17:52" href="/projects/exiv2/activity?from=2016-08-08">over 5 years</a> ago
      <span id="journal-5238-private_notes" class=""></span>
    </h4>

    <div id="journal-5238-notes" class="wiki"><p>ExifTools do not show IPTC suppport in WebP.</p>


	<p>But IPTC can be embeded in Exif. There is a standard tags for that. It's only recommend to do it with image format that support long chunk of byte array to host metadata. For ex, JPEG only support 64Kb for Exif, which is too small as IPTC can store 256Kb of preview image for ex.</p>


	<p>So, this depend of WebP feature. If metadata chunk is small, forget IPTC in Exif. else you can do it in right exif tag.</p>


	<p>But i recommend to do the same than ExifTools, to be homogeneous for the moment.</p>


	<p>Gilles Caulier</p></div>
    </div>
  </div>
  
  <div id="change-5239" class="journal has-notes">
    <div id="note-17">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-17" class="journal-link">#17</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Aug 2016 17:56" href="/projects/exiv2/activity?from=2016-08-08">over 5 years</a> ago
      <span id="journal-5239-private_notes" class=""></span>
    </h4>

    <div id="journal-5239-notes" class="wiki"><p>Ben</p>


	<p>Never underestimate what it takes to get code to work everywhere.  When people say "it's done", they usually mean "it worked once on my computer".  That's  not "done".  That is "just started".  Getting it to work once on one test file is probably about 25% of the job (possibly less).</p>


	<p>When folks (like Gilles) say "All Robin has to do is ....", notice the clever use of the words "Robin has to do it all.".  The 50 hours left for v0.26 are documented here:  <a class="external" href="http://dev.exiv2.org/news/2">http://dev.exiv2.org/news/2</a>  under "Remaining work for Robin".</p>


	<p>My wife is fixing dinner at the moment (I'm in England) and I've started to step through your code.  There's a test in decodeChunks:<pre>if (equalsWebPTag(chunkId, "VP8X")</pre>The file Stonehenge.webp has the chunkId == "VP8 ".  I'll have to read the WebP spec to figure out what this is about.</p>


	<p>Let's see if we can get this building/working/passing the tests on every platform, build system, 32/64 bit static/dynamic little-endian/big-endian without ether of us having to do too much work.  We can do it.  Let's do it!</p></div>
    </div>
  </div>
  
  <div id="change-5240" class="journal has-notes">
    <div id="note-18">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-18" class="journal-link">#18</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Aug 2016 18:48" href="/projects/exiv2/activity?from=2016-08-08">over 5 years</a> ago
      <span id="journal-5240-private_notes" class=""></span>
    </h4>

    <div id="journal-5240-notes" class="wiki"><p>I think I agree with Gilles position on IPTC.  I usually agree with Gilles.  If IPTC is encoded in a block in WebP, it would be good to respect it.  Let's not worry about IPTC yet.</p>


<blockquote>

	<p>Here's the plan:</p>


	<p><strong>1)</strong> I'll support the build stuff. CMake/Visual Studio/Autotools will be working by 2016-08-09 12:00 UTC. The buildserver will be building and passing this by 2016-08-10 12:00 UTC.<br /><strong>2)</strong> Can you sync/build the trunk and debug WebPImage::decodeChunks()</p>


	<p>Once we have the code working, we can discuss:<br /><strong>3)</strong> Test Harness and test files<br /><strong>4)</strong> Functionality (Exif, IPTC, XMP and ICC support)<br /><strong>5)</strong> Stuff we haven't thought of yet!</p>


</blockquote>

	<p>I'm working on <em><strong>Step 1</em></strong>.  Can you work on <em><strong>Step 2</em></strong>?  We'll discuss IPTC in <em><strong>Step 4</em></strong>.</p>


	<p>The biggest part of this project (like most projects) is probably <em><strong>Step 5</em></strong> - dealing with stuff we don't know anything about yet.  Of course, the battle cry of managers is <em><strong>"it shouldn't be like that"</strong></em>, or the even more stupid <em><strong>"why didn't you tell me about this sooner"</strong></em>.  For example, we'll have to update the man page exiv2.1 and we may have to modify some sample applications.  There may be hidden horrors in the webp specification.  libwebp/src has 43000 lines of code and exiv2/src/webpimage.cpp has 430.  It's possible that we are not 100x smarter than the Googlers who wrote libwebp.</p></div>
    </div>
  </div>
  
  <div id="change-5241" class="journal has-notes">
    <div id="note-19">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-19" class="journal-link">#19</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="09 Aug 2016 00:37" href="/projects/exiv2/activity?from=2016-08-09">over 5 years</a> ago
      <span id="journal-5241-private_notes" class=""></span>
    </h4>

    <div id="journal-5241-notes" class="wiki"><p>Robin i never said it was done lol, but i get what you mean. Software is never done, smh, i know i used to do this professionally in a previous life.</p>


	<p>There are several VP8 (that being lossy and VP8L being lossless) type chunks, VP8X is the usually the first one (right after the header "RIFFxxxxWEBP" 12bytes long) describing image size and supported features. The wepb always sticks the 'ICCP' chunk right after that followed by the frame/layer/image data and ends with the rest of the metadata chunks. Odds are the stonehenge converted to webp doesn't contain copy of the metadata. I'll double check this but none of the images i found had any in them. Do a hex search for 'EXIF', 'XMP ', or 'ICCP' for the chunk headers in the file. If they're in there then its a bug if not the cwebp only copies the image data. I'll be trying it here in a bit as well. Btw 'VP8 ' should should be the data for a single image and 'ANIM' as well as 'ANMF' are the animation and frame data chunks. Webp has no IPTC chunk which was why i was asking. Time to do a quick check of all this here before heading of the Zzz land.</p>


	<p>Here's the direct link to the container specs <a class="external" href="https://developers.google.com/speed/webp/docs/riff_container">https://developers.google.com/speed/webp/docs/riff_container</a></p></div>
    </div>
  </div>
  
  <div id="change-5242" class="journal has-notes">
    <div id="note-20">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-20" class="journal-link">#20</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="09 Aug 2016 00:42" href="/projects/exiv2/activity?from=2016-08-09">over 5 years</a> ago
      <span id="journal-5242-private_notes" class=""></span>
    </h4>

    <div id="journal-5242-notes" class="wiki"><p>I opened up the stonehenge file after converting it with cwebp here and there is no metadata in it.</p></div>
    </div>
  </div>
  
  <div id="change-5243" class="journal has-notes has-details">
    <div id="note-21">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-21" class="journal-link">#21</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="09 Aug 2016 00:45" href="/projects/exiv2/activity?from=2016-08-09">over 5 years</a> ago
      <span id="journal-5243-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/1026">Stonehenge.webp</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/1026/Stonehenge.webp">Stonehenge.webp</a> added</li>
    </ul>
    <div id="journal-5243-notes" class="wiki"><p>@Robin: Here is the Stonehenge.webp i exported using my gimp plugin with the patch i submitted and it works fine here. Let me know how it works out for you.</p></div>
    </div>
  </div>
  
  <div id="change-5244" class="journal has-notes">
    <div id="note-22">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-22" class="journal-link">#22</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="09 Aug 2016 00:55" href="/projects/exiv2/activity?from=2016-08-09">over 5 years</a> ago
      <span id="journal-5244-private_notes" class=""></span>
    </h4>

    <div id="journal-5244-notes" class="wiki"><p>I can always add extra display messages for when no ICCP, XMP, and EXIF chunks are found.</p></div>
    </div>
  </div>
  
  <div id="change-5245" class="journal has-notes">
    <div id="note-23">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-23" class="journal-link">#23</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="09 Aug 2016 00:58" href="/projects/exiv2/activity?from=2016-08-09">over 5 years</a> ago
      <span id="journal-5245-private_notes" class=""></span>
    </h4>

    <div id="journal-5245-notes" class="wiki"><p>Last bit before heading off, you can use webpmux to add/remove metadata in a webp file which is what i used originally when i started tinkering.</p></div>
    </div>
  </div>
  
  <div id="change-5246" class="journal has-notes">
    <div id="note-24">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-24" class="journal-link">#24</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="09 Aug 2016 01:16" href="/projects/exiv2/activity?from=2016-08-09">over 5 years</a> ago
      <span id="journal-5246-private_notes" class=""></span>
    </h4>

    <div id="journal-5246-notes" class="wiki"><p>Doh, first bug already, the stonehenge file seems to not export well with my gimp plugin though all my previous files worked. Now to see if its the export of the exiv2 patch thats the problem. Will update back tomorrow.</p></div>
    </div>
  </div>
  
  <div id="change-5248" class="journal has-notes has-details">
    <div id="note-25">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-25" class="journal-link">#25</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="09 Aug 2016 10:04" href="/projects/exiv2/activity?from=2016-08-09">over 5 years</a> ago
      <span id="journal-5248-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/1027">Desk2016-08-09.jpg</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/1027/Desk2016-08-09.jpg">Desk2016-08-09.jpg</a> added</li>
    </ul>
    <div id="journal-5248-notes" class="wiki"><p>Good News:</p>


	<p><strong>1 Stonehenge.webp does not have metadata</strong><pre>570 rmills@rmillsmbp:~/gnu/webp/libwebp $ exiv2 --verbose -pa ~/Stonehenge.webp
File 1/1: /Users/rmills/Stonehenge.webp
1
2
/Users/rmills/Stonehenge.webp: No Exif data found in the file
/Users/rmills/Stonehenge.webp: No IPTC data found in the file
/Users/rmills/Stonehenge.webp: No XMP data found in the file
571 rmills@rmillsmbp:~/gnu/webp/libwebp $</pre><strong>2 cwebp can preserve some metadata</strong></p>


<pre>577 rmills@rmillsmbp:~/gnu/webp/libwebp $ cwebp -metadata all ~/Stonehenge.jpg -o ~/Stonehenge.webp
Saving file '/Users/rmills/Stonehenge.webp'
File:      /Users/rmills/Stonehenge.jpg
Dimension: 6000 x 4000
Output:    1936490 bytes Y-U-V-All-PSNR 38.52 45.95 46.86   39.94 dB
block count:  intra4: 61816
              intra16: 31934  (-&gt; 34.06%)
              skipped block: 15202 (16.22%)
bytes used:  header:            370  (0.0%)
             mode-partition: 302819  (15.6%)
 Residuals bytes  |segment 1|segment 2|segment 3|segment 4|  total
    macroblocks:  |       5%|      21%|      22%|      50%|   93750
      quantizer:  |      36 |      34 |      29 |      19 |
   filter level:  |      11 |       8 |       6 |       8 |
Metadata:
  * EXIF data:     15280 bytes
  * XMP data:       2579 bytes
578 rmills@rmillsmbp:~/gnu/webp/libwebp $ exiv2 -pa ~/Stonehenge.webp 
1
2
Warning: Failed to decode Exif metadata.
Exif.Image.DateTime                          Ascii      20  2015:07:16 20:25:28
Exif.Image.ImageDescription                  Ascii      13  Classic View
Exif.Image.Rating                            Short       1  0
Iptc.Application2.RecordVersion              Short       1  0
Iptc.Envelope.CharacterSet                   String      3  G
Iptc.Application2.Caption                    String     12  Classic View
Xmp.xmp.Rating                               XmpText     1  0
Xmp.xmp.ModifyDate                           XmpText    25  2015-07-16T20:25:28+01:00
Xmp.dc.description                           LangAlt     1  lang="x-default" Classic View
579 rmills@rmillsmbp:~/gnu/webp/libwebp $</pre>

	<p><strong>3 CMake/Visual Studio/Autotool builds are working</strong></p>


	<p><a class="external" href="http://exiv2.dyndns.org:8080/">http://exiv2.dyndns.org:8080/</a></p>


	<p><strong>4 I'll write WebPImage::printStructure()</strong></p>


	<p>I think this is a very valuable debugging tool.  I hope to submit that code today.</p>


	<p><strong>5 What I'd like you to do</strong></p>


	<p>Perhaps we should have a discussion on Skype.  I am 'clanmills'.  Let's discuss your situation (location, availability, skills).  We have to assemble some test files and write some test scripts.  We can use the Stonehenge file, together with the libwebp utilities to generate copyright free images for the test suite.  We should make the test images as small as possible to minimise the size of the svn source checkout.</p>


	<p>We have to investigate readMetadata().  <em><strong><code>$ cwebp -metadata all</code></strong></em> claimed to have written 12k bytes of Exif metadata, however there are only 3 keys being reported.  There's a mysterious message <em><strong><code>Warning: Failed to decode Exif metadata</code></strong></em> We are also reporting IPTC metadata.  The XMP data looks correct.<pre>580 rmills@rmillsmbp:~/gnu/webp/libwebp $ exiv2 -pa ~/Stonehenge.webp 
1
2
Warning: Failed to decode Exif metadata.
Exif.Image.DateTime                          Ascii      20  2015:07:16 20:25:28
Exif.Image.ImageDescription                  Ascii      13  Classic View
Exif.Image.Rating                            Short       1  0
Iptc.Application2.RecordVersion              Short       1  0
Iptc.Envelope.CharacterSet                   String      3  G
Iptc.Application2.Caption                    String     12  Classic View
Xmp.xmp.Rating                               XmpText     1  0
Xmp.xmp.ModifyDate                           XmpText    25  2015-07-16T20:25:28+01:00
Xmp.dc.description                           LangAlt     1  lang="x-default" Classic View
581 rmills@rmillsmbp:~/gnu/webp/libwebp $ exiv2 -pa --grep Xmp ~/Stonehenge.jpg 
Xmp.xmp.Rating                               XmpText     1  0
Xmp.xmp.ModifyDate                           XmpText    25  2015-07-16T20:25:28+01:00
Xmp.dc.description                           LangAlt     1  lang="x-default" Classic View
582 rmills@rmillsmbp:~/gnu/webp/libwebp $ </pre>Investigating these odd things will be much easier when WebPImage::printStructure() has been implemented.</p>


	<p><strong>6 Perfect Weather in England</strong></p>


	<p>Beautiful day here and the forecast for the next week is perfect.  Here's the view from my desk.</p>


	<p><img src="/attachments/download/1027/Desk2016-08-09.jpg" alt="" /></p></div>
    </div>
  </div>
  
  <div id="change-5249" class="journal has-details">
    <div id="note-26">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-26" class="journal-link">#26</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="09 Aug 2016 10:09" href="/projects/exiv2/activity?from=2016-08-09">over 5 years</a> ago
      <span id="journal-5249-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/1028">Stonehenge2.webp</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/1028/Stonehenge2.webp">Stonehenge2.webp</a> added</li>
       <li><strong>% Done</strong> changed from <i>20</i> to <i>30</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-5250" class="journal has-notes">
    <div id="note-27">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-27" class="journal-link">#27</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/76">Gilles Caulier</a> <a title="09 Aug 2016 10:32" href="/projects/exiv2/activity?from=2016-08-09">over 5 years</a> ago
      <span id="journal-5250-private_notes" class=""></span>
    </h4>

    <div id="journal-5250-notes" class="wiki"><p>Ben,</p>


	<p>About webp features that i need to implement in digiKam image loader, outside metadata, i'm right if i said :</p>


	<p>- 8 and 16 bits colors depth.<br />- lossy and loss less compression.<br />- ARGB or RGB support.<br />- ICC color profile support.</p>


	<p>Does lossless is only in 8 bits color depth or 16 bits is supported ?<br />RGBA color components are stored in image as PNG for ex ?<br />Other color spaces are supported, as YCrCb as JPEG ?</p>


	<p>On wikipedia, information are not clear or perhaps not up to date. I don't yet take a look into libwebp, but as i see in your gimp plugin code, it's very easy to implement. <br />There is any way to have a progress info while load/decoding or encoding/save the image ?</p>


	<p>Thanks in advance</p>


	<p>Gilles Caulier</p></div>
    </div>
  </div>
  
  <div id="change-5251" class="journal has-notes">
    <div id="note-28">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-28" class="journal-link">#28</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="09 Aug 2016 11:25" href="/projects/exiv2/activity?from=2016-08-09">over 5 years</a> ago
      <span id="journal-5251-private_notes" class=""></span>
    </h4>

    <div id="journal-5251-notes" class="wiki"><p>@Gilles I haven't found enough information to properly answer you, so i'll try with what i know. As far as i can see its ARGB, ICC profiles are support (the gimp file plugin i'm working on exports it to them at any rate, lol) and lossy and lossless is support but for color depth it seems to be 8 bits only but i am not 100% sure on that part but the encoder seems to only output that. But the documentation is lacking in some areas so its hard to tell. It's RGBA only as far as i can tell, and how i implented it in the plugin.</p>


	<p>@Robin Ha nice day, still early here on the other side of the pond :) and good to know about cwebp, honestly never used till last night lol.</p>


	<p>I found two issues last night trying to code around them, turns out some height x width data should be in the VP8 and VP8L  chunks as well and i need to reference that when no VP8X header is included to get h,w and second when no VP8X header is in the file i need to create one when adding either EXIF or XMP chunks or else the reference library (and related apps) give an error.</p>


	<p>I never noticed it before because the exporter i was using was adding an ICC profile and was thus already creating the VP8X header. I'm poring over the webpmux code to see how i could implement that hopefully today or tomorrow worst case.</p>


	<p>As for items 3 and 4 good to know, especially for item 3 i tried to edit the files but since i don't have those items to test with it was a shot in the dark :)</p>


	<p>For item 5 as i said above i still have a few items to fix, once thats done i should be able to generate any combination of images as needed.</p>


	<p>As for location i'm in Canada on the eastern side (EST time). I'll dust off my old Skype account i almost never use it now. Time for some breakfeast now.</p></div>
    </div>
  </div>
  
  <div id="change-5252" class="journal has-notes">
    <div id="note-29">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-29" class="journal-link">#29</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="09 Aug 2016 11:57" href="/projects/exiv2/activity?from=2016-08-09">over 5 years</a> ago
      <span id="journal-5252-private_notes" class=""></span>
    </h4>

    <div id="journal-5252-notes" class="wiki"><p>@Robin Skype request sent.</p></div>
    </div>
  </div>
  
  <div id="change-5253" class="journal has-notes">
    <div id="note-30">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-30" class="journal-link">#30</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="09 Aug 2016 12:06" href="/projects/exiv2/activity?from=2016-08-09">over 5 years</a> ago
      <span id="journal-5253-private_notes" class=""></span>
    </h4>

    <div id="journal-5253-notes" class="wiki"><p>Thanks for the update, Ben.  Canada, eh?  I'm an American Citizen, however I've only been in Canada at Niagara Falls.  Would like to ride the train coast-to-coast one day.  I'll try to get printStructure() implemented later today.  Not only is that useful for debugging, I'll actually understand the WebP format when I have that done.  So if you fix anything you know is broken, it will be helpful to fix it and send me a patch.  After that we can tackle the test harness.  If you get the files, I'll do the bash scripts.</p>


	<p>Gilles:  I can't answer your questions about ColorSpaces, depth and so on.  The idea of having a progress callback for readMetadata() and writeMetadata() sounds good.  I think that should be added to the Exiv2::Image class and be available for every type of Image.  Can you raise a feature request on Redmine.</p></div>
    </div>
  </div>
  
  <div id="change-5254" class="journal has-notes">
    <div id="note-31">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-31" class="journal-link">#31</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="09 Aug 2016 13:15" href="/projects/exiv2/activity?from=2016-08-09">over 5 years</a> ago
      <span id="journal-5254-private_notes" class=""></span>
    </h4>

    <div id="journal-5254-notes" class="wiki"><p>VP8 Spec <a class="external" href="https://tools.ietf.org/html/rfc6386">https://tools.ietf.org/html/rfc6386</a><br />VP8L Spec <a class="external" href="https://chromium.googlesource.com/webm/libwebp/+/master/doc/webp-lossless-bitstream-spec.txt">https://chromium.googlesource.com/webm/libwebp/+/master/doc/webp-lossless-bitstream-spec.txt</a></p></div>
    </div>
  </div>
  
  <div id="change-5255" class="journal has-notes">
    <div id="note-32">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-32" class="journal-link">#32</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="09 Aug 2016 13:23" href="/projects/exiv2/activity?from=2016-08-09">over 5 years</a> ago
      <span id="journal-5255-private_notes" class=""></span>
    </h4>

    <div id="journal-5255-notes" class="wiki"><p>@Robin Yep, I noticed that when i saw you were from San Jose, from your Skype profile :) Never been there but have driven out from here to Vancouver though half on the Canadian side and half on the American side (Detroit to Seattle). Yeah a train ride across would be nice though as i understand it there's a small stretch where where this isn't any service any longer somewhere in Ontario (though i may have misunderstood what i was told at the time or it may have changed since) so you'd have to switch off and on there.</p>


	<p>Yeah working on adding the parts i noticed were missing like having to add reading the sizes properly for when the VP8X chunk is missing. Going to work on the writing part that needs fixing later on today or tomorrow morning.</p></div>
    </div>
  </div>
  
  <div id="change-5256" class="journal has-notes">
    <div id="note-33">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-33" class="journal-link">#33</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="09 Aug 2016 15:07" href="/projects/exiv2/activity?from=2016-08-09">over 5 years</a> ago
      <span id="journal-5256-private_notes" class=""></span>
    </h4>

    <div id="journal-5256-notes" class="wiki"><p>We lived in San Jose (Silicon Valley) for 14 years and retired to our 'old' house in England 2 years ago.  We've totally renovated our 40 year old house.  All the construction work is finished and we're into decorating.  We'll be pretty well done in September or October.</p>


	<p>We've visited all 50 of the United States and crossed the States on all three trans-continental tracks.  However, we have never been in Canada or Mexico.  A deliberate choice.  If you take on too much, you fail.  We restricted ourselves to the States.  We're both US Citizens and very happy to be 'home' in England.  We met in High School in Scotland.  So one of our 'bucket list' projects is to cross Canada by train.  <a class="external" href="http://clanmills.com/BucketList.shtml">http://clanmills.com/BucketList.shtml</a></p>


	<p>Right.  I have to go with Alison to look at tiles for the kitchen, then I'll write WebPImage::printStructure().  I'm rather hoping that I can cut'n'paste your code for readMetadata() and get this done quickly.  From your conversation with Gilles, I think you have a WebP parser here: <a class="external" href="https://github.com/draekko/gimp-webp">https://github.com/draekko/gimp-webp</a></p></div>
    </div>
  </div>
  
  <div id="change-5257" class="journal has-notes">
    <div id="note-34">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-34" class="journal-link">#34</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="09 Aug 2016 19:18" href="/projects/exiv2/activity?from=2016-08-09">over 5 years</a> ago
      <span id="journal-5257-private_notes" class=""></span>
    </h4>

    <div id="journal-5257-notes" class="wiki"><p>@Gilles looks like was wrong about the colorspace see <a class="external" href="https://developers.google.com/speed/webp/docs/api">https://developers.google.com/speed/webp/docs/api</a> and do a search in the page for colorspace. As far as i know right now all exporters are doing rgba.</p></div>
    </div>
  </div>
  
  <div id="change-5259" class="journal has-notes">
    <div id="note-35">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-35" class="journal-link">#35</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/76">Gilles Caulier</a> <a title="09 Aug 2016 20:51" href="/projects/exiv2/activity?from=2016-08-09">over 5 years</a> ago
      <span id="journal-5259-private_notes" class=""></span>
    </h4>

    <div id="journal-5259-notes" class="wiki"><p>yes, i see. so RGBA is fine...</p></div>
    </div>
  </div>
  
  <div id="change-5261" class="journal has-notes">
    <div id="note-36">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-36" class="journal-link">#36</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="10 Aug 2016 14:29" href="/projects/exiv2/activity?from=2016-08-10">over 5 years</a> ago
      <span id="journal-5261-private_notes" class=""></span>
    </h4>

    <div id="journal-5261-notes" class="wiki"><p>@Robin: hit a snag, seems like the encoder pads with extra \0 some chunks trying to figure it out and how to handle it in the writeMetadata function. Fixed the reading part to disregard those.</p></div>
    </div>
  </div>
  
  <div id="change-5262" class="journal has-notes has-details">
    <div id="note-37">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-37" class="journal-link">#37</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="10 Aug 2016 16:17" href="/projects/exiv2/activity?from=2016-08-10">over 5 years</a> ago
      <span id="journal-5262-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/1030">exiv2-160810-3.diff</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/1030/exiv2-160810-3.diff">exiv2-160810-3.diff</a> added</li>
    </ul>
    <div id="journal-5262-notes" class="wiki"><p>@Robin New patch update which fixes all previous issues and adds printStructure. I did find one new issue where with a lossless image with alpha but without animation the height listed in the data is way too high (eg. should be 1333 and gets 17717). Trying to figure out where it gets mangled as all other variations work fine. This patch adds/changes to whats in the repo.</p></div>
    </div>
  </div>
  
  <div id="change-5263" class="journal has-notes">
    <div id="note-38">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-38" class="journal-link">#38</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="10 Aug 2016 16:19" href="/projects/exiv2/activity?from=2016-08-10">over 5 years</a> ago
      <span id="journal-5263-private_notes" class=""></span>
    </h4>

    <div id="journal-5263-notes" class="wiki"><p>Before i forget again, i get free errors with the gimp plugin when loading an image using whats in repo but when built from the stable version (0.25) it works fine.</p></div>
    </div>
  </div>
  
  <div id="change-5264" class="journal has-notes has-details">
    <div id="note-39">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-39" class="journal-link">#39</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="10 Aug 2016 18:21" href="/projects/exiv2/activity?from=2016-08-10">over 5 years</a> ago
      <span id="journal-5264-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>30</i> to <i>40</i></li>
    </ul>
    <div id="journal-5264-notes" class="wiki"><p>Thanks for providing the patch.  It's submitted <a class="changeset" title="#1199  Thank you to Ben for the patch.  This corrects various matters and adds a first stab at We..." href="/projects/exiv2/repository/exiv2/revisions/4360">r4360</a>  Very good work indeed.  Thank You very much.</p>


	<p><strong>1 Functionality</strong></p>


	<p>Here's what I see:<pre>630 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pS ~/Stonehenge2.webp 
STRUCTURE OF WEBP FILE: /Users/rmills/Stonehenge2.webp
    offset  | chunk_type |   length   | data
          0 |    WEBP    |         12 | RIFFH...WEBP 
         12 |    VP8X    |         10 | ....o..... 
         30 |    VP8     |    1936470 | .....*p...&gt;.D.I 
    1936508 |    EXIF    |      15280 | II*............ 
    1951796 |    XMP     |       2579 | &lt;?xpacket begin 
631 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pa ~/Stonehenge2.webp 
Warning: Failed to decode Exif metadata.
Exif.Image.DateTime                          Ascii      20  2015:07:16 20:25:28
Exif.Image.ImageDescription                  Ascii      13  Classic View
Exif.Image.Rating                            Short       1  0
Iptc.Application2.RecordVersion              Short       1  0
Iptc.Envelope.CharacterSet                   String      3  G
Iptc.Application2.Caption                    String     12  Classic View
Xmp.xmp.Rating                               XmpText     1  0
Xmp.xmp.ModifyDate                           XmpText    25  2015-07-16T20:25:28+01:00
Xmp.dc.description                           LangAlt     1  lang="x-default" Classic View
632 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>The Exif data block is 15280 byte and that feels "about right" and it was 15288 in Stonehenge.jpg (which has a few additional bytes to identify it as Exif in at APP1 segment).  However you're only reporting a few keys.  I'm wondering if your call to copyXmpToExif() is clobbering something.  Also, you have a warning <strong><em>Warning: Failed to decode Exif metadata.</em></strong>  What's that about? <pre>632 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pS ~/Stonehenge.jpg
STRUCTURE OF JPEG FILE: /Users/rmills/Stonehenge.jpg
 address | marker     | length  | data
       2 | 0xd8 SOI   |       0 
       4 | 0xe1 APP1  |   15288 | Exif..II*......................
   15294 | 0xe1 APP1  |    2610 | http://ns.adobe.com/xap/1.0/.&lt;?x
   17906 | 0xed APP13 |      96 | Photoshop 3.0.8BIM.......'.....
   18004 | 0xe2 APP2  |    4094 | MPF.II*...............0100.....
   22100 | 0xdb DQT   |     132 
   22234 | 0xc0 SOF0  |      17 
   22253 | 0xc4 DHT   |     418 
   22673 | 0xda SOS   |      12 
633 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre></p>


	<p><strong>2 printStructure()</strong></p>


	<p>I was bored this afternoon and did some work on printStructure().  You have the right idea about what's to be done and you've implemented the -pS capability.</p>


	<p>Some constructive comments about printStructure()</p>


	<p>a) You've used sprintf to format strings.  I have Internal:: functions to perform that<br />b) There are a load of Clang warnings about unsigned/signed comparisons <br />c) Deal with recursion to dump the Exif data (which is a TIFF formatted structure)<br />d) We should also implement the options used by<br />i) -pR/C/X (print Recursive, ICC Profile, XMP)<br />ii) -dC/E/I/X (delete ICC profile, Exif, IPTC and XMP)</p>


	<p>So, to help you focus on the WebP matters, I'll take responsibility for printStructure() and develop it.  I'll submit what I have so far which is functionally the same as you have.  I've implemented -pS and just started to work on -pR.</p>


	<p><strong>3 Leaking memory</strong></p>


	<p>I'm not aware of that.  Can you open a new issue in Redmine for that to ensure it is not forgotten.</p>


	<p><strong>4 Last night's build/test was totally successful.</strong></p>


	<p>Clang, GCC, Visual Studio 2005/8/10/12/13/15 (x86 &#38; x64) was 100% successful and includes webpimage.cpp/.hpp</p>


	<p><strong>5 We can probably start working on the test suite on Friday</strong></p>


	<p>When we resolve the difference between the Exif metadata appearing from Stonehenge2.webp and Stonehenge.jpg we'll be ready to start working on the test suite.  And while you're figuring out the mysteriously missing metadata, I'll complete WebPImage::printStructure().</p>


	<p><strong>6 Other matters</strong></p>


	<p>I looked at your contribution to Gimp (themes and back porting them).  And you've been active on other projects.  I encourage you to spend a little time on OpenHub to be sure your other projects are monitored and that your "Kudos" rating reflects your contributions.  You may need to register projects such as the themes and plugin with OpenHub.  It's painless and free - just a little of your time.</p>


	<p>I'll email Andreas about granting you write access to the repos.  Can't guess or promise when (or even if) he will do that.</p>


	<p>Thanks very much for doing this work.  It will be appreciated by many.  Don't expect anybody to thank you - however that doesn't mean that it isn't appreciated!  As a matter of fact, I really only hear from folks about bugs and issues.  Being thanked is very unusual.  However, I do appreciate and say <em><strong>Thank You, Ben</strong></em> for getting involved with this.</p></div>
    </div>
  </div>
  
  <div id="change-5265" class="journal has-notes">
    <div id="note-40">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-40" class="journal-link">#40</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="10 Aug 2016 19:34" href="/projects/exiv2/activity?from=2016-08-10">over 5 years</a> ago
      <span id="journal-5265-private_notes" class=""></span>
    </h4>

    <div id="journal-5265-notes" class="wiki"><p>1- If you get a chance maybe double check where i create the exif blob to see if did it right i may have missed something obvious. As for the actual data i was exporting from Gimp and it rewrites some data on export which i pass on to gexiv2 which gives it to exiv2 lib so its possible its also from there. As for the error message i'm not getting that on my end, all of them list fine. How was the file created?</p>


	<p>2- Sounds good to me. You know better what you want there, i only did that to get things going and it helped me as well with those offsets because google doesn't follow their spec and pads any data payload with \0 on odd sized data chunks.</p>


	<p>3- Not sure either but i think its the icc code which is ifdef'ed for the SVN version only. Not really high on my list just yet.</p>


	<p>4- Sweet, good news.</p>


	<p>5- Ok</p>


	<p>6- Thanks for saying, and yeah i doesn't happen often enough considering the hours we pour into these apps. I will add a bit more on openhub once i figure it out and am done with this :) As for the repo well whenever it happens is good enough :)</p></div>
    </div>
  </div>
  
  <div id="change-5266" class="journal has-notes">
    <div id="note-41">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-41" class="journal-link">#41</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="10 Aug 2016 19:57" href="/projects/exiv2/activity?from=2016-08-10">over 5 years</a> ago
      <span id="journal-5266-private_notes" class=""></span>
    </h4>

    <div id="journal-5266-notes" class="wiki"><p>Right.  I think we're in agreement here.  The ICC code could be causing a leak.  It shouldn't of course, however for sure it could.  I think auto pointers are a horrible idea.  Never too sure who owns the pointer - grrrr.</p>


	<p>Incidentally I think SVN is always defined.  If the build doesn't know, it sets it to 0.</p>


	<p>I really don't know anything about your plugin or gexiv2.  It's a useful additional test.  Let's do our work with the exiv2 sample apps because we both have them.  I created Stonehenge2.webp with the cwebp:<pre>681 rmills@rmillsmbp:~/temp/forBen $ curl --silent -O http://clanmills.com/Stonehenge.jpg
682 rmills@rmillsmbp:~/temp/forBen $ ls -alt Stonehenge.jpg 
-rw-r--r--+ 1 rmills  staff  6757827 10 Aug 20:52 Stonehenge.jpg
683 rmills@rmillsmbp:~/temp/forBen $ cwebp -metadata all Stonehenge.jpg -o Stonehenge2.webp
Saving file 'Stonehenge2.webp'
File:      Stonehenge.jpg
Dimension: 6000 x 4000
Output:    1936490 bytes Y-U-V-All-PSNR 38.52 45.95 46.86   39.94 dB
block count:  intra4: 61816
              intra16: 31934  (-&gt; 34.06%)
              skipped block: 15202 (16.22%)
bytes used:  header:            370  (0.0%)
             mode-partition: 302819  (15.6%)
 Residuals bytes  |segment 1|segment 2|segment 3|segment 4|  total
    macroblocks:  |       5%|      21%|      22%|      50%|   93750
      quantizer:  |      36 |      34 |      29 |      19 |
   filter level:  |      11 |       8 |       6 |       8 |
Metadata:
  * EXIF data:     15280 bytes
  * XMP data:       2579 bytes
684 rmills@rmillsmbp:~/temp/forBen $ exiv2 -pS Stonehenge2.webp 
STRUCTURE OF WEBP FILE: Stonehenge2.webp
 Chunk |   Length |   Offset | Payload
  RIFF |  1954376 |        0 | WEBP
  VP8X |       10 |       12 | ....o....
  VP8  |  1936470 |       30 | .....*p...&gt;.D.I..#$(.*p...gn..d.
  EXIF |    15280 |  1936508 | II*............................
  XMP  |     2579 |  1951796 | &lt;?xpacket begin="..." id="W5M0Mp
685 rmills@rmillsmbp:~/temp/forBen $ exiv2 -pa Stonehenge2.webp 
Warning: Failed to decode Exif metadata.
Exif.Image.DateTime                          Ascii      20  2015:07:16 20:25:28
Exif.Image.ImageDescription                  Ascii      13  Classic View
Exif.Image.Rating                            Short       1  0
Iptc.Application2.RecordVersion              Short       1  0
Iptc.Envelope.CharacterSet                   String      3  G
Iptc.Application2.Caption                    String     12  Classic View
Xmp.xmp.Rating                               XmpText     1  0
Xmp.xmp.ModifyDate                           XmpText    25  2015-07-16T20:25:28+01:00
Xmp.dc.description                           LangAlt     1  lang="x-default" Classic View
686 rmills@rmillsmbp:~/temp/forBen $ </pre></p></div>
    </div>
  </div>
  
  <div id="change-5267" class="journal has-notes">
    <div id="note-42">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-42" class="journal-link">#42</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="10 Aug 2016 20:11" href="/projects/exiv2/activity?from=2016-08-10">over 5 years</a> ago
      <span id="journal-5267-private_notes" class=""></span>
    </h4>

    <div id="journal-5267-notes" class="wiki"><p>I'm starting to distrust cwebp because it fails to create lossless images as well as the error above. I think i found a work around for fetching the height by getting it from the first available frame chunk (Vp8/Vp8l/Anmf).</p></div>
    </div>
  </div>
  
  <div id="change-5268" class="journal has-notes">
    <div id="note-43">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-43" class="journal-link">#43</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="10 Aug 2016 20:29" href="/projects/exiv2/activity?from=2016-08-10">over 5 years</a> ago
      <span id="journal-5268-private_notes" class=""></span>
    </h4>

    <div id="journal-5268-notes" class="wiki"><p>We can also create proper webp files using webpmux</p>


	<p>eg.</p>


	<p>cwebp Stonehenge.jpg -o Stonehenge.webp<br />webpmux -set exif Stonehenge.exv Stonehenge.webp -o Stonehenge-exif.webp<br />webpmux -set xmp Stonehenge.xmp Stonehenge-exif.webp -o Stonehenge-exif-xmp.webp<br />webpmux -set icc Stonehenge.icc Stonehenge-exif-xmp.webp -o Stonehenge-exif-xmp-icc.webp</p></div>
    </div>
  </div>
  
  <div id="change-5270" class="journal has-notes has-details">
    <div id="note-44">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-44" class="journal-link">#44</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="10 Aug 2016 22:29" href="/projects/exiv2/activity?from=2016-08-10">over 5 years</a> ago
      <span id="journal-5270-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/1031">exiv2-height-160810.diff</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/1031/exiv2-height-160810.diff">exiv2-height-160810.diff</a> added</li>
    </ul>
    <div id="journal-5270-notes" class="wiki"><p>Patch to fix listed height issue on VP8L chunks (lossless single frame/image)</p></div>
    </div>
  </div>
  
  <div id="change-5271" class="journal has-notes has-details">
    <div id="note-45">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-45" class="journal-link">#45</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="11 Aug 2016 10:11" href="/projects/exiv2/activity?from=2016-08-11">over 5 years</a> ago
      <span id="journal-5271-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/1032">Stonehenge3.webp</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/1032/Stonehenge3.webp">Stonehenge3.webp</a> added</li>
    </ul>
    <div id="journal-5271-notes" class="wiki"><p>Ben</p>


	<p>I've merged your patch and made some minor changes.  Please sync and review. <a class="changeset" title="#1199  Patch from Ben.  http://dev.exiv2.org/issues/1199#note-37" href="/projects/exiv2/repository/exiv2/revisions/4363">r4363</a></p>


	<p><strong>1 Stonehenge3.webp</strong></p>


	<p>I've tried your tricks above with cwebp and webpmux and created Stonehenge3.webp (attached).  Your new code is reporting the metadata.  <pre>732 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pa --grep model/i ~/Stonehenge3.webp 
Error: XMP Toolkit error 201: XML parsing failure
Warning: Failed to decode XMP metadata.
Exif.Image.Model                             Ascii      12  NIKON D5300
733 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>A couple of grumpy warnings for you to investigate.</p>


	<p><strong>2 Test files</strong></p>


	<p>I found some here.  <a class="external" href="https://github.com/drewnoakes/metadata-extractor-images/tree/master/webp">https://github.com/drewnoakes/metadata-extractor-images/tree/master/webp</a><br /><pre>742 rmills@rmillsmbp:~/gnu/exiv2/trunk $ ls -alt ~/Downloads/*.webp
-rw-r--r--@ 1 rmills  staff   19944 11 Aug 09:46 /Users/rmills/Downloads/Nikon D1X.webp
-rw-r--r--@ 1 rmills  staff  273410 11 Aug 09:45 /Users/rmills/Downloads/webpvp8.webp
-rw-r--r--@ 1 rmills  staff  474772 11 Aug 09:43 /Users/rmills/Downloads/Nikon Coolpix P7000.webp
743 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 --verbose -pa --grep model/i ~/Downloads/*.webp 
File 1/3: /Users/rmills/Downloads/Nikon Coolpix P7000.webp
Warning: Failed to decode Exif metadata.
/Users/rmills/Downloads/Nikon Coolpix P7000.webp  Exif.Image.Model                             Ascii      14  COOLPIX P7000
/Users/rmills/Downloads/Nikon Coolpix P7000.webp  Xmp.tiff.Model                               XmpText    13  COOLPIX P7000
File 2/3: /Users/rmills/Downloads/Nikon D1X.webp
Warning: Failed to decode Exif metadata.
/Users/rmills/Downloads/Nikon D1X.webp: No Exif data found in the file
/Users/rmills/Downloads/Nikon D1X.webp: No IPTC data found in the file
/Users/rmills/Downloads/Nikon D1X.webp: No XMP data found in the file
File 3/3: /Users/rmills/Downloads/webpvp8.webp
/Users/rmills/Downloads/webpvp8.webp: No Exif data found in the file
/Users/rmills/Downloads/webpvp8.webp: No IPTC data found in the file
/Users/rmills/Downloads/webpvp8.webp: No XMP data found in the file
744 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 --verbose -pS ~/Downloads/*.webp 
File 1/3: /Users/rmills/Downloads/Nikon Coolpix P7000.webp
STRUCTURE OF WEBP FILE: /Users/rmills/Downloads/Nikon Coolpix P7000.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   474764 |        0 | WEBP
  VP8X |       10 |       12 | ....?....
  VP8  |   410596 |       30 | p.&#38;..*@...&gt;.H.K..).#r..@..gn..g.
  EXIF |    59965 |   410634 | II*........... ................
  XMP  |     4155 |   470608 | &lt;?xpacket begin="..." id="W5M0Mp
File 2/3: /Users/rmills/Downloads/Nikon D1X.webp
STRUCTURE OF WEBP FILE: /Users/rmills/Downloads/Nikon D1X.webp
 Chunk |   Length |   Offset | Payload
  RIFF |    19936 |        0 | WEBP
  VP8X |       10 |       12 | ....W....
  VP8  |    16128 |       30 | .c...*X...&gt;.D.J...$..+p...g:.7..
  EXIF |     3770 |    16166 | II*........... ................
File 3/3: /Users/rmills/Downloads/webpvp8.webp
STRUCTURE OF WEBP FILE: /Users/rmills/Downloads/webpvp8.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   273402 |        0 | WEBP
  VP8  |   273390 |       12 | 0 ...*@...&gt;U$.E#.!..Q.Hp..em3..q
745 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>Our behaviour is a bit random.</p>


	<p><strong>3 webpmux is not good for creating test files</strong></p>


	<p>The problem is that webpmux doesn't know anything about metadata.  It simply copies any data you give him into a chunk in the file.</p>


	<p><strong>4 What I'm going to do now</strong></p>


	<p>I'm going to focus on printStructure on the following three files.  <pre>749 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 --verbose -pR ~/Downloads/N*.webp ~/Stonehenge2.webp 
File 1/3: /Users/rmills/Downloads/Nikon Coolpix P7000.webp
STRUCTURE OF WEBP FILE: /Users/rmills/Downloads/Nikon Coolpix P7000.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   474764 |        0 | WEBP
  VP8X |       10 |       12 | ....?....
  VP8  |   410596 |       30 | p.&#38;..*@...&gt;.H.K..).#r..@..gn..g.
  EXIF |    59965 |   410634 | II*........... ................
  STRUCTURE OF TIFF FILE (II): /Users/rmills/Downloads/Nikon Coolpix P7000.webp
  dirLength = 17751
  END /Users/rmills/Downloads/Nikon Coolpix P7000.webp
  XMP  |     4155 |   470608 | &lt;?xpacket begin="..." id="W5M0Mp
File 2/3: /Users/rmills/Downloads/Nikon D1X.webp
STRUCTURE OF WEBP FILE: /Users/rmills/Downloads/Nikon D1X.webp
 Chunk |   Length |   Offset | Payload
  RIFF |    19936 |        0 | WEBP
  VP8X |       10 |       12 | ....W....
  VP8  |    16128 |       30 | .c...*X...&gt;.D.J...$..+p...g:.7..
  EXIF |     3770 |    16166 | II*........... ................
  STRUCTURE OF TIFF FILE (II): /Users/rmills/Downloads/Nikon D1X.webp
  dirLength = 17751
  END /Users/rmills/Downloads/Nikon D1X.webp
File 3/3: /Users/rmills/Stonehenge2.webp
STRUCTURE OF WEBP FILE: /Users/rmills/Stonehenge2.webp
 Chunk |   Length |   Offset | Payload
  RIFF |  1954376 |        0 | WEBP
  VP8X |       10 |       12 | ....o....
  VP8  |  1936470 |       30 | .....*p...&gt;.D.I..#$(.*p...gn..d.
  EXIF |    15280 |  1936508 | II*............................
  STRUCTURE OF TIFF FILE (II): /Users/rmills/Stonehenge2.webp
  dirLength = 17751
  END /Users/rmills/Stonehenge2.webp
  XMP  |     2579 |  1951796 | &lt;?xpacket begin="..." id="W5M0Mp
750 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre></p>


	<p><strong>5 Null padding blocks with odd length</strong></p>


	<p>I believe that's in the spec.  I can't remember where I read that, however I'm confident that I read that on the libwebp web site.</p></div>
    </div>
  </div>
  
  <div id="change-5272" class="journal has-notes">
    <div id="note-46">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-46" class="journal-link">#46</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="11 Aug 2016 10:40" href="/projects/exiv2/activity?from=2016-08-11">over 5 years</a> ago
      <span id="journal-5272-private_notes" class=""></span>
    </h4>

    <div id="journal-5272-notes" class="wiki"><p>1- The XMP chunk is filled with exif data. Probably why it fails like that :)</p>


	<p>2- Nice, when i googled originally all i got back from the search results was total crap. Will fetch them and give them the once over and see whats there.</p>


	<p>3- cwebp uses the same tricks to do it. But with webpmux you can create some specific files with any data.</p>


	<p>4- Sounds better, i should have done that for the header part but i had a lot of other things on my mind. Going to sync up the code here with the repo after my first coffee.</p>


	<p>5- Really i only found out after a lot of time reverse engineering a bunch of files with a hexeditor, it would have saved me considerable time if i had known before hand. Google really really sucks at documenting their APIs. sigh.</p></div>
    </div>
  </div>
  
  <div id="change-5273" class="journal has-notes">
    <div id="note-47">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-47" class="journal-link">#47</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="11 Aug 2016 10:47" href="/projects/exiv2/activity?from=2016-08-11">over 5 years</a> ago
      <span id="journal-5273-private_notes" class=""></span>
    </h4>

    <div id="journal-5273-notes" class="wiki"><p>Just discovered i can use svn to get a single subdirectory from any github project. In this case like so:</p>


	<p>svn checkout <a class="external" href="https://github.com/drewnoakes/metadata-extractor-images/trunk/webp">https://github.com/drewnoakes/metadata-extractor-images/trunk/webp</a></p>


	<p>Didn't know github actually support svn lol.</p></div>
    </div>
  </div>
  
  <div id="change-5274" class="journal has-notes">
    <div id="note-48">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-48" class="journal-link">#48</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="11 Aug 2016 10:52" href="/projects/exiv2/activity?from=2016-08-11">over 5 years</a> ago
      <span id="journal-5274-private_notes" class=""></span>
    </h4>

    <div id="journal-5274-notes" class="wiki"><p>Only these 3 files have metadata from that repo:</p>


	<p>HTC Desire.webp (exif)<br />Nikon Coolpix P7000.webp (exif,xmp)<br />Nikon D1X.webp (exif)</p></div>
    </div>
  </div>
  
  <div id="change-5275" class="journal has-notes">
    <div id="note-49">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-49" class="journal-link">#49</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="11 Aug 2016 11:26" href="/projects/exiv2/activity?from=2016-08-11">over 5 years</a> ago
      <span id="journal-5275-private_notes" class=""></span>
    </h4>

    <div id="journal-5275-notes" class="wiki"><p>I think i figured out why the warning about decoding exif; which has to do with the test for the header. Not sure how i'll tackle it just now.</p></div>
    </div>
  </div>
  
  <div id="change-5284" class="journal has-notes has-details">
    <div id="note-50">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-50" class="journal-link">#50</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="11 Aug 2016 19:15" href="/projects/exiv2/activity?from=2016-08-11">over 5 years</a> ago
      <span id="journal-5284-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>40</i> to <i>50</i></li>
    </ul>
    <div id="journal-5284-notes" class="wiki"><p>Ah.  I stumbled onto two of the three files by pure luck.  -pR / -pX are working and tested.  -pC is in the code and waiting for a test file. <a class="changeset" title="#1199 Fixed exiv2 -pR/-pC/-pX Stonehenge2.webp to report exif/ICC/XMP" href="/projects/exiv2/repository/exiv2/revisions/4366">r4366</a></p>


	<p>If I spend time on Exiv2 tomorrow, I will get murdered.  I'll check email/Redmine/Skype.  I'll try not to get sucked into anything.</p>


<pre>886 rmills@rmillsmbp:~/gnu/exiv2/trunk $ ls -alt ~/Downloads/N*.webp
-rw-r--r--@ 1 rmills  staff   19944 11 Aug 09:46 /Users/rmills/Downloads/Nikon D1X.webp
-rw-r--r--@ 1 rmills  staff  474772 11 Aug 09:43 /Users/rmills/Downloads/Nikon Coolpix P7000.webp
887 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pR ~/Downloads/N*.webp
STRUCTURE OF WEBP FILE: /Users/rmills/Downloads/Nikon Coolpix P7000.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   474764 |        0 | WEBP
  VP8X |       10 |       12 | ....?....
  VP8  |   410596 |       30 | p.&#38;..*@...&gt;.H.K..).#r..@..gn..g.
  EXIF |    59965 |   410634 | II*........... ................
  STRUCTURE OF TIFF FILE (II): MemIo
   address |    tag                           |      type |    count |    offset | value
        10 | 0x010e ImageDescription          |     ASCII |       32 |       146 |                                
        22 | 0x010f Make                      |     ASCII |        6 |       178 | NIKON
        34 | 0x0110 Model                     |     ASCII |       16 |       184 | COOLPIX P7000..
        46 | 0x0112 Orientation               |     SHORT |        1 |         6 | 6
        58 | 0x011a XResolution               |  RATIONAL |        1 |       200 | 200/0
        70 | 0x011b YResolution               |  RATIONAL |        1 |       208 | 208/0
        82 | 0x0128 ResolutionUnit            |     SHORT |        1 |         2 | 2
        94 | 0x0131 Software                  |     ASCII |       32 |       216 | COOLPIX P7000V1.0              
       106 | 0x0132 DateTime                  |     ASCII |       20 |       248 | 2010:10:21 11:22:48
       118 | 0x0213 YCbCrPositioning          |     SHORT |        1 |         2 | 2
       130 | 0x8769 ExifTag                   |      LONG |        1 |       268 | 268
    STRUCTURE OF TIFF FILE (II): MemIo
     address |    tag                           |      type |    count |    offset | value
         270 | 0x829a ExposureTime              |  RATIONAL |        1 |       694 | 694/0
         282 | 0x829d FNumber                   |  RATIONAL |        1 |       702 | 702/0
         294 | 0x8822 ExposureProgram           |     SHORT |        1 |         2 | 2
         306 | 0x8827 ISOSpeedRatings           |     SHORT |        1 |       100 | 100
         318 | 0x9000 ExifVersion               | UNDEFINED |        4 | 808596016 | 0220
         330 | 0x9003 DateTimeOriginal          |     ASCII |       20 |       710 | 2010:10:21 11:22:48
         342 | 0x9004 DateTimeDigitized         |     ASCII |       20 |       730 | 2010:10:21 11:22:48
         354 | 0x9101 ComponentsConfiguration   | UNDEFINED |        4 |    197121 | ...
         366 | 0x9102 CompressedBitsPerPixel    |  RATIONAL |        1 |       750 | 750/0
         378 | 0x9204 ExposureBiasValue         | SRATIONAL |        1 |       758 | 758/0
         390 | 0x9205 MaxApertureValue          |  RATIONAL |        1 |       766 | 766/0
         402 | 0x9207 MeteringMode              |     SHORT |        1 |         5 | 5
         414 | 0x9208 LightSource               |     SHORT |        1 |         0 | 0
         426 | 0x9209 Flash                     |     SHORT |        1 |        16 | 16
         438 | 0x920a FocalLength               |  RATIONAL |        1 |       774 | 774/0
         450 | 0x927c MakerNote                 | UNDEFINED |     4721 |      1040 | Nikon.....II*.....+............ ...
      STRUCTURE OF TIFF FILE (II): MemIo
       address |    tag                           |      type |    count |    offset | value
            10 | 0x0001 Version                   | UNDEFINED |        4 |       512 | ...
            22 | 0x0002 ISOSpeed                  |     SHORT |        2 |         0 | 0 0
            34 | 0x0003 ColorMode                 |     ASCII |        7 |       530 | COLOR 
            46 | 0x0004 Quality                   |     ASCII |        8 |       538 | FINE   
            58 | 0x0005 WhiteBalance              |     ASCII |       14 |       546 | AUTO         
            70 | 0x0006 Sharpening                |     ASCII |        8 |       560 | NORMAL 
            82 | 0x0007 Focus                     |     ASCII |        8 |       568 | AF-S   
            94 | 0x0008 FlashSetting              |     ASCII |        8 |       576 |        
           106 | 0x000a 0x000a                    |  RATIONAL |        1 |       584 | 584/0
           118 | 0x000b ProcessingSoftware        |    SSHORT |        2 |         0 | 0 0
           130 | 0x000f ISOSelection              |     ASCII |        8 |       592 | AUTO   
           142 | 0x0010 DataDump                  | UNDEFINED |     3342 |       600 | ...............1.0.......#b6#... ...
           154 | 0x0011 GPSImgDirection           |      LONG |        1 |      4632 | 4632
           166 | 0x001a GPSDestDistance           |     ASCII |       40 |      3942 |                    .             ...
           178 | 0x0021                           | UNDEFINED |      106 |      3982 | ............................... ...
           190 | 0x0022                           |     SHORT |        1 |         0 | 0
           202 | 0x0026                           |     SHORT |       18 |      4088 | 256 0 0 0 0 ...
           214 | 0x0027                           |     SHORT |        7 |      4124 | 256 320 240 0 0 ...
           226 | 0x0029                           |     SHORT |        2 |         0 | 0 0
           238 | 0x002d                           |     SHORT |        2 |       256 | 256 0
           250 | 0x002e                           |     SHORT |        1 |         0 | 0
           262 | 0x002f                           |     SHORT |        1 |         0 | 0
           274 | 0x0030                           |     SHORT |        1 |         0 | 0
           286 | 0x0080 ImageAdjustment           |     ASCII |       14 |      4138 | NORMAL       
           298 | 0x0081                           |     ASCII |       10 |      4152 | NORMAL  .
           310 | 0x0082 AuxiliaryLens             |     ASCII |       14 |      4162 | OFF          
           322 | 0x0085 FocusDistance             |  RATIONAL |        1 |      4176 | 4176/0
           334 | 0x0086 DigitalZoom               |  RATIONAL |        1 |      4184 | 4184/0
           346 | 0x0088 AFFocusPos                | UNDEFINED |        4 |       768 | ...
           358 | 0x008f                           |     ASCII |       16 |      4192 |                
           370 | 0x0091                           | UNDEFINED |      225 |      4208 | ...DTVR................g.d..... ...
           382 | 0x0094                           |    SSHORT |        1 |         0 | 0
           394 | 0x0095                           |     ASCII |        6 |      4434 | OFF  
           406 | 0x009b                           |      BYTE |        2 |         0 | .
           418 | 0x009c                           |     ASCII |       20 |      4440 |                    
           430 | 0x009d                           |     SHORT |        1 |         0 | 0
           442 | 0x009e                           |     SHORT |       10 |      4460 | 0 0 0 0 0 ...
           454 | 0x00a8                           | UNDEFINED |       46 |      4480 | 0104.B......................... ...
           466 | 0x00aa                           |     ASCII |       16 |      4526 | NORMAL         
           478 | 0x00ac                           |     ASCII |       14 |      4542 | VR-ON       .
           490 | 0x00b2                           |     ASCII |       10 |      4556 | NORMAL  .
           502 | 0x00b3                           |     ASCII |        8 |      4566 |        
           514 | 0x00bd                           | UNDEFINED |       58 |      4574 | 0100STANDARD   .........STANDARD ...
      END MemIo
         462 | 0x9286 UserComment               | UNDEFINED |      126 |       782 | ........                         ...
         474 | 0xa000 FlashpixVersion           | UNDEFINED |        4 | 808464688 | 0100
         486 | 0xa001 ColorSpace                |     SHORT |        1 |         1 | 1
         498 | 0xa002 PixelXDimension           |     SHORT |        1 |      3648 | 3648
         510 | 0xa003 PixelYDimension           |     SHORT |        1 |      2736 | 2736
         522 | 0xa005 InteroperabilityTag       |      LONG |        1 |      1010 | 1010
         534 | 0xa300 FileSource                | UNDEFINED |        1 |         3 | .
         546 | 0xa301 SceneType                 | UNDEFINED |        1 |         1 | .
         558 | 0xa401 CustomRendered            |     SHORT |        1 |         0 | 0
         570 | 0xa402 ExposureMode              |     SHORT |        1 |         0 | 0
         582 | 0xa403 WhiteBalance              |     SHORT |        1 |         0 | 0
         594 | 0xa404 DigitalZoomRatio          |  RATIONAL |        1 |       908 | 908/0
         606 | 0xa405 FocalLengthIn35mmFilm     |     SHORT |        1 |        28 | 28
         618 | 0xa406 SceneCaptureType          |     SHORT |        1 |         0 | 0
         630 | 0xa407 GainControl               |     SHORT |        1 |         0 | 0
         642 | 0xa408 Contrast                  |     SHORT |        1 |         0 | 0
         654 | 0xa409 Saturation                |     SHORT |        1 |         0 | 0
         666 | 0xa40a Sharpness                 |     SHORT |        1 |         0 | 0
         678 | 0xa40c SubjectDistanceRange      |     SHORT |        1 |         0 | 0
    END MemIo
       918 | 0x0103 Compression               |     SHORT |        1 |         6 | 6
       930 | 0x011a XResolution               |  RATIONAL |        1 |       994 | 994/0
       942 | 0x011b YResolution               |  RATIONAL |        1 |      1002 | 1002/0
       954 | 0x0128 ResolutionUnit            |     SHORT |        1 |         2 | 2
       966 | 0x0201 JPEGInterchangeFormat     |      LONG |        1 |      8692 | 8692
       978 | 0x0202 JPEGInterchangeFormatLeng |      LONG |        1 |      6044 | 6044
  END MemIo
  XMP  |     4155 |   470608 | &lt;?xpacket begin="..." id="W5M0Mp
STRUCTURE OF WEBP FILE: /Users/rmills/Downloads/Nikon D1X.webp
 Chunk |   Length |   Offset | Payload
  RIFF |    19936 |        0 | WEBP
  VP8X |       10 |       12 | ....W....
  VP8  |    16128 |       30 | .c...*X...&gt;.D.J...$..+p...g:.7..
  EXIF |     3770 |    16166 | II*........... ................
  STRUCTURE OF TIFF FILE (II): MemIo
   address |    tag                           |      type |    count |    offset | value
        10 | 0x010e ImageDescription          |     ASCII |       32 |       170 |                                
        22 | 0x010f Make                      |     ASCII |       18 |       202 | NIKON CORPORATION
        34 | 0x0110 Model                     |     ASCII |       10 |       220 | NIKON D1X
        46 | 0x011a XResolution               |  RATIONAL |        1 |       230 | 230/0
        58 | 0x011b YResolution               |  RATIONAL |        1 |       238 | 238/0
        70 | 0x0128 ResolutionUnit            |     SHORT |        1 |         2 | 2
        82 | 0x0131 Software                  |     ASCII |       10 |       246 | Ver.5.01 
        94 | 0x0132 DateTime                  |     ASCII |       20 |       256 | 2003:08:06 18:04:34
       106 | 0x0213 YCbCrPositioning          |     SHORT |        1 |         2 | 2
       118 | 0x0214 ReferenceBlackWhite       |  RATIONAL |        6 |       276 | 0/0 1/0 255/0 1/0 128/0 ...
       130 | 0x8298 Copyright                 |     ASCII |       33 |       324 | Copyright,                       ...
       142 | 0x8769 ExifTag                   |      LONG |        1 |       358 | 358
    STRUCTURE OF TIFF FILE (II): MemIo
     address |    tag                           |      type |    count |    offset | value
         360 | 0x829a ExposureTime              |  RATIONAL |        1 |       872 | 872/0
         372 | 0x829d FNumber                   |  RATIONAL |        1 |       880 | 880/0
         384 | 0x8822 ExposureProgram           |     SHORT |        1 |         2 | 2
         396 | 0x9000 ExifVersion               | UNDEFINED |        4 | 808596016 | 0220
         408 | 0x9003 DateTimeOriginal          |     ASCII |       20 |       808 | 2003:08:06 18:04:34
         420 | 0x9004 DateTimeDigitized         |     ASCII |       20 |       828 | 2003:08:06 18:04:34
         432 | 0x9101 ComponentsConfiguration   | UNDEFINED |        4 |    197121 | ...
         444 | 0x9204 ExposureBiasValue         | SRATIONAL |        1 |       848 | 848/0
         456 | 0x9205 MaxApertureValue          |  RATIONAL |        1 |       856 | 856/0
         468 | 0x9207 MeteringMode              |     SHORT |        1 |         5 | 5
         480 | 0x9208 LightSource               |     SHORT |        1 |         4 | 4
         492 | 0x9209 Flash                     |     SHORT |        1 |         7 | 7
         504 | 0x920a FocalLength               |  RATIONAL |        1 |       864 | 864/0
         516 | 0x927c MakerNote                 | UNDEFINED |     2787 |       888 | Nikon.....II*...............0200 ...
      STRUCTURE OF TIFF FILE (II): MemIo
       address |    tag                           |      type |    count |    offset | value
            10 | 0x0001 Version                   | UNDEFINED |        4 | 808464944 | 0200
            22 | 0x0002 ISOSpeed                  |     SHORT |        2 |  13107200 | 0 200
            34 | 0x0003 ColorMode                 |     ASCII |        6 |       386 | COLOR
            46 | 0x0004 Quality                   |     ASCII |        8 |       392 | RAW    
            58 | 0x0005 WhiteBalance              |     ASCII |       13 |       400 | FLASH       
            70 | 0x0006 Sharpening                |     ASCII |        7 |       414 | NONE  
            82 | 0x0007 Focus                     |     ASCII |        7 |       422 | AF-S  
            94 | 0x0008 FlashSetting              |     ASCII |       13 |       430 | NORMAL      
           106 | 0x0009 GPSStatus                 |     ASCII |        9 |       444 | NEW_TTL 
           118 | 0x000b ProcessingSoftware        |    SSHORT |        1 |         0 | 0
           130 | 0x000c GPSSpeedRef               |  RATIONAL |        4 |       454 | 15673/3582 57600/1525 26513/17 16960/15
           142 | 0x000d GPSSpeed                  | UNDEFINED |        4 |    196864 | ...
           154 | 0x000e GPSTrackRef               | UNDEFINED |        4 |    786688 | ...
           166 | 0x0011 GPSImgDirection           |      LONG |        1 |      2781 | 2781
           178 | 0x0081                           |     ASCII |        7 |       486 | NORMAL
           190 | 0x0083                           |      BYTE |        1 |         2 | .
           202 | 0x0084                           |  RATIONAL |        4 |       494 | 17/0 1/0 35/0 1/0
           214 | 0x0087                           |      BYTE |        1 |         3 | .
           226 | 0x0088 AFFocusPos                | UNDEFINED |        4 |     65537 | ...
           238 | 0x0089                           |      BYTE |        1 |         1 | .
           250 | 0x008b                           | UNDEFINED |        4 |    786760 | H..
           262 | 0x008c                           | UNDEFINED |     2112 |       526 | ............................... ...
           274 | 0x008d                           |     ASCII |        9 |      2638 | MODE2   
           286 | 0x008e                           | SRATIONAL |        4 |      2648 | 27885/840 57600/1525 34979/65455 57600/1525
           298 | 0x0090                           |     ASCII |       12 |      2680 | SPEEDLIGHT 
           310 | 0x0091                           | UNDEFINED |       53 |      2692 | 0100....%6... .....F...........4 ...
           322 | 0x0092                           |    SSHORT |        1 |         3 | 3
           334 | 0x0098                           | UNDEFINED |       20 |      2745 | 0100w\cH+D$$h.$.5.Q
           346 | 0x0099                           |     SHORT |        2 |  43386846 | 2014 662
           358 | 0x009a                           |  RATIONAL |        2 |      2765 | 59/0 10/0
           370 | 0x0e10                           |      LONG |        1 |      2875 | 2875
      END MemIo
         528 | 0x9286 UserComment               | UNDEFINED |       48 |      3676 | ............................... ...
         540 | 0x9290 SubSecTime                |     ASCII |        3 |     12598 | 61
         552 | 0x9291 SubSecTimeOriginal        |     ASCII |        3 |     12598 | 61
         564 | 0x9292 SubSecTimeDigitized       |     ASCII |        3 |     12598 | 61
         576 | 0xa000 FlashpixVersion           | UNDEFINED |        4 | 808464688 | 0100
         588 | 0xa001 ColorSpace                |     SHORT |        1 |         1 | 1
         600 | 0xa002 PixelXDimension           |      LONG |        1 |       600 | 600
         612 | 0xa003 PixelYDimension           |      LONG |        1 |       391 | 391
         624 | 0xa217 SensingMethod             |     SHORT |        1 |         2 | 2
         636 | 0xa300 FileSource                | UNDEFINED |        1 |         3 | .
         648 | 0xa301 SceneType                 | UNDEFINED |        1 |         1 | .
         660 | 0xa302 CFAPattern                | UNDEFINED |        8 |      3724 | .......
         672 | 0xa401 CustomRendered            |     SHORT |        1 |         0 | 0
         684 | 0xa402 ExposureMode              |     SHORT |        1 |         0 | 0
         696 | 0xa403 WhiteBalance              |     SHORT |        1 |         1 | 1
         708 | 0xa404 DigitalZoomRatio          |  RATIONAL |        1 |      3732 | 3732/0
         720 | 0xa405 FocalLengthIn35mmFilm     |     SHORT |        1 |        25 | 25
         732 | 0xa406 SceneCaptureType          |     SHORT |        1 |         0 | 0
         744 | 0xa407 GainControl               |     SHORT |        1 |         0 | 0
         756 | 0xa408 Contrast                  |     SHORT |        1 |         0 | 0
         768 | 0xa409 Saturation                |     SHORT |        1 |         0 | 0
         780 | 0xa40a Sharpness                 |     SHORT |        1 |         1 | 1
         792 | 0xa40c SubjectDistanceRange      |     SHORT |        1 |         0 | 0
    END MemIo
       154 | 0x8825 GPSTag                    |      LONG |        1 |      3740 | 3740
  END MemIo
888 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre></div>
    </div>
  </div>
  
  <div id="change-5285" class="journal has-notes">
    <div id="note-51">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-51" class="journal-link">#51</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="11 Aug 2016 19:19" href="/projects/exiv2/activity?from=2016-08-11">over 5 years</a> ago
      <span id="journal-5285-private_notes" class=""></span>
    </h4>

    <div id="journal-5285-notes" class="wiki"><p>Gotcha and nice :)</p>


	<p>Good luck on that other matter. I'll be updating the decodeChunk function shortly i think i have all the kinks out now. Doing one last pass before committing the code in.</p></div>
    </div>
  </div>
  
  <div id="change-5286" class="journal has-notes">
    <div id="note-52">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-52" class="journal-link">#52</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="11 Aug 2016 19:24" href="/projects/exiv2/activity?from=2016-08-11">over 5 years</a> ago
      <span id="journal-5286-private_notes" class=""></span>
    </h4>

    <div id="journal-5286-notes" class="wiki"><p>Never worry about making mistakes and checking in code that's not right.  The whole point of our test harness is to detect that.  Of course, we haven't got any tests for your stuff yet, however nobody knows it's there anyway.  And we're on the trunk which is a development branch.  I try to keep it stable so that it will always build and pass our test suite.</p>


	<p>I've drawn a blank on <a class="issue tracker-1 status-2 priority-4 priority-default" title="Bug: Exif.CanonCs.FocusContinuous reported as Short (Assigned)" href="/issues/1203">#1203</a>.  I'll deal with it in v0.27 next year.  I closed <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Exif.CanonCs.FocusContinuous = 8 = Manual (Closed)" href="/issues/1202">#1202</a> today and printStructure() is working.  A good day.</p></div>
    </div>
  </div>
  
  <div id="change-5287" class="journal has-notes">
    <div id="note-53">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-53" class="journal-link">#53</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="11 Aug 2016 19:33" href="/projects/exiv2/activity?from=2016-08-11">over 5 years</a> ago
      <span id="journal-5287-private_notes" class=""></span>
    </h4>

    <div id="journal-5287-notes" class="wiki"><p>Just read the for <a class="issue tracker-1 status-2 priority-4 priority-default" title="Bug: Exif.CanonCs.FocusContinuous reported as Short (Assigned)" href="/issues/1203">#1203</a>, yep sounds a like a good one. As for the commits i'm not too worried but i prefer to do the work to fix stuff (if possible) before shipping it :)</p>


	<p>I cleaned up a bunch of stuff while i was in there fix it. Oh and created a hexdump function that probably should go elsewhere in the but we can discuss that in chat. Prints two 8 byte wide hex sections and the ascii dump to the right of that. I needed that instead of opening the hex editor every two seconds to get the proper info from some of the chunks. Anyways it'll be in this commit.</p></div>
    </div>
  </div>
  
  <div id="change-5294" class="journal has-notes">
    <div id="note-54">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-54" class="journal-link">#54</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="12 Aug 2016 09:38" href="/projects/exiv2/activity?from=2016-08-12">over 5 years</a> ago
      <span id="journal-5294-private_notes" class=""></span>
    </h4>

    <div id="journal-5294-notes" class="wiki"><p>This looks fine, Ben.  A couple of suggestions:</p>


	<p><strong>1 Move the hexDump code to the Internal namespace</strong></p>


	<p>We'll find a good use for this elsewhere in the code. Much as I have done for Internal::binaryToString().  I suggest a signature such as:<pre>std::string Internal::binaryToHex(const byte*,size_t);</pre></p>


	<p><strong>2 I'm surprised that you can parse Stonehenge3.webp</strong></p>


	<p>Is this what you refer to as a "long" header?  I have my doubts that Stonehenge3.webp is a valid file.  The EXIF data in a JPEG is stored in an APP1 segment and it's a 100% valid TIFF file. I think the WebP EXIF Chunk is a valid TIFF file (although it has no image). You can extract the TIFF with the utility dd (dastardly dangerous).  dd is one of the most feared tools in Linux.<pre>900 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pS ~/Stonehenge2.webp 
STRUCTURE OF WEBP FILE: /Users/rmills/Stonehenge2.webp
 Chunk |   Length |   Offset | Payload
  RIFF |  1954376 |        0 | WEBP
  VP8X |       10 |       12 | ....o....
  VP8  |  1936470 |       30 | .....*p...&gt;.D.I..#$(.*p...gn..d.
  EXIF |    15280 |  1936508 | II*............................
  XMP  |     2579 |  1951796 | &lt;?xpacket begin="..." id="W5M0Mp
901 rmills@rmillsmbp:~/gnu/exiv2/trunk $ dd bs=1 skip=$((1936508+8)) count=15280 if=~/Stonehenge2.webp of=Stonehenge2.tiff
15280+0 records in
15280+0 records out
15280 bytes transferred in 0.055026 secs (277688 bytes/sec)
902 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pR Stonehenge2.tiff 
STRUCTURE OF TIFF FILE (II): Stonehenge2.tiff
 address |    tag                           |      type |    count |    offset | value
      10 | 0x010f Make                      |     ASCII |       18 |       146 | NIKON CORPORATION
      22 | 0x0110 Model                     |     ASCII |       12 |       164 | NIKON D5300
...
    4410 | 0x0213 YCbCrPositioning          |     SHORT |        1 |         1 | 1
END Stonehenge2.tiff
903 rmills@rmillsmbp:~/gnu/exiv2/trunk $</pre>The following command fails miserably:<pre>904 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pR ~/Stonehenge3.webp 
STRUCTURE OF WEBP FILE: /Users/rmills/Stonehenge3.webp
 Chunk |   Length |   Offset | Payload
  RIFF |  1972496 |        0 | WEBP
  VP8X |       10 |       12 | ....o....
  VP8  |  1936470 |       30 | .....*p...&gt;.D.I..#$(.*p...gn..d.
  EXIF |    17989 |  1936508 | ..Exiv2..;.Exif..II*............
  STRUCTURE OF TIFF FILE (??): MemIo
  END MemIo
  XMP  |    17989 |  1954506 | ..Exiv2..;.Exif..II*............
905 rmills@rmillsmbp:~/gnu/exiv2/trunk</pre>I could fix that of course.  However I don't think I should fix it.  Stonehenge3.webp has an embedded .exv file in the EXIF Chunk.  I don't think that's valid use of the EXIF Chunk in WebP. <pre>905 rmills@rmillsmbp:~/gnu/exiv2/trunk $ dd bs=1 skip=$((1936508+8)) count=17989 if=~/Stonehenge3.webp of=Stonehenge3.exv
17989+0 records in
17989+0 records out
17989 bytes transferred in 0.053564 secs (335841 bytes/sec)
906 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pR Stonehenge3.exv 
STRUCTURE OF JPEG FILE: Stonehenge3.exv
 address | marker     | length  | data
       2 | 0x01       |       0 
       9 | 0xe1 APP1  |   15296 | Exif..II*......................
  STRUCTURE OF TIFF FILE (II): MemIo
   address |    tag                           |      type |    count |    offset | value
        10 | 0x010f Make                      |     ASCII |       18 |       146 | NIKON CORPORATION
        22 | 0x0110 Model                     |     ASCII |       12 |       164 | NIKON D5300
...
      4394 | 0x0201 JPEGInterchangeFormat     |      LONG |        1 |      4450 | 4450
      4406 | 0x0202 JPEGInterchangeFormatLeng |      LONG |        1 |     10837 | 10837
      4418 | 0x0213 YCbCrPositioning          |     SHORT |        1 |         1 | 1
  END MemIo
   15307 | 0xe1 APP1  |    2610 | http://ns.adobe.com/xap/1.0/.&lt;?x
   17919 | 0xed APP13 |      68 | Photoshop 3.0.8BIM.......'.....
  Record | DataSet | Name                     | Length | Data
       1 |       0 | ModelVersion             |      2 | ..
       1 |      90 | CharacterSet             |      3 | .%G
       2 |       0 | RecordVersion            |      2 | ..
       2 |     120 | Caption                  |     12 | Classic View
   17989 | 0xd9 EOI  907 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre><strong>3 File Type Recognition</strong></p>


	<p>Exiv2 doesn't use the file extension to recognise a file type.  It 'sniffs' inside the file.  The ImageFactory has an array of filesTypes.  He opens the file an calls the registered sniffer.  For WebP it's isWebPType.  If you say "I'm good with this", you handle it. The file extension is irrelevant.<pre>907 rmills@rmillsmbp:~/gnu/exiv2/trunk $ grep isWebPType src/*.cpp
src/image.cpp:        { ImageType::webp, newWebPInstance, isWebPType, amReadWrite, amNone,      amReadWrite, amNone      },
src/webpimage.cpp:        if (!isWebPType(*io_, true)) {
src/webpimage.cpp:        if (!isWebPType(*io_, true)) {
src/webpimage.cpp:    bool isWebPType(BasicIo&#38; iIo, bool /*advance*/)
908 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre><strong>4 I'm going to do my chores today</strong></p>


	<p>I've got a load of stuff to get done around the house and garden.  Alison is painting.  If I spend all day on the computer, she might throw it out the window.  I'll be checking email and Redmine - so please ask if I can help you in some way.</p>


	<p>I've spent about half my working life as the project leader and folks often say something like "I don't want to disturb you.  You might get mad if I waste your time!".  And my response is usually.  "You are never disturbing me.  I will get mad if I discover that your wheels are spinning and you didn't ask for help.  If your wheels are spinning for more than 2 hours, I want to know about it!"</p></div>
    </div>
  </div>
  
  <div id="change-5295" class="journal has-notes">
    <div id="note-55">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-55" class="journal-link">#55</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="12 Aug 2016 09:58" href="/projects/exiv2/activity?from=2016-08-12">over 5 years</a> ago
      <span id="journal-5295-private_notes" class=""></span>
    </h4>

    <div id="journal-5295-notes" class="wiki"><p>1- indeed i'll see what i can come up with.</p>


	<p>2- hahaha, i use dd a lot, though for some tasks i now use pv when copying data as it gives me a progress bar. As for decoding i made it so it was more resilient with various forms of data i tried since the encoder (webpmux) doesn't care whats going in there i try to validate and preformat the data before feeding it to the exif decoder. That way it has a better chance of pulling out something useful. I could just let it fail though :)</p>


	<p>3- Not sure what you mean here, i already have isWebPType sniffing the header to make sure its valid.</p>


	<p>4- Sounds like a good idea :) and yeah that was a tough one early in my career, sadly some places and managers don't see it that way, you should already be an all knowing robot :/  Reminds me of this video i saw onj youtube last year, reminded me of quite a few meetings i was in on ... <a class="external" href="https://www.youtube.com/watch?v=BKorP55Aqvg">https://www.youtube.com/watch?v=BKorP55Aqvg</a></p></div>
    </div>
  </div>
  
  <div id="change-5296" class="journal has-notes">
    <div id="note-56">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-56" class="journal-link">#56</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="12 Aug 2016 10:27" href="/projects/exiv2/activity?from=2016-08-12">over 5 years</a> ago
      <span id="journal-5296-private_notes" class=""></span>
    </h4>

    <div id="journal-5296-notes" class="wiki"><p>Your WebP file sniffer is working perfectly.  I was explaining how it worked and if you already knew that, well that's fine.</p>


	<p>The webpmux bastardo.  I'll have to look at him.  If he's generating horrible files, we should handle them.  However if the file is bad, we should reject it.  Exiv2 philosophy: we report/modify/write perfect files.  We don't forgive deviation from the standard - that's a very slippery slope.</p>


	<p>The video is a hoot.  I have a nightmare a couple of times every week about being back at work and being asked to do impossible things (like drawing red lines with blue ink).  No matter how I try to negotiate, I cannot get the stakeholders to change the request.</p>


	<p>The other nightmare is that when the project is done, the boss redefines the finish line with something new.  For example, when I finish the new kitchen, the boss says "well, that's kind of OK, however you know that the bathroom is more important.  Why has the bathroom not been done and you know it must be finished for guests arriving on Sunday!  You don't know about the guests because you were so busy on the stupid kitchen that you didn't attend the meeting where we discussed the guests.  Your communication skills need a lot of work."</p>


	<p>I never miss work.  I've got Exiv2 to keep my software skills alive.  I love my wife and we're very happy to be working together to make our house perfect.  Life is good - never been happier.</p></div>
    </div>
  </div>
  
  <div id="change-5297" class="journal has-notes">
    <div id="note-57">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-57" class="journal-link">#57</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="12 Aug 2016 10:37" href="/projects/exiv2/activity?from=2016-08-12">over 5 years</a> ago
      <span id="journal-5297-private_notes" class=""></span>
    </h4>

    <div id="journal-5297-notes" class="wiki"><p>Ah ok i did know, figured it out after looking it the other file types when i started. Was momentarily confused, i blame it on not ingesting the "Coffee" before answering :)</p>


	<p>Wepbmux just stuffs whatever it gets told to put in there i don't think they do any validation from the quick test i've done (actually just look at what it let through for the XMP chunk in Stonehenge3.webp for another example). When i encode the exif not sure i've got it just right, though it works now, it feels off.</p>


	<p>I used to have similar dreams after my last official job. When saw that video the first i both laughed and cringed having been in similar situations.</p>


	<p>Yeah its good to have projects, keeps the mind active and skills sharp. I'm glad for you and that's a good thing you get along with the 'boss' so well :)</p></div>
    </div>
  </div>
  
  <div id="change-5305" class="journal has-notes">
    <div id="note-58">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-58" class="journal-link">#58</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="13 Aug 2016 02:24" href="/projects/exiv2/activity?from=2016-08-13">over 5 years</a> ago
      <span id="journal-5305-private_notes" class=""></span>
    </h4>

    <div id="journal-5305-notes" class="wiki"><p>Just enabled the iptc handling and fixed the warnings in stringToHex.</p></div>
    </div>
  </div>
  
  <div id="change-5306" class="journal has-notes">
    <div id="note-59">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-59" class="journal-link">#59</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="13 Aug 2016 02:27" href="/projects/exiv2/activity?from=2016-08-13">over 5 years</a> ago
      <span id="journal-5306-private_notes" class=""></span>
    </h4>

    <div id="journal-5306-notes" class="wiki"><p>Wondering if i should enable copying the exif data to xmp?</p></div>
    </div>
  </div>
  
  <div id="change-5311" class="journal has-notes">
    <div id="note-60">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-60" class="journal-link">#60</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="13 Aug 2016 09:21" href="/projects/exiv2/activity?from=2016-08-13">over 5 years</a> ago
      <span id="journal-5311-private_notes" class=""></span>
    </h4>

    <div id="journal-5311-notes" class="wiki"><p>I think you should ask Alan about this exif/xmp stuff.  If we do that for jpg and tiff, we should do it for webp.</p>


	<p>There are a couple of features of Exiv2 that I wish had never been added to the code base:  Lens Recognition and conversion functions.  The reason I dislike these features is that the metadata is "cooked up" by the code and not in the file itself.  Both are troublesome.  Lens Recognition is probably 50% of the issues reported in Redmine.  Because of my background in compilers/interpreters, I never try to guess what the code being compiled might mean.  If it's a syntax violation, I signal an error and leave the human to deal with it.</p></div>
    </div>
  </div>
  
  <div id="change-5315" class="journal has-notes">
    <div id="note-61">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-61" class="journal-link">#61</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="13 Aug 2016 10:41" href="/projects/exiv2/activity?from=2016-08-13">over 5 years</a> ago
      <span id="journal-5315-private_notes" class=""></span>
    </h4>

    <div id="journal-5315-notes" class="wiki"><p>I'll double check whats done there and ask if its not clear.</p>


	<p>Is there somewhere, or resource i could read up on lens recognition (aside from the code lol)?  I know that past versions of Photoshop also had issues with one of my lenses when doing lens correction in Camera Raw. I'd have to try it with a recent version of it.</p>


	<p>I just dislike messy warnings of any kind, i find it irritating, not that i always correct them but yeah :)</p></div>
    </div>
  </div>
  
  <div id="change-5316" class="journal has-notes">
    <div id="note-62">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-62" class="journal-link">#62</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="13 Aug 2016 11:23" href="/projects/exiv2/activity?from=2016-08-13">over 5 years</a> ago
      <span id="journal-5316-private_notes" class=""></span>
    </h4>

    <div id="journal-5316-notes" class="wiki"><p>There's not much to the Lens Recognition.  It's easy to understand. The manufacturer is meant to set a unique LensId in the metadata<pre>938 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pa --grep LensID/i ~/Stonehenge.jpg 
Exif.NikonLd3.LensIDNumber                   Byte        1  Sigma 18-250mm F3.5-6.3 DC OS Macro HSM
939 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pv --grep LensID/i ~/Stonehenge.jpg 
0x000c NikonLd3     LensIDNumber                Byte        1  146
940 rmills@rmillsmbp:~/gnu/exiv2/trunk $</pre>There are two horrible consequences:</p>


	<p>1) Every manufacturer uses a different way to store this.  For Nikon, it's Exif.NikonLd3.LensIDNumber, Sony it's Exif.Sony1.LensID<br />2) Often, the same ID is used for several different lenses, so we need to inspect the other metadata to guess what lens is being used.<pre>945 rmills@rmillsmbp:~/gnu/exiv2/trunk $ hex 146
146 = 0x92
946 rmills@rmillsmbp:~/gnu/exiv2/trunk $ grep 92 src/nikonmn.cpp 
        TagInfo(0x0092, "HueAdjustment", N_("Hue Adjustment"), N_("Hue adjustment"), nikon3Id, makerTags, signedShort, -1, printValue),
{0x8C,0x40,0x2D,0x53,0x2C,0x3C,0x8E,0x06,0x01,0x00,0x00, "Nikon", "JAA792DA", "AF-S DX Zoom-Nikkor 18-55mm f/3.5-5.6G ED"},
{0x90,0x3B,0x53,0x80,0x30,0x3C,0x92,0x0E,0x01,0x00,0x00, "Nikon", "JAA798DA", "AF-S DX VR Zoom-Nikkor 55-200mm f/4-5.6G IF-ED"},
{0x92,0x48,0x24,0x37,0x24,0x24,0x94,0x06,0x01,0x00,0x00, "Nikon", "JAA801DA", "AF-S Zoom-Nikkor 14-24mm f/2.8G ED"},
{0x92,0x39,0x2D,0x88,0x2C,0x40,0x4B,0x0E,0x01,0x00,0x00, "Sigma", "", "18-250mm F3.5-6.3 DC OS Macro HSM"},
947 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>The maintenance of  non-unique lensIDs is very troublesome.  Anybody using Exiv2 who goes and buys a nice new lens is very likely to discover that we don't know about it.  They raise an issue on Redmine.</p>


	<p>For v0.26, we have a great new feature.  The user has a "config" file ~/.exiv2 which can be updated on his machine.  <a class="external" href="http://dev.exiv2.org/issues/1034">http://dev.exiv2.org/issues/1034</a></p>


	<p>I don't think we use those copy/convertor.cpp functions for other image types, so lets not use them in webp.<pre>952 rmills@rmillsmbp:~/gnu/exiv2/trunk $ grep copyIptcToXmp src/*.cpp
src/convert.cpp:    void copyIptcToXmp(const IptcData&#38; iptcData, XmpData&#38; xmpData, const char *iptcCharset)
src/webpimage.cpp:            copyIptcToXmp(iptcData_, xmpData_);
src/xmpsidecar.cpp:            copyIptcToXmp(iptcData_, xmpData_);
953 rmills@rmillsmbp:~/gnu/exiv2/trunk $ grep copyExifToXmp src/*.cpp
src/convert.cpp:    void copyExifToXmp(const ExifData&#38; exifData, XmpData&#38; xmpData)
src/xmpsidecar.cpp:            copyExifToXmp(exifData_, xmpData_);
954 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>Write, I think we're almost ready to start on the test code.  I've got some stuff to do in the garden today.  I can talk later on Skype (after 17:00/12:00) and explain it to you.</p></div>
    </div>
  </div>
  
  <div id="change-5317" class="journal has-notes">
    <div id="note-63">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-63" class="journal-link">#63</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="13 Aug 2016 11:29" href="/projects/exiv2/activity?from=2016-08-13">over 5 years</a> ago
      <span id="journal-5317-private_notes" class=""></span>
    </h4>

    <div id="journal-5317-notes" class="wiki"><p>Indeed, guess you'd have to inspect focal lengths as well to guesstimate it.</p>


	<p>Sounds good, hopefully no interruptions like yesterday on my end :)</p></div>
    </div>
  </div>
  
  <div id="change-5324" class="journal has-details">
    <div id="note-64">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-64" class="journal-link">#64</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="13 Aug 2016 14:57" href="/projects/exiv2/activity?from=2016-08-13">over 5 years</a> ago
      <span id="journal-5324-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/1033">Stonehenge-with-icc.webp</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/1033/Stonehenge-with-icc.webp">Stonehenge-with-icc.webp</a> added</li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-5325" class="journal has-notes">
    <div id="note-65">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-65" class="journal-link">#65</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/76">Gilles Caulier</a> <a title="13 Aug 2016 15:12" href="/projects/exiv2/activity?from=2016-08-13">over 5 years</a> ago
      <span id="journal-5325-private_notes" class=""></span>
    </h4>

    <div id="journal-5325-notes" class="wiki"><p>Next week i will start to implement the digiKam WebP image loader based on libwebp. I will able to test your Exiv2 WebP handler in real...</p></div>
    </div>
  </div>
  
  <div id="change-5346" class="journal has-notes">
    <div id="note-66">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-66" class="journal-link">#66</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="14 Aug 2016 14:03" href="/projects/exiv2/activity?from=2016-08-14">over 5 years</a> ago
      <span id="journal-5346-private_notes" class=""></span>
    </h4>

    <div id="journal-5346-notes" class="wiki"><p>@Gilles: Sweet. So far it works with the implementation of the GIMP plugin for WebP.</p></div>
    </div>
  </div>
  
  <div id="change-5347" class="journal has-notes">
    <div id="note-67">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-67" class="journal-link">#67</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="14 Aug 2016 14:04" href="/projects/exiv2/activity?from=2016-08-14">over 5 years</a> ago
      <span id="journal-5347-private_notes" class=""></span>
    </h4>

    <div id="journal-5347-notes" class="wiki"><p>@Gilles: I forgot to add that the code is in file-webp under plugins in the gimp git repo.</p></div>
    </div>
  </div>
  
  <div id="change-5355" class="journal has-notes has-details">
    <div id="note-68">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-68" class="journal-link">#68</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Aug 2016 22:36" href="/projects/exiv2/activity?from=2016-08-14">over 5 years</a> ago
      <span id="journal-5355-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Assignee</strong> changed from <i>Robin Mills</i> to <i>Ben Touchette</i></li>
       <li><strong>% Done</strong> changed from <i>50</i> to <i>60</i></li>
       <li><strong>Estimated time</strong> changed from <i>15.00 h</i> to <i>50.00 h</i></li>
    </ul>
    <div id="journal-5355-notes" class="wiki"><p>Ben</p>


	<p>I'm going to assign this issue to you because you're doing to hard work to make this happen.  When the release notes for v0.26 are prepared you will rightfully be given the credit for bringing this feature to life.  You've done a great job.  Thanks very much.  I'll continue to support you with this.  I'll probably add the erase code on Monday to implement -dtgt where txt = { a , e , i , x, c, C }.</p></div>
    </div>
  </div>
  
  <div id="change-5356" class="journal has-notes">
    <div id="note-69">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-69" class="journal-link">#69</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="14 Aug 2016 23:30" href="/projects/exiv2/activity?from=2016-08-14">over 5 years</a> ago
      <span id="journal-5356-private_notes" class=""></span>
    </h4>

    <div id="journal-5356-notes" class="wiki"><p>@Robin: :) sounds fine, I'm glad i could help, and thanks for saying. I already tested the i,e, and x cases for deleting (-d option) that was my last patch before i spent most of the day trying to debrick the router. Fun times <strong>cough</strong> with serial interfaces/cables, tftp, and router innards lol. I believe it is very much muerte though :/</p></div>
    </div>
  </div>
  
  <div id="change-5361" class="journal has-notes">
    <div id="note-70">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-70" class="journal-link">#70</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/360">Thomas Beutlich</a> <a title="15 Aug 2016 19:42" href="/projects/exiv2/activity?from=2016-08-15">over 5 years</a> ago
      <span id="journal-5361-private_notes" class=""></span>
    </h4>

    <div id="journal-5361-notes" class="wiki"><p>This is just a reminder to not forget updating exiv2.1 on the new WEBP file format. Thanks!</p></div>
    </div>
  </div>
  
  <div id="change-5362" class="journal has-notes">
    <div id="note-71">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-71" class="journal-link">#71</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/76">Gilles Caulier</a> <a title="16 Aug 2016 22:18" href="/projects/exiv2/activity?from=2016-08-16">over 5 years</a> ago
      <span id="journal-5362-private_notes" class=""></span>
    </h4>

    <div id="journal-5362-notes" class="wiki"><p>digiKam 5.2.0 now support WebP image format in read write .<br />Tested with current implementation from Exiv2. Sound working fine for the moment.<br /><a class="external" href="https://www.flickr.com/photos/digikam/29032567885/">https://www.flickr.com/photos/digikam/29032567885/</a></p></div>
    </div>
  </div>
  
  <div id="change-5363" class="journal has-notes">
    <div id="note-72">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-72" class="journal-link">#72</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="16 Aug 2016 22:23" href="/projects/exiv2/activity?from=2016-08-16">over 5 years</a> ago
      <span id="journal-5363-private_notes" class=""></span>
    </h4>

    <div id="journal-5363-notes" class="wiki"><p>@Gilles Nice. I'm trying to catch up on everything right now.</p></div>
    </div>
  </div>
  
  <div id="change-5365" class="journal has-notes">
    <div id="note-73">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-73" class="journal-link">#73</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="17 Aug 2016 10:50" href="/projects/exiv2/activity?from=2016-08-17">over 5 years</a> ago
      <span id="journal-5365-private_notes" class=""></span>
    </h4>

    <div id="journal-5365-notes" class="wiki"><p>@Thomas: Not sure what you there?</p></div>
    </div>
  </div>
  
  <div id="change-5366" class="journal has-notes">
    <div id="note-74">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-74" class="journal-link">#74</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="17 Aug 2016 10:56" href="/projects/exiv2/activity?from=2016-08-17">over 5 years</a> ago
      <span id="journal-5366-private_notes" class=""></span>
    </h4>

    <div id="journal-5366-notes" class="wiki"><p>lol second try.</p>


	<p>@Thomas: Not sure what you mean there?</p></div>
    </div>
  </div>
  
  <div id="change-5367" class="journal has-notes">
    <div id="note-75">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-75" class="journal-link">#75</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/360">Thomas Beutlich</a> <a title="17 Aug 2016 11:39" href="/projects/exiv2/activity?from=2016-08-17">over 5 years</a> ago
      <span id="journal-5367-private_notes" class=""></span>
    </h4>

    <div id="journal-5367-notes" class="wiki"><p>I noticed that <a class="source" href="/projects/exiv2/repository/exiv2/entry/trunk/src/exiv2.1">source:trunk/src/exiv2.1</a> contains the list of supported file formats which serves as the Wiki base. This file needs to be updated to consider new WEBP support.</p></div>
    </div>
  </div>
  
  <div id="change-5368" class="journal has-notes">
    <div id="note-76">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-76" class="journal-link">#76</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="17 Aug 2016 12:39" href="/projects/exiv2/activity?from=2016-08-17">over 5 years</a> ago
      <span id="journal-5368-private_notes" class=""></span>
    </h4>

    <div id="journal-5368-notes" class="wiki"><p>Thanks for explain, will add that.</p></div>
    </div>
  </div>
  
  <div id="change-5369" class="journal has-notes">
    <div id="note-77">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-77" class="journal-link">#77</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="17 Aug 2016 12:44" href="/projects/exiv2/activity?from=2016-08-17">over 5 years</a> ago
      <span id="journal-5369-private_notes" class=""></span>
    </h4>

    <div id="journal-5369-notes" class="wiki"><p>@Thomas done :)</p></div>
    </div>
  </div>
  
  <div id="change-5370" class="journal has-notes">
    <div id="note-78">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-78" class="journal-link">#78</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="17 Aug 2016 13:42" href="/projects/exiv2/activity?from=2016-08-17">over 5 years</a> ago
      <span id="journal-5370-private_notes" class=""></span>
    </h4>

    <div id="journal-5370-notes" class="wiki"><p>Started the process of updating the wiki to add webp information.</p></div>
    </div>
  </div>
  
  <div id="change-5371" class="journal has-notes">
    <div id="note-79">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-79" class="journal-link">#79</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="17 Aug 2016 19:57" href="/projects/exiv2/activity?from=2016-08-17">over 5 years</a> ago
      <span id="journal-5371-private_notes" class=""></span>
    </h4>

    <div id="journal-5371-notes" class="wiki"><p>I don't believe the EXIF chunk in test/data/exiv2-bug1199.webp is valid.  It think it should be a TIFF.  I've based this believe on the EXIF in this file:<pre>1199 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pS ~/Downloads/Nikon\ D1X.webp 
STRUCTURE OF WEBP FILE: /Users/rmills/Downloads/Nikon D1X.webp
 Chunk |   Length |   Offset | Payload
  RIFF |    19936 |        0 | WEBP
  VP8X |       10 |       12 | ....W....
  VP8  |    16128 |       30 | .c...*X...&gt;.D.J...$..+p...g:.7..
  EXIF |     3770 |    16166 | II*........... ................
1200 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>The data in the current file is:<pre>1156 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pS 1199.webp 
STRUCTURE OF WEBP FILE: 1199.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   187536 |        0 | WEBP
  VP8X |       10 |       12 | ,........
  ICCP |      560 |       30 | ...0ADBE....mntrRGB XYZ ........
  VP8  |   172008 |      598 | .G...*.. .&gt;1..B.!..o.. ......]..
  EXIF |    12050 |   172614 | ../.Exif..II*..................
  XMP  |     2864 |   184672 | &lt;?xpacket begin="..." id="W5M0Mp</pre>I believe the EXIF chunk has 10 bytes which should not be there.</p>


	<p>I've extracted the metadata, shortened the EXIF chunk and reassembled the file as follows: <pre>$ cp test/data/exiv2-bug1199.webp 1199.webp
$ webpmux -get icc 1199.webp -o 1199.icc
$ webpmux -get exif 1199.webp -o 1199.exif
$ webpmux -get xmp 1199.webp -o 1199.xmp
$ dd bs=1 count=$((12050-10)) skip=10 if=1199.exif &gt; 1199.tiff
$ webpmux -set exif 1199.tiff 1199.webp -o 1199-1.webp
$ webpmux -set icc 1199.icc 1199-1.webp -o 1199-2.webp
$ webpmux -set xmp 1199.xmp 1199-2.webp -o 1199-3.webp
$ cp 1199-3.webp test/data/exiv2-bug1199.webp </pre>The modified file test/data/exiv2-bug1199.webp is now 10 bytes shorter.  I've updated the test suite appropriately.  I've updated the Wiki/WEBP page <a class="external" href="http://dev.exiv2.org/projects/exiv2/wiki/The_Metadata_in_WEBP_files">http://dev.exiv2.org/projects/exiv2/wiki/The_Metadata_in_WEBP_files</a></p>


<pre>1200 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pS test/data/exiv2-bug1199.webp 
STRUCTURE OF WEBP FILE: test/data/exiv2-bug1199.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   187526 |        0 | WEBP
  VP8X |       10 |       12 | ,........
  ICCP |      560 |       30 | ...0ADBE....mntrRGB XYZ ........
  VP8  |   172008 |      598 | .G...*.. .&gt;1..B.!..o.. ......]..
  EXIF |    12040 |   172614 | II*........................... .
  XMP  |     2864 |   184662 | &lt;?xpacket begin="..." id="W5M0Mp
1201 rmills@rmillsmbp:~/gnu/exiv2/trunk $</pre></div>
    </div>
  </div>
  
  <div id="change-5377" class="journal has-notes">
    <div id="note-80">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-80" class="journal-link">#80</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="18 Aug 2016 10:29" href="/projects/exiv2/activity?from=2016-08-18">over 5 years</a> ago
      <span id="journal-5377-private_notes" class=""></span>
    </h4>

    <div id="journal-5377-notes" class="wiki"><p>You may be right i just ran cwebp with all metadata conversion on Stonehenge.jpg and it has the same format, so i guess i'll adjust accordingly.</p></div>
    </div>
  </div>
  
  <div id="change-5378" class="journal has-notes has-details">
    <div id="note-81">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-81" class="journal-link">#81</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="18 Aug 2016 10:51" href="/projects/exiv2/activity?from=2016-08-18">over 5 years</a> ago
      <span id="journal-5378-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/1037">Stonehenge-with-icc-exif-xmp.webp</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/1037/Stonehenge-with-icc-exif-xmp.webp">Stonehenge-with-icc-exif-xmp.webp</a> added</li>
    </ul>
    <div id="journal-5378-notes" class="wiki"><p>Changed it to remove the header padding. Should produce correct exif data now. Attaching new test image.</p></div>
    </div>
  </div>
  
  <div id="change-5379" class="journal has-notes">
    <div id="note-82">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-82" class="journal-link">#82</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="18 Aug 2016 11:10" href="/projects/exiv2/activity?from=2016-08-18">over 5 years</a> ago
      <span id="journal-5379-private_notes" class=""></span>
    </h4>

    <div id="journal-5379-notes" class="wiki"><p>This looks better.  Comparing three files:<pre>606 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pS ~/Downloads/Stonehenge-with-icc.webp 
STRUCTURE OF WEBP FILE: /Users/rmills/Downloads/Stonehenge-with-icc.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   187536 |        0 | WEBP
  VP8X |       10 |       12 | ,........
  ICCP |      560 |       30 | ...0ADBE....mntrRGB XYZ ........
  VP8  |   172008 |      598 | .G...*.. .&gt;1..B.!..o.. ......]..
  EXIF |    12050 |   172614 | ../.Exif..II*..................
  XMP  |     2864 |   184672 | &lt;?xpacket begin="..." id="W5M0Mp
607 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pS ~/Downloads/Stonehenge-with-icc-exif-xmp.webp 
STRUCTURE OF WEBP FILE: /Users/rmills/Downloads/Stonehenge-with-icc-exif-xmp.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   180990 |        0 | WEBP
  VP8X |       10 |       12 | ,........
  ICCP |      560 |       30 | ...0ADBE....mntrRGB XYZ ........
  VP8  |   165706 |      598 | .....*.. .&gt;1..B.! ...yX@..gn.E..
  EXIF |    12068 |   166312 | II*........................... .
  XMP  |     2602 |   178388 | &lt;?xpacket begin="..." id="W5M0Mp
608 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pS test/data/exiv2-bug1199.webp 
STRUCTURE OF WEBP FILE: test/data/exiv2-bug1199.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   187526 |        0 | WEBP
  VP8X |       10 |       12 | ,........
  ICCP |      560 |       30 | ...0ADBE....mntrRGB XYZ ........
  VP8  |   172008 |      598 | .G...*.. .&gt;1..B.!..o.. ......]..
  EXIF |    12040 |   172614 | II*........................... .
  XMP  |     2864 |   184662 | &lt;?xpacket begin="..." id="W5M0Mp
609 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>The new file looks correctly formatted with the TIFF in the EXIF chunk.  Oddly, the XMP and EXIF chunks are different.  Dumping and comparing the metadata reveals:<pre>609 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pa ~/Downloads/Stonehenge-with-icc-exif-xmp.webp | sort &gt; new.txt
610 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pa  test/data/exiv2-bug1199.webp | sort &gt; test.txt
611 rmills@rmillsmbp:~/gnu/exiv2/trunk $ diff test.txt new.txt 
13c13
&lt; Exif.Image.DateTime                          Ascii      20  2016:08:13 10:54:16
---
&gt; Exif.Image.DateTime                          Ascii      20  2016:08:18 06:50:07
168c168
&lt; Exif.Thumbnail.JPEGInterchangeFormatLength   Long        1  6861
---
&gt; Exif.Thumbnail.JPEGInterchangeFormatLength   Long        1  6889
171,172d170
&lt; Iptc.Application2.Byline                     String     11  Robin Mills
&lt; Iptc.Application2.BylineTitle                String     10  Stonehenge
174d171
&lt; Iptc.Application2.ObjectName                 String     10  Stonehenge
612 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>I think your new file is fine.  I will not change test/data/exiv2-bug1199.webp at this time as I believe it is already working perfectly.  Your new file contains slightly different metadata, however there's nothing substantially different.</p>


	<p>I know that exiv2 -dC test/data/exiv2-bug1199.webp isn't working.  I will fix that today.</p></div>
    </div>
  </div>
  
  <div id="change-5380" class="journal has-notes">
    <div id="note-83">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-83" class="journal-link">#83</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="18 Aug 2016 11:15" href="/projects/exiv2/activity?from=2016-08-18">over 5 years</a> ago
      <span id="journal-5380-private_notes" class=""></span>
    </h4>

    <div id="journal-5380-notes" class="wiki"><p>The difference is probably due to my removing the iptc conversion code to/from xmp. After a fitful night, decided to remove it, apps should handle that themselves and seeing as Google didn't included iptc support in the spec at this time i guess you were right</p></div>
    </div>
  </div>
  
  <div id="change-5381" class="journal has-notes">
    <div id="note-84">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-84" class="journal-link">#84</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="18 Aug 2016 19:20" href="/projects/exiv2/activity?from=2016-08-18">over 5 years</a> ago
      <span id="journal-5381-private_notes" class=""></span>
    </h4>

    <div id="journal-5381-notes" class="wiki"><p>Getting (error 32) "Setting IPTC metadata in WebP images is not supported" when doing exiv2 -i X test.webp (with file test.xml in the same directory) to insert an xml file.</p></div>
    </div>
  </div>
  
  <div id="change-5382" class="journal has-notes has-details">
    <div id="note-85">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-85" class="journal-link">#85</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="18 Aug 2016 20:22" href="/projects/exiv2/activity?from=2016-08-18">over 5 years</a> ago
      <span id="journal-5382-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>60</i> to <i>70</i></li>
    </ul>
    <div id="journal-5382-notes" class="wiki"><p><a class="changeset" title="#1199  Fixing exiv2 -dC image-path to delete ICC profile." href="/projects/exiv2/repository/exiv2/revisions/4409">r4409</a>.  I've fixed the code for exiv2 -dC image-path in WebPImage::writeMetadata().  Please review.</p>


	<p>There a bug in -de (delete Exif).  It appears to be deleting EXIF and ICCP.</p>


	<p>The following is fine (delete ICC Profile):<pre>726 rmills@rmillsmbp:~/gnu/exiv2/trunk $ cp test/data/exiv2-bug1199.webp 1199.webp
727 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pS 1199.webp
STRUCTURE OF WEBP FILE: 1199.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   187526 |        0 | WEBP
  VP8X |       10 |       12 | ,........
  ICCP |      560 |       30 | ...0ADBE....mntrRGB XYZ ........
  VP8  |   172008 |      598 | .G...*.. .&gt;1..B.!..o.. ......]..
  EXIF |    12040 |   172614 | II*........................... .
  XMP  |     2864 |   184662 | &lt;?xpacket begin="..." id="W5M0Mp
728 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 --verbose -dC 1199.webp 
File 1/1: 1199.webp
Erasing ICC Profile data from the file
729 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pS 1199.webp
STRUCTURE OF WEBP FILE: 1199.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   186958 |        0 | WEBP
  VP8X |       10 |       12 | .........
  VP8  |   172008 |       30 | .G...*.. .&gt;1..B.!..o.. ......]..
  EXIF |    12040 |   172046 | II*........................... .
  XMP  |     2864 |   184094 | &lt;?xpacket begin="..." id="W5M0Mp
730 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>The following is fine (delete XMP)<pre>730 rmills@rmillsmbp:~/gnu/exiv2/trunk $ cp test/data/exiv2-bug1199.webp 1199.webp
731 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pS 1199.webp
STRUCTURE OF WEBP FILE: 1199.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   187526 |        0 | WEBP
  VP8X |       10 |       12 | ,........
  ICCP |      560 |       30 | ...0ADBE....mntrRGB XYZ ........
  VP8  |   172008 |      598 | .G...*.. .&gt;1..B.!..o.. ......]..
  EXIF |    12040 |   172614 | II*........................... .
  XMP  |     2864 |   184662 | &lt;?xpacket begin="..." id="W5M0Mp
732 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 --verbose -dx 1199.webp 
File 1/1: 1199.webp
Erasing XMP data from the file
733 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pS 1199.webp
STRUCTURE OF WEBP FILE: 1199.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   184094 |        0 | WEBP
  VP8X |       10 |       12 | (........
  VP8  |   172008 |       30 | .G...*.. .&gt;1..B.!..o.. ......]..
  EXIF |    12040 |   172046 | II*........................... .
734 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>Deleting EXIF also deletes ICC:<pre>747 rmills@rmillsmbp:~/gnu/exiv2/trunk $ cp test/data/exiv2-bug1199.webp 1199.webp
748 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pS 1199.webp
STRUCTURE OF WEBP FILE: 1199.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   187526 |        0 | WEBP
  VP8X |       10 |       12 | ,........
  ICCP |      560 |       30 | ...0ADBE....mntrRGB XYZ ........
  VP8  |   172008 |      598 | .G...*.. .&gt;1..B.!..o.. ......]..
  EXIF |    12040 |   172614 | II*........................... .
  XMP  |     2864 |   184662 | &lt;?xpacket begin="..." id="W5M0Mp
749 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 --verbose -de 1199.webp
File 1/1: 1199.webp
Erasing Exif data from the file
750 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pS 1199.webp
STRUCTURE OF WEBP FILE: 1199.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   174918 |        0 | WEBP
  VP8X |       10 |       12 | $........
  VP8  |   172008 |       30 | .G...*.. .&gt;1..B.!..o.. ......]..
  XMP  |     2864 |   172046 | &lt;?xpacket begin="..." id="W5M0Mp
751 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>Can you investigate this, please.  If you don't fix it, I'll deal with it on Friday.</p>


	<p>I will add tests to the test suite on Friday for -dC -dx -de</p></div>
    </div>
  </div>
  
  <div id="change-5383" class="journal has-notes">
    <div id="note-86">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-86" class="journal-link">#86</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="18 Aug 2016 22:11" href="/projects/exiv2/activity?from=2016-08-18">over 5 years</a> ago
      <span id="journal-5383-private_notes" class=""></span>
    </h4>

    <div id="journal-5383-notes" class="wiki"><p>I fixed -de and -dc will commit them in a bit.</p></div>
    </div>
  </div>
  
  <div id="change-5384" class="journal has-notes">
    <div id="note-87">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-87" class="journal-link">#87</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="19 Aug 2016 00:55" href="/projects/exiv2/activity?from=2016-08-19">over 5 years</a> ago
      <span id="journal-5384-private_notes" class=""></span>
    </h4>

    <div id="journal-5384-notes" class="wiki"><p>Committed the updates and added inserting icc profiles as well to the commit.</p></div>
    </div>
  </div>
  
  <div id="change-5394" class="journal has-notes">
    <div id="note-88">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-88" class="journal-link">#88</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="19 Aug 2016 19:15" href="/projects/exiv2/activity?from=2016-08-19">over 5 years</a> ago
      <span id="journal-5394-private_notes" class=""></span>
    </h4>

    <div id="journal-5394-notes" class="wiki"><p>Ben</p>


	<p>Right.  I've submitted some fixes. <a class="changeset" title="#1199 Test suite changes and associate fixes to the code." href="/projects/exiv2/repository/exiv2/revisions/4416">r4416</a></p>


	<p>Testing always seems like a good idea to me.  Here's the status:</p>


	<p><strong>1 Refactored bugfixes-test.sh into webp-test.sh</strong></p>


	<p>You can run "our tests" with <strong><code>$ make webp-test</code></strong> and you don't to wait for the suite to grind through all the bugs</p>


	<p><strong>2 Issues with actions.cpp/actions.hpp</strong></p>


	<p>I've made some changes to this.  There are two options for inserting XMP -ix and -iX:</p>


	<p>a) <strong><code>$ exiv2 -iX foo.xxx</code></strong><br />- this reads foo.xmp (which must be XML) and copies it into the foo.xxx</p>


	<p>b) <strong><code>$ exiv2 -ix foo.xxx</code></strong>  (not working correctly, discussion below)<br />- this reads foo.exv and updates the XMP in foo.xxx with the XMP from foo.exv<br />- you can create foo.exv with <strong><code> $ exiv2 --force --verbose -ea foo.xxx</code></strong></p>


	<p>c) <strong><code>$ cat foo.xmp | exiv2 -ix- foo.xxx</code></strong> (probably not working at all)<br />- the reads something from stdin and puts it somewhere<br />- we should get this to "sniff" the data in stdin<br />- this is off topic.  Please don't spend time on this.  I'll fix this soon.</p>


	<p><strong>3 Changes to webpimage.cpp</strong></p>


	<p>Have a look.  Nothing major.  Ask if you want me to explain any of the changes.</p>


	<p><strong>4 Moving forward</strong></p>


	<p>I'm a bit lost with this.  If you'd like to investigate with the debugger.  Or I'll fix it tomorrow.<pre>1069 rmills@rmillsmbp:~/gnu/exiv2/trunk $ cp test/data/exiv2-bug1199.webp 1199.webp ; cp test/data/Reagan.tiff . ; exiv2 -ea --force Reagan.tiff ; mv Reagan.exv 1199.exf ; exiv2 -pS 1199.webp ; exiv2 -ix 1199.webp ; exiv2 -pS 1199.webp 
STRUCTURE OF WEBP FILE: 1199.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   187526 |        0 | WEBP
  VP8X |       10 |       12 | ,........
  ICCP |      560 |       30 | ...0ADBE....mntrRGB XYZ ........
  VP8  |   172008 |      598 | .G...*.. .&gt;1..B.!..o.. ......]..
  EXIF |    12040 |   172614 | II*........................... .
  XMP  |     2864 |   184662 | &lt;?xpacket begin="..." id="W5M0Mp
STRUCTURE OF WEBP FILE: 1199.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   187241 |        0 | WEBP
  P8X
 | 738197504 |       13 | .........ICCP0......0ADBE....mnt   &lt;--- YIKES
1070 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre></p></div>
    </div>
  </div>
  
  <div id="change-5396" class="journal has-notes">
    <div id="note-89">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-89" class="journal-link">#89</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="19 Aug 2016 19:30" href="/projects/exiv2/activity?from=2016-08-19">over 5 years</a> ago
      <span id="journal-5396-private_notes" class=""></span>
    </h4>

    <div id="journal-5396-notes" class="wiki"><p>1 - sweet, still need to figure that damned library issue i mentioned.<br />2ab - so many combinations i haven't explored yet :)<br />2c - does exiv2 validate xml?<br />4- I had that happening yesterday after your changes, the recast when writing data seemed to have been failing and basically wasn't writing anything so the offsets were wrong due to the chunk not having any data that it said it had. Probably something bad along those lines here, will give a once over.</p></div>
    </div>
  </div>
  
  <div id="change-5398" class="journal has-notes">
    <div id="note-90">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-90" class="journal-link">#90</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="19 Aug 2016 19:46" href="/projects/exiv2/activity?from=2016-08-19">over 5 years</a> ago
      <span id="journal-5398-private_notes" class=""></span>
    </h4>

    <div id="journal-5398-notes" class="wiki"><p>The exiv2 utility is a feature rich thing.  At the moment, I don't validate XMP, and perhaps I never will.  If you want to put any load of binary code into the XMP storage location, I don't see any reason to prevent you!</p>


	<p>There's definitely something not nice happening in WebPImage::writeMetadata().  We'll find it.  We'll fix it.  No question about it.</p>


	<p>I'm rather happy to be working on this.  It's brought me back to exploring this <del>ix -iX -iX</del> <del>ix</del> calculus.  For sure I want to get all that magic functioning correctly for v0.26 and properly tested in the test suite.</p>


	<p>I'm not surprised by the time that this is taking.  I wanted to defer this to v0.27 and focus on getting v0.26 out the door.  We'll get this fixed <em><strong>AND</strong></em> we'll get v0.26 finished.  However, I know that very soon I will get an email from somebody saying "why isn't v0.26 finished yet?".  I might not get paid, however there are many folks using Exiv2.  One of them will be urgently waiting for one of the new features in v0.26.</p></div>
    </div>
  </div>
  
  <div id="change-5399" class="journal has-notes">
    <div id="note-91">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-91" class="journal-link">#91</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="19 Aug 2016 19:52" href="/projects/exiv2/activity?from=2016-08-19">over 5 years</a> ago
      <span id="journal-5399-private_notes" class=""></span>
    </h4>

    <div id="journal-5399-notes" class="wiki"><p>Indeed an intricate weave of functionality so of course there's lots of plumbing to work on lol.</p>


	<p>I hear ya on the time-frame. People get funny about that even when it's freely given. At the time when i first submitted the patch i didn't realize that or the level of intricacy hidden behind exiv2, i figured at the time it was just going to be another quick hi/bye thanks for the code situation, i guess learned differently :)</p></div>
    </div>
  </div>
  
  <div id="change-5400" class="journal has-notes">
    <div id="note-92">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-92" class="journal-link">#92</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="19 Aug 2016 20:11" href="/projects/exiv2/activity?from=2016-08-19">over 5 years</a> ago
      <span id="journal-5400-private_notes" class=""></span>
    </h4>

    <div id="journal-5400-notes" class="wiki"><p>Wish i could fix it. Seems to work on my end :</p>


	<p>cp test/data/exiv2-bug1199.webp 1199.webp ; cp test/data/Reagan.tiff . ; exiv2 -ea --force Reagan.tiff ; mv Reagan.exv 1199.exf ; exiv2 -pS 1199.webp ; exiv2 -ix 1199.webp ; exiv2 -pS 1199.webp <br />STRUCTURE OF WEBP FILE: 1199.webp<br /> Chunk |   Length |   Offset | Payload<br />  RIFF |   187526 |        0 | WEBP<br />  VP8X |       10 |       12 | ,........<br />  ICCP |      560 |       30 | ...0ADBE....mntrRGB XYZ ........<br />  VP8  |   172008 |      598 | .G...*.. .>1..B.!..o.. ......]..<br />  EXIF |    12040 |   172614 | II*........................... .<br />  XMP  |     2864 |   184662 | <?xpacket begin="..." id="W5M0Mp<br />./1199.exv: Failed to open the file<br />STRUCTURE OF WEBP FILE: 1199.webp<br /> Chunk |   Length |   Offset | Payload<br />  RIFF |   187526 |        0 | WEBP<br />  VP8X |       10 |       12 | ,........<br />  ICCP |      560 |       30 | ...0ADBE....mntrRGB XYZ ........<br />  VP8  |   172008 |      598 | .G...*.. .>1..B.!..o.. ......]..<br />  EXIF |    12040 |   172614 | II*........................... .<br />  XMP  |     2864 |   184662 | <?xpacket begin="..." id="W5M0Mp</p>


	<p>i did an svn update, let me do a clean checkout and try again.</p></div>
    </div>
  </div>
  
  <div id="change-5401" class="journal has-notes">
    <div id="note-93">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-93" class="journal-link">#93</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="19 Aug 2016 20:13" href="/projects/exiv2/activity?from=2016-08-19">over 5 years</a> ago
      <span id="journal-5401-private_notes" class=""></span>
    </h4>

    <div id="journal-5401-notes" class="wiki"><p>Oops</p>


<pre>
cp test/data/exiv2-bug1199.webp 1199.webp ; cp test/data/Reagan.tiff . ; exiv2 -ea --force Reagan.tiff ; mv Reagan.exv 1199.exf ; exiv2 -pS 1199.webp ; exiv2 -ix 1199.webp ; exiv2 -pS 1199.webp 
STRUCTURE OF WEBP FILE: 1199.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   187526 |        0 | WEBP
  VP8X |       10 |       12 | ,........
  ICCP |      560 |       30 | ...0ADBE....mntrRGB XYZ ........
  VP8  |   172008 |      598 | .G...*.. .&gt;1..B.!..o.. ......]..
  EXIF |    12040 |   172614 | II*........................... .
  XMP  |     2864 |   184662 | &lt;?xpacket begin="..." id="W5M0Mp
./1199.exv: Failed to open the file
STRUCTURE OF WEBP FILE: 1199.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   187526 |        0 | WEBP
  VP8X |       10 |       12 | ,........
  ICCP |      560 |       30 | ...0ADBE....mntrRGB XYZ ........
  VP8  |   172008 |      598 | .G...*.. .&gt;1..B.!..o.. ......]..
  EXIF |    12040 |   172614 | II*........................... .
  XMP  |     2864 |   184662 | &lt;?xpacket begin="..." id="W5M0Mp

</pre></div>
    </div>
  </div>
  
  <div id="change-5402" class="journal has-notes">
    <div id="note-94">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-94" class="journal-link">#94</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="19 Aug 2016 21:43" href="/projects/exiv2/activity?from=2016-08-19">over 5 years</a> ago
      <span id="journal-5402-private_notes" class=""></span>
    </h4>

    <div id="journal-5402-notes" class="wiki"><p>Ok now able to reproduce it, there was a typo in the command stack up there :)</p></div>
    </div>
  </div>
  
  <div id="change-5403" class="journal has-notes">
    <div id="note-95">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-95" class="journal-link">#95</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="20 Aug 2016 00:34" href="/projects/exiv2/activity?from=2016-08-20">over 5 years</a> ago
      <span id="journal-5403-private_notes" class=""></span>
    </h4>

    <div id="journal-5403-notes" class="wiki"><p>Fixed #4, turns out there was no padding for odd sized chunks for the exif and xmp data. Added a check and output the extra padding character needed for those cases.</p></div>
    </div>
  </div>
  
  <div id="change-5404" class="journal has-notes">
    <div id="note-96">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-96" class="journal-link">#96</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="20 Aug 2016 00:38" href="/projects/exiv2/activity?from=2016-08-20">over 5 years</a> ago
      <span id="journal-5404-private_notes" class=""></span>
    </h4>

    <div id="journal-5404-notes" class="wiki"><p>It also still breaks on -iX when i tried:</p>


<pre>
rm *.webp *.tiff *.exv *.xmp *.icc ; cp test/data/exiv2-bug1199.webp 1199.webp ; cp test/data/Reagan.tiff . ; exiv2 -eX --force Reagan.tiff ; mv Reagan.xmp 1199.xmp ; exiv2 -pS 1199.webp ; exiv2 -iX 1199.webp ; exiv2 -pS 1199.webp 
STRUCTURE OF WEBP FILE: 1199.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   187526 |        0 | WEBP
  VP8X |       10 |       12 | ,........
  ICCP |      560 |       30 | ...0ADBE....mntrRGB XYZ ........
  VP8  |   172008 |      598 | .G...*.. .&gt;1..B.!..o.. ......]..
  EXIF |    12040 |   172614 | II*........................... .
  XMP  |     2864 |   184662 | &lt;?xpacket begin="..." id="W5M0Mp
size 189288
size 189289
STRUCTURE OF WEBP FILE: 1199.webp
 Chunk |   Length |   Offset | Payload
  RIFF |   189289 |        0 | WEBP
  P8X
 | 738197504 |       13 | .........ICCP0......0ADBE....mnt
</pre></div>
    </div>
  </div>
  
  <div id="change-5405" class="journal has-notes">
    <div id="note-97">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-97" class="journal-link">#97</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="20 Aug 2016 00:48" href="/projects/exiv2/activity?from=2016-08-20">over 5 years</a> ago
      <span id="journal-5405-private_notes" class=""></span>
    </h4>

    <div id="journal-5405-notes" class="wiki"><p>The size is wrong in the RIFF header vs actual file size. Will investigate further in the morning</p></div>
    </div>
  </div>
  
  <div id="change-5409" class="journal has-notes">
    <div id="note-98">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-98" class="journal-link">#98</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="20 Aug 2016 10:11" href="/projects/exiv2/activity?from=2016-08-20">over 5 years</a> ago
      <span id="journal-5409-private_notes" class=""></span>
    </h4>

    <div id="journal-5409-notes" class="wiki"><p>Loads of changes to deal with the padding byte.  Please review: <a class="changeset" title="#1199 Fix WebP printStructure(), readMetadata() and doWriteMetadata() to handle payload padding b..." href="/projects/exiv2/repository/exiv2/revisions/4418">r4418</a></p>


	<p>Comments:</p>


	<p><strong>1 TAG_SIZE</strong></p>


	<p>I've moved TAG_SIZE to include/exiv2/webpimage.hpp and initialised it in WebPImage::WebPImage().  Can you have a look at all those 4s in the code.</p>


	<p><strong>2 Height/Width</strong></p>


	<p>I'm puzzled by the code for decoding height and width.  There are 4's and 7's in the code.  3 byte littleEndians or something.  Can you put a comment in the code about this.  Perhaps you should say something about it in the Wiki:  <a class="external" href="http://dev.exiv2.org/projects/exiv2/wiki/The_Metadata_in_WEBP_files">http://dev.exiv2.org/projects/exiv2/wiki/The_Metadata_in_WEBP_files</a></p>


	<p><strong>3 Symbols for Bits in the header</strong></p>


	<p>I see there's some bit twiddling going on.  I think you're setting flags to say "I've got an ICCP" or something like that.  Can you give those values symbolic names using an enum in include/exiv2/webpimage.hpp.</p>


	<p><strong>4 Gotta be just about there now</strong></p>


	<p>a) Can you go over the code again, please.  I suspect we can remove about 200 lines by refactoring repeated code into functions.  For example when we write XMP and EXIF near line 365.</p>


	<p>b) I'm also bothered about testing io_->eof() and io->size().  I'd like to see us navigate the file using file size from the RIFF header.</p>


	<p>c) I personally never use 'break' except in switch/case.  'break' is a goto kind of thing.</p>


	<p><strong>5 What I'm going to do</strong></p>


	<p>a) Something broke yesterday in test/conversions.sh  Groan.  I'll investigate.</p>


	<p>b) I think I have Gilles' multithreading issue off my back <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: digiKam maintenance tool to synchronize files metadata and database crash in Exiv2 (re-entrancy i... (Closed)" href="/issues/1207">#1207</a></p>


	<p>c) I'll deal with stdin/stdout such as <strong><code>-iX-</code></strong> and the like.  It's related to this, however it's a different matter.</p></div>
    </div>
  </div>
  
  <div id="change-5411" class="journal has-notes">
    <div id="note-99">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-99" class="journal-link">#99</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="20 Aug 2016 10:19" href="/projects/exiv2/activity?from=2016-08-20">over 5 years</a> ago
      <span id="journal-5411-private_notes" class=""></span>
    </h4>

    <div id="journal-5411-notes" class="wiki"><p>1- noticed no problemo<br />2- I have to decode it from the chunks available and reinsert when creating a new VP8X chunk, unavoidable<br />3- Yes i can do<br />4a- I can double check <br />4b- No it needs to be done because we need the new size from the actual data we write back.<br />4c- Yeah to break out of a while loop you need to break;</p>


	<p>I noticed you removed a critical check at the end of the chunk reading code in writeMetaData and was in there because we need read and account for the damned padding character. Now it will break again on odd size chunks by not account for that byte.</p></div>
    </div>
  </div>
  
  <div id="change-5412" class="journal has-notes">
    <div id="note-100">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-100" class="journal-link">#100</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="20 Aug 2016 10:31" href="/projects/exiv2/activity?from=2016-08-20">over 5 years</a> ago
      <span id="journal-5412-private_notes" class=""></span>
    </h4>

    <div id="journal-5412-notes" class="wiki"><p>nevermind i saw what you did further up in the code.</p></div>
    </div>
  </div>
  
  <div id="change-5413" class="journal has-notes">
    <div id="note-101">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-101" class="journal-link">#101</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="20 Aug 2016 10:37" href="/projects/exiv2/activity?from=2016-08-20">over 5 years</a> ago
      <span id="journal-5413-private_notes" class=""></span>
    </h4>

    <div id="journal-5413-notes" class="wiki"><p>For the width &#38; heights unfortunately they encode it into 28 bits of 32bit field so there's lots of bit shifting to get the actual sizes.</p></div>
    </div>
  </div>
  
  <div id="change-5414" class="journal has-notes">
    <div id="note-102">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-102" class="journal-link">#102</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="20 Aug 2016 13:12" href="/projects/exiv2/activity?from=2016-08-20">over 5 years</a> ago
      <span id="journal-5414-private_notes" class=""></span>
    </h4>

    <div id="journal-5414-notes" class="wiki"><p>Updated, fixed and commented, all the tests run 100%.</p></div>
    </div>
  </div>
  
  <div id="change-5415" class="journal has-notes">
    <div id="note-103">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-103" class="journal-link">#103</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="20 Aug 2016 14:17" href="/projects/exiv2/activity?from=2016-08-20">over 5 years</a> ago
      <span id="journal-5415-private_notes" class=""></span>
    </h4>

    <div id="journal-5415-notes" class="wiki"><p>Some polishing - <a class="changeset" title="#1199 Spit&#39;n&#39;polish on the loops in printStructure(), metadataRead() and doWriteMetadata().  Adde..." href="/projects/exiv2/repository/exiv2/revisions/4421">r4421</a>.  Please review.  Apologies if I've accidentally broken your code.</p>


	<p>I think we're now "done" on this.  I believe we've successfully carried out our plan above:  <a class="external" href="http://dev.exiv2.org/issues/1199#note-12">http://dev.exiv2.org/issues/1199#note-12</a></p>


	<p>The code is beautiful.  I'm very pleased indeed with what has been done.  I'm sure we'll discover something in the weeks and months ahead.  Thank You very much indeed.  I'm going OpenHub to give you Kudos for a great job.</p></div>
    </div>
  </div>
  
  <div id="change-5416" class="journal has-details">
    <div id="note-104">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-104" class="journal-link">#104</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="20 Aug 2016 14:17" href="/projects/exiv2/activity?from=2016-08-20">over 5 years</a> ago
      <span id="journal-5416-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>70</i> to <i>80</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-5417" class="journal has-notes">
    <div id="note-105">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-105" class="journal-link">#105</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4722">Ben Touchette</a> <a title="20 Aug 2016 14:31" href="/projects/exiv2/activity?from=2016-08-20">over 5 years</a> ago
      <span id="journal-5417-private_notes" class=""></span>
    </h4>

    <div id="journal-5417-notes" class="wiki"><p>w00t :) i think a beer might be in order here :)</p></div>
    </div>
  </div>
  
  <div id="change-5455" class="journal has-notes has-details">
    <div id="note-106">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-106" class="journal-link">#106</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="25 Aug 2016 16:53" href="/projects/exiv2/activity?from=2016-08-25">about 5 years</a> ago
      <span id="journal-5455-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Closed</i></li>
       <li><strong>% Done</strong> changed from <i>80</i> to <i>100</i></li>
    </ul>
    <div id="journal-5455-notes" class="wiki"><p>Thanks very much for working on this, Ben.  I has been a pleasure to work with you.  I'm going to mark this "closed" as we head into feature complete on v0.26.</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/1199.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/1199.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
