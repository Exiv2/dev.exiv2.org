<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #602: Exiv2 generated TIFF incompatible with libtiff - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="MT/K65eU3C6VzJVuQP/yTggRWd/mQVjB3mSFnn3onzjTcmEE5e4QLsCoimL/KP59N4MNphei+XsjRBUWPtF4Vw==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #602: Exiv2 generated TIFF incompatible with libtiff" href="https://dev.exiv2.org/issues/602.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #602</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Exiv2 generated TIFF incompatible with libtiff</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/132">Udi Fuchs</a> <a title="12 Jan 2009 20:29" href="/projects/exiv2/activity?from=2009-01-12">almost 13 years</a> ago.
        Updated <a title="30 Mar 2009 06:13" href="/projects/exiv2/activity?from=2009-03-30">over 12 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value">-</div></div><div class="category attribute"><div class="label">Category:</div><div class="value">tools</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="02 Apr 2009" href="/versions/42">0.18.1</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">12 Jan 2009</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>It seems that embedding EXIF data in TIFF files causes libtiff to complain.</p>


	<p>The first attached TIFF file was created with the command-line:</p>


	<p>exiv2 in dsc_0113_exiv2.tif</p>


	<p>The exv file originated from a Nikon D70 NEF file, but I think the problem is general.</p>


	<p>Openning this file with any program based on libtiff (gimp, display, tifftopnm) fails with the error:</p>


	<p>TIFF directory is missing required "StripOffsets" field. `MissingRequired'.</p>


	<p>The second file was create with ufraw. This TIFF image opens fine but produces warnings:</p>


	<p>$ tifftopnm dsc_0113_ufraw.tif > dsc_0113_ufraw.pnm<br />TIFFReadDirectory: Warning, dsc_0113_ufraw.tif: invalid TIFF directory; tags are not sorted in ascending order.<br />TIFFReadDirectory: Warning, dsc_0113_ufraw.tif: unknown field with tag 11 (0xb) encountered.<br />TIFFReadDirectory: Warning, dsc_0113_ufraw.tif: unknown field with tag 36867 (0x9003) encountered.<br />TIFFReadDirectory: Warning, dsc_0113_ufraw.tif: unknown field with tag 37398 (0x9216) encountered.<br />tifftopnm: writing PPM file</p>


	<p>Udi</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/58">dsc_0113_exiv2.tif</a>    <span class="size">(34.8 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/58/dsc_0113_exiv2.tif">dsc_0113_exiv2.tif</a>  </td>
  <td>File created with exiv2 command-line</td>
  <td>
      <span class="author">Udi Fuchs, 12 Jan 2009 20:29</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/59">dsc_0113_ufraw.tif</a>    <span class="size">(24.8 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/59/dsc_0113_ufraw.tif">dsc_0113_ufraw.tif</a>  </td>
  <td>File created with ufraw</td>
  <td>
      <span class="author">Udi Fuchs, 12 Jan 2009 20:29</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/60">dsc_0113.tif</a>    <span class="size">(17.1 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/60/dsc_0113.tif">dsc_0113.tif</a>  </td>
  <td>Original TIFF file, generated with ufraw without EXIF data</td>
  <td>
      <span class="author">Udi Fuchs, 12 Jan 2009 21:41</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/61">dsc_0113.exv</a>    <span class="size">(34.8 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/61/dsc_0113.exv">dsc_0113.exv</a>  </td>
  <td>exv file generated with exiv2 ex from a NEF file</td>
  <td>
      <span class="author">Udi Fuchs, 12 Jan 2009 21:41</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>








</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 1759" href="/projects/exiv2/repository/exiv2/revisions/1759">Revision 1759</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/1759/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="07 Mar 2009 02:11" href="/projects/exiv2/activity?from=2009-03-07">over 12 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Exiv2 generated TIFF incompatible with libtiff (Closed)" href="/issues/602">#602</a>: Added specialized insert and delete code for TIFF-like target images.</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-1139" class="journal has-notes">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="12 Jan 2009 21:25" href="/projects/exiv2/activity?from=2009-01-12">almost 13 years</a> ago
      <span id="journal-1139-private_notes" class=""></span>
    </h4>

    <div id="journal-1139-notes" class="wiki"><p>$ exiv2 in dsc_0113_exiv2.tif</p>


	<p>where does the dsc_0113_exiv2.tif file come from, does it have a StripOffsets tag? Can you please provide this and the corresponding exv file so that I can run the above command here?</p></div>
    </div>
  </div>
  
  <div id="change-1140" class="journal has-notes has-details">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/132">Udi Fuchs</a> <a title="12 Jan 2009 21:41" href="/projects/exiv2/activity?from=2009-01-12">almost 13 years</a> ago
      <span id="journal-1140-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/60">dsc_0113.tif</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/60/dsc_0113.tif">dsc_0113.tif</a> added</li>
       <li><strong>File</strong> <a href="/attachments/61">dsc_0113.exv</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/61/dsc_0113.exv">dsc_0113.exv</a> added</li>
    </ul>
    <div id="journal-1140-notes" class="wiki"><p>Requested files added. The TIFF file I'm starting with was created with ufraw/libtiff without embedding EXIF data in it, and it opens fine in all programs.</p>


	<p>Udi</p></div>
    </div>
  </div>
  
  <div id="change-1141" class="journal has-notes">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="12 Jan 2009 23:27" href="/projects/exiv2/activity?from=2009-01-12">almost 13 years</a> ago
      <span id="journal-1141-private_notes" class=""></span>
    </h4>

    <div id="journal-1141-notes" class="wiki"><blockquote>

	<p>exiv2 in dsc_0113_exiv2.tif</p>


</blockquote>

	<p>The "exiv2 in" command seems to overwrite existing tags in the tif file, the result is essentially the exv file, there is definitely something wrong here.</p>


<blockquote>

	<p>$ tifftopnm dsc_0113_ufraw.tif > dsc_0113_ufraw.pnm<br />TIFFReadDirectory: Warning, dsc_0113_ufraw.tif: invalid TIFF directory; tags are not sorted in ascending order.</p>


</blockquote>

	<p>Looking at the exiv2 -pa output, the only issue I can see is that there are two Exif.Image.Orientation tags, which is not valid. Maybe that's the reason for this warning.</p>


	<p>(Exiv2 <em>does</em> sort tags in each directory when writing, except for makernote IFDs)</p>


<blockquote>

	<p>TIFFReadDirectory: Warning, dsc_0113_ufraw.tif: unknown field with tag 11 (0xb) encountered.<br />TIFFReadDirectory: Warning, dsc_0113_ufraw.tif: unknown field with tag 36867 (0x9003) encountered.<br />TIFFReadDirectory: Warning, dsc_0113_ufraw.tif: unknown field with tag 37398 (0x9216) encountered.</p>


</blockquote>

	<p>Yes, I can see these (Exif.Image) tags. The Exiv2 TIFF parser doesn't filter anything, if you don't want these, the application will have to suppress them.</p></div>
    </div>
  </div>
  
  <div id="change-1185" class="journal has-notes has-details">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="07 Mar 2009 02:17" href="/projects/exiv2/activity?from=2009-03-07">over 12 years</a> ago
      <span id="journal-1185-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Category</strong> set to <i>tools</i></li>
       <li><strong>Status</strong> changed from <i>New</i> to <i>Resolved</i></li>
       <li><strong>Target version</strong> set to <i>0.18.1</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
    </ul>
    <div id="journal-1185-notes" class="wiki"><p>The issue with the command line utility is fixed with <a class="changeset" title="#602: Added specialized insert and delete code for TIFF-like target images." href="/projects/exiv2/repository/exiv2/revisions/1759">r1759</a>. For TIFF-like target images, image and metadata are in the same TIFF structure and special care is required to determine which tags and IFDs should be treated as metadata and copied by the utility so that tags containing image information are not overwritten. The same applies for the remove action.</p></div>
    </div>
  </div>
  
  <div id="change-1206" class="journal has-details">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="30 Mar 2009 06:13" href="/projects/exiv2/activity?from=2009-03-30">over 12 years</a> ago
      <span id="journal-1206-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
    </ul>
    
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/602.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/602.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
