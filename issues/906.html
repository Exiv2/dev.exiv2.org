<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #906: Mountain Lion Plugin crashes when setxattr called - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="uptwMfJp08qWjv5KOX5U2MF+GgN3g6Z5b+t4XK8n47xY1tvegBMfysPq4UaGqVjr/uxOeoZgB8OSy+jU7B4E0w==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #906: Mountain Lion Plugin crashes when setxattr called" href="https://dev.exiv2.org/issues/906.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #906</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Mountain Lion Plugin crashes when setxattr called</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="10 Jun 2013 09:37" href="/projects/exiv2/activity?from=2013-06-10">over 8 years</a> ago.
        Updated <a title="25 Jul 2013 02:42" href="/projects/exiv2/activity?from=2013-07-25">over 8 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/119">Robin Mills</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">build</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="31 Jul 2013" href="/versions/50">0.24</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">10 Jun 2013</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-50"><tr><td style="width: 50%;" class="closed" title="50%"></td><td style="width: 50%;" class="todo"></td></tr></table><p class="percent">50%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value">4.00 h</div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>This has been reported by Yang Yang of Topaz Labs.</p>
  </div>
</div>






<hr />
<div id="relations">
<div class="contextual">
</div>

<p><strong>Related issues</strong></p>

<form data-cm-url="/issues/context_menu" action="/issues/906" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="1l9dw3ff9zuTJL15qzkBCt4/nuun9NMGS1L/UxFSbP00EvYsBaU7O8ZAonUU7g054a3KklYXcry2cm/bUmuLkg==" />
  <table class="list issues odd-even"><tr id="relation-96" class="issue hascontextmenu issue tracker-1 status-2 priority-4 priority-default"><td class="checkbox"><input type="checkbox" name="ids[]" value="910" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-1 status-2 priority-4 priority-default" href="/issues/910">Bug #910</a>: Bug #836 possibly reintroduced: writeMetadata() destroys resource fork on MacOS X for big files (&gt;1MB)</td><td class="status">Assigned</td><td class="start_date">25 Jul 2013</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-0"><tr><td style="width: 100%;" class="todo"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr></table>
</form>
<form class="new_relation" id="new-relation-form" style="display: none;" action="/issues/906/relations" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />


<p><select onchange="setPredecessorFieldsVisibility();" name="relation[relation_type]" id="relation_relation_type"><option selected="selected" value="relates">Related to</option>
<option value="duplicates">Is duplicate of</option>
<option value="duplicated">Has duplicate</option>
<option value="blocks">Blocks</option>
<option value="blocked">Blocked by</option>
<option value="precedes">Precedes</option>
<option value="follows">Follows</option>
<option value="copied_to">Copied to</option>
<option value="copied_from">Copied from</option></select>
Issue #<input size="10" type="text" name="relation[issue_to_id]" id="relation_issue_to_id" />
<span id="predecessor_fields" style="display:none;">
Delay: <input size="3" type="text" name="relation[delay]" id="relation_delay" /> days
</span>
<input type="submit" name="commit" value="Add" data-disable-with="Add" />
<a href="#" onclick="$(&quot;#new-relation-form&quot;).hide();; return false;">Cancel</a>
</p>

<script>
//<![CDATA[
observeAutocompleteField('relation_issue_to_id', '/issues/auto_complete?issue_id=906&project_id=exiv2&scope=all')
//]]>
</script>

<script>
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>
</div>

</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 3050" href="/projects/exiv2/repository/exiv2/revisions/3050">Revision 3050</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3050/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="10 Jun 2013 09:49" href="/projects/exiv2/activity?from=2013-06-10">over 8 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p>Issue: <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Mountain Lion Plugin crashes when setxattr called (Closed)" href="/issues/906">#906</a></p>
    </div>
    </div>
    <div class="changeset">
    <p><a title="Revision 3065" href="/projects/exiv2/repository/exiv2/revisions/3065">Revision 3065</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/3065/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="06 Jul 2013 22:16" href="/projects/exiv2/activity?from=2013-07-06">over 8 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p>Mac build <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Mountain Lion Plugin crashes when setxattr called (Closed)" href="/issues/906">#906</a>  fix compilation error (thanks to Tuan for this fix).</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-2488" class="journal has-notes">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="10 Jun 2013 09:45" href="/projects/exiv2/activity?from=2013-06-10">over 8 years</a> ago
      <span id="journal-2488-private_notes" class=""></span>
    </h4>

    <div id="journal-2488-notes" class="wiki"><p>I think it's clear that this is a fault being thrown by Mac's 'sandbox' feature which was introduced by Mountain Lion.  The 'sandbox' restricts system calls.  As our test suite passes, it would appear that Terminal applications are not 'sandboxed'.</p>


	<p>I believe we can dummy it to be effectivly void copyXattrFrom(const FileIo&#38;) { return ; }.<br />…</p>


	<p>#ifndef <i>APPLE</i><br />            if (::setxattr(path_.c_str(), name, value, valueSize, 0, 0) != 0) {<br />                throw Error(2, path_, strError(), "setxattr");<br />            }<br />#endif<br />…</p>


	<p><strong>What's xattr and how to work with it:</strong></p>


	<p>I've googled up a couple of pages about this<br /><a class="external" href="http://www.jetseven.org/2011/09/tiny-terminal-tip-xattr.html">http://www.jetseven.org/2011/09/tiny-terminal-tip-xattr.html</a><br /><a class="external" href="http://xahlee.info/comp/OS_X_extended_attributes_xattr.html">http://xahlee.info/comp/OS_X_extended_attributes_xattr.html</a></p>


	<p>I've applied an xattr to Volker's test files:<br /><pre>
$ cd &lt;exiv2dir&gt;/test/data
$ xattr -w -x aabbcc 2233445566 *.eps
$ ls -alt@ *.eps
….
-rw-r--r--@ 1 rmills  staff  1256239 Oct 19  2012 test/data/eps/eps-flat_coreldraw-x3-lev2.eps
    aabbcc          5 
564 rmills@rmills-imac:~/gnu/exiv2/test.build $ 
</pre></p>


	<p>I added a cout to copyXattrFrom to be certain it's being called:<br /><pre>
#ifdef DEBUG
            EXV_DEBUG &lt;&lt; "Copying xattr \"" &lt;&lt; name &lt;&lt; "\" with value size " &lt;&lt; valueSize &lt;&lt; "\n";
#endif
#ifndef __APPLE__
            if (::setxattr(path_.c_str(), name, value, valueSize, 0, 0) != 0) {
                throw Error(2, path_, strError(), "setxattr");
            }
#else
            std::cout &lt;&lt; "SETATTR" &lt;&lt; std::endl;
#endif

555 rmills@rmills-imac:~/gnu/exiv2/test.build $ make teste
cd test &#38;&#38; make teste
Running eps-test.sh ...
.............................................................................................................
Files /Users/rmills/gnu/exiv2/test.build/test/tmp/../data/eps/eps-test.out and /Users/rmills/gnu/exiv2/test.build/test/tmp/eps-test.out differ
--- /Users/rmills/gnu/exiv2/test.build/test/tmp/../data/eps/eps-test.out    2012-10-19 21:18:22.000000000 -0700
+++ /Users/rmills/gnu/exiv2/test.build/test/tmp/eps-test.out    2013-06-03 11:25:13.000000000 -0700
@@ -5,6 +5,7 @@
 Exit code: 253

 Command: exiv2 -dx eps-flat_coreldraw-x3-lev2.eps
+SETATTR
 Exit code: 0

 Command: exiv2 -f -ex eps-flat_coreldraw-x3-lev2.eps
@@ -16,6 +17,7 @@
 Exit code: 0

 Command: exiv2 -ix eps-flat_coreldraw-x3-lev2.eps
+SETATTR
 Exit code: 0

 Command: (2) exiv2 -ix eps-flat_coreldraw-x3-lev2.eps
make[1]: *** [teste] Error 1
make: *** [teste] Error 2
556 rmills@rmills-imac:~/gnu/exiv2/test.build $ 
</pre><br /><em><strong>Notice there is an exception coming from test/data/eps-test.out</strong></em><br /><pre>
560 rmills@rmills-imac:~/gnu/exiv2/test.build $ ls -alt@ test/tmp/eps-test.out 
-rw-r--r--+ 1 rmills  staff  427419 Jun  3 11:25 test/tmp/eps-test.out
561 rmills@rmills-imac:~/gnu/exiv2/test.build $ ls -alt@ test/data/eps/eps-test.out 
-rw-r--r--+ 1 rmills  staff  427403 Oct 19  2012 test/data/eps/eps-test.out
562 rmills@rmills-imac:~/gnu/exiv2/test.build $ 
</pre><br />Both have extended attributes and the second is shorter by 16 bytes.  However ls -alt@ didn't list anything.  I think he has an invisible string in his xattr. Volker's test is strong enough to detect this.  I think this exception is benign.</p></div>
    </div>
  </div>
  
  <div id="change-2490" class="journal has-notes">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="10 Jun 2013 09:53" href="/projects/exiv2/activity?from=2013-06-10">over 8 years</a> ago
      <span id="journal-2490-private_notes" class=""></span>
    </h4>

    <div id="journal-2490-notes" class="wiki"><p>Fix submitted: <a class="changeset" title="Issue: #906" href="/projects/exiv2/repository/exiv2/revisions/3050">r3050</a>.</p></div>
    </div>
  </div>
  
  <div id="change-2566" class="journal has-notes has-details">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="24 Jul 2013 15:48" href="/projects/exiv2/activity?from=2013-07-24">over 8 years</a> ago
      <span id="journal-2566-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Closed</i></li>
    </ul>
    <div id="journal-2566-notes" class="wiki"><p>I believe this is fixed in 0.24.  If you wish this issue to be reconsidered, please open a new issue on dev.exiv2.org and reference this report.</p></div>
    </div>
  </div>
  
  <div id="change-2594" class="journal has-notes">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/206">Volker Grabsch</a> <a title="25 Jul 2013 02:32" href="/projects/exiv2/activity?from=2013-07-25">over 8 years</a> ago
      <span id="journal-2594-private_notes" class=""></span>
    </h4>

    <div id="journal-2594-notes" class="wiki"><p>Please note that the MacOSX platform was the reason we introduced the xattr stuff in the first place, as otherwise the resource fork of images bigger than 1MB would be destroyed (see issue <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: writeMetadata() destroys resource fork on MacOS X for big files (&gt;1MB) (Closed)" href="/issues/836">#836</a>).</p>


	<p>So I think that disabling this mechanism for all MacOSX platforms is going too far.</p>


	<p>We should either disable this for exactly the MacOSX versions that cause trouble.</p>


	<p>Or better: provide an alternative mechanism that preserves resource forks.</p></div>
    </div>
  </div>
  
  <div id="change-2595" class="journal has-notes">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/206">Volker Grabsch</a> <a title="25 Jul 2013 02:42" href="/projects/exiv2/activity?from=2013-07-25">over 8 years</a> ago
      <span id="journal-2595-private_notes" class=""></span>
    </h4>

    <div id="journal-2595-notes" class="wiki"><p>I created a new issue <a class="issue tracker-1 status-2 priority-4 priority-default" title="Bug: Bug #836 possibly reintroduced: writeMetadata() destroys resource fork on MacOS X for big files (... (Assigned)" href="/issues/910">#910</a> to address this possible reintroduction of a bug.</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/906.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/906.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
