<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #769: &quot;Assertion `sv == d&#39; failed&quot; in 0.21.1 (r2474) - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="YwUpBGPu2DtvVeSgliRDvw4fi6YqiOzrL7I1MuzZHDOBSILrEZQUOzox+6wp80+MMY3f39trTVHSkqW6r+D7XA==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #769: &quot;Assertion `sv == d&#39; failed&quot; in 0.21.1 (r2474)" href="https://dev.exiv2.org/issues/769.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #769</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>&quot;Assertion `sv == d&#39; failed&quot; in 0.21.1 (r2474)</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/2298">Derek Chen-Becker</a> <a title="24 Apr 2011 16:55" href="/projects/exiv2/activity?from=2011-04-24">over 10 years</a> ago.
        Updated <a title="18 Sep 2011 05:27" href="/projects/exiv2/activity?from=2011-09-18">about 10 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/53">Andreas Huggel</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">tiff parser</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="18 Sep 2011" href="/versions/47">0.22</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">24 Apr 2011</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>I thought that this was <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Crash when writing Exif.Image.Software (Closed)" href="/issues/752">#752</a> but I pulled and build from SVN/trunk (<a class="changeset" title="Added Tokina AT-X 107 AF DX Fish-eye 10-17mm f/3.5-4.5 lens (Milan Knizek)" href="/projects/exiv2/repository/exiv2/revisions/2474">r2474</a>) and I'm still getting a crash in gThumb when rotating an image (same image every time). Full stack trace:</p>


<pre>
#0  0x00007fd985f476dd in waitpid () from /lib/libpthread.so.0
#1  0x00007fd98645ed11 in g_spawn_sync (working_directory=&lt;value optimized out&gt;, argv=&lt;value optimized out&gt;, envp=&lt;value optimized out&gt;, flags=&lt;value optimized out&gt;, child_setup=&lt;value optimized out&gt;, user_data=&lt;value optimized out&gt;, standard_output=0x0, standard_error=0x0, exit_status=0x0, error=0x7fffae83c038) at /build/buildd/glib2.0-2.26.1/glib/gspawn.c:392
#2  0x00007fd98645f029 in g_spawn_command_line_sync (command_line=&lt;value optimized out&gt;, standard_output=0x0, standard_error=0x0, exit_status=0x0, error=0x7fffae83c038) at /build/buildd/glib2.0-2.26.1/glib/gspawn.c:706
#3  0x00007fd98036f2c4 in ?? () from /usr/lib/gtk-2.0/modules/libgnomesegvhandler.so
#4  &lt;signal handler called&gt;
#5  0x00007fd985be8ba5 in raise () from /lib/libc.so.6
#6  0x00007fd985bec6b0 in abort () from /lib/libc.so.6
#7  0x00007fd985be1a71 in __assert_fail () from /lib/libc.so.6
#8  0x00007fd989dbb4d8 in Exiv2::Internal::TiffDirectory::doWrite (this=0x1b5b540, ioWrapper=..., byteOrder=Exiv2::littleEndian, offset=704, valueIdx=330, dataIdx=2680, imageIdx=@0x7fffae83cfd8) at tiffcomposite.cpp:1156
#9  0x00007fd989dbaee9 in Exiv2::Internal::TiffComponent::write (this=0x1b5b540, ioWrapper=..., byteOrder=Exiv2::littleEndian, offset=704, valueIdx=4294967295, dataIdx=4294967295, imageIdx=@0x7fffae83cfd8) at tiffcomposite.cpp:1065
#10 0x00007fd989dbc142 in Exiv2::Internal::TiffIfdMakernote::doWrite (this=0x1b5b520, ioWrapper=..., byteOrder=Exiv2::littleEndian, offset=704, imageIdx=@0x7fffae83cfd8) at tiffcomposite.cpp:1362
#11 0x00007fd989dbaee9 in Exiv2::Internal::TiffComponent::write (this=0x1b5b520, ioWrapper=..., byteOrder=Exiv2::littleEndian, offset=704, valueIdx=4294967295, dataIdx=4294967295, imageIdx=@0x7fffae83cfd8) at tiffcomposite.cpp:1065
#12 0x00007fd989dbc08a in Exiv2::Internal::TiffMnEntry::doWrite (this=0x1b59890, ioWrapper=..., byteOrder=Exiv2::littleEndian, offset=210, valueIdx=494, dataIdx=3198, imageIdx=@0x7fffae83cfd8) at tiffcomposite.cpp:1346
#13 0x00007fd989dbaee9 in Exiv2::Internal::TiffComponent::write (this=0x1b59890, ioWrapper=..., byteOrder=Exiv2::littleEndian, offset=210, valueIdx=494, dataIdx=3198, imageIdx=@0x7fffae83cfd8) at tiffcomposite.cpp:1065
#14 0x00007fd989dbb4ae in Exiv2::Internal::TiffDirectory::doWrite (this=0x1b57fe0, ioWrapper=..., byteOrder=Exiv2::littleEndian, offset=210, valueIdx=494, dataIdx=3198, imageIdx=@0x7fffae83cfd8) at tiffcomposite.cpp:1155
#15 0x00007fd989dbaee9 in Exiv2::Internal::TiffComponent::write (this=0x1b57fe0, ioWrapper=..., byteOrder=Exiv2::littleEndian, offset=210, valueIdx=4294967295, dataIdx=4294967295, imageIdx=@0x7fffae83cfd8) at tiffcomposite.cpp:1065
#16 0x00007fd989dbcc86 in Exiv2::Internal::TiffSubIfd::doWriteData (this=0x1b583d0, ioWrapper=..., byteOrder=Exiv2::littleEndian, offset=8, dataIdx=202, imageIdx=@0x7fffae83cfd8) at tiffcomposite.cpp:1513
#17 0x00007fd989dbc96f in Exiv2::Internal::TiffComponent::writeData (this=0x1b583d0, ioWrapper=..., byteOrder=Exiv2::littleEndian, offset=8, dataIdx=202, imageIdx=@0x7fffae83cfd8) at tiffcomposite.cpp:1449
#18 0x00007fd989dbc9ec in Exiv2::Internal::TiffDirectory::doWriteData (this=0x1b57060, ioWrapper=..., byteOrder=Exiv2::littleEndian, offset=8, dataIdx=202, imageIdx=@0x7fffae83cfd8) at tiffcomposite.cpp:1460
#19 0x00007fd989dbc96f in Exiv2::Internal::TiffComponent::writeData (this=0x1b57060, ioWrapper=..., byteOrder=Exiv2::littleEndian, offset=8, dataIdx=202, imageIdx=@0x7fffae83cfd8) at tiffcomposite.cpp:1449
#20 0x00007fd989dbb5f0 in Exiv2::Internal::TiffDirectory::doWrite (this=0x1b57060, ioWrapper=..., byteOrder=Exiv2::littleEndian, offset=8, valueIdx=202, dataIdx=202, imageIdx=@0x7fffae83cfd8) at tiffcomposite.cpp:1172
#21 0x00007fd989dbaee9 in Exiv2::Internal::TiffComponent::write (this=0x1b57060, ioWrapper=..., byteOrder=Exiv2::littleEndian, offset=8, valueIdx=4294967295, dataIdx=4294967295, imageIdx=@0x7fffae83cfd8) at tiffcomposite.cpp:1065
#22 0x00007fd989dc670d in Exiv2::Internal::TiffParserWorker::encode (io=..., pData=0x1564850 "II*", size=13302, exifData=..., iptcData=..., xmpData=..., root=131072, findEncoderFct=0x7fd989dc5cd0 &lt;Exiv2::Internal::TiffMapping::findEncoder(std::string const&#38;, uint32_t, Exiv2::Internal::IfdId)&gt;, pHeader=0x160f0e0) at tiffimage.cpp:1852
#23 0x00007fd989d3c066 in Exiv2::ExifParser::encode (blob=..., pData=0x1564850 "II*", size=13302, byteOrder=Exiv2::littleEndian, exifData=...) at exif.cpp:723
#24 0x00007fd989d56e7c in Exiv2::JpegBase::doWriteMetadata (this=0x156baa0, outIo=...) at jpgimage.cpp:674
#25 0x00007fd989d55a9b in Exiv2::JpegBase::writeMetadata (this=0x156baa0) at jpgimage.cpp:499
#26 0x00007fd97e6ea712 in exiv2_write_metadata_private (image=&lt;value optimized out&gt;, info=&lt;value optimized out&gt;, pixbuf=&lt;value optimized out&gt;) at exiv2-utils.cpp:1027
#27 0x00007fd97e6eb23b in exiv2_write_metadata_to_buffer (buffer=0x7fffae83e968, buffer_size=0x7fffae83e960, info=0x134d100, pixbuf=0x0, error=&lt;value optimized out&gt;) at exiv2-utils.cpp:1091
#28 0x00007fd97e6efe0c in exiv2_jpeg_tran_cb (tran_info=0x7fffae83e130) at main.c:212
#29 0x00007fd98640aeef in g_hook_list_marshal (hook_list=0x11bae20, may_recurse=1, marshaller=0x466440 &lt;invoke_marshaller_1&gt;, data=0x1525130) at /build/buildd/glib2.0-2.26.1/glib/ghook.c:387
#30 0x000000000046680e in gth_hook_invoke (name=&lt;value optimized out&gt;, first_data=&lt;value optimized out&gt;) at gth-hook.c:269
#31 0x00007fd97ed0ccb6 in jpegtran (in_buffer=&lt;value optimized out&gt;, in_buffer_size=&lt;value optimized out&gt;, out_buffer=&lt;value optimized out&gt;, out_buffer_size=&lt;value optimized out&gt;, transformation=&lt;value optimized out&gt;, mcu_action=&lt;value optimized out&gt;, error=0x7fffae83e958) at jpegtran.c:337
#32 0x00007fd97ef14109 in file_buffer_ready_cb (buffer=0x1655d18, count=1308364, error=0x0, user_data=&lt;value optimized out&gt;) at rotation-utils.c:289
#33 0x000000000043c3ea in load_file__stream_read_cb (source_object=&lt;value optimized out&gt;, result=&lt;value optimized out&gt;, user_data=&lt;value optimized out&gt;) at gio-utils.c:2011
#34 0x00007fd988a5a2e9 in async_ready_callback_wrapper (source_object=0x15d7920, res=0x16319e0, user_data=0x1654cf0) at /build/buildd/glib2.0-2.26.1/gio/ginputstream.c:470
#35 0x00007fd988a69f28 in complete_in_idle_cb_for_thread (_data=&lt;value optimized out&gt;) at /build/buildd/glib2.0-2.26.1/gio/gsimpleasyncresult.c:757
#36 0x00007fd986418342 in g_main_dispatch (context=0x1136510) at /build/buildd/glib2.0-2.26.1/glib/gmain.c:2149
#37 g_main_context_dispatch (context=0x1136510) at /build/buildd/glib2.0-2.26.1/glib/gmain.c:2702
#38 0x00007fd98641c2a8 in g_main_context_iterate (context=0x1136510, block=&lt;value optimized out&gt;, dispatch=&lt;value optimized out&gt;, self=&lt;value optimized out&gt;) at /build/buildd/glib2.0-2.26.1/glib/gmain.c:2780
#39 0x00007fd98641c7b5 in g_main_loop_run (loop=0x10fbd70) at /build/buildd/glib2.0-2.26.1/glib/gmain.c:2988
#40 0x00007fd9893193e7 in IA__gtk_main () at /build/buildd/gtk+2.0-2.22.0/gtk/gtkmain.c:1237
#41 0x00000000004911bd in main (argc=1, argv=0x7fffae83ed28) at main.c:449
</pre>

	<p>The image is attached. This is happening a lot with images taken with my new camera (Canon S95), so I'm not sure if there's some makernote field that's not getting parsed properly or if something else is really broken.</p>


	<p>Thanks,</p>


	<p>Derek</p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/249">IMG_2281.JPG</a>    <span class="size">(1.25 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/249/IMG_2281.JPG">IMG_2281.JPG</a>  </td>
  <td>The image that causes the crash when rotating</td>
  <td>
      <span class="author">Derek Chen-Becker, 24 Apr 2011 16:55</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/250">IMG_2280.exif</a>    <span class="size">(7.79 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/250/IMG_2280.exif">IMG_2280.exif</a>  </td>
  <td></td>
  <td>
      <span class="author">Derek Chen-Becker, 26 Apr 2011 17:19</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/251">IMG_2281.exif</a>    <span class="size">(8.38 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/251/IMG_2281.exif">IMG_2281.exif</a>  </td>
  <td></td>
  <td>
      <span class="author">Derek Chen-Becker, 26 Apr 2011 17:19</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/253">IMG_2801-orig.JPG</a>    <span class="size">(450 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/253/IMG_2801-orig.JPG">IMG_2801-orig.JPG</a>  </td>
  <td>Original image</td>
  <td>
      <span class="author">Derek Chen-Becker, 16 May 2011 09:12</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/254">IMG_2801.JPG</a>    <span class="size">(441 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/254/IMG_2801.JPG">IMG_2801.JPG</a>  </td>
  <td>Rotated image</td>
  <td>
      <span class="author">Derek Chen-Becker, 16 May 2011 09:12</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/255">2801.txt</a>    <span class="size">(532 Bytes)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/255/2801.txt">2801.txt</a>  </td>
  <td>Commands to transform metadata of IMG_2801-orig.JPG to that of IMG_2801.JPG</td>
  <td>
      <span class="author">Andreas Huggel, 19 May 2011 09:16</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/264">exif-dump-before.txt</a>    <span class="size">(13.3 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/264/exif-dump-before.txt">exif-dump-before.txt</a>  </td>
  <td></td>
  <td>
      <span class="author">Paolo Bacchilega, 18 Jul 2011 07:13</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/265">exif-data-after.txt</a>    <span class="size">(12.7 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/265/exif-data-after.txt">exif-data-after.txt</a>  </td>
  <td></td>
  <td>
      <span class="author">Paolo Bacchilega, 18 Jul 2011 07:13</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/266">exif-data-after-no-crash.txt</a>    <span class="size">(12.7 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/266/exif-data-after-no-crash.txt">exif-data-after-no-crash.txt</a>  </td>
  <td></td>
  <td>
      <span class="author">Paolo Bacchilega, 18 Jul 2011 07:13</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/267">exif-data-before-after-diff.txt</a>    <span class="size">(3.47 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/267/exif-data-before-after-diff.txt">exif-data-before-after-diff.txt</a>  </td>
  <td></td>
  <td>
      <span class="author">Paolo Bacchilega, 19 Jul 2011 04:26</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/268">exiv2-bug769.jpg</a>    <span class="size">(6.01 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/268/exiv2-bug769.jpg">exiv2-bug769.jpg</a>  </td>
  <td></td>
  <td>
      <span class="author">Andreas Huggel, 19 Jul 2011 21:06</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/269">exif-data-after.txt.cmd</a>    <span class="size">(11.4 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/269/exif-data-after.txt.cmd">exif-data-after.txt.cmd</a>  </td>
  <td></td>
  <td>
      <span class="author">Andreas Huggel, 19 Jul 2011 21:06</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>








</div>

<div id="issue-changesets">
<h3>Associated revisions</h3>
    <div class="changeset">
    <p><a title="Revision 2562" href="/projects/exiv2/repository/exiv2/revisions/2562">Revision 2562</a>
        (<a href="/projects/exiv2/repository/exiv2/revisions/2562/diff">diff</a>)
        <br />
        <span class="author">Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="20 Jul 2011 22:01" href="/projects/exiv2/activity?from=2011-07-20">over 10 years</a> ago</span></p>
    <div class="wiki changeset-comments">
        <p><a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: &quot;Assertion `sv == d&#39; failed&quot; in 0.21.1 (r2474) (Closed)" href="/issues/769">#769</a>: Fixed calculation of binary array size in the case when the array elements are not sorted in ascending order, added test case.</p>
    </div>
    </div>

</div>



<div id="history">
<h3>History</h3>
  <div id="change-1885" class="journal has-notes">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="25 Apr 2011 18:06" href="/projects/exiv2/activity?from=2011-04-25">over 10 years</a> ago
      <span id="journal-1885-private_notes" class=""></span>
    </h4>

    <div id="journal-1885-notes" class="wiki"><p>The image looks ok, I can't see anything wrong with its metadata. Definitely not the same problem as <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Crash when writing Exif.Image.Software (Closed)" href="/issues/752">#752</a>.</p>


	<p>I can't reproduce the issue with the exiv2 command line tool. Adding a tag works fine. The backtrace shows that exiv2 is serializing the metadata when it crashes, maybe related to the actual data that was changed. What tags does gThumb modify here?</p>


	<p>(cc Mike from gThumb)</p></div>
    </div>
  </div>
  
  <div id="change-1886" class="journal has-notes">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/2298">Derek Chen-Becker</a> <a title="26 Apr 2011 17:12" href="/projects/exiv2/activity?from=2011-04-26">over 10 years</a> ago
      <span id="journal-1886-private_notes" class=""></span>
    </h4>

    <div id="journal-1886-notes" class="wiki"><p>I'll have to confirm but at the very least it's going to modify the orientation tags and probably the pixel X/Y dimensions. It also appears to remove the EXIF thumbnail from my images (thank goodness, I wish I could just turn that off in my camera). gThumb adds a "Software" tag equal to "gthumb &lt;version". Let me compare EXIF tags from the image in question and one of the images that gthumb successfully rotates.</p></div>
    </div>
  </div>
  
  <div id="change-1887" class="journal has-notes has-details">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/2298">Derek Chen-Becker</a> <a title="26 Apr 2011 17:19" href="/projects/exiv2/activity?from=2011-04-26">over 10 years</a> ago
      <span id="journal-1887-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/250">IMG_2280.exif</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/250/IMG_2280.exif">IMG_2280.exif</a> added</li>
       <li><strong>File</strong> <a href="/attachments/251">IMG_2281.exif</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/251/IMG_2281.exif">IMG_2281.exif</a> added</li>
    </ul>
    <div id="journal-1887-notes" class="wiki"><p>OK, here are the tags I can get from "exiv2 -P E pr &lt;file&gt;" for an image that doesn't crash (IMG_2280.JPG) and the one that does (IMG_2281.JPG). Besides the obvious differences in shooting conditions, it looks like a few of the tags get removed (Exif.Canon.OwnerName, Exif.Image.ImageDescription, etc). If you would like more detailed EXIF data just let me know the command line I should use.</p></div>
    </div>
  </div>
  
  <div id="change-1888" class="journal has-notes">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="26 Apr 2011 17:44" href="/projects/exiv2/activity?from=2011-04-26">over 10 years</a> ago
      <span id="journal-1888-private_notes" class=""></span>
    </h4>

    <div id="journal-1888-notes" class="wiki"><p>Thanks. Since they are not too large, can you just attach a "before" and "after" picture?</p></div>
    </div>
  </div>
  
  <div id="change-1889" class="journal has-notes">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="26 Apr 2011 17:51" href="/projects/exiv2/activity?from=2011-04-26">over 10 years</a> ago
      <span id="journal-1889-private_notes" class=""></span>
    </h4>

    <div id="journal-1889-notes" class="wiki"><p>This is what I'll do with the information, but probably not before the weekend. If you have time, you can try yourself: Create an exiv2 command script that transforms the metadata of the "before" picture to the "after" state (-m option, man exiv2). Then apply it to the picture that crashes. Does it crash too, i.e., can you reproduce the crash with these exiv2 commands?</p></div>
    </div>
  </div>
  
  <div id="change-1890" class="journal has-notes">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/2298">Derek Chen-Becker</a> <a title="26 Apr 2011 19:34" href="/projects/exiv2/activity?from=2011-04-26">over 10 years</a> ago
      <span id="journal-1890-private_notes" class=""></span>
    </h4>

    <div id="journal-1890-notes" class="wiki"><p>Andreas Huggel wrote:</p>


<blockquote>

	<p>This is what I'll do with the information, but probably not before the weekend. If you have time, you can try yourself: Create an exiv2 command script that transforms the metadata of the "before" picture to the "after" state (-m option, man exiv2). Then apply it to the picture that crashes. Does it crash too, i.e., can you reproduce the crash with these exiv2 commands?</p>


</blockquote>

	<p>I'll have time to work on this on Sunday. Let me see what I find. I'll take a test photo to do before and after and see if I can make a script that replicates the changes.</p>


	<p>Thanks!</p></div>
    </div>
  </div>
  
  <div id="change-1892" class="journal has-notes">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/2298">Derek Chen-Becker</a> <a title="16 May 2011 09:05" href="/projects/exiv2/activity?from=2011-05-16">over 10 years</a> ago
      <span id="journal-1892-private_notes" class=""></span>
    </h4>

    <div id="journal-1892-notes" class="wiki"><p>Well, I've tried replicating using a mod script, but I can't figure out how to modify things like MakerNotes (which is changed). Let me take a test shot and upload before and after images (assuming I can get an image that won't crash gThumb)</p></div>
    </div>
  </div>
  
  <div id="change-1893" class="journal has-notes has-details">
    <div id="note-8">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-8" class="journal-link">#8</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/2298">Derek Chen-Becker</a> <a title="16 May 2011 09:12" href="/projects/exiv2/activity?from=2011-05-16">over 10 years</a> ago
      <span id="journal-1893-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/253">IMG_2801-orig.JPG</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/253/IMG_2801-orig.JPG">IMG_2801-orig.JPG</a> added</li>
       <li><strong>File</strong> <a href="/attachments/254">IMG_2801.JPG</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/254/IMG_2801.JPG">IMG_2801.JPG</a> added</li>
    </ul>
    <div id="journal-1893-notes" class="wiki"><p>OK, got lucky. The attached images are the before (-orig) and after images with a gThumb rotation.</p></div>
    </div>
  </div>
  
  <div id="change-1894" class="journal has-notes has-details">
    <div id="note-9">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-9" class="journal-link">#9</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="19 May 2011 09:16" href="/projects/exiv2/activity?from=2011-05-19">over 10 years</a> ago
      <span id="journal-1894-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/255">2801.txt</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/255/2801.txt">2801.txt</a> added</li>
       <li><strong>Status</strong> changed from <i>New</i> to <i>Feedback</i></li>
    </ul>
    <div id="journal-1894-notes" class="wiki"><p>I can't reproduce the issue. The attach command file transforms the metadata of the "before" image to the "after" state but also applies without any crash on IMG_2281.JPG.</p>


	<p>There is definitely something wrong here, but I can't help without being able to reproduce the crash.</p>


	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1895" class="journal has-notes">
    <div id="note-10">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-10" class="journal-link">#10</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/2298">Derek Chen-Becker</a> <a title="19 May 2011 13:27" href="/projects/exiv2/activity?from=2011-05-19">over 10 years</a> ago
      <span id="journal-1895-private_notes" class=""></span>
    </h4>

    <div id="journal-1895-notes" class="wiki"><p>Understood. The command file I sent isn't 100% correct, FYI. For one thing, I don't transform the maker notes or a few other things that I wasn't sure how to change. In any case I'm working around the issue now by using exiftran from the command line.</p></div>
    </div>
  </div>
  
  <div id="change-1896" class="journal has-notes">
    <div id="note-11">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-11" class="journal-link">#11</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="19 May 2011 19:52" href="/projects/exiv2/activity?from=2011-05-19">over 10 years</a> ago
      <span id="journal-1896-private_notes" class=""></span>
    </h4>

    <div id="journal-1896-notes" class="wiki"><p>Makernote tags can be modified like any other tags. The only special cases here are tags with offsets, which are computed during writing. You don't need to set them. See the commands in the attached file 2801.txt. After applying these commands to IMG_2801-orig.JPG, exiv2 reports the same metadata in IMG_2801-orig.JPG as in IMG_2801.JPG, except for a difference in the sequence of the makernote tags.</p>


	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1897" class="journal has-notes">
    <div id="note-12">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-12" class="journal-link">#12</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/2298">Derek Chen-Becker</a> <a title="19 May 2011 22:44" href="/projects/exiv2/activity?from=2011-05-19">over 10 years</a> ago
      <span id="journal-1897-private_notes" class=""></span>
    </h4>

    <div id="journal-1897-notes" class="wiki"><p>Ah, sorry, I misunderstood. I'll bump this up the the gThumb folks and see if they can look at it. Just looking at their source for the image rotation extension, it looks like they're wiping all EXIF data from the image and then rebuilding it, rather than modifying one or two attributes.</p></div>
    </div>
  </div>
  
  <div id="change-1937" class="journal has-notes">
    <div id="note-13">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-13" class="journal-link">#13</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/2517">Paolo Bacchilega</a> <a title="17 Jul 2011 08:10" href="/projects/exiv2/activity?from=2011-07-17">over 10 years</a> ago
      <span id="journal-1937-private_notes" class=""></span>
    </h4>

    <div id="journal-1937-notes" class="wiki"><p>Andreas Huggel wrote:</p>


<blockquote>

	<p>Makernote tags can be modified like any other tags. The only special cases here are tags with offsets, which are computed during writing. You don't need to set them.</p>


</blockquote>

	<p>Is there a way to know if a tag has an offset or, in general, if it's safe to set it?</p>


	<p>Paolo (gThumb developer)</p></div>
    </div>
  </div>
  
  <div id="change-1938" class="journal has-notes">
    <div id="note-14">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-14" class="journal-link">#14</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/2298">Derek Chen-Becker</a> <a title="17 Jul 2011 20:50" href="/projects/exiv2/activity?from=2011-07-17">over 10 years</a> ago
      <span id="journal-1938-private_notes" class=""></span>
    </h4>

    <div id="journal-1938-notes" class="wiki"><p>FYI, since Paolo joined in I wanted to mention that I'm still affected by this. I'm working around it currently by disabling auto-rotate on import and then I have my own script (using exiftran) that deals with the images :(</p></div>
    </div>
  </div>
  
  <div id="change-1940" class="journal has-notes">
    <div id="note-15">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-15" class="journal-link">#15</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="17 Jul 2011 23:22" href="/projects/exiv2/activity?from=2011-07-17">over 10 years</a> ago
      <span id="journal-1940-private_notes" class=""></span>
    </h4>

    <div id="journal-1940-notes" class="wiki"><p>Paolo Bacchilega wrote:</p>


<blockquote>

	<p>Andreas Huggel wrote:</p>


<blockquote>

	<p>Makernote tags can be modified like any other tags. The only special cases here are tags with offsets, which are computed during writing. You don't need to set them.</p>


</blockquote>

	<p>Is there a way to know if a tag has an offset or, in general, if it's safe to set it?</p>


	<p>Paolo (gThumb developer)</p>


</blockquote>

	<p>Setting these offset tags doesn't affect the way exiv2 works and doesn't result in a corrupted image. The value you set is ignored and instead exiv2 uses the calculated offset. If the tag is not needed it will not be written at all to ensure the TIFF structure remains intact and prevent a dangling pointer.</p>


	<p>There is no simple way to recognize these tags. The most common ones are:</p>


<pre>
Exif.Image.ExifTag             : Offset of the Exif IFD    
Exif.Photo.InteroperabilityTag : Offset of the Interoperability IFD
Exif.Image.GPSTag              : Offset of the GPS IFD
</pre>

	<p>You'd have to read specifications or look in the Exiv2 source code for others (look for newTiffSubIfd in tiffimage.cpp).</p>


	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1941" class="journal has-notes">
    <div id="note-16">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-16" class="journal-link">#16</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/2517">Paolo Bacchilega</a> <a title="18 Jul 2011 01:02" href="/projects/exiv2/activity?from=2011-07-18">over 10 years</a> ago
      <span id="journal-1941-private_notes" class=""></span>
    </h4>

    <div id="journal-1941-notes" class="wiki"><blockquote>

	<p>Setting these offset tags doesn't affect the way exiv2 works and doesn't result in a corrupted image.</p>


</blockquote>

	<p>I still don't understand how to avoid the sv==d assertion failure.</p>


	<p>I'll try to describe how gThumb uses exiv2.</p>


	<p>Metadata is read in the exiv2_read_metadata function (<a class="external" href="http://git.gnome.org/browse/gthumb/tree/extensions/exiv2_tools/exiv2-utils.cpp#n557">http://git.gnome.org/browse/gthumb/tree/extensions/exiv2_tools/exiv2-utils.cpp#n557</a>), for each metadatum the key, description, formatted value, raw value and type name are stored in the GthMetadata structure.</p>


	<p>Metadata is written in the exiv2_write_metadata_private function (<a class="external" href="http://git.gnome.org/browse/gthumb/tree/extensions/exiv2_tools/exiv2-utils.cpp#n861">http://git.gnome.org/browse/gthumb/tree/extensions/exiv2_tools/exiv2-utils.cpp#n861</a>) where values are created using the command:</p>


	<p>Exiv2::Value::AutoPtr value = Exiv2::Value::create (Exiv2::TypeInfo::typeId (value_type));<br />value->read (raw_value);</p>


	<p>where value_type is the string returned by md->typeName() and raw_value by md->value() in the exiv2_read_metadata function.</p>


	<p>Do you see any problem with this way of saving metadata ?</p></div>
    </div>
  </div>
  
  <div id="change-1942" class="journal has-notes">
    <div id="note-17">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-17" class="journal-link">#17</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="18 Jul 2011 02:48" href="/projects/exiv2/activity?from=2011-07-18">over 10 years</a> ago
      <span id="journal-1942-private_notes" class=""></span>
    </h4>

    <div id="journal-1942-notes" class="wiki"><blockquote>

	<p>I still don't understand how to avoid the sv==d assertion failure.</p>


</blockquote>

	<p>That's probably a bug. I'd like to understand what triggers it. If you can reproduce the problem, can you dump the contents of the ExifData container after reading the metadata and again, before writing (from the newly constructed ExifData container)? Something like this <a class="external" href="http://www.exiv2.org/doc/exifprint_8cpp-example.html#_a1">http://www.exiv2.org/doc/exifprint_8cpp-example.html#_a1</a> can be used to print the data.</p>


<blockquote>

	<p>Do you see any problem with this way of saving metadata ?</p>


</blockquote>

	<p>It differs from the common use-case, but I can't immediately tell why it sometimes doesn't work. The usual case is that applications keep the ExifData container and modify it as needed (add/mod/del tags). In gthumb you take the tags out of that into another list and later build a new ExifData object.</p>


	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1943" class="journal has-notes has-details">
    <div id="note-18">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-18" class="journal-link">#18</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/2517">Paolo Bacchilega</a> <a title="18 Jul 2011 07:13" href="/projects/exiv2/activity?from=2011-07-18">over 10 years</a> ago
      <span id="journal-1943-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/264">exif-dump-before.txt</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/264/exif-dump-before.txt">exif-dump-before.txt</a> added</li>
       <li><strong>File</strong> <a href="/attachments/265">exif-data-after.txt</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/265/exif-data-after.txt">exif-data-after.txt</a> added</li>
       <li><strong>File</strong> <a href="/attachments/266">exif-data-after-no-crash.txt</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/266/exif-data-after-no-crash.txt">exif-data-after-no-crash.txt</a> added</li>
    </ul>
    <div id="journal-1943-notes" class="wiki"><p>Andreas Huggel wrote:</p>


<blockquote><blockquote>

	<p>I still don't understand how to avoid the sv==d assertion failure.</p>


</blockquote>

	<p>That's probably a bug. I'd like to understand what triggers it. If you can reproduce the problem, can you dump the contents of the ExifData container after reading the metadata and again, before writing (from the newly constructed ExifData container)?</p>


</blockquote>

	<p>I can reproduce the problem when changing a set of 600 images, the s==d assertion is triggered always by the same image, however if I try to change only that image, or a smaller set of images containing that same image, there is no error.</p>


	<p>Explanation of the attached files:</p>


	<p>exif-dump-before.txt => this is the ExifData of the original image<br />exif-dump-before-after.txt => this is the ExifData before saving the image and when the image is part of a 600 images set<br />exif-dump-before-after-no-crash.txt => this is the ExifData before saving the image and when the image is the only file to be changed (in this case there is no crash)</p></div>
    </div>
  </div>
  
  <div id="change-1944" class="journal has-notes has-details">
    <div id="note-19">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-19" class="journal-link">#19</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/2517">Paolo Bacchilega</a> <a title="19 Jul 2011 04:26" href="/projects/exiv2/activity?from=2011-07-19">over 10 years</a> ago
      <span id="journal-1944-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/267">exif-data-before-after-diff.txt</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/267/exif-data-before-after-diff.txt">exif-data-before-after-diff.txt</a> added</li>
    </ul>
    <div id="journal-1944-notes" class="wiki"><p>Here is the diff between exif-dump-before.txt and exif-data-after.txt, maybe this way it's easier to spot the problem.</p></div>
    </div>
  </div>
  
  <div id="change-1946" class="journal has-notes has-details">
    <div id="note-20">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-20" class="journal-link">#20</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="19 Jul 2011 21:03" href="/projects/exiv2/activity?from=2011-07-19">over 10 years</a> ago
      <span id="journal-1946-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Category</strong> set to <i>tiff parser</i></li>
       <li><strong>Status</strong> changed from <i>Feedback</i> to <i>Assigned</i></li>
       <li><strong>Assignee</strong> set to <i>Andreas Huggel</i></li>
    </ul>
    <div id="journal-1946-notes" class="wiki"><p>Thanks Paolo! With this data I can finally reproduce the assertion here!</p></div>
    </div>
  </div>
  
  <div id="change-1947" class="journal has-notes has-details">
    <div id="note-21">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-21" class="journal-link">#21</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="19 Jul 2011 21:06" href="/projects/exiv2/activity?from=2011-07-19">over 10 years</a> ago
      <span id="journal-1947-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/268">exiv2-bug769.jpg</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/268/exiv2-bug769.jpg">exiv2-bug769.jpg</a> added</li>
       <li><strong>File</strong> <a href="/attachments/269">exif-data-after.txt.cmd</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/269/exif-data-after.txt.cmd">exif-data-after.txt.cmd</a> added</li>
    </ul>
    <div id="journal-1947-notes" class="wiki"><p>$ exiv2 -m exif-data-after.txt.cmd exiv2-bug769.jpg<br />Warning: Directory Thumbnail, entry 0x0201: Data area exceeds data buffer, ignoring it.<br />Warning: Directory Thumbnail, entry 0x0201: Data area exceeds data buffer, ignoring it.<br />exiv2: tiffcomposite.cpp:1156: virtual uint32_t Exiv2::Internal::TiffDirectory::doWrite(Exiv2::Internal::IoWrapper&#38;, Exiv2::ByteOrder, int32_t, uint32_t, uint32_t, uint32_t&#38;): Assertion `sv == d' failed.<br />Aborted</p></div>
    </div>
  </div>
  
  <div id="change-1948" class="journal has-notes has-details">
    <div id="note-22">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-22" class="journal-link">#22</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="20 Jul 2011 22:12" href="/projects/exiv2/activity?from=2011-07-20">over 10 years</a> ago
      <span id="journal-1948-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Resolved</i></li>
       <li><strong>Target version</strong> set to <i>0.22</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>100</i></li>
    </ul>
    <div id="journal-1948-notes" class="wiki"><p>The bug that I can reproduce here shows if one tries to add binary array elements out of sequence. That happens in the above cases because Exif.CanonCs.FlashDetails is added at the end of the list.</p>


	<p><a class="changeset" title="#769: Fixed calculation of binary array size in the case when the array elements are not sorted i..." href="/projects/exiv2/repository/exiv2/revisions/2562">r2562</a> fixes this issue. Please test and confirm that all assertions are gone with the current trunk. Alternatively, <a href="http://dev.exiv2.org/projects/exiv2/repository/revisions/2562/diff?format=diff&#38;rev_to=2561" class="external">the changes</a> should also apply as a binary compatible patch to 0.21.1.</p>


	<p>Andreas</p></div>
    </div>
  </div>
  
  <div id="change-1950" class="journal has-notes">
    <div id="note-23">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-23" class="journal-link">#23</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/2517">Paolo Bacchilega</a> <a title="21 Jul 2011 01:07" href="/projects/exiv2/activity?from=2011-07-21">over 10 years</a> ago
      <span id="journal-1950-private_notes" class=""></span>
    </h4>

    <div id="journal-1950-notes" class="wiki"><p>The patch fixes the bug for me as well, thank you.</p>


	<p>Paolo</p></div>
    </div>
  </div>
  
  <div id="change-2002" class="journal has-details">
    <div id="note-24">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-24" class="journal-link">#24</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="18 Sep 2011 05:27" href="/projects/exiv2/activity?from=2011-09-18">about 10 years</a> ago
      <span id="journal-2002-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
    </ul>
    
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/769.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/769.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
