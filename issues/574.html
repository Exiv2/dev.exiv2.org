<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Feature #574: Support &quot;Adobe Makernote&quot; in DNGPrivateData - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="FtugavJGaQzFTMpZw2+aB1w3PAEl3FxQhGGT77NrTJT0lguFgDylDJAo1VV8uJY0Y6VoeNQ//ep5QQNn8FKr+w==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Feature #574: Support &quot;Adobe Makernote&quot; in DNGPrivateData" href="https://dev.exiv2.org/issues/574.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Feature #574</h2>

<div class="issue tracker-2 status-1 priority-4 priority-default details">
    <div class="next-prev-links contextual">
      <a title="#1311" accesskey="p" href="/issues/1311">« Previous</a> |
        <span class="position">
          <a href="/issues?f%5B%5D=status_id&amp;op%5Bstatus_id%5D=o&amp;page=1&amp;per_page=100&amp;set_filter=1&amp;sort=updated_on%3Adesc%2Cid&amp;v%5Bstatus_id%5D%5B%5D=">12 of 78</a>
        </span> |
      <a title="#577" accesskey="n" href="/issues/577">Next »</a>
    </div>

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Support &quot;Adobe Makernote&quot; in DNGPrivateData</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="28 Sep 2008 23:39" href="/projects/exiv2/activity?from=2008-09-28">about 13 years</a> ago.
        Updated <a title="26 Apr 2017 22:27" href="/projects/exiv2/activity?from=2017-04-26">over 4 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">New</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value">-</div></div><div class="category attribute"><div class="label">Category:</div><div class="value">exif</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a href="/versions/31">1.0</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value"></div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-0"><tr><td style="width: 100%;" class="todo"></td></tr></table><p class="percent">0%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value"></div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>From Gilles Caulier:</p>


	<p>After playing and playing with Adobe DNG converter to tune my propers raw to DNG tool (<a class="external" href="http://www.digikam.org/drupal/node/373">http://www.digikam.org/drupal/node/373</a>) , i have discovered than Adobe do not use Exif.Photo.MakerNote tags to host makernote byte array, but a new DNG tag named DNGPrivateData Look this page:</p>


	<p><a class="external" href="http://www.barrypearson.co.uk/articles/dng/safety.htm">http://www.barrypearson.co.uk/articles/dng/safety.htm</a></p>


	<p>...and this comment :</p>


	<p>"The code change in ACR/DNG 3.1 that preserves private MakerNotes applies to all formats that store their private data using the Exif MakerNote format, which includes Pentax. These MakerNotes are often byte order or offset dependent, so what I'm doing to preserve this data safely is repackaging it into the DNGPrivateData tag. This repackaging stores the source file's byte order and the original file offset to the MakerNote, along with the MakerNote data itself. This allows an application that understands the MakerNote format for a particular camera to find the MakerNote data, along with the original byte order and file offset, and thus parse the MakerNote data correctly from the DNG file".</p>


	<p>But the better is here :</p>


	<p><a class="external" href="http://www.barrypearson.co.uk/articles/dng/specification.htm">http://www.barrypearson.co.uk/articles/dng/specification.htm</a></p>


	<p>With these informations how to store makernotes in DNGPrivateData:<br />Storage of Makernote in DNGPrivateData<br />...</p>


	<p>The DNGPrivateData generated by the DNG Converter, hence containing the original EXIF Makeernote, is:</p>
	<pre><code>1. Six bytes containing the zero-terminated string "Adobe". (The DNG specification calls for the DNGPrivateData tag to start with an ASCII string identifying the creator/format).<br />   2. 4 bytes: an ASCII string ("MakN" for a Makernote),  indicating what sort of data is being stored here. Note that this is not zero-terminated.<br />   3. A four-byte count (number of data bytes following); this is the length of the original MakerNote data. (This is always in "most significant byte first" format).<br />   4. 2 bytes: the byte-order indicator from the original file (the usual 'MM'/4D4D or 'II'/4949).<br />   5. 4 bytes: the original file offset for the MakerNote tag data (stored according to the byte order given above).<br />   6. The contents of the MakerNote tag. This is a simple byte-for-byte copy, with no modification.</code></pre>


	<p>So, i will using this way in my converter to be fully compatible with Adobe tool.</p>


	<p>This imply too that Exiv2 need to support this way to extract makernotes from DNG files...</p>
  </div>
</div>






<hr />
<div id="relations">
<div class="contextual">
</div>

<p><strong>Related issues</strong></p>

<form data-cm-url="/issues/context_menu" action="/issues/574" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="rew2oELMf5pO22IhW73Aq58JErBSPOtTmPDI7NfKRtxPoZ1PMLazmhu/fS3kasyYoJtGyaPfSull0FhklPOhsw==" />
  <table class="list issues odd-even"><tr id="relation-29" class="issue hascontextmenu issue tracker-2 status-5 priority-4 priority-default closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="543" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-2 status-5 priority-4 priority-default closed" href="/issues/543">Feature #543</a>: make exiv2 respect makernote offset that Microsoft WIC tools introduce when it edits photos</td><td class="status">Closed</td><td class="start_date"></td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr><tr id="relation-83" class="issue hascontextmenu issue tracker-1 status-5 priority-3 priority-lowest closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="758" /></td><td class="subject" style="width: 50%">Has duplicate Exiv2 - <a class="issue tracker-1 status-5 priority-3 priority-lowest closed" href="/issues/758">Bug #758</a>: Exiv2 doesn&#39;t detect lens model in Pentax k-x DNG files</td><td class="status">Closed</td><td class="start_date">08 Feb 2011</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-0"><tr><td style="width: 100%;" class="todo"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr></table>
</form>
<form class="new_relation" id="new-relation-form" style="display: none;" action="/issues/574/relations" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />


<p><select onchange="setPredecessorFieldsVisibility();" name="relation[relation_type]" id="relation_relation_type"><option selected="selected" value="relates">Related to</option>
<option value="duplicates">Is duplicate of</option>
<option value="duplicated">Has duplicate</option>
<option value="blocks">Blocks</option>
<option value="blocked">Blocked by</option>
<option value="precedes">Precedes</option>
<option value="follows">Follows</option>
<option value="copied_to">Copied to</option>
<option value="copied_from">Copied from</option></select>
Issue #<input size="10" type="text" name="relation[issue_to_id]" id="relation_issue_to_id" />
<span id="predecessor_fields" style="display:none;">
Delay: <input size="3" type="text" name="relation[delay]" id="relation_delay" /> days
</span>
<input type="submit" name="commit" value="Add" data-disable-with="Add" />
<a href="#" onclick="$(&quot;#new-relation-form&quot;).hide();; return false;">Cancel</a>
</p>

<script>
//<![CDATA[
observeAutocompleteField('relation_issue_to_id', '/issues/auto_complete?issue_id=574&project_id=exiv2&scope=all')
//]]>
</script>

<script>
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>
</div>

</div>




<div id="history">
<h3>History</h3>
  <div id="change-1027" class="journal has-notes">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="29 Sep 2008 01:58" href="/projects/exiv2/activity?from=2008-09-29">about 13 years</a> ago
      <span id="journal-1027-private_notes" class=""></span>
    </h4>

    <div id="journal-1027-notes" class="wiki"><p>The new Exif.MakerNote.Offset tag is part of the fix for this but I'm not sure<br />yet to what extent this Adobe Makernote should be supported in Exiv2.</p>


	<p>With the new tag, you can almost write such Adobe makernotes. I will<br />add the byte order in a similar way, still for 0.18. (Watch out, in<br />some cases the Exif data has a different byte order than the<br />makernote, you can't always simply take the byte order from the<br />image).</p>


	<p>IMO they make a bad thing worse. I recommend that you boycott it and<br />don't write this tag. It is flawed in more than one way. (*)</p>


	<p>Microsoft, in Vista, did something similar<br />( <a class="external" href="http://dev.robotbattle.com/bugs/view.php?id=543">http://dev.robotbattle.com/bugs/view.php?id=543</a> ). It also doesn't<br />always work, but is still better than this Adobe tag. The irony is<br />that Adobe and Microsoft sit in the same metadata working group<br />( <a class="external" href="http://www.metadataworkinggroup.org/">http://www.metadataworkinggroup.org/</a> ), who's declared goal is to<br />provide common specifications for seamless interoperability of digital<br />image metadata.</p>


	<p>Andreas</p>


	<p>(*)<br />1) It doesn't always work. For some cases it is still necessary to<br />know the makernote structure. Comment from Phil Harvey, ExifTool<br />author, on one of the pages you pointed me to: "The Olympus maker<br />notes contain pointers which reference information outside the<br />makernotes data block. This information (a few kB worth) is not copied<br />by the DNG converter [...]. To properly copy ORF maker notes, you need<br />to understand the structure".<br />2) It is unclear how to deal with cases which have a normal makernote<br />tag as well as this Adobe makernote.<br />3) It seems the Adobe makernote tag tries to provide all info that is<br />needed to read the makernote in one tag but it doesn't: In order to be<br />able to decode the makernote you also need to know what makernote it<br />is.<br />4) It's more complex than necessary. The M$ implementation to address<br />the same problem ("How to preserve makernote data if I don't know its<br />structure?") is simpler, doesn't suffer from issue 2) and doesn't<br />pretend to provide 3).</p></div>
    </div>
  </div>
  
  <div id="change-1051" class="journal has-details">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="15 Dec 2008 17:37" href="/projects/exiv2/activity?from=2008-12-15">almost 13 years</a> ago
      <span id="journal-1051-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Assignee</strong> set to <i>Andreas Huggel</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-1354" class="journal has-notes">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="10 Sep 2009 21:49" href="/projects/exiv2/activity?from=2009-09-10">about 12 years</a> ago
      <span id="journal-1354-private_notes" class=""></span>
    </h4>

    <div id="journal-1354-notes" class="wiki"><p>See also: <a class="external" href="http://dev.exiv2.org/boards/3/topics/show/222">http://dev.exiv2.org/boards/3/topics/show/222</a></p></div>
    </div>
  </div>
  
  <div id="change-1355" class="journal has-notes">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="11 Sep 2009 21:46" href="/projects/exiv2/activity?from=2009-09-11">about 12 years</a> ago
      <span id="journal-1355-private_notes" class=""></span>
    </h4>

    <div id="journal-1355-notes" class="wiki"><p>Decoding should be reasonably straightforward. Encoding is more interesting: If makernote tags decoded from this tag use the same groups as the native makernote tags (e.g., <strong>Exif.OlympusEq.SerialNumber</strong>, <em>not</em> something like <strong>Exif.DngOlympusEq.SerialNumber</strong>), then the question is whether they should be packed into a native makernote tag or a DNGPrivateData tag when writing. One idea is to decide based on the presence of a DNGPrivateData tag: If such a tag exists, pack makernote tags into that (and remove a native makernote if there is one), else, pack makernote tags into a native makernote as usual. That would make conversion between native and these DNG makernotes straightforward: Delete the DNGPrivateData tag to convert to a native makernote and add it (with any value) to convert native makernote tags into a DNG makernote.</p>


	<p>(Using different group names would require a lot of additional configuration and make conversion difficult.)</p></div>
    </div>
  </div>
  
  <div id="change-4064" class="journal has-details">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="23 Aug 2015 15:49" href="/projects/exiv2/activity?from=2015-08-23">about 6 years</a> ago
      <span id="journal-4064-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Target version</strong> set to <i>1.0</i></li>
    </ul>
    
    </div>
  </div>
  
  <div id="change-5998" class="journal has-details">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="26 Apr 2017 22:27" href="/projects/exiv2/activity?from=2017-04-26">over 4 years</a> ago
      <span id="journal-5998-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Assignee</strong> deleted (<del><i>Andreas Huggel</i></del>)</li>
    </ul>
    
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/574.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/574.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
