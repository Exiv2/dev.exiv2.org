<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #1182: Exiv2 is unable to update any Exif.SubImageN.xxx tag such as Exif.SubImage1.DefaultScale in a DNG - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="7jUfz7V8OnN6vUeTqzah4e9cASt+gZTmKNol07qojwUMeLQgxwb2cy/ZWJ8U4a3S0M5VUo9iNVzV+rVb+ZFoag==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #1182: Exiv2 is unable to update any Exif.SubImageN.xxx tag such as Exif.SubImage1.DefaultScale in a DNG" href="https://dev.exiv2.org/issues/1182.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #1182</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Exiv2 is unable to update any Exif.SubImageN.xxx tag such as Exif.SubImage1.DefaultScale in a DNG</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="02 May 2016 21:17" href="/projects/exiv2/activity?from=2016-05-02">over 5 years</a> ago.
        Updated <a title="09 May 2016 09:36" href="/projects/exiv2/activity?from=2016-05-09">over 5 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/119">Robin Mills</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">tiff parser</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="28 Apr 2017" href="/versions/52">0.26</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">02 May 2016</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value">10.00 h</div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>See discussion/test files: <a class="external" href="http://dev.exiv2.org/boards/3/topics/2546">http://dev.exiv2.org/boards/3/topics/2546</a></p>
  </div>
</div>
  <hr />
  <p><strong>Files</strong></p>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1001">exiv2</a>    <span class="size">(2.26 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1001/exiv2">exiv2</a>  </td>
  <td></td>
  <td>
      <span class="author">Robin Mills, 07 May 2016 10:48</span>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1002">May8InEngland.jpg</a>    <span class="size">(393 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1002/May8InEngland.jpg">May8InEngland.jpg</a>  </td>
  <td></td>
  <td>
      <span class="author">Robin Mills, 08 May 2016 14:57</span>
  </td>
  <td>
  </td>
</tr>
</table>
</div>







<hr />
<div id="relations">
<div class="contextual">
</div>

<p><strong>Related issues</strong></p>

<form data-cm-url="/issues/context_menu" action="/issues/1182" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="3PaizeefWKMB3AgPO437teYIWzWCwoouGJUHV9lYlT8+uwkileWUo1S4FwOEWveG2ZoPTHMhK5TltZffmmFyUA==" />
  <table class="list issues odd-even"><tr id="relation-223" class="issue hascontextmenu issue tracker-2 status-5 priority-4 priority-default closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="668" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-2 status-5 priority-4 priority-default closed" href="/issues/668">Feature #668</a>: &quot;TIFF-safe&quot; setExifData variant</td><td class="status">Closed</td><td class="start_date">03 Jan 2010</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr><tr id="relation-224" class="issue hascontextmenu issue tracker-2 status-2 priority-4 priority-default"><td class="checkbox"><input type="checkbox" name="ids[]" value="992" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-2 status-2 priority-4 priority-default" href="/issues/992">Feature #992</a>: Better raw file support and test</td><td class="status">Assigned</td><td class="start_date">18 Sep 2014</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-0"><tr><td style="width: 100%;" class="todo"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr></table>
</form>
<form class="new_relation" id="new-relation-form" style="display: none;" action="/issues/1182/relations" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />


<p><select onchange="setPredecessorFieldsVisibility();" name="relation[relation_type]" id="relation_relation_type"><option selected="selected" value="relates">Related to</option>
<option value="duplicates">Is duplicate of</option>
<option value="duplicated">Has duplicate</option>
<option value="blocks">Blocks</option>
<option value="blocked">Blocked by</option>
<option value="precedes">Precedes</option>
<option value="follows">Follows</option>
<option value="copied_to">Copied to</option>
<option value="copied_from">Copied from</option></select>
Issue #<input size="10" type="text" name="relation[issue_to_id]" id="relation_issue_to_id" />
<span id="predecessor_fields" style="display:none;">
Delay: <input size="3" type="text" name="relation[delay]" id="relation_delay" /> days
</span>
<input type="submit" name="commit" value="Add" data-disable-with="Add" />
<a href="#" onclick="$(&quot;#new-relation-form&quot;).hide();; return false;">Cancel</a>
</p>

<script>
//<![CDATA[
observeAutocompleteField('relation_issue_to_id', '/issues/auto_complete?issue_id=1182&project_id=exiv2&scope=all')
//]]>
</script>

<script>
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>
</div>

</div>




<div id="history">
<h3>History</h3>
  <div id="change-5027" class="journal has-notes has-details">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 May 2016 20:05" href="/projects/exiv2/activity?from=2016-05-03">over 5 years</a> ago
      <span id="journal-5027-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Assignee</strong> changed from <i>Robin Mills</i> to <i>Andreas Huggel</i></li>
    </ul>
    <div id="journal-5027-notes" class="wiki"><p>Andreas</p>


	<p>Can you look at this for me, please?  It's down inside the tiffvisitor code.  exiv2 does rewrite the dng, however the changes are not in the file.  For example: <pre>$ curl -O http://dev.exiv2.org/attachments/download/992/M28-1507_1_2016-04-25_0001_C0000_000001.dng
$ exiv2 -pa --grep DefaultScale/i M28-1507_1_2016-04-25_0001_C0000_000001.dng 
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
$ exiv2 --verbose -M'set Exif.SubImage1.DefaultScale 3/1' M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "3/1" (Rational)
$ exiv2 -pa --grep DefaultScale/i M28-1507_1_2016-04-25_0001_C0000_000001.dng 
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
</pre>If you don't have time to investigate, please assign it to me.  I'll probably defer it for a future release.</p></div>
    </div>
  </div>
  
  <div id="change-5028" class="journal has-notes has-details">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="04 May 2016 17:58" href="/projects/exiv2/activity?from=2016-05-04">over 5 years</a> ago
      <span id="journal-5028-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>% Done</strong> changed from <i>20</i> to <i>60</i></li>
       <li><strong>Estimated time</strong> changed from <i>5.00 h</i> to <i>10.00 h</i></li>
    </ul>
    <div id="journal-5028-notes" class="wiki"><p>I've spent most of a day looking at this.  Gosh, it's an amazing trick to write the SubImageN tags in-line with the other metadata.  There is something from the original file which 'eclipses' TiffEncoder::exifData_ and causes TiffSubIfd to encode the data from the original file into the output destination file.  There's a very complicated network of classes involved in this conspiracy:</p>


	<ol>
	<li>TiffParserWorker</li>
		<li>TiffCopier</li>
		<li>TiffEncoder</li>
		<li>TiffSubIfd</li>
		<li>TiffVisitor</li>
	</ol>


	<p>If Andreas doesn't fix this for v0.26, I will defer this for a future version.</p></div>
    </div>
  </div>
  
  <div id="change-5029" class="journal has-notes">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4659">D Anderson</a> <a title="04 May 2016 19:01" href="/projects/exiv2/activity?from=2016-05-04">over 5 years</a> ago
      <span id="journal-5029-private_notes" class=""></span>
    </h4>

    <div id="journal-5029-notes" class="wiki"><p>That complicated huh?<br />Maybe Andreas can find some code from 2014 laying around ;).</p></div>
    </div>
  </div>
  
  <div id="change-5030" class="journal has-notes has-details">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="06 May 2016 03:14" href="/projects/exiv2/activity?from=2016-05-06">over 5 years</a> ago
      <span id="journal-5030-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Estimated time</strong> changed from <i>10.00 h</i> to <i>12.00 h</i></li>
    </ul>
    <div id="journal-5030-notes" class="wiki"><p>I can't find any evidence that this worked during 2013/2014.  I've done 20 builds with this script:<pre>#!/bin/bash

# 526 rmills@rmillsmbp:~/gnu/exiv2/trunk $ svn log src/tiffvisitor.cpp | grep ^r | grep -e 2013 -e 2014
# r3479 | robinwmills | 2014-12-25 13:55:57 +0000 (Thu, 25 Dec 2014) | 1 line
# r3233 | ahuggel | 2014-01-17 10:23:30 +0000 (Fri, 17 Jan 2014) | 1 line
# r3214 | robinwmills | 2013-12-28 03:41:01 +0000 (Sat, 28 Dec 2013) | 1 line
# r3201 | ahuggel | 2013-12-01 12:13:42 +0000 (Sun, 01 Dec 2013) | 1 line
# r3190 | ahuggel | 2013-10-06 15:04:48 +0100 (Sun, 06 Oct 2013) | 1 line
# r3090 | robinwmills | 2013-07-24 06:05:52 +0100 (Wed, 24 Jul 2013) | 1 line
# r3089 | robinwmills | 2013-07-24 04:12:38 +0100 (Wed, 24 Jul 2013) | 1 line
# r3056 | nkbj | 2013-06-19 05:02:05 +0100 (Wed, 19 Jun 2013) | 1 line
# r2991 | robinwmills | 2013-02-20 05:30:14 +0000 (Wed, 20 Feb 2013) | 1 line
# r2976 | robinwmills | 2013-01-16 02:23:10 +0000 (Wed, 16 Jan 2013) | 1 line
# r2966 | robinwmills | 2013-01-13 01:31:18 +0000 (Sun, 13 Jan 2013) | 1 line
# 527 rmills@rmillsmbp:~/gnu/exiv2/trunk $

for r in 4298 2966 2976 2991 3056 3089 3190 3201 3214 3233 3280 3300 3320 3340 3360 3380 3400 3420 3440 3460 3479 4298 ; do
    echo ------------- $r begin --------------
    if [ -e $r ]; then rm -rf $r ; fi
    svn checkout svn://dev.exiv2.org/svn/trunk --revision $r $r | wc
    cd $r
    make config 2&gt;/dev/null | wc
    ./configure             | wc
    make -j  2&gt;&#38;1           | wc
    sudo make install       | wc
    echo SVN = $(exiv2 -vV | grep svn)
    curl --silent -O http://dev.exiv2.org/attachments/download/992/M28-1507_1_2016-04-25_0001_C0000_000001.dng
    exiv2 -pa M28-1507_1_2016-04-25_0001_C0000_000001.dng | grep SubImage1 | grep DefaultScale
    exiv2 -v -M'set Exif.SubImage1.DefaultScale 10/9 8/7' M28-1507_1_2016-04-25_0001_C0000_000001.dng
    exiv2 -pa M28-1507_1_2016-04-25_0001_C0000_000001.dng | grep SubImage1 | grep DefaultScale
    echo ------------- $r end --------------
    echo ''
    cd ..
done

# That's all Folks!
##</pre>And here's the output: <pre>547 rmills@rmillsmbp:~/gnu/exiv2 $ ./build_them.sh 
------------- 4298 begin --------------
    1281    2564   51584
       2      10     116
     197    1156    9388
     197    4649   64793
     106     589    8088
SVN = svn=4298
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 4298 end --------------

------------- 2966 begin --------------
    1286    2574   60296
       2      10     116
     190    1120    9108
     260    4813   64230
      97     551    6797
SVN =
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 2966 end --------------

------------- 2976 begin --------------
    1286    2574   60296
       2      10     116
     190    1120    9108
     242    4734   63438
      97     551    6797
SVN =
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 2976 end --------------

------------- 2991 begin --------------
    1290    2582   60437
       2      10     116
     190    1120    9108
     242    4734   63438
      97     551    6797
SVN =
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 2991 end --------------

------------- 3056 begin --------------
    1412    2826   65431
       2      10     116
     190    1120    9108
     615    6385   81155
basicio.cpp:29:1: warning: variable 'rcsId' is uninitialized when used within its own initialization [-Wuninitialized]

____ died a horrible death ____

make[1]: *** [basicio.o] Error 1
make: *** [install] Error 2
       4      50     595
SVN =
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3056 end --------------

------------- 3089 begin --------------
    1518    3038   70600
       2      10     116
     190    1120    9108
   11578   65680  942138

____ died a horrible death ____

make[1]: *** [asfvideo.o] Error 1
make: *** [install] Error 2
       4      50     597
SVN =
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3089 end --------------

------------- 3190 begin --------------
    1518    3038   70600
       2      10     116
     190    1120    9108
     242    4732   63436
      95     528    6545
SVN =
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3190 end --------------

------------- 3201 begin --------------
    1518    3038   70600
       2      10     116
     190    1120    9108
     242    4732   63436
      95     528    6545
SVN =
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3201 end --------------

------------- 3214 begin --------------
    1521    3044   70693
       2      10     116
     190    1120    9108
     198    4427   60936
      95     528    6545
SVN =
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3214 end --------------

------------- 3233 begin --------------
    1521    3044   70693
       2      10     116
     190    1120    9108
     198    4427   60936
      95     528    6545
SVN =
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3233 end --------------

------------- 3280 begin --------------
    1525    3052   70849
       2      10     116
     190    1120    9108
     199    4429   60961
      96     534    6632
SVN = svn=3280
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3280 end --------------

------------- 3300 begin --------------
    1527    3056   70904
       2      10     116
     190    1120    9108
     199    4429   60961
      96     534    6632
SVN = svn=3300
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3300 end --------------

------------- 3320 begin --------------
    1527    3056   70904
       2      10     116
     190    1120    9108
     199    4429   60961
      96     534    6632
SVN = svn=3320
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3320 end --------------

------------- 3340 begin --------------
    1527    3056   70904
       2      10     116
     190    1120    9108
     199    4429   60961
      96     534    6632
SVN = svn=3340
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3340 end --------------

------------- 3360 begin --------------
    1534    3070   71145
       2      10     116
     190    1120    9108
     201    4484   61746
      97     540    6721
SVN = svn=3360
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3360 end --------------

------------- 3380 begin --------------
    1536    3074   71211
       2      10     116
     190    1120    9108
     201    4484   61746
      97     540    6721
SVN = svn=3380
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3380 end --------------

------------- 3400 begin --------------
    1536    3074   71211
       2      10     116
     190    1120    9108
     201    4484   61746
      97     540    6721
SVN = svn=3400
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3400 end --------------

------------- 3420 begin --------------
    1536    3074   71211
       2      10     116
     190    1120    9108
     201    4484   61746
      97     540    6721
SVN = svn=3420
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3420 end --------------

------------- 3440 begin --------------
    1536    3074   71211
       2      10     116
     190    1120    9108
     201    4484   61746
      97     540    6721
SVN = svn=3440
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3440 end --------------

------------- 3460 begin --------------
    1540    3082   71349
       2      10     116
     190    1120    9108
     201    4484   61746
      97     540    6721
SVN = svn=3460
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3460 end --------------

------------- 3479 begin --------------
    1092    2186   44193
       2      10     116
     200    1166    9494
     224    5104   71717
     102     587    8058
SVN = svn=3479
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3479 end --------------

------------- 4298 begin --------------
    1281    2564   51584
       2      10     116
     197    1156    9388
     197    4649   64793
     106     589    8088
SVN = svn=4298
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 4298 end --------------

548 rmills@rmillsmbp:~/gnu/exiv2 $ </pre></p></div>
    </div>
  </div>
  
  <div id="change-5031" class="journal has-notes">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4659">D Anderson</a> <a title="06 May 2016 05:40" href="/projects/exiv2/activity?from=2016-05-06">over 5 years</a> ago
      <span id="journal-5031-private_notes" class=""></span>
    </h4>

    <div id="journal-5031-notes" class="wiki"><p>Very strange. Highly unlikely but did this guy solve the issue in his static build?<br /><a class="external" href="http://dev.exiv2.org/issues/1180#note-23">http://dev.exiv2.org/issues/1180#note-23</a><br />I could try and see if it,s possible to get some answers from him.</p></div>
    </div>
  </div>
  
  <div id="change-5032" class="journal has-notes">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4659">D Anderson</a> <a title="06 May 2016 05:53" href="/projects/exiv2/activity?from=2016-05-06">over 5 years</a> ago
      <span id="journal-5032-private_notes" class=""></span>
    </h4>

    <div id="journal-5032-notes" class="wiki"><p>Exiv2 doesn,t allow deleting default scale tag either it seems. DEL works with the mysterious build from here <a class="external" href="http://dev.exiv2.org/issues/1180#note-23">http://dev.exiv2.org/issues/1180#note-23</a></p></div>
    </div>
  </div>
  
  <div id="change-5033" class="journal has-notes">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="06 May 2016 09:19" href="/projects/exiv2/activity?from=2016-05-06">over 5 years</a> ago
      <span id="journal-5033-private_notes" class=""></span>
    </h4>

    <div id="journal-5033-notes" class="wiki"><p>DEL doesn't work for the same reason that SET and ADD do not work.  The metadata in the original file is 'eclipsing' SubImage1 changes and being rewritten into the file.</p>


	<p>Can you contact whoever made your build as they seem to have fixed this.  Perhaps Andreas will look this weekend.  If he doesn't, I might have another session in the debugger next week.  I always fix things, however it takes time to understand other folk's magic.  It's possible that Andreas didn't write this either.</p>


	<p>I've rerun the builds with --enable-static and --disable-shared and tweaked the script:<pre>    ./configure --disable-shared --enable-static | wc
    make -j  2&gt;&#38;1           | wc
    sudo make install       | wc
    echo build = $(exiv2 -vV | grep -e svn -e dll) $(ls -alt $(which exiv2))</pre>The results are the same:</p>


<pre>.... lots of similar stuff ....

------------- 3460 begin --------------
    1540    3082   71349
       2      10     116
     190    1120    9106
     127    2370   31848
      95     509    6447
build = dll=0 svn=3460 -rwxr-xr-x 1 root admin 2782712 6 May 10:05 /usr/local/bin/exiv2
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3460 end --------------

------------- 3479 begin --------------
    1092    2186   44193
       2      10     116
     200    1166    9492
     148    2788   38309
     100     557    7800
build = dll=0 svn=3479 -rwxr-xr-x 1 root admin 2905640 6 May 10:06 /usr/local/bin/exiv2
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 3479 end --------------

------------- 4298 begin --------------
    1281    2564   51584
       2      10     116
     197    1156    9386
     126    2488   33627
     104     559    7830
build = dll=0 svn=4298 -rwxr-xr-x 1 root admin 2757260 6 May 10:07 /usr/local/bin/exiv2
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
------------- 4298 end --------------</pre></div>
    </div>
  </div>
  
  <div id="change-5034" class="journal has-notes has-details">
    <div id="note-8">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-8" class="journal-link">#8</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="07 May 2016 10:48" href="/projects/exiv2/activity?from=2016-05-07">over 5 years</a> ago
      <span id="journal-5034-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/1001">exiv2</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/1001/exiv2">exiv2</a> added</li>
       <li><strong>% Done</strong> changed from <i>60</i> to <i>70</i></li>
    </ul>
    <div id="journal-5034-notes" class="wiki"><p>I attach the <em><strong>static version of exiv2</strong></em> which Daniel provided with <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Add tags defined by Adobe in the Cinema DNG Specification  (Closed)" href="/issues/1180">#1180</a>.  Daniel is going to contact the person who made this as we believe she/he has the fix. <pre>517 rmills@rmillsmbp:~/temp $ ./exiv2 -vV
exiv2 0.24 001800 (64 bit build)
Copyright (C) 2004-2013 Andreas Huggel.

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public
License along with this program; if not, write to the Free
Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
Boston, MA 02110-1301 USA
exiv2=0.24.0
platform=apple
compiler=Clang
bits=64
dll=0
debug=0
version=4.2.1 Compatible Apple LLVM 5.1 (clang-503.0.40)
date=May 12 2014
time=11:21:35
executable=/Users/rmills/temp/./exiv2
library=/usr/lib/libiconv.2.dylib
library=/usr/lib/libz.1.dylib
library=/usr/lib/libexpat.1.dylib
library=/usr/lib/libSystem.B.dylib
library=/usr/lib/libc++.1.dylib
library=/usr/lib/system/libcache.dylib
library=/usr/lib/system/libcommonCrypto.dylib
library=/usr/lib/system/libcompiler_rt.dylib
library=/usr/lib/system/libcopyfile.dylib
library=/usr/lib/system/libcorecrypto.dylib
library=/usr/lib/system/libdispatch.dylib
library=/usr/lib/system/libdyld.dylib
library=/usr/lib/system/libkeymgr.dylib
library=/usr/lib/system/liblaunch.dylib
library=/usr/lib/system/libmacho.dylib
library=/usr/lib/system/libquarantine.dylib
library=/usr/lib/system/libremovefile.dylib
library=/usr/lib/system/libsystem_asl.dylib
library=/usr/lib/system/libsystem_blocks.dylib
library=/usr/lib/system/libsystem_c.dylib
library=/usr/lib/system/libsystem_configuration.dylib
library=/usr/lib/system/libsystem_coreservices.dylib
library=/usr/lib/system/libsystem_coretls.dylib
library=/usr/lib/system/libsystem_dnssd.dylib
library=/usr/lib/system/libsystem_info.dylib
library=/usr/lib/system/libsystem_kernel.dylib
library=/usr/lib/system/libsystem_m.dylib
library=/usr/lib/system/libsystem_malloc.dylib
library=/usr/lib/system/libsystem_network.dylib
library=/usr/lib/system/libsystem_networkextension.dylib
library=/usr/lib/system/libsystem_notify.dylib
library=/usr/lib/system/libsystem_platform.dylib
library=/usr/lib/system/libsystem_pthread.dylib
library=/usr/lib/system/libsystem_sandbox.dylib
library=/usr/lib/system/libsystem_secinit.dylib
library=/usr/lib/system/libsystem_trace.dylib
library=/usr/lib/system/libunc.dylib
library=/usr/lib/system/libunwind.dylib
library=/usr/lib/system/libxpc.dylib
library=/usr/lib/libobjc.A.dylib
library=/usr/lib/libauto.dylib
library=/usr/lib/libc++abi.dylib
library=/usr/lib/libDiagnosticMessagesClient.dylib
518 rmills@rmillsmbp:~/temp $  curl --silent -O http://dev.exiv2.org/attachments/download/992/M28-1507_1_2016-04-25_0001_C0000_000001.dng
519 rmills@rmillsmbp:~/temp $ ./exiv2 -pa M28-1507_1_2016-04-25_0001_C0000_000001.dng | grep SubImage1 | grep DefaultScale
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
520 rmills@rmillsmbp:~/temp $ ./exiv2 -v -M'set Exif.SubImage1.DefaultScale 10/9 8/7' M28-1507_1_2016-04-25_0001_C0000_000001.dng
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
521 rmills@rmillsmbp:~/temp $ ./exiv2 -pa M28-1507_1_2016-04-25_0001_C0000_000001.dng | grep SubImage1 | grep DefaultScale
Exif.SubImage1.DefaultScale                  Rational    2  10/9 8/7
522 rmills@rmillsmbp:~/temp $ </pre>To be certain about this situation, I have built a static version of <em><strong>vanilla v0.24</strong></em>.  This build has the fault.<pre>524 rmills@rmillsmbp:~/gnu/exiv2/0.24 $ makes
make
       6      41     364
sudo make install
      93     497    6271
525 rmills@rmillsmbp:~/gnu/exiv2/0.24 $ bin/exiv2 -vV
exiv2 0.24 001800 (64 bit build)
Copyright (C) 2004-2013 Andreas Huggel.

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public
License along with this program; if not, write to the Free
Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
Boston, MA 02110-1301 USA
exiv2=0.24.0
platform=apple
compiler=Clang
bits=64
dll=0
debug=0
version=4.2.1 Compatible Apple LLVM 7.3.0 (clang-703.0.31)
date=May  7 2016
time=09:42:40
executable=/Users/rmills/gnu/exiv2/0.24/bin/exiv2
library=/usr/local/lib/libintl.8.dylib
library=/usr/lib/libSystem.B.dylib
library=/usr/lib/libiconv.2.dylib
library=/usr/local/lib/libz.1.dylib
library=/usr/lib/libc++.1.dylib
library=/System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation
library=/usr/lib/system/libcache.dylib
library=/usr/lib/system/libcommonCrypto.dylib
library=/usr/lib/system/libcompiler_rt.dylib
library=/usr/lib/system/libcopyfile.dylib
library=/usr/lib/system/libcorecrypto.dylib
library=/usr/lib/system/libdispatch.dylib
library=/usr/lib/system/libdyld.dylib
library=/usr/lib/system/libkeymgr.dylib
library=/usr/lib/system/liblaunch.dylib
library=/usr/lib/system/libmacho.dylib
library=/usr/lib/system/libquarantine.dylib
library=/usr/lib/system/libremovefile.dylib
library=/usr/lib/system/libsystem_asl.dylib
library=/usr/lib/system/libsystem_blocks.dylib
library=/usr/lib/system/libsystem_c.dylib
library=/usr/lib/system/libsystem_configuration.dylib
library=/usr/lib/system/libsystem_coreservices.dylib
library=/usr/lib/system/libsystem_coretls.dylib
library=/usr/lib/system/libsystem_dnssd.dylib
library=/usr/lib/system/libsystem_info.dylib
library=/usr/lib/system/libsystem_kernel.dylib
library=/usr/lib/system/libsystem_m.dylib
library=/usr/lib/system/libsystem_malloc.dylib
library=/usr/lib/system/libsystem_network.dylib
library=/usr/lib/system/libsystem_networkextension.dylib
library=/usr/lib/system/libsystem_notify.dylib
library=/usr/lib/system/libsystem_platform.dylib
library=/usr/lib/system/libsystem_pthread.dylib
library=/usr/lib/system/libsystem_sandbox.dylib
library=/usr/lib/system/libsystem_secinit.dylib
library=/usr/lib/system/libsystem_trace.dylib
library=/usr/lib/system/libunc.dylib
library=/usr/lib/system/libunwind.dylib
library=/usr/lib/system/libxpc.dylib
library=/usr/lib/libobjc.A.dylib
library=/usr/lib/libauto.dylib
library=/usr/lib/libc++abi.dylib
library=/usr/lib/libDiagnosticMessagesClient.dylib
library=/usr/lib/libicucore.A.dylib
library=/usr/lib/libz.1.dylib
526 rmills@rmillsmbp:~/gnu/exiv2/0.24 $ curl --silent -O http://dev.exiv2.org/attachments/download/992/M28-1507_1_2016-04-25_0001_C0000_000001.dng
528 rmills@rmillsmbp:~/gnu/exiv2/0.24 $ ./bin/exiv2 -pa M28-1507_1_2016-04-25_0001_C0000_000001.dng | grep SubImage1 | grep DefaultScale
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
529 rmills@rmillsmbp:~/gnu/exiv2/0.24 $ ./bin/exiv2 -v -M'set Exif.SubImage1.DefaultScale 10/9 8/7' M28-1507_1_2016-04-25_0001_C0000_000001.dng
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7" (Rational)
530 rmills@rmillsmbp:~/gnu/exiv2/0.24 $ ./bin/exiv2 -pa M28-1507_1_2016-04-25_0001_C0000_000001.dng | grep SubImage1 | grep DefaultScale
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
531 rmills@rmillsmbp:~/gnu/exiv2/0.24 $ </pre>There are more forensics I can perform on <em><strong>static version of exiv2</strong></em> attached to this issue (and issue <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Add tags defined by Adobe in the Cinema DNG Specification  (Closed)" href="/issues/1180">#1180</a>).  However, let's see if Daniel can find out more before I continue exploring the code with the debugger.</p></div>
    </div>
  </div>
  
  <div id="change-5048" class="journal has-notes">
    <div id="note-9">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-9" class="journal-link">#9</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="08 May 2016 14:28" href="/projects/exiv2/activity?from=2016-05-08">over 5 years</a> ago
      <span id="journal-5048-private_notes" class=""></span>
    </h4>

    <div id="journal-5048-notes" class="wiki"><p>Sorry, I just only managed to look into this. <br />The issue is that in TIFF and TIFF-like images, we need to be careful, which tags to modify (in particular, delete), as both, the actual image information and the metadata is part of the same TIFF structure: When you, e.g., ask exiv2 to delete all metadata, you expect it not to delete the actual image(s). For that purpose there is the notion of "image tags", which exiv2 will not touch, even if you ask it to, and the SubImage tags are such untouchable "image tags" by definition.<br />See <a href="http://dev.exiv2.org/boards/3/topics/1650?r=1651#message-1651" class="external">this forum post</a> and the related issues and discussions linked from there for more detailed explanations. The code to look at is <a href="http://dev.exiv2.org/projects/exiv2/repository/entry/trunk/src/tiffimage.cpp#L2516" class="external">TiffHeader::isImageTag</a> and the real solution would be to split out proper DNG and/or NEF parser(s) instead of using the TIFF parser for these.</p></div>
    </div>
  </div>
  
  <div id="change-5049" class="journal has-notes has-details">
    <div id="note-10">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-10" class="journal-link">#10</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 May 2016 14:57" href="/projects/exiv2/activity?from=2016-05-08">over 5 years</a> ago
      <span id="journal-5049-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>File</strong> <a href="/attachments/1002">May8InEngland.jpg</a> <a class="icon-only icon-download" title="Download" href="/attachments/download/1002/May8InEngland.jpg">May8InEngland.jpg</a> added</li>
       <li><strong>Assignee</strong> changed from <i>Andreas Huggel</i> to <i>Robin Mills</i></li>
    </ul>
    <div id="journal-5049-notes" class="wiki"><p>Thanks for talking about this, Andreas.  TiffImage::writeMetadata() is an ingenious recursive encoder.  When I was cutting the grass today, I was thinking <em>"I may have to rewrite TiffImage::writeMetadata() to fix this"</em>.  Then I thought that's tricky because the image and the metadata are all mixed together in one big pot.  I'm rather hoping that Daniel will get the fix from the person who created the static exiv2 attached to this issue.</p>


	<p>I recently refactored <em><strong><code class="cplusplus syntaxhl"><span class="k">class</span> <span class="nc">OrfImage</span> <span class="o">:</span> <span class="k">public</span> <span class="n">TiffImage</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span></code></strong></em> maybe it's easy to add: <em><strong><code class="cplusplus syntaxhl"><span class="k">class</span> <span class="nc">DngImage</span> <span class="o">:</span> <span class="k">public</span> <span class="n">TiffImage</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span></code></strong></em> which would have my new function  <em><strong><code class="cplusplus syntaxhl"><span class="n">DngImage</span><span class="o">::</span><span class="n">writeMetadata</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">};</span></code></strong></em> .</p>


	<p>I'm going to reassign this for my attention and hope to either fix or defer it this week.  On target to be code-complete v0.26 early June.</p>


	<p><img src="/attachments/download/1002/May8InEngland.jpg" alt="" /></p></div>
    </div>
  </div>
  
  <div id="change-5050" class="journal has-notes">
    <div id="note-11">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-11" class="journal-link">#11</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 May 2016 15:28" href="/projects/exiv2/activity?from=2016-05-08">over 5 years</a> ago
      <span id="journal-5050-private_notes" class=""></span>
    </h4>

    <div id="journal-5050-notes" class="wiki"><p>As always, Andreas, you know the answer.  I've brutalised the code as discussed here:  <a class="external" href="http://dev.exiv2.org/boards/3/topics/1650?r=1651#message-1651">http://dev.exiv2.org/boards/3/topics/1650?r=1651#message-1651</a> And it works: <pre>709 rmills@rmillsmbp:~/gnu/exiv2/ttt $ curl --silent -O http://dev.exiv2.org/attachments/download/992/M28-1507_1_2016-04-25_0001_C0000_000001.dng
710 rmills@rmillsmbp:~/gnu/exiv2/ttt $ exiv2 -pa --grep DefaultScale/i M28-1507_1_2016-04-25_0001_C0000_000001.dng
Exif.SubImage1.DefaultScale                  Rational    2  1/1 5/3
711 rmills@rmillsmbp:~/gnu/exiv2/ttt $ exiv2 --verbose -M'set Exif.SubImage1.DefaultScale 10/9 8/7 6/5 4/3' M28-1507_1_2016-04-25_0001_C0000_000001.dng
File 1/1: M28-1507_1_2016-04-25_0001_C0000_000001.dng
Set Exif.SubImage1.DefaultScale "10/9 8/7 6/5 4/3" (Rational)
712 rmills@rmillsmbp:~/gnu/exiv2/ttt $ exiv2 -pa --grep DefaultScale/i M28-1507_1_2016-04-25_0001_C0000_000001.dng
Exif.SubImage1.DefaultScale                  Rational    4  10/9 8/7 6/5 4/3
713 rmills@rmillsmbp:~/gnu/exiv2/ttt $ </pre>Here's the patch:<pre>717 rmills@rmillsmbp:~/gnu/exiv2/ttt $ svn diff .
Index: src/tiffimage.cpp
===================================================================
--- src/tiffimage.cpp    (revision 4302)
+++ src/tiffimage.cpp    (working copy)
@@ -2517,6 +2517,7 @@
                                       IfdId          group,
                                 const PrimaryGroups* pPrimaryGroups) const
     {
+        if ( hasImageTags_) return false;
         if (!hasImageTags_) {
 #ifdef DEBUG
             std::cerr &lt;&lt; "No image tags in this image\n";
718 rmills@rmillsmbp:~/gnu/exiv2/ttt $ </pre>I'm not going to submit this code as it breaks a sensible defence mechanism.  I'll have to think a little more before deciding how to proceed.</p></div>
    </div>
  </div>
  
  <div id="change-5051" class="journal has-notes">
    <div id="note-12">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-12" class="journal-link">#12</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4659">D Anderson</a> <a title="08 May 2016 17:56" href="/projects/exiv2/activity?from=2016-05-08">over 5 years</a> ago
      <span id="journal-5051-private_notes" class=""></span>
    </h4>

    <div id="journal-5051-notes" class="wiki"><p>No word still from the person I pm:d regarding this issue. <br />I suspected there was a "defence mechanism" involved here. Exiftool allows for modifying this tag, however I had some email correspondance with Dave Coffin(dcraw) once about dcraw not reading the defaultscale tag. He responded that usually this tag isn,t supposed to be modified and that was that :).<br />I,ll see if I get the patch working. Since It,s only supposed to be used on a specific type of Magic lantern produced dng files I don,t see myself in any serious danger ;).  <br />Thanks a lot for checking into this.</p></div>
    </div>
  </div>
  
  <div id="change-5052" class="journal has-notes has-details">
    <div id="note-13">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-13" class="journal-link">#13</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 May 2016 18:29" href="/projects/exiv2/activity?from=2016-05-08">over 5 years</a> ago
      <span id="journal-5052-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Closed</i></li>
       <li><strong>% Done</strong> changed from <i>70</i> to <i>100</i></li>
       <li><strong>Estimated time</strong> changed from <i>12.00 h</i> to <i>10.00 h</i></li>
    </ul>
    <div id="journal-5052-notes" class="wiki"><p>I think your build was made by Thomas Davrai, who was given advice by Andreas!</p>


	<p>When that was discussed two years ago, I didn't know what a SubIFD was!  Although I've worked on Exiv2 for 8 years now, it's only in the last couple of years that I've started to really understand how the metadata is stored.  Before that, I mostly focused on the build.</p>


	<p>We have an open v1.0 issue <a class="issue tracker-2 status-2 priority-4 priority-default" title="Feature: Better raw file support and test (Assigned)" href="/issues/992">#992</a> to do more work on our raw image support (which includes DNG).  I thinking about recruit a student next year to work on that.  <a class="external" href="http://dev.exiv2.org/boards/3/topics/1650?r=2570#message-2570">http://dev.exiv2.org/boards/3/topics/1650?r=2570#message-2570</a></p>


	<p>I've been thinking about adding global options which can be switched on/off at will.  For example, outputting debug information.  An option to say "allow editing of tags in sub images" (default false) is another possibility.  I'm in the final month before code-complete for v0.26 and unwilling to extend the scope of the project.  So, I'm going to close this as you have a work-around.  I'll update <a class="issue tracker-2 status-2 priority-4 priority-default" title="Feature: Better raw file support and test (Assigned)" href="/issues/992">#992</a> to reference this conversation and this will be considered again when <a class="issue tracker-2 status-2 priority-4 priority-default" title="Feature: Better raw file support and test (Assigned)" href="/issues/992">#992</a> is serviced.</p></div>
    </div>
  </div>
  
  <div id="change-5054" class="journal has-notes">
    <div id="note-14">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-14" class="journal-link">#14</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4659">D Anderson</a> <a title="08 May 2016 20:38" href="/projects/exiv2/activity?from=2016-05-08">over 5 years</a> ago
      <span id="journal-5054-private_notes" class=""></span>
    </h4>

    <div id="journal-5054-notes" class="wiki"><p>Going for a static build<br /><pre>
sudo make distclean 
make config 
./configure --disable-shared --enable-static ; make -j ; sudo make install ; make -j samples
</pre></p>


	<p>I,m trying to replace this <br /><pre>
                                      IfdId          group,
                                const PrimaryGroups* pPrimaryGroups) const
    {
        if (!hasImageTags_) {
#ifdef DEBUG
            std::cerr &lt;&lt; "No image tags in this image\n";
</pre></p>


	<p>With this<br /><pre>
                                       IfdId          group,
                                 const PrimaryGroups* pPrimaryGroups) const
     {
+        if ( hasImageTags_) return false;
         if (!hasImageTags_) {
 #ifdef DEBUG
             std::cerr &lt;&lt; "No image tags in this image\n";
</pre></p>


	<p>But it seems to miss an expression somewhere? I,m a more than a little lost when it comes to C++ :). Any hints?<br />error message<br /><pre>
tiffimage.cpp:2458:10: error: expected expression
+        if ( hasImageTags_) { return false;
</pre></p></div>
    </div>
  </div>
  
  <div id="change-5055" class="journal has-notes">
    <div id="note-15">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-15" class="journal-link">#15</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4659">D Anderson</a> <a title="08 May 2016 20:45" href="/projects/exiv2/activity?from=2016-05-08">over 5 years</a> ago
      <span id="journal-5055-private_notes" class=""></span>
    </h4>

    <div id="journal-5055-notes" class="wiki"><p>Solved the issue myself! Erased the +. ANd it works! Great! That is awesomeness.<br /><pre>

                                       IfdId          group,
                                 const PrimaryGroups* pPrimaryGroups) const
     {
         if ( hasImageTags_) return false;
         if (!hasImageTags_) {
 #ifdef DEBUG
             std::cerr &lt;&lt; "No image tags in this image\n";
</pre></p></div>
    </div>
  </div>
  
  <div id="change-5056" class="journal has-notes">
    <div id="note-16">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-16" class="journal-link">#16</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4659">D Anderson</a> <a title="08 May 2016 20:56" href="/projects/exiv2/activity?from=2016-05-08">over 5 years</a> ago
      <span id="journal-5056-private_notes" class=""></span>
    </h4>

    <div id="journal-5056-notes" class="wiki"><p>Solved the issue myself! Erased the +. ANd it works! Great! That is awesomeness.<br /><pre>

                                       IfdId          group,
                                 const PrimaryGroups* pPrimaryGroups) const
     {
         if ( hasImageTags_) return false;
         if (!hasImageTags_) {
 #ifdef DEBUG
             std::cerr &lt;&lt; "No image tags in this image\n";
</pre></p></div>
    </div>
  </div>
  
  <div id="change-5057" class="journal has-notes">
    <div id="note-17">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-17" class="journal-link">#17</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="09 May 2016 04:48" href="/projects/exiv2/activity?from=2016-05-09">over 5 years</a> ago
      <span id="journal-5057-private_notes" class=""></span>
    </h4>

    <div id="journal-5057-notes" class="wiki"><p>Some additional comments:</p>


	<p>class OrfImage : public TiffImage { ... };</p>


	<p>All image classes used to be derived from Image, and maybe use a different parser and their own header. I'm not sure of the implications when the image class is now derived from TiffImage.</p>


	<p>[..] add: class DngImage [...]</p>


	<p>Yes, the architecture is such that it should be easy to add new classes for different image formats. The question here is whether to split out DngImage or NefImage or both. The latter is the one with the issue, DngImage and TiffImage may be able to remain happy twins and share the same functionality (i.e., more fine-grained control of which subimage tags can be modified).</p>


	<p>Then of course, the main question is whether it is legitimate to allow modifying (and thus deleting) subimage tags (all, some, which ones?): If you ask exiv2 to delete all metadata, it will delete all tags it considers metadata (i.e., not image tags). Is the result what you expected, or does it cripple the actual image(s)? It may be an improvement, some research is required, which for TIFF and DNG shouldn't be too difficult, as unlike NEF, these are open formats.</p>


	<p>In the meantime, I'm quite happy if a few users, who figured out that exiv2 can actually be used to write TIFF-like images (including the image data), make the small changes to the code that are required for that for their own use. That's very different from us trying to support modifications of the actual image data in TIFFs, in addition to just the metadata. (Did you know you can write a TIFF image from scratch with exiv2 commands? - I think it's done in one of the test cases.)</p></div>
    </div>
  </div>
  
  <div id="change-5058" class="journal has-notes">
    <div id="note-18">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-18" class="journal-link">#18</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="09 May 2016 05:34" href="/projects/exiv2/activity?from=2016-05-09">over 5 years</a> ago
      <span id="journal-5058-private_notes" class=""></span>
    </h4>

    <div id="journal-5058-notes" class="wiki"><blockquote>

	<p>[...] global options which can be switched on/off at will. For example, outputting debug information</p>


</blockquote>

	<p>That already exists. See the -Q option of the exiv2 tool and <a href="http://www.exiv2.org/doc/classExiv2_1_1LogMsg.html" class="external">class Exiv2::LogMsg</a> which also explains how to output stuff from the library.</p>


	<p>The difficulty with "outputting debug info" is deciding what debug info is useful. If we simply translate all the #ifdef DEBUG blocks to such debug logs and then turn it on, the output will be one overwhelming mess. Because I had difficulties defining what useful debug data is, there is currently not much. Personally, I still prefer the #ifdef DEBUGs, which can be commented selectively when I want to point my torchlight in one particular corner to see what is happening there, but that may be just my old-fashioned way.</p>


	<p>I don't remember if info messages are used at all, for the same reason as debug. For errors and warnings on the other hand it is very clear what should be written out.</p></div>
    </div>
  </div>
  
  <div id="change-5059" class="journal has-notes">
    <div id="note-19">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-19" class="journal-link">#19</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4659">D Anderson</a> <a title="09 May 2016 08:55" href="/projects/exiv2/activity?from=2016-05-09">over 5 years</a> ago
      <span id="journal-5059-private_notes" class=""></span>
    </h4>

    <div id="journal-5059-notes" class="wiki"><p>Very interesting.</p>


<blockquote>

	<p>TIFF image from scratch with exiv2 commands?</p>


</blockquote>

	<p>One aim I had with exiftool when starting using it was to be able to rebuild all metadata from dng files and rebuid it to cdng spec. Not sure if that would be possible with exiv2. Probably should learn how to code better and create the wanted cdng file from scratch ;).</p>


	<p>Thanks for explaining. I just recently learnt how to work with the basic command in exiv2. <br />Regarding modifying the defaultscale tag it is only happening with a certain film mode in 720p filming raw material with canon eos cameras. The footage comes out stretched so a "unstretch" factor of 1.66 is very usable. The tag is not respected in Premiere or Davinci resolve but ACR and also dcraw reads this tag.</p>


	<p>So my own statement below was wrong. I actually referred to another tag now when I rechecked my emails(I think it was about the Baseline Exposure tag)</p>


<blockquote>

	<p>Dave Coffin(dcraw) once about dcraw not reading the defaultscale tag. He responded that usually this tag isn,t supposed to be modified and that was that :).</p>


</blockquote>

	<p>Thanks for sharing a great tool.</p></div>
    </div>
  </div>
  
  <div id="change-5060" class="journal has-notes">
    <div id="note-20">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-20" class="journal-link">#20</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="09 May 2016 09:36" href="/projects/exiv2/activity?from=2016-05-09">over 5 years</a> ago
      <span id="journal-5060-private_notes" class=""></span>
    </h4>

    <div id="journal-5060-notes" class="wiki"><p><em><strong>Daniel:</strong></em><br />Your code for src/tiffimage.cpp#2200 should be:<pre><code class="cplusplus syntaxhl">    <span class="kt">bool</span> <span class="n">TiffHeader</span><span class="o">::</span><span class="n">isImageTag</span><span class="p">(</span>      <span class="kt">uint16_t</span>       <span class="n">tag</span><span class="p">,</span>
                                      <span class="n">IfdId</span>          <span class="n">group</span><span class="p">,</span>
                                <span class="k">const</span> <span class="n">PrimaryGroups</span><span class="o">*</span> <span class="n">pPrimaryGroups</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">hasImageTags</span> <span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">// #1182</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hasImageTags_</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#ifdef DEBUG
</span>            <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"No image tags in this image</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
<span class="cp">#endif
</span>            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">//// .... //// don't change anything</span>
    <span class="p">}</span> <span class="c1">// TiffHeader::isImageTag</span></code></pre><em><strong>Andreas:</strong></em> <br />Thanks for your comments about global options and deriving Image classes.  I'm not going to change any of that code before v0.26.  These subjects can be revisited at some time in the future.</p>


	<p><em><strong>Both:</strong></em><br />This conversation has been very productive.  I hope to recruit and mentor a student in GSoC 2017 to work on raw image support (<a class="issue tracker-2 status-2 priority-4 priority-default" title="Feature: Better raw file support and test (Assigned)" href="/issues/992">#992</a>).  So the major features of v0.27 could be:</p>


	<ol>
	<li>Improved raw image code and test (<a class="issue tracker-2 status-2 priority-4 priority-default" title="Feature: Better raw file support and test (Assigned)" href="/issues/992">#992</a>)</li>
		<li>Update the version of Adobe XMPsdk in our code base (<a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Upgrade xmpsdk source to Adobe&#39;s current version (Closed)" href="/issues/941">#941</a>)</li>
		<li>Coverity Scan (<a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Use Coverity SCAN on exiv2 code-base (Closed)" href="/issues/883">#883</a>)</li>
		<li>Harden the video code (<a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Video Code Umbrella (Closed)" href="/issues/1068">#1068</a>)</li>
		<li>Additional image (webp/webm) formats (<a class="issue tracker-2 status-1 priority-4 priority-default" title="Feature: Add support for webm video format. (New)" href="/issues/1048">#1048</a>)</li>
		<li>Mobile (iOS and Android) build and test support</li>
	</ol>


	<p>Lots of work ahead.</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/1182.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/1182.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
