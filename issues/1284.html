<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Bug #1284: Possible exiv2 0.26-svn bug - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="TE6uosAFxZRnja62QQ1By49w1RKhtl4EQqzz+Xqwi7GuAwVNsn8JlDLpsbr+2k34sOKBa1BV/76/jGNxOYls3g==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="alternate" type="application/atom+xml" title="Exiv2 - Bug #1284: Possible exiv2 0.26-svn bug" href="https://dev.exiv2.org/issues/1284.atom" />
<script src="/javascripts/context_menu.js?1550767427"></script><link rel="stylesheet" media="screen" href="/stylesheets/context_menu.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-issues action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="issues" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="issues" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="">
    <div id="sidebar">
          <h3>Issues</h3>

<ul>
<li><a href="/projects/exiv2/issues?set_filter=1">View all issues</a></li>
<li><a href="/projects/exiv2/issues/report">Summary</a></li>

</ul>









        
    </div>

    <div id="content">
        
        <div class="contextual">





</div>


<h2>Bug #1284</h2>

<div class="issue tracker-1 status-5 priority-4 priority-default closed details">

  <div class="gravatar-with-child">
    
    
  </div>

<div class="subject">
<div><h3>Possible exiv2 0.26-svn bug</h3></div>
</div>
        <p class="author">
        Added by <a class="user active" href="/users/4748">Wil Cowb</a> <a title="13 Mar 2017 15:18" href="/projects/exiv2/activity?from=2017-03-13">over 4 years</a> ago.
        Updated <a title="14 Mar 2017 19:59" href="/projects/exiv2/activity?from=2017-03-14">over 4 years</a> ago.
        </p>

<div class="attributes">
<div class="splitcontent"><div class="splitcontentleft"><div class="status attribute"><div class="label">Status:</div><div class="value">Closed</div></div><div class="priority attribute"><div class="label">Priority:</div><div class="value">Normal</div></div><div class="assigned-to attribute"><div class="label">Assignee:</div><div class="value"><a class="user active" href="/users/119">Robin Mills</a></div></div><div class="category attribute"><div class="label">Category:</div><div class="value">xmp</div></div><div class="fixed-version attribute"><div class="label">Target version:</div><div class="value"><a title="28 Apr 2017" href="/versions/52">0.26</a></div></div></div><div class="splitcontentleft"><div class="start-date attribute"><div class="label">Start date:</div><div class="value">13 Mar 2017</div></div><div class="due-date attribute"><div class="label">Due date:</div><div class="value"></div></div><div class="progress attribute"><div class="label">% Done:</div><div class="value"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent">100%</p></div></div><div class="estimated-hours attribute"><div class="label">Estimated time:</div><div class="value">3.00 h</div></div></div></div>


</div>

<hr />
<div class="description">
  <div class="contextual">
  
  </div>

  <p><strong>Description</strong></p>
  <div class="wiki">
  <p>Hello,</p>


	<p>Here is a sample image:<br /><a class="external" href="https://drive.google.com/open?id=0B5_iknSPeSNBcGFZcUduTzJsZzQ">https://drive.google.com/open?id=0B5_iknSPeSNBcGFZcUduTzJsZzQ</a></p>


	<p>The XMP packet in the image start with :</p>


	<p><?xpacket begin='' id='W5M0MpCehiHzreSzNTczkc9d'?><br />&lt;x:xmpmeta xmlns:x="adobe:ns:meta/"&gt;&lt;rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;&lt;rdf:Description rdf:about="uuid:faf5bdd5-ba3d-11da-ad31-d33d75182f1b" xmlns:xmp="http://ns.adobe.com/xap/1.0/"&gt;&lt;xmp:CreatorTool&gt;Microsoft Photo Gallery 16.4.3528.331&lt;/xmp:CreatorTool&gt;&lt;/rdf:Description&gt;&lt;rdf:Description rdf:about="uuid:faf5bdd5-ba3d-11da-ad31-d33d75182f1b" xmlns:prefix0="http://iptc.org/std/Iptc4xmpExt/2008-02-29/"&gt;&lt;prefix0:LocationCreated&gt;&lt;rdf:Bag xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;&lt;rdf:li&gt;&lt;rdf:Description xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;&lt;prefix0:CountryName xmlns:prefix0="http://iptc.org/std/Iptc4xmpExt/2008-02-29/"&gt;Canada&lt;/prefix0:CountryName&gt;&lt;prefix1:ProvinceState xmlns:prefix1="http://iptc.org/std/Iptc4xmpExt/2008-02-29/"&gt;AB&lt;/prefix1:ProvinceState&gt;&lt;prefix2:City xmlns:prefix2="http://iptc.org/std/Iptc4xmpExt/2008-02-29/"&gt;Alberta&lt;/prefix2:City&gt;&lt;/rdf:Description&gt;</p>


	<p>Exiv2 CLI tool said that a XMP namespace do not match.</p>


	<p>I thought maybe the XMP definition is be fully implemented in Exiv2. Can you investigate when you have a chance please?</p>
  </div>
</div>






<hr />
<div id="relations">
<div class="contextual">
</div>

<p><strong>Related issues</strong></p>

<form data-cm-url="/issues/context_menu" action="/issues/1284" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="MMrRqoehLwwDElJCK0UoPZssO1ZU777VLM6QPCmuykTSh3pF9dvjDFZ2TU6UkiQOpL5vL6UMH2/R7gC0apctKw==" />
  <table class="list issues odd-even"><tr id="relation-262" class="issue hascontextmenu issue tracker-2 status-5 priority-4 priority-default closed"><td class="checkbox"><input type="checkbox" name="ids[]" value="941" /></td><td class="subject" style="width: 50%">Related to Exiv2 - <a class="issue tracker-2 status-5 priority-4 priority-default closed" href="/issues/941">Feature #941</a>: Upgrade xmpsdk source to Adobe&#39;s current version</td><td class="status">Closed</td><td class="start_date">27 Dec 2013</td><td class="due_date"></td><td class="done_ratio"><table class="progress progress-100"><tr><td style="width: 100%;" class="closed" title="100%"></td></tr></table><p class="percent"></p></td><td class="buttons"><a title="Actions" class="icon-only icon-actions js-contextmenu" href="#">Actions</a></td></tr></table>
</form>
<form class="new_relation" id="new-relation-form" style="display: none;" action="/issues/1284/relations" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />


<p><select onchange="setPredecessorFieldsVisibility();" name="relation[relation_type]" id="relation_relation_type"><option selected="selected" value="relates">Related to</option>
<option value="duplicates">Is duplicate of</option>
<option value="duplicated">Has duplicate</option>
<option value="blocks">Blocks</option>
<option value="blocked">Blocked by</option>
<option value="precedes">Precedes</option>
<option value="follows">Follows</option>
<option value="copied_to">Copied to</option>
<option value="copied_from">Copied from</option></select>
Issue #<input size="10" type="text" name="relation[issue_to_id]" id="relation_issue_to_id" />
<span id="predecessor_fields" style="display:none;">
Delay: <input size="3" type="text" name="relation[delay]" id="relation_delay" /> days
</span>
<input type="submit" name="commit" value="Add" data-disable-with="Add" />
<a href="#" onclick="$(&quot;#new-relation-form&quot;).hide();; return false;">Cancel</a>
</p>

<script>
//<![CDATA[
observeAutocompleteField('relation_issue_to_id', '/issues/auto_complete?issue_id=1284&project_id=exiv2&scope=all')
//]]>
</script>

<script>
//<![CDATA[
setPredecessorFieldsVisibility();
//]]>
</script>

</form>
</div>

</div>




<div id="history">
<h3>History</h3>
  <div id="change-5911" class="journal has-notes has-details">
    <div id="note-1">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-1" class="journal-link">#1</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="13 Mar 2017 17:01" href="/projects/exiv2/activity?from=2017-03-13">over 4 years</a> ago
      <span id="journal-5911-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>New</i> to <i>Assigned</i></li>
       <li><strong>Assignee</strong> set to <i>Robin Mills</i></li>
       <li><strong>% Done</strong> changed from <i>0</i> to <i>30</i></li>
       <li><strong>Estimated time</strong> set to <i>3.00 h</i></li>
    </ul>
    <div id="journal-5911-notes" class="wiki"><p>Wil:</p>


	<p>Thank you for reporting this and providing the test file.  Is that photo in New Zealand?</p>


	<p>I've reproduced the fault as follows:<pre>520 rmills@rmillsmbp:~ $ exiv2 -px ~/Downloads/20160911_132121.jpg  
Error: XMP Toolkit error 101: Schema namespace URI and prefix mismatch
Warning: Failed to decode XMP metadata.
521 rmills@rmillsmbp:~ $</pre>This is an error being thrown by the XMPsdk embedded in Exiv2.  This error isn't being thrown by the latest Adobe XMPsdk:<pre>526 rmills@rmillsmbp:~/gnu/xmpsdk $ XMP-Toolkit-SDK-CC201607/samples/target/macintosh/intel_64/Release/DumpFile ~/Downloads/20160911_132121.jpg 
Dumping JPEG file 
    [size 2499072 (0x262200)]
  JPEG:FFD8 
      [offset 0 (0x0),SOI]
...
OK
527 rmills@rmillsmbp:~/gnu/xmpsdk $</pre>Exiv2 can perform as similar file analysis:<pre>528 rmills@rmillsmbp:~/gnu/xmpsdk $ exiv2 -pS ~/Downloads/20160911_132121.jpg 
STRUCTURE OF JPEG FILE: /Users/rmills/Downloads/20160911_132121.jpg
 address | marker       |  length | data
       0 | 0xffd8 SOI  
       2 | 0xffe0 APP0  |      16 | JFIF.....H.H....
      20 | 0xffe1 APP1  |   14936 | Exif..MM.*......................
   14958 | 0xffe4 APP4  |   13144 | ...............................
   28104 | 0xffe5 APP5  |      26 | ....2016:09:11 19:21:21...
   28132 | 0xffe1 APP1  |   13429 | http://ns.adobe.com/xap/1.0/.&lt;?x
   41563 | 0xffdb DQT   |      67 
   41632 | 0xffdb DQT   |      67 
   41701 | 0xffc0 SOF0  |      17 
   41720 | 0xffc4 DHT   |      31 
   41753 | 0xffc4 DHT   |     181 
   41936 | 0xffc4 DHT   |      31 
   41969 | 0xffc4 DHT   |     181 
   42152 | 0xffda SOS  
529 rmills@rmillsmbp:~/gnu/xmpsdk $</pre>And exiv2 can extract the "raw" XMP.<pre>521 rmills@rmillsmbp:~ $ exiv2 -pX ~/Downloads/20160911_132121.jpg  | xmllint --format - 
&lt;?xml version="1.0"?&gt;
&lt;?xpacket begin='﻿' id='W5M0MpCehiHzreSzNTczkc9d'?&gt;
&lt;x:xmpmeta xmlns:x="adobe:ns:meta/"&gt;
  &lt;rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;
    &lt;rdf:Description xmlns:xmp="http://ns.adobe.com/xap/1.0/" rdf:about="uuid:faf5bdd5-ba3d-11da-ad31-d33d75182f1b"&gt;
      &lt;xmp:CreatorTool&gt;Microsoft Photo Gallery 16.4.3528.331&lt;/xmp:CreatorTool&gt;
    &lt;/rdf:Description&gt;
    &lt;rdf:Description xmlns:prefix0="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" rdf:about="uuid:faf5bdd5-ba3d-11da-ad31-d33d75182f1b"&gt;
      &lt;prefix0:LocationCreated&gt;
        &lt;rdf:Bag xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;
          &lt;rdf:li&gt;
            &lt;rdf:Description xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;
              &lt;prefix0:CountryName xmlns:prefix0="http://iptc.org/std/Iptc4xmpExt/2008-02-29/"&gt;Canada&lt;/prefix0:CountryName&gt;
              &lt;prefix1:ProvinceState xmlns:prefix1="http://iptc.org/std/Iptc4xmpExt/2008-02-29/"&gt;AB&lt;/prefix1:ProvinceState&gt;
              &lt;prefix2:City xmlns:prefix2="http://iptc.org/std/Iptc4xmpExt/2008-02-29/"&gt;Alberta&lt;/prefix2:City&gt;
            &lt;/rdf:Description&gt;
          &lt;/rdf:li&gt;
        &lt;/rdf:Bag&gt;
      &lt;/prefix0:LocationCreated&gt;
    &lt;/rdf:Description&gt;
  &lt;/rdf:RDF&gt;
&lt;/x:xmpmeta&gt;
&lt;?xpacket end='w'?&gt;
522 rmills@rmillsmbp:~ $</pre>I don't know the meaning of the XMPsdk exception: <em>Error: XMP Toolkit error 101: Schema namespace URI and prefix mismatch</em>.  It's clearly legal XML, however there something about the namespace declarations that is upsetting XMPsdk.  The pattern of XMP/namespaces looks similar to test/data/exiv2-1112.xmp<pre>535 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pa test/data/exiv2-bug1112.xmp 
Exif.Photo.DateTimeDigitized                 Ascii      20  2012:02:01 14:28:00
Iptc.Application2.DigitizationDate           Date        8  2012-02-01
Iptc.Envelope.CharacterSet                   String      3  G
Xmp.xmp.CreateDate                           XmpText    25  2012-02-01T16:28:00+02:00
536 rmills@rmillsmbp:~/gnu/exiv2/trunk $ cat test/data/exiv2-bug1112.xmp 
&lt;?xpacket begin="﻿" id="W5M0MpCehiHzreSzNTczkc9d"?&gt;
&lt;x:xmpmeta xmlns:x="adobe:ns:meta/" x:xmptk="XMP Core 4.4.0-Exiv2"&gt;
 &lt;rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;
  &lt;rdf:Description rdf:about="" 
    xmlns:xmp="http://ns.adobe.com/xap/1.0/" 
   xmp:CreateDate="2012-02-01T16:28:00+02:00"/&gt;
 &lt;/rdf:RDF&gt;
&lt;/x:xmpmeta&gt;
&lt;?xpacket end="w"?&gt;537 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>I think there's something in prefix0 (or prefix1 or prefix2) causing XMPsdk's code <em><strong><code>&lt;exiv2-dir&gt;/xmpsdk/src/ParseRDF.cpp</code></strong></em> to stop parsing the file.</p>


	<p>I think you will have to register the namespaces prefix0/1/2 as they are not registered by default with XMPsdk.  You can determine the pre-registered namespaces with the command: <pre>$ exiv2 --verbose --version --grep xmlns 
...
xmlns=xmpNote:http://ns.adobe.com/xmp/note/
xmlns=xmpRights:http://ns.adobe.com/xap/1.0/rights/
xmlns=xmpT:http://ns.adobe.com/xap/1.0/t/
xmlns=xmpTPg:http://ns.adobe.com/xap/1.0/t/pg/
xmlns=xmpidq:http://ns.adobe.com/xmp/Identifier/qual/1.0/
541 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>I've tried to register prefix0, prefix1 and prefix2:<pre>565 rmills@rmillsmbp:~/gnu/exiv2 $ exiv2 \
  -M'reg prefix0 http://iptc.org/std/Iptc4xmpExt/2008-02-29/' \
  -M'reg prefix1 http://iptc.org/std/Iptc4xmpExt/2008-02-29/' \
  -M'reg prefix2 http://iptc.org/std/Iptc4xmpExt/2008-02-29/' \
 ~/Downloads/20160911_132121-2.jpg
Error: XMP Toolkit error 101: Schema namespace URI and prefix mismatch 
Warning: Failed to decode XMP metadata.
566 rmills@rmillsmbp:~/gnu/exiv2 $</pre>There is something suspicious about the declaration of <strong>prefix0</strong>, as it's declared twice.  However <strong>rdf</strong> is also declared twice without obvious panic.  I also notice that the URI for prefix0, prefix1 and prefix2 are identical.  I don't know if that's significant.<pre>567 rmills@rmillsmbp:~/gnu/exiv2 $ exiv2 -pX ~/Downloads/20160911_132121-3.jpg | xmllint --format - | grep prefix 
    &lt;rdf:Description xmlns:prefix0="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" rdf:about="uuid:faf5bdd5-ba3d-11da-ad31-d33d75182f1b"&gt;
      &lt;prefix0:LocationCreated&gt;
              &lt;prefix0:CountryName xmlns:prefix0="http://iptc.org/std/Iptc4xmpExt/2008-02-29/"&gt;Canada&lt;/prefix0:CountryName&gt;
              &lt;prefix1:ProvinceState xmlns:prefix1="http://iptc.org/std/Iptc4xmpExt/2008-02-29/"&gt;AB&lt;/prefix1:ProvinceState&gt;
              &lt;prefix2:City xmlns:prefix2="http://iptc.org/std/Iptc4xmpExt/2008-02-29/"&gt;Alberta&lt;/prefix2:City&gt;
      &lt;/prefix0:LocationCreated&gt;
568 rmills@rmillsmbp:~/gnu/exiv2 $ </pre></p>


	<p>Incidentally, it's possible in exiv2 to extract/edit/insert RAW XML/XMP as follows:<pre>$ exiv2 -pX foo.jpg | xmllint bla bla | exiv2 -iX- foo.jpg</pre>I'll run your file through the debugger in the next 24 hours to understand more.  If the analysis above leads you to understand more about this issue, please share your thoughts.</p></div>
    </div>
  </div>
  
  <div id="change-5912" class="journal has-notes">
    <div id="note-2">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-2" class="journal-link">#2</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="13 Mar 2017 19:16" href="/projects/exiv2/activity?from=2017-03-13">over 4 years</a> ago
      <span id="journal-5912-private_notes" class=""></span>
    </h4>

    <div id="journal-5912-notes" class="wiki"><p>I see this is Alberta and not NZ.  I've been in Glacier National Park and never crossed into Canada.  One day.  We were in the Southern Alps of New Zealand in January and thought "Alpine Snow in September.  Must be NZ!".</p>


	<p>I've run your file in the debugger.  It's throwing the exception here in VerifyXPathRoot in XMPCoreImpl.cpp:<pre>        // The propName is qualified. Make sure the prefix is legit. Use the associated URI and qualified name.

        size_t prefixLen = colonPos - propName + 1;    // ! Include the colon.
        VerifySimpleXMLName ( colonPos+1, colonPos+strlen(colonPos) );

        XMP_VarString prefix ( propName, prefixLen );
        XMP_StringMapPos prefixPos = sNamespacePrefixToURIMap-&gt;find ( prefix );
        if ( prefixPos == sNamespacePrefixToURIMap-&gt;end() ) {
            XMP_Throw ( "Unknown schema namespace prefix", kXMPErr_BadSchema ); // &lt;--- trouble here
        }
        if ( prefix != uriPos-&gt;second ) {
            XMP_Throw ( "Schema namespace URI and prefix mismatch", kXMPErr_BadSchema );
        }</pre>The value of <em><strong><code>prefix = prefix0</code></strong></em>.  It's trying to parse <em><strong><code>prefix0:LocationCreated</code></strong></em>.  Why?  I don't know.  I think I'll add prefix0,1,2 to the predefined namespaces in XMPsdk and run it in the debugger.  I can't do that until Tuesday.</p>


	<p>Incidentally, I don't know if XMPsdk DumpFile actually parses the XMP - it might just dump the structure of the file.  Similar to exiv2 -pS.  However for certain, ReadingXMP does parse XMP.  For sure, XMPsdk 201607 is happy with that XMP.<pre>607 rmills@rmillsmbp:~/gnu/xmpsdk/XMP-Toolkit-SDK-CC201607/samples/target/macintosh/intel_64/Release $ ./ReadingXMP ~/Downloads/20160911_132121.jpg 

/Users/rmills/Downloads/20160911_132121.jpg is opened successfully
CreatorTool = G925W8VLU4CPG2
dc:title in Englisuh = 
dc:title in French = 
Flash Used = False

XMP dumped to XMPDump.txt
608 rmills@rmillsmbp:~/gnu/xmpsdk/XMP-Toolkit-SDK-CC201607/samples/target/macintosh/intel_64/Release $ cat XMPDump.txt 
Dumping XMPMeta object ""  (0x0)

   xmp:  http://ns.adobe.com/xap/1.0/  (0x80000000 : schema)
      xmp:CreatorTool = "G925W8VLU4CPG2" 
      xmp:ModifyDate = "2016-11-02T14:41:56" 
      xmp:CreateDate = "2016-09-11T13:21:21" 

   Iptc4xmpExt:  http://iptc.org/std/Iptc4xmpExt/2008-02-29/  (0x80000000 : schema)
      Iptc4xmpExt:LocationCreated  (0x200 : isArray)
         [1]  (0x100 : isStruct)
            Iptc4xmpExt:CountryName = "Canada" 
            Iptc4xmpExt:ProvinceState = "AB" 
            Iptc4xmpExt:City = "Alberta" 

   xmpMM:  http://ns.adobe.com/xap/1.0/mm/  (0x80000000 : schema)
      xmpMM:InstanceID = "uuid:faf5bdd5-ba3d-11da-ad31-d33d75182f1b" 

   tiff:  http://ns.adobe.com/tiff/1.0/  (0x80000000 : schema)
      tiff:ImageWidth = "5312" 
      tiff:ImageLength = "2988" 
      tiff:Orientation = "1" 
      tiff:XResolution = "72/1" 
      tiff:YResolution = "72/1" 
      tiff:ResolutionUnit = "2" 
      tiff:YCbCrPositioning = "1" 
      tiff:Make = "samsung" 
      tiff:Model = "SM-G925W8" 

   exif:  http://ns.adobe.com/exif/1.0/  (0x80000000 : schema)
      exif:ColorSpace = "1" 
      exif:PixelXDimension = "5312" 
      exif:PixelYDimension = "2988" 
      exif:ImageUniqueID = "A16LLIC08SM A16LLIL02GM
" 
      exif:ExposureTime = "1/386" 
      exif:FNumber = "19/10" 
      exif:ExposureProgram = "2" 
      exif:ShutterSpeedValue = "859/100" 
      exif:ApertureValue = "185/100" 
      exif:BrightnessValue = "685/100" 
      exif:ExposureBiasValue = "0/10" 
      exif:MaxApertureValue = "185/100" 
      exif:MeteringMode = "2" 
      exif:FocalLength = "430/100" 
      exif:ExposureMode = "0" 
      exif:WhiteBalance = "0" 
      exif:FocalLengthIn35mmFilm = "28" 
      exif:SceneCaptureType = "0" 
      exif:DateTimeOriginal = "2016-09-11T13:21:21" 
      exif:ISOSpeedRatings  (0x600 : isOrdered isArray)
         [1] = "40" 
      exif:ExifVersion = "0220" 
      exif:FlashpixVersion = "0100" 
      exif:Flash  (0x100 : isStruct)
         exif:Fired = "False" 
         exif:Return = "0" 
         exif:Mode = "0" 
         exif:Function = "False" 
         exif:RedEyeMode = "False" 

   photoshop:  http://ns.adobe.com/photoshop/1.0/  (0x80000000 : schema)
      photoshop:DateCreated = "2016-09-11T13:21:21" 
609 rmills@rmillsmbp:~/gnu/xmpsdk/XMP-Toolkit-SDK-CC201607/samples/target/macintosh/intel_64/Release $</pre></p></div>
    </div>
  </div>
  
  <div id="change-5913" class="journal has-notes has-details">
    <div id="note-3">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-3" class="journal-link">#3</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="13 Mar 2017 22:31" href="/projects/exiv2/activity?from=2017-03-13">over 4 years</a> ago
      <span id="journal-5913-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Assigned</i> to <i>Resolved</i></li>
       <li><strong>% Done</strong> changed from <i>30</i> to <i>90</i></li>
    </ul>
    <div id="journal-5913-notes" class="wiki"><p>There is no doubt about what is causing this.  The version of XMPsdk embedded in Exiv2 enforces the condition that every namespace prefix (such as prefix0 and prefix1) a different URI.  I've modified your file with a Hex Editor (HexFiend on the Mac) so that <em><strong><code>xmlns:prefix0="http://iptc.org/std/Iptc4xmpExt/2008-02-20/</code></strong></em> and similar for prefix1 and prefix2. <pre>649 rmills@rmillsmbp:~/Downloads $ exiv2 -pX 20160911_132121.jpg | xmllint --format -
&lt;?xml version="1.0"?&gt;
&lt;?xpacket begin='﻿' id='W5M0MpCehiHzreSzNTczkc9d'?&gt;
&lt;x:xmpmeta xmlns:x="adobe:ns:meta/"&gt;
  &lt;rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;
    &lt;rdf:Description xmlns:xmp="http://ns.adobe.com/xap/1.0/" rdf:about="uuid:faf5bdd5-ba3d-11da-ad31-d33d75182f1b"&gt;
      &lt;xmp:CreatorTool&gt;Microsoft Photo Gallery 16.4.3528.331&lt;/xmp:CreatorTool&gt;
    &lt;/rdf:Description&gt;
    &lt;rdf:Description xmlns:prefix0="http://iptc.org/std/Iptc4xmpExt/2008-02-20/" rdf:about="uuid:faf5bdd5-ba3d-11da-ad31-d33d75182f1b"&gt;
      &lt;prefix0:LocationCreated&gt;
        &lt;rdf:Bag xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;
          &lt;rdf:li&gt;
            &lt;rdf:Description xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;
              &lt;prefix0:CountryName xmlns:prefix0="http://iptc.org/std/Iptc4xmpExt/2008-02-20/"&gt;Canada&lt;/prefix0:CountryName&gt;
              &lt;prefix1:ProvinceState xmlns:prefix1="http://iptc.org/std/Iptc4xmpExt/2008-02-21/"&gt;AB&lt;/prefix1:ProvinceState&gt;
              &lt;prefix2:City xmlns:prefix2="http://iptc.org/std/Iptc4xmpExt/2008-02-22/"&gt;Alberta&lt;/prefix2:City&gt;
            &lt;/rdf:Description&gt;
          &lt;/rdf:li&gt;
        &lt;/rdf:Bag&gt;
      &lt;/prefix0:LocationCreated&gt;
    &lt;/rdf:Description&gt;
  &lt;/rdf:RDF&gt;
&lt;/x:xmpmeta&gt;
&lt;?xpacket end='w'?&gt;</pre><pre>650 rmills@rmillsmbp:~/Downloads $ exiv2 -px 20160911_132121.jpg
Xmp.xmp.CreatorTool                          XmpText    37  Microsoft Photo Gallery 16.4.3528.331
Xmp.prefix0.LocationCreated                  XmpText     0  type="Bag" 
Xmp.prefix0.LocationCreated[1]               XmpText     0  type="Struct" 
Xmp.prefix0.LocationCreated[1]/prefix0:CountryName XmpText     6  Canada
Xmp.prefix0.LocationCreated[1]/prefix1:ProvinceState XmpText     2  AB
Xmp.prefix0.LocationCreated[1]/prefix2:City  XmpText     7  Alberta
Xmp.xmpMM.InstanceID                         XmpText    41  uuid:faf5bdd5-ba3d-11da-ad31-d33d75182f1b
651 rmills@rmillsmbp:~/Downloads $ </pre>I've seen something similar recently <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: fails to read any XMP metadata when duplicates present (Closed)" href="/issues/1276">#1276</a> in which the exception is thrown in RDFParse.cpp hence my earlier guess about the cause of the fault.  It's possible that the <em><strong>unique URI</strong></em>  condition was specified in an earlier edition of the XMP Spec and subsequently relaxed.</p>


	<p>I'm very reluctant to change code in the embedded copy of XMPsdk in Exiv2 because:<br />1) It has worked well for years with very few issues.<br />2) This issue has been in Exiv2 for years and has not been introduced by changes for v0.26.<br />3) We have a project <em>already in progress</em> to update to the latest XMPsdk in Exiv2 v0.27 (<a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Upgrade xmpsdk source to Adobe&#39;s current version (Closed)" href="/issues/941">#941</a>)<br />4) I'm in the last few days of Exiv2 v0.26 and very reluctant to change XMPsdk code as the consequences are unpredictable and unknowable.</p>


	<p>I've associated this issue with <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Upgrade xmpsdk source to Adobe&#39;s current version (Closed)" href="/issues/941">#941</a> so that when <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Upgrade xmpsdk source to Adobe&#39;s current version (Closed)" href="/issues/941">#941</a> is serviced, this issue will be easily visible.  Based on my investigation into XMPdump, I expect this issue to disappear when we upgrade XMPsdk for v0.27.</p>


	<p>I feel I've pursued this matter as far as I can at the moment and this issue should be closed.  Do you agree?</p></div>
    </div>
  </div>
  
  <div id="change-5914" class="journal has-notes">
    <div id="note-4">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-4" class="journal-link">#4</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4748">Wil Cowb</a> <a title="14 Mar 2017 15:38" href="/projects/exiv2/activity?from=2017-03-14">over 4 years</a> ago
      <span id="journal-5914-private_notes" class=""></span>
    </h4>

    <div id="journal-5914-notes" class="wiki"><p>Hello Robin,</p>


	<p>Thank you very much for taking the time to investigate this.</p>


	<p>The mountains on the picture are Canadian Rockies by Calgary, Alberta, Canada.</p>


	<p>Yes I agree 100% with your plan. There is no need to introduce any major changes in Exiv2 code right now.<br />The only reason I even noticed that is because Exiv2 actually crashes on Linux Mint instead of throwing an C++ exception.<br />Looks like there is some issue with libc++ in Mint because after I moved to a different distro (Manjaro 17) Exiv2 does not crash anymore.</p>


	<p>On a separate note, Do you think if I got rid of these fields the issue will dissapear?<br />I stopped using Microsoft Photo Gallery because it will be discontiuned soon so can delete all the mess it made and forget about it.</p>


	<p>[XMP-rdf]       About                           : uuid:faf5bdd5-ba3d-11da-ad31-d33d75182f1b<br />[XMP-xmp]       CreatorTool                     : Microsoft Photo Gallery 16.4.3528.331<br />[XMP-iptcExt]   LocationCreatedCountryName      : Canada<br />[XMP-iptcExt]   LocationCreatedProvinceState    : AB<br />[XMP-iptcExt]   LocationCreatedCity             : Alberta</p></div>
    </div>
  </div>
  
  <div id="change-5915" class="journal has-notes has-details">
    <div id="note-5">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-5" class="journal-link">#5</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Mar 2017 17:09" href="/projects/exiv2/activity?from=2017-03-14">over 4 years</a> ago
      <span id="journal-5915-private_notes" class=""></span>
    </h4>

    <ul class="details">
       <li><strong>Status</strong> changed from <i>Resolved</i> to <i>Closed</i></li>
       <li><strong>% Done</strong> changed from <i>90</i> to <i>100</i></li>
    </ul>
    <div id="journal-5915-notes" class="wiki"><p>I'm very surprised to hear that Exiv2 is crashing on Mint.  Can you raise a report about that and I'll create a Mint VM and investigate (after v0.26 ships).  Do you know if it's crashing generally, or only on this file?  Our buildserver uses Kubuntu and I have VMs for Fedora and FreeBSD which were created to investigate platform issues raised by users.</p>


	<p>The quick fix is to delete the XMP from your images with:<pre>$ exiv2 -dx image ...</pre>As always:<br />1 <em><strong>be sure to backup your images</strong></em> before you try this.<br />2 This will throw out the XMP in your image.  If somebody (apart from Microsoft Photo Gallery) has been editing the XMP, you'll also throw away anything they have stored in XMP.</p>


	<p>Thanks for getting back to me about.  I'm going to close this one.</p></div>
    </div>
  </div>
  
  <div id="change-5916" class="journal has-notes">
    <div id="note-6">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-6" class="journal-link">#6</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4748">Wil Cowb</a> <a title="14 Mar 2017 17:14" href="/projects/exiv2/activity?from=2017-03-14">over 4 years</a> ago
      <span id="journal-5916-private_notes" class=""></span>
    </h4>

    <div id="journal-5916-notes" class="wiki"><p>I just found out that it crashes on Manjaro too.</p>


	<p>I narrowed the issue down and looks like it only crashes when:</p>


	<p>1. You have the following packages installed:<br />gdb (7.12.1-1)<br />gdb-common (7.12.1-1)<br />2. Run application in "debug" mode, e.g. if I use digiKam I would run 'digikam.appimage debug' in terminal.</p>


	<p>Too bad I actually moved from Mint to Manjaro because of this...</p></div>
    </div>
  </div>
  
  <div id="change-5917" class="journal has-notes">
    <div id="note-7">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-7" class="journal-link">#7</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Mar 2017 17:21" href="/projects/exiv2/activity?from=2017-03-14">over 4 years</a> ago
      <span id="journal-5917-private_notes" class=""></span>
    </h4>

    <div id="journal-5917-notes" class="wiki"><p>Is it crashing from the exiv2 command-line, or from digiKam?  Gilles has reported numerous crashes which turned out to be build issues with digiKam.</p>


	<p>I'm really only tooled up to deal with issues which can be reproduced from the command-line using the exiv2 samples - especially exiv2(.exe).  The primary development platform in MacOS-X.  The code is very portable.  Platform dependent errors are rather unusual.</p></div>
    </div>
  </div>
  
  <div id="change-5918" class="journal has-notes">
    <div id="note-8">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-8" class="journal-link">#8</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/4748">Wil Cowb</a> <a title="14 Mar 2017 17:35" href="/projects/exiv2/activity?from=2017-03-14">over 4 years</a> ago
      <span id="journal-5918-private_notes" class=""></span>
    </h4>

    <div id="journal-5918-notes" class="wiki"><p>It is crashing from digiKam. Gilles is aware of the issue now. Initially he thought Exiv2 is the one not creating C++ exceptions but now he knows that the issue is somewhere else.<br />I thought the issue was with lib++ library in Linux Mint so I tried another Linux distribution but it turned out that the debugger is the one causing problems.<br />I just deleted it and keep working on my images. Got too many of them piled up waiting to be processed.</p></div>
    </div>
  </div>
  
  <div id="change-5919" class="journal has-notes">
    <div id="note-9">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-9" class="journal-link">#9</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Mar 2017 18:10" href="/projects/exiv2/activity?from=2017-03-14">over 4 years</a> ago
      <span id="journal-5919-private_notes" class=""></span>
    </h4>

    <div id="journal-5919-notes" class="wiki"><p>Right.  Thanks for the update.  digiKam is a big beast and I've no idea how to use it, built it or debug it.  I try to reduce complexity and focus purely on Exiv2 code.  There's 100k lines of code of which I probably wrote about 10-20k and have modified another 10-20k.  Plenty of puzzles to keep me busy.</p>


	<p>You work on your images, I'll work on Exiv2 v0.26 and Gilles can worry about digiKam.  We'll all survive - well we've always survived until now!</p></div>
    </div>
  </div>
  
  <div id="change-5920" class="journal has-notes">
    <div id="note-10">
    <div class="contextual">
      <span class="journal-actions"></span>
      <a href="#note-10" class="journal-link">#10</a>
    </div>
    <h4>
      
      Updated by <a class="user active" href="/users/76">Gilles Caulier</a> <a title="14 Mar 2017 19:59" href="/projects/exiv2/activity?from=2017-03-14">over 4 years</a> ago
      <span id="journal-5920-private_notes" class=""></span>
    </h4>

    <div id="journal-5920-notes" class="wiki"><p>The C++ exception crash is NOT a compilation issue, for digiKam or Exiv2. I'm sure, else we will receive a lots of report about...</p>


	<p>But, i suspect a settings somewhere on Linux env. to turn on/off C++ exception at run time. I suspect that your Linux distro do something in background when you install GDB.</p>


	<p>This is a weird side effect, and for me it's a bug in Linux Distro. The C++ exception handling must be always enabled to prevent unwanted crash. Here i tested under Suse, Mageia, Centos, all work perfectly with GDB (or not)...</p></div>
    </div>
  </div>
  


</div>

<div style="clear: both;"></div>
<div class="contextual">





</div>


<div style="clear: both;"></div>


<p class="other-formats">Also available in:  <span><a class="atom" rel="nofollow" href="/issues/1284.atom">Atom</a></span>
  <span><a class="pdf" rel="nofollow" href="/issues/1284.pdf">PDF</a></span>
</p>





        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
