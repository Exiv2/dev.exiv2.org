<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Version 16 - History - How to add support for a new makernote - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="cidLyqfNXRlEbnD4cHmUpsHMMYhY0BR1IiXKmjg0HpSQauAl1beRGREKb/TPrpiV/l5l8akztc/fBVoSew35+w==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
<link rel="stylesheet" media="screen" href="/stylesheets/scm.css?1550767427" />
</head>
<body class="project-exiv2 has-main-menu controller-wiki action-annotate avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="wiki_pages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="wiki_pages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=wiki" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=wiki">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki selected" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <div class="contextual">
<a class="icon icon-edit" href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/edit">Edit</a>
<a class="icon icon-history" href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/history">History</a>
</div>



<h2><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote">How to add support for a new makernote</a> &#187; <a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/history">History</a> &#187; Version 16</h2>

<p>
  <em><a class="user active" href="/users/53">Andreas Huggel</a>, 18 Oct 2011 18:07 </em><br />
  
</p>


<table class="filecontent annotate">
<tbody>
<tr class="bloc-0">
    <th class="line-num">1</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/1">1</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>h1. How to add support for a new makernote</pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">2</th>
    <td class="revision"></td>
    <td class="author"></td>
    <td class="line-code"><pre></pre></td>
</tr>
<tr class="bloc-1">
    <th class="line-num">3</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/12">12</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>This page is a work in progress. For the moment it only documents the most common aspect of makernote maintenance:</pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">4</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/1">1</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre></pre></td>
</tr>
<tr class="bloc-2">
    <th class="line-num">5</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/10">10</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>h2. Changes needed to add a new group to an existing makernote</pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">6</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/1">1</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre></pre></td>
</tr>
<tr class="bloc-1">
    <th class="line-num">7</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/12">12</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>Groups consist of tags from the same composite tag in the TIFF structure, e.g., a sub-IFD or binary arrays. While the standard Exif groups are well defined and don&#39;t change, makernotes and the community&#39;s understanding of them tend to evolve and adding new groups of makernote tags to an existing makernote is a fairly common task. The changes necessary to add a new group to the Exiv2 library are binary compatible.</pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">8</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/1">1</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre></pre></td>
</tr>
<tr class="bloc-3">
    <th class="line-num">9</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/11">11</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>Revision r2620 is a complete example for the changes discussed here and the filenames below are linked to the corresponding portions of that changeset.</pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">10</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/1">1</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre></pre></td>
</tr>
<tr class="bloc-4">
    <th class="line-num">11</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/9">9</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>&quot;*src/tags_int.hpp*&quot;:http://dev.exiv2.org/projects/exiv2/repository/revisions/2620/diff/trunk/src/tags_int.hpp</pre></td>
</tr>
<tr class="bloc-5">
    <th class="line-num">12</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/14">14</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>The middle part of an Exif key is the group name. E.g., the group of the key *Exif.NikonAFT.AFFineTune* is *NikonAFT*. </pre></td>
</tr>
<tr class="bloc-6">
    <th class="line-num">13</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/16">16</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>Every group needs a unique identifier in *@enum IfdId@*. E.g., the IfdId which corresponds to group *NikonAFT* is *@nikonAFTId@*. (The type is called @IfdId@ for historical reasons. Nowadays, it is used for all Exif groups, not only IFDs.)</pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">14</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/1">1</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre></pre></td>
</tr>
<tr class="bloc-3">
    <th class="line-num">15</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/11">11</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>&quot;*src/tags.cpp*&quot;:http://dev.exiv2.org/projects/exiv2/repository/revisions/2620/diff/trunk/src/tags.cpp</pre></td>
</tr>
<tr class="bloc-3">
    <th class="line-num">16</th>
    <td class="revision"></td>
    <td class="author"></td>
    <td class="line-code"><pre>Update the *@groupInfo[]@* table. This table links IFD id (@GroupInfo::ifdId_@), Group name (@GroupInfo::groupName_@) and taglists (@GroupInfo::tagList_@). Note that different groups can use the same taglist.</pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">17</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/1">1</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre></pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">18</th>
    <td class="revision"></td>
    <td class="author"></td>
    <td class="line-code"><pre>&quot;*src/&lt;MAKE&gt;mn_int.hpp*&quot;:http://dev.exiv2.org/projects/exiv2/repository/revisions/2620/diff/trunk/src/nikonmn_int.hpp</pre></td>
</tr>
<tr class="bloc-5">
    <th class="line-num">19</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/14">14</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>&lt;MAKE&gt; refers to the camera make, e.g., for Nikon makernotes, src/&lt;MAKE&gt;mn_int.hpp refers to the source file src/nikonmn_int.hpp.</pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">20</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/1">1</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>Add a *static function* to access the tag list, similar to the existing functions.</pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">21</th>
    <td class="revision"></td>
    <td class="author"></td>
    <td class="line-code"><pre>Add a *@static const TagInfo@* array variable for the taglist.</pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">22</th>
    <td class="revision"></td>
    <td class="author"></td>
    <td class="line-code"><pre>By convention, *pretty-print functions* are declared here as well.</pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">23</th>
    <td class="revision"></td>
    <td class="author"></td>
    <td class="line-code"><pre></pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">24</th>
    <td class="revision"></td>
    <td class="author"></td>
    <td class="line-code"><pre>&quot;*src/&lt;MAKE&gt;mn.cpp*&quot;:http://dev.exiv2.org/projects/exiv2/repository/revisions/2620/diff/trunk/src/nikonmn.cpp</pre></td>
</tr>
<tr class="bloc-1">
    <th class="line-num">25</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/12">12</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>The taglists and pretty-print mappings and functions defined here describe the tags and how their values are interpreted.</pre></td>
</tr>
<tr class="bloc-7">
    <th class="line-num">26</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/15">15</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>Define the *taglist* array and the *function to access the taglist*. If the parent tag, which refers to or contains the group doesn&#39;t have an entry in the parent group table yet, add that as well (@TagInfo(0x00b9, &quot;AFTune&quot;, ...@ in the example).</pre></td>
</tr>
<tr class="bloc-3">
    <th class="line-num">27</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/11">11</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>If new *pretty-print mappings* are required, define them here as well and use the *@EXV_PRINT_TAG@* macro in the print function field of the taglist array. If new *pretty-print functions* are required, define them here. See existing code for plenty of examples.</pre></td>
</tr>
<tr class="bloc-1">
    <th class="line-num">28</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/12">12</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre></pre></td>
</tr>
<tr class="bloc-1">
    <th class="line-num">29</th>
    <td class="revision"></td>
    <td class="author"></td>
    <td class="line-code"><pre>&quot;*src/tiffimage.cpp*&quot;:http://dev.exiv2.org/projects/exiv2/repository/revisions/2620/diff/trunk/src/tiffimage.cpp</pre></td>
</tr>
<tr class="bloc-1">
    <th class="line-num">30</th>
    <td class="revision"></td>
    <td class="author"></td>
    <td class="line-code"><pre>The configurations in this file describe how to decode and encode the tags from/to the binary makernote. </pre></td>
</tr>
<tr class="bloc-1">
    <th class="line-num">31</th>
    <td class="revision"></td>
    <td class="author"></td>
    <td class="line-code"><pre>Update the *@TiffCreator::tiffTreeStruct_[]@* and *@TiffCreator::tiffGroupStruct_[]@* tables. In @tiffTreeStruct_[]@, the new group must be added with its parent group and parent tag to define where in the TIFF tree it belongs to. (The root element is also listed to specify which TIFF tree(s) it is found in.)</pre></td>
</tr>
<tr class="bloc-1">
    <th class="line-num">32</th>
    <td class="revision"></td>
    <td class="author"></td>
    <td class="line-code"><pre>@tiffGroupStruct_[]@ describes the layout of the new group. Specify the tag in the parent group, which refers to the new group together with the respective composite TIFF component and for each tag of the group itself, which TIFF component is to be used to parse (read and write) it. Refer to the comments in the code and the existing table for more info and plenty of examples. The sample linked above also defines @ArrayCfg@ and @ArrayDef@ structures. These are only required for binary array components, to configure the component for the new group.</pre></td>
</tr>
<tr class="bloc-1">
    <th class="line-num">33</th>
    <td class="revision"></td>
    <td class="author"></td>
    <td class="line-code"><pre></pre></td>
</tr>
<tr class="bloc-1">
    <th class="line-num">34</th>
    <td class="revision"></td>
    <td class="author"></td>
    <td class="line-code"><pre>Finally, compile and test the library with the changes. In addition to simple read-tests, please also test if writing a tag in each new group works as expected.</pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">35</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/1">1</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre></pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">36</th>
    <td class="revision"></td>
    <td class="author"></td>
    <td class="line-code"><pre>h3. Documentation</pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">37</th>
    <td class="revision"></td>
    <td class="author"></td>
    <td class="line-code"><pre></pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">38</th>
    <td class="revision"></td>
    <td class="author"></td>
    <td class="line-code"><pre>The tag reference documentation is generated automatically, it requires just a trigger in the Makefile and an updated template.</pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">39</th>
    <td class="revision"></td>
    <td class="author"></td>
    <td class="line-code"><pre></pre></td>
</tr>
<tr class="bloc-8">
    <th class="line-num">40</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/5">5</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>*doc/templates/Makefile*</pre></td>
</tr>
<tr class="bloc-9">
    <th class="line-num">41</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/4">4</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>Add the name of the new group to the *@TABLES@* variable.</pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">42</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/1">1</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre></pre></td>
</tr>
<tr class="bloc-8">
    <th class="line-num">43</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/5">5</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>*doc/templates/tags-&lt;MAKE&gt;.html.in*</pre></td>
</tr>
<tr class="bloc-0">
    <th class="line-num">44</th>
    <td class="revision"><a href="/projects/exiv2/wiki/How_to_add_support_for_a_new_makernote/1">1</a></td>
    <td class="author">Andreas Huggel</td>
    <td class="line-code"><pre>Add a section for the new group, similar to existing sections.</pre></td>
</tr>
</tbody>
</table>


        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
