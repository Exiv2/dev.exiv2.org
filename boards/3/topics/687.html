<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>registering/deleting xmptags issue - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="0SqNESwm7xKYQfZi5NO0wzNnc96c17eHwGCyl3MsuE0zZyb+XlwjEs0l6W5bBLjwDPUnp200Fj09QCIfMBVfIg==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>registering/deleting xmptags issue</h2>

<div class="message">
<p><span class="author">Added by <a class="user active" href="/users/1485">andreas schmid</a> <a title="27 Oct 2010 09:12" href="/projects/exiv2/activity?from=2010-10-27">about 11 years</a> ago</span></p>
<div class="wiki">
<p>hi,</p>


	<p>im trying to register my own namespace for an xmptag and i can add it successfully with the command:<br />exiv2 -M 'reg whatevertag <a class="external" href="http://ns.whatevertag.pro/whatevertag/v1/">http://ns.whatevertag.pro/whatevertag/v1/</a>' -M'set Xmp.whatevertag.val asdfasd' image.jpg</p>


	<p>what i noticed is that sometimes it adds a namespace like 'whatevertag_1_' to the image so i have the one i registered ( Xmp.whatevertag.val) but also one like Xmp.whatevertag_1_.val which i don't really like.</p>


	<p>why is this tag in there?</p>


	<p>if i try to delete it what happens is that the tag gets deleted but a new one appears like: Xmp.whatevertag_1__1_.val</p>


	<p>any help?</p>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (7)</h3>
  <div class="message reply" id="message-694">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/687?r=694#message-694">RE: registering/deleting xmptags issue</a>
    -
    Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="27 Oct 2010 18:08" href="/projects/exiv2/activity?from=2010-10-27">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>This sounds vaguely familiar. Can you provide a sample image and the commands to reproduce the issue?</p></div>
  
  </div>
  <div class="message reply" id="message-712">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/687?r=712#message-712">RE: registering/deleting xmptags issue</a>
    -
    Added by <a class="user active" href="/users/1485">andreas schmid</a> <a title="03 Nov 2010 16:10" href="/projects/exiv2/activity?from=2010-11-03">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>this seems to happen only with some files.</p>


	<p>we tried it with  v.0.20 and v.0.19. same thing</p>


	<p>how to reproduce:<br />write with the following command on the attached 001.jpg<br /><pre>
exiv2 -M 'reg imageapp http://ns.imagapp.pro/imageapp/v1/' -M 'set Xmp.imageapp.uuid ab75b096-83d3-11df-91a5-000c2953179a' 001.jpg
</pre></p>


	<p>exiv2 doubles the namespace and writes a Xmp.imageapp_1_.uuid instead of overwrite the actual value which is already in.<br />the same happens if you clean up all metatdata lets say with expression media and run the command.</p>


	<p>the second attached file contains the double namespaces.</p>


	<p>let me know what you think</p></div>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/218">001.jpg</a>    <span class="size">(899 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/218/001.jpg">001.jpg</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/219">001-double-namespace.jpg</a>    <span class="size">(897 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/219/001-double-namespace.jpg">001-double-namespace.jpg</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

  </div>
  <div class="message reply" id="message-713">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/687?r=713#message-713">RE: registering/deleting xmptags issue</a>
    -
    Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="03 Nov 2010 19:59" href="/projects/exiv2/activity?from=2010-11-03">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>Thanks for the reproducer. The root cause appears to be that the URL of the imageapp namespace that already exists in the image is different from that in the command above: <a class="external" href="http://ns.adobe.com/imageapp/1.0/">http://ns.adobe.com/imageapp/1.0/</a><br />If I run the command with that URL instead, it works.</p>


	<p>However that is a workaround at best. There are at least two issues here that need further investigation:</p>


	<ol>
	<li>Why is it necessary to register a namspace that already exists?</li>
		<li>How should re-registration of a namespace with a different URL really work?</li>
	</ol>


	<p>Andreas</p></div>
  
  </div>
  <div class="message reply" id="message-714">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/687?r=714#message-714">RE: registering/deleting xmptags issue</a>
    -
    Added by <a class="user active" href="/users/1485">andreas schmid</a> <a title="03 Nov 2010 20:08" href="/projects/exiv2/activity?from=2010-11-03">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>there might be a problem in my app then.</p>


	<p>the workflow is:<br />- get the uuid<br />- the uuid tag doesn't exit yet, so register the namespace and write a uuid to the file.</p>


	<p>so that means something is wrong in my first step.</p>


	<p>i didn't really see the different url in the namespace. <br />thanks a lot for pointing that out.</p></div>
  
  </div>
  <div class="message reply" id="message-715">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/687?r=715#message-715">RE: registering/deleting xmptags issue</a>
    -
    Added by <a class="user active" href="/users/1485">andreas schmid</a> <a title="04 Nov 2010 07:22" href="/projects/exiv2/activity?from=2010-11-04">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>is there a way to 'migrate' the namespaces url?</p></div>
  
  </div>
  <div class="message reply" id="message-716">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/687?r=716#message-716">RE: registering/deleting xmptags issue</a>
    -
    Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="06 Nov 2010 07:18" href="/projects/exiv2/activity?from=2010-11-06">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>Now there is (with the latest changes in <a class="changeset" title="Allow &quot;migration&quot; of XMP namespaces. Simplified XMP-SDK RegisterNamespace()." href="/projects/exiv2/repository/exiv2/revisions/2374">r2374</a>), which also answers my own second question above:</p>


<pre>
$ exiv2 -M 'reg imageapp http://ns.imagapp.pro/imageapp/v1/' -M 'set Xmp.imageapp.uuid ab75b096-83d3-11df-91a5-000c2953179a' 001.jpg
Warning: Updating namespace URI for imageapp from http://ns.adobe.com/imageapp/1.0/ to http://ns.imagapp.pro/imageapp/v1/
$ exiv2 -g Xmp.imageapp.uuid 001.jpg
Xmp.imageapp.uuid                            XmpText    36  ab75b096-83d3-11df-91a5-000c2953179a
</pre>

	<p>Is that better?</p>


	<p>As for the first question, the exiv2 tool parses the command line and validates all keys found in the modify commands before it reads the image, that's why it needs reg commands on the command line even for custom namespaces which are in the image. There is room for improvement here.</p>


	<p>Another small feature that might be useful in this context is a command line option to write out all schema namespace prefixes and URIs of an XMP packet.</p>


	<p>Andreas</p></div>
  
  </div>
  <div class="message reply" id="message-717">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/687?r=717#message-717">RE: registering/deleting xmptags issue</a>
    -
    Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="07 Nov 2010 18:46" href="/projects/exiv2/activity?from=2010-11-07">about 11 years</a> ago
  </h4>
  <div class="wiki"><blockquote>

	<p>Another small feature that might be useful in this context is a command line option to write out all schema namespace prefixes and URIs of an XMP packet.</p>


</blockquote>

	<p>Experimented a bit with this but it turns out this is not as small as expected and requires a conceptual change. Currently the XMP-SDK uses a global registry for namespaces and prefixes, and Exiv2 follows this model. But after playing around with this, it is clear that this not a good idea. Instead this registry should be per object, probably in XmpData for Exiv2 and similar in XMP-SDK.</p></div>
  
  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-7/7)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
