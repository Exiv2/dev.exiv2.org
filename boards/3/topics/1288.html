<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>IptcData not utf8 ? - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="QgV78VKTbuveGsCcNZsoTVCfBAQ1WEU7ZL/QsJMs0+6gSNAeIOmi64t+35CKTCR+bw1QfcS75IGZn0A40BU0gQ==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>IptcData not utf8 ?</h2>

<div class="message">
<p><span class="author">Added by <a class="user active" href="/users/3673">G K</a> <a title="24 Oct 2012 03:46" href="/projects/exiv2/activity?from=2012-10-24">about 9 years</a> ago</span></p>
<div class="wiki">
<p>Hello,<br />how do i get the IptcData always as utf8 string?<br />Thanks :)</p>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (5)</h3>
  <div class="message reply" id="message-1292">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1288?r=1292#message-1292">RE: IptcData not utf8 ?</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="29 Oct 2012 18:43" href="/projects/exiv2/activity?from=2012-10-29">about 9 years</a> ago
  </h4>
  <div class="wiki"><p>G K</p>


	<p>I'd like to help you, however you'll have to explain more about your expectations.  We had a discussion recently with Shawn who is one of our contributors from China.  <a class="external" href="http://dev.exiv2.org/issues/848">http://dev.exiv2.org/issues/848</a>  May I ask you to read that thread, please?</p>


	<p>If you have specific test input/output and/or image files for which you believe exiv2 is not performing correctly/adequately, please document your concerns and they will be investigated.</p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-1293">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1288?r=1293#message-1293">RE: IptcData not utf8 ?</a>
    -
    Added by <a class="user active" href="/users/3673">G K</a> <a title="30 Oct 2012 03:10" href="/projects/exiv2/activity?from=2012-10-30">about 9 years</a> ago
  </h4>
  <div class="wiki"><p>Well i do not know if this is wrong behavior of exiv2, i rather think not. Somewhere i read that iptc data is always read using the encoding that it is saved with or something, but not by default utf8.<br />For example the image xmp.jpg. It has iptc data written in some unknown character set. If i read the iptc data</p>


	<p>Exiv2::IptcData &#38;iptcData = image->iptcData();<br />Exiv2::IptcData::const_iterator itcpEnd = iptcData.end();<br />  or (Exiv2::IptcData::const_iterator i = iptcData.begin(); i != itcpEnd; ++i) {    <br />    std::string value = i->value().toString();<br />.<br />.</p>


	<p>Then "value" - for iptc data in this image - is only valid utf8 if the value does not contain special characters. <br />Therefore i can not blindly pass the value to another function accepting only valid utf8.</p></div>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/410">blob</a>    <span class="size">(157 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/410/blob">blob</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

  </div>
  <div class="message reply" id="message-1294">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1288?r=1294#message-1294">RE: IptcData not utf8 ?</a>
    -
    Added by <a class="user active" href="/users/3673">G K</a> <a title="30 Oct 2012 03:10" href="/projects/exiv2/activity?from=2012-10-30">about 9 years</a> ago
  </h4>
  <div class="wiki"><p>Well i do not know if this is wrong behavior of exiv2, i rather think not. Somewhere i read that iptc data is always read using the encoding that it is saved with or something, but not by default utf8.<br />For example the image xmp.jpg. It has iptc data written in some unknown character set. If i read the iptc data</p>


	<p>Exiv2::IptcData &#38;iptcData = image->iptcData();<br />Exiv2::IptcData::const_iterator itcpEnd = iptcData.end();<br />  or (Exiv2::IptcData::const_iterator i = iptcData.begin(); i != itcpEnd; ++i) {    <br />    std::string value = i->value().toString();<br />.<br />.</p>


	<p>Then "value" - for iptc data in this image - is only valid utf8 if the value does not contain special characters. <br />Therefore i can not blindly pass the value to another function accepting only valid utf8.</p></div>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/411">blob</a>    <span class="size">(157 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/411/blob">blob</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

  </div>
  <div class="message reply" id="message-1296">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1288?r=1296#message-1296">RE: IptcData not utf8 ?</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Nov 2012 10:43" href="/projects/exiv2/activity?from=2012-11-03">about 9 years</a> ago
  </h4>
  <div class="wiki"><p>G K</p>


	<p>Thanks for updating this.  And thank you for the code in topic 1289: "Exif deletes too many tags??".  I'll have a look at both of those matters on Sunday afternoon (2012-11-04).</p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-1298">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1288?r=1298#message-1298">RE: IptcData not utf8 ?</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="04 Nov 2012 21:55" href="/projects/exiv2/activity?from=2012-11-04">about 9 years</a> ago
  </h4>
  <div class="wiki"><p>I'd like to help you, however I don't know much about this.  As I explained to Shawn, being Scottish (and a Native english speaker), I'm rather challenged by non-ascii character sets.</p>


	<p>Last weekend, a photo IMG_2257.jpg was taken and I added a Caption in Picasa.  You can see that Picasa added the tag "Iptc.Application2.Caption".</p>


<pre>
C:\Users\rmills\Desktop&gt;exiv2 -pi IMG_2257.jpg
Iptc.Envelope.ModelVersion                   Short       1  4
Iptc.Envelope.CharacterSet                   String      3  ←%G
Iptc.Application2.RecordVersion              Short       1  4
Iptc.Application2.Caption                    String     24  Robin and Jim Recovering
</pre>

	<p>I've scaled the image, and copied the Iptc data with the metacopy sample application.</p>


<pre>
C:\Users\rmills\Desktop&gt;pscale
Syntax PScale &lt;infilename&gt; &lt;outfilename&gt; &lt;scale&gt;

C:\Users\rmills\Desktop&gt;pscale IMG_2257.jpg robin.jpg 0.1

C:\Users\rmills\Desktop&gt;\gnu.test\exiv2\msvc\bin\Release\Metacopy
Metacopy: Read and write files must be specified

Reads and writes raw metadata. Use -h option for help.
Usage: Metacopy [-iecaph] readfile writefile

C:\Users\rmills\Desktop&gt;\gnu.test\exiv2\msvc\bin\Release\Metacopy -i IMG_2257.jpg robin.jpg

C:\Users\rmills\Desktop&gt;exiv2 -pi robin.jpg
Iptc.Envelope.ModelVersion                   Short       1  4
Iptc.Envelope.CharacterSet                   String      3  ←%G
Iptc.Application2.RecordVersion              Short       1  4
Iptc.Application2.Caption                    String     24  Robin and Jim Recovering

</pre>

	<p>The IPTC data is a dictionary of key value pairs.  In the case of the Caption, it has been added a string of 24 ascii bytes.<br /><pre>
0        1         1
12345678901234567890123456789
Robin and Jim Recovering
</pre><br />However from the earlier thread with Shawn in China, I thought we concluded that although labelled "String", Iptc.Application2.Caption is 24 binary bytes.  The bytes could be ascii/UTF-8 or any other character set.  So you can call toString() and hope for the best, however if the bytes are encoded in some way, you'll be out of luck.  You'll need to do the C++/library equivalent of running iconv:<br /><pre>
577 rmills@rmills-laptop:~/Desktop $ iconv -?
Usage: iconv [-c] [-s] [-f fromcode] [-t tocode] [file ...]
or:    iconv -l
Try `iconv --help' for more information.
578 rmills@rmills-laptop:~/Desktop $
</pre><br />I hope the photo of me in my kilt cooling off after running 10k will please you - even although I can't give you a solid answer to your question.</p>


	<p><img src="http://clanmills.com/2012/BigSur/Images/IMG_2257.jpg" alt="" /></p>


	<p>Robin</p></div>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/415">robin.jpg</a>    <span class="size">(151 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/415/robin.jpg">robin.jpg</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-5/5)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
