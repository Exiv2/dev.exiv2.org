<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Exiv2 &amp; Unicode Paths on Windows - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="HP5fNtAF1cnTu+5WSeQna2zQtBj7sJkHfdR8f199ahX+s/TZon8ZyYbf8Vr2MytYU0LgYQpTOL2A9Oz3HESNeg==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>Exiv2 &amp; Unicode Paths on Windows</h2>

<div class="message">
<p><span class="author">Added by <a class="user active" href="/users/4647">Arnold Wiegert</a> <a title="05 Sep 2017 16:07" href="/projects/exiv2/activity?from=2017-09-05">about 4 years</a> ago</span></p>
<div class="wiki">
<p>When compiling exiv2lib for debugging, the output library is already 'decorated' with a trailing 'd'.<br />Once Unicode versions become available, it would be equally desirable to also identify those specific libraries with a trailing 'u'.</p>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (17)</h3>
  <div class="message reply" id="message-2946">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2944?r=2946#message-2946">RE: Exvi2 &amp; Unicode</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="05 Sep 2017 16:22" href="/projects/exiv2/activity?from=2017-09-05">about 4 years</a> ago
  </h4>
  <div class="wiki"><p>I have code to submit for '', 'u', 'd', 'ud' and it seems to be working.  Hope to submit it later this week.</p>


	<p>Another approach would be to only support UNICODE on Windows because it provides a superset of the API.  It takes nothing away, it adds wstring path functions to the api.  <a class="external" href="http://dev.exiv2.org/boards/3/topics/2913?r=2921#message-2921">http://dev.exiv2.org/boards/3/topics/2913?r=2921#message-2921</a></p></div>
  
  </div>
  <div class="message reply" id="message-2948">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2944?r=2948#message-2948">RE: Exiv2 &amp; Unicode Paths on Windows</a>
    -
    Added by <a class="user active" href="/users/4647">Arnold Wiegert</a> <a title="05 Sep 2017 16:34" href="/projects/exiv2/activity?from=2017-09-05">about 4 years</a> ago
  </h4>
  <div class="wiki"><p>'Windows only' would work for me; it is all I really work with and the proposed decorations are what I am used to.</p>


	<p>After reading parts of the message you referenced, I would like to add that is is not just file names &#38; paths that need to be handled as UNICODE.<br />The metadata withing the images can also contain UNICODE strings.</p></div>
  
  </div>
  <div class="message reply" id="message-2949">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2944?r=2949#message-2949">RE: Exiv2 &amp; Unicode Paths on Windows</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="05 Sep 2017 17:27" href="/projects/exiv2/activity?from=2017-09-05">about 4 years</a> ago
  </h4>
  <div class="wiki"><p>The aim here is to fix/guarantee that the UNICODE path code in Windows builds correctly with all Windows build systems (and Windows environment such as Cygwin and msys/2.0).</p>


	<p>Exiv2 v0.26.1 is a 'dot' release and should be a 'drop in replacement' for v0.26.  Changing the default libexiv2.dll to provide UNICODE functions is probably harmless, however we are changing the ABI should not do that for a 'dot' release.  Let's get more experience/feedback with the UNICODE path code.  We can consider making UNICODE the default build in Exiv2 v0.27.</p>


	<p>The subject of handling UNICODE in the metadata is another matter.  Being a native English speaker, I am rather challenged by localisation.  I believe Exif tags <em>(with string values)</em> are binary which we can treat as UTF-8.  I believe IPTC is similar.  It's a byte count and some bytes.  You've already mentioned that you have an UTF-8 issue with XMPsdk.  I'm willing to investigate UTF-8 issues with Exif, IPTC and XMP metadata if you can provide test cases.</p></div>
  
  </div>
  <div class="message reply" id="message-2950">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2944?r=2950#message-2950">RE: Exiv2 &amp; Unicode Paths on Windows</a>
    -
    Added by <a class="user active" href="/users/4647">Arnold Wiegert</a> <a title="05 Sep 2017 18:05" href="/projects/exiv2/activity?from=2017-09-05">about 4 years</a> ago
  </h4>
  <div class="wiki"><p>Handling Unicode path is certainly essential to allow use of exiv2 under Windows, irrespective of the compiler etc.</p>


	<p>How it is handled on the code and build end, is entirely up to you. I have no backwards or other compatibility constraints.<br />As for localization, until I got involved in this aspect of metadata, it was only a word in the dictionary and even now I am very much a newb myself.</p>


	<p>But, since the image metadata standards all support Unicode strings in one way or other, in the end then exiv2 would need to be able to handle those as well, else path compatibility is nice, but not everything ;-)</p>


	<p>I'll try to attach a couple of rather simplistic test files. <br />The first one, itext2.png is an unmodified copy of the PNG test file itxt2.png.<br />It contains some French text with one accented character.</p>


	<p>The second one, itxt-german.png is a slightly modified version of one of the PNG test images.<br />IIRC, it was modified using pngcheck and contains a string in German with a couple of German characters, one 'Umlaut' &#38; one sharp 's'</p>


	<p><a class="external" href="http://www.libpng.org/pub/png/apps/pngcheck.html">http://www.libpng.org/pub/png/apps/pngcheck.html</a></p></div>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1183">itxt2.png</a>    <span class="size">(5.35 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1183/itxt2.png">itxt2.png</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1184">itxt-german.png</a>    <span class="size">(5.4 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1184/itxt-german.png">itxt-german.png</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

  </div>
  <div class="message reply" id="message-2951">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2944?r=2951#message-2951">RE: Exiv2 &amp; Unicode Paths on Windows</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="05 Sep 2017 18:38" href="/projects/exiv2/activity?from=2017-09-05">about 4 years</a> ago
  </h4>
  <div class="wiki"><p>Arnold</p>


	<p>We're off topic.  I'm working flat-out on the Exiv2 v0.26.1 release - including your UNICODE/static/Debug/CMake code.  And there are other matters on the TODO list that has been promised in v0.26.1  I don't have the bandwidth at present to start a totally different subjects such as UNICODE in metadata.</p>


	<p>However, I've looked briefly at the files you sent.   <pre>599 rmills@rmillsmbp:~/Downloads $ exiv2 -pa ~/Downloads/itxt2.png 
600 rmills@rmillsmbp:~/Downloads $ exiv2 -pR ~/Downloads/itxt2.png 
STRUCTURE OF PNG FILE: /Users/rmills/Downloads/itxt2.png
 address | chunk |  length | data                           | checksum
       8 | IHDR  |      13 | ...[...E.....                  | 0x52edaae4
      33 | gAMA  |       4 | ....                           | 0x0bfc6105
      49 | sBIT  |       4 | ....                           | 0x4da52df6
      65 | bKGD  |       6 | ......                         | 0x95cd2f20
      83 | pCAL  |      44 | bogus units...........foo/bar  | 0x57407b1c
     139 | pHYs  |       9 | .........                      | 0xd2dd7efc
     160 | tIME  |       7 | .....:.                        | 0x8eff267a
     179 | tEXt  |       9 | Title.PNG                      | 0xdc017935
     200 | iTXt  |      39 | Author...fr.Auteur.La plume de | 0x4fdb72e1
     251 | zTXt  |      26 | test.....N.)-Qx.P.........     | 0xa869e99d
     289 | IDAT  |    4828 | x..\+........EFFb...X$.......D | 0x353e27e9
    5129 | zTXt  |     202 | Description....M.Mj.@...&gt;.[... | 0xa9a15024
    5343 | iTXt  |     111 | Warning...de.WARNING........0. | 0xb3adddee
    5466 | IEND  |       0 |                                | 0xae426082
601 rmills@rmillsmbp:~/Downloads $ exiv2 -pa ~/Downloads/itxt2.png 
602 rmills@rmillsmbp:~/Downloads $ which exiv2
/usr/local/bin/exiv2
603 rmills@rmillsmbp:~/Downloads $ exiv2 -pR ~/Downloads/itxt-german.png 
STRUCTURE OF PNG FILE: /Users/rmills/Downloads/itxt-german.png
 address | chunk |  length | data                           | checksum
       8 | IHDR  |      13 | ...[...E.....                  | 0x52edaae4
      33 | gAMA  |       4 | ....                           | 0x0bfc6105
      49 | sBIT  |       4 | ....                           | 0x4da52df6
      65 | pCAL  |      44 | bogus units...........foo/bar  | 0x57407b1c
     121 | tIME  |       7 | .....:.                        | 0x8eff267a
     140 | bKGD  |       6 | ......                         | 0x95cd2f20
     158 | pHYs  |       9 | .........                      | 0xd2dd7efc
     179 | tEXt  |       9 | Title.PNG                      | 0xdc017935
     200 | iTXt  |      39 | Author...fr.Auteur.La plume de | 0x4fdb72e1
     251 | IDAT  |    4000 | x..\+........EFFb...X$.......D | 0x199b9fd7
    4263 | IDAT  |     831 | .......#T..6.....`....G...(&lt;.. | 0xa028a770
    5106 | zTXt  |     202 | Description..x.M.Mj.@...&gt;.[... | 0x692a52f9
    5320 | iTXt  |     111 | Warning...de.WARNING.x......0. | 0xb5cd3e90
    5443 | iTXt  |      65 | Deutsch...de..Steinstra..e 10, | 0x23616b74
    5520 | IEND  |       0 |                                | 0xae426082
604 rmills@rmillsmbp:~/Downloads $</pre>As you can see, exiv2 does not list any metadata in the files.  However the debugging code exiv2 -pR foo.png spots iTXt and zTXt blocks with Title, Author, Description.  Exiv2 deals with Exif, IPTC, XMP and ICC metadata.  This is a totally new <em><strong>species</strong></em> of metadata in PNG files.  And that's another subject that could be investigated.</p>


	<p>However, my focus is Exiv2 v0.26.1.  These new subjects:</p>


	<ol>
	<li>UNICODE in metadata</li>
		<li>Metadata iXTt/zTXt blocks in PNG files</li>
	</ol>


	<p>have never been supported by Exiv2.  I'd like to retain focus and stack those other subjects for a future project.  I recommend that you open new Feature requests and they will be investigated at a future time.</p></div>
  
  </div>
  <div class="message reply" id="message-2952">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2944?r=2952#message-2952">RE: Exiv2 &amp; Unicode Paths on Windows</a>
    -
    Added by <a class="user active" href="/users/4647">Arnold Wiegert</a> <a title="05 Sep 2017 20:13" href="/projects/exiv2/activity?from=2017-09-05">about 4 years</a> ago
  </h4>
  <div class="wiki"><p>Understood.</p>


	<p>Because I am not sure how to exactly describe the issues, I have opened 2 feature request and hope that you or someone else on the team can flesh out the nitty gritty details.</p></div>
  
  </div>
  <div class="message reply" id="message-2953">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2944?r=2953#message-2953">RE: Exiv2 &amp; Unicode Paths on Windows</a>
    -
    Added by <a class="user active" href="/users/4647">Arnold Wiegert</a> <a title="05 Sep 2017 20:40" href="/projects/exiv2/activity?from=2017-09-05">about 4 years</a> ago
  </h4>
  <div class="wiki"><p>PS: any support for Unicode strings by exiv2 will be useful.<br />I am by no means tied to iTxt or zTxt chunks - they were just handy examples files<br />Support via XMP or any other 'standard' would be quite workable for me.</p>


	<p>As an example, I have added some UTF-8-Unicode strings to a sample jpg image using XnViewMP<br />XnViewMP reports the data as being placed in IPTC-IIM &#38; XMP</p>


	<p>IPTC-IIM Keywords : Places, Germany, Baden-Württemberg, UmlautßüöäÜÖÄ<br /><pre>
XMP
dc     subject[1] Places, 
       subject[2] Germany
       subject[3] Baden-Württemberg
       subject[4] UmlautßüöäÜÖÄ
lr
       hierarchical subject[1] Places
       hierarchical subject[2] Places|Germany
       hierarchical subject[3] Places|Germany|Baden-Württemberg
       hierarchical subject[4] Places|Germany|UmlautßüöäÜÖÄ
</pre></p>


	<p>Exiftool reports the data as:<br />Subject                         : Places, Germany, Baden-Württemberg, UmlautßüöäÜÖÄ<br />Hierarchical Subject            : Places, Places|Germany, Places|Germany|Baden-Württemberg, Places|Germany|UmlautßüöäÜÖÄ</p></div>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1186">metadata-test.jpg</a>    <span class="size">(70.6 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1186/metadata-test.jpg">metadata-test.jpg</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

  </div>
  <div class="message reply" id="message-2954">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2944?r=2954#message-2954">RE: Exiv2 &amp; Unicode Paths on Windows</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="05 Sep 2017 21:26" href="/projects/exiv2/activity?from=2017-09-05">about 4 years</a> ago
  </h4>
  <div class="wiki"><p>Well, here's what I see on the Mac:<pre>623 rmills@rmillsmbp:~/gnu/exiv2/0.26 $ exiv2 -px ~/Downloads/metadata-test.jpg
Xmp.dc.subject               XmpBag      4  Places, Germany, Baden-Württemberg, UmlautßüöäÜÖÄ
Xmp.lr.hierarchicalSubject   XmpBag      4  Places, Places|Germany, Places|Germany|Baden-Württemberg, Places|Germany|UmlautßüöäÜÖÄ
624 rmills@rmillsmbp:~/gnu/exiv2/0.26 $ </pre>You can get the "raw" XMP/xml from the file with:<pre>625 rmills@rmillsmbp:~/gnu/exiv2/0.26 $ exiv2 -pX ~/Downloads/metadata-test.jpg
&lt;?xpacket begin="﻿" id="W5M0MpCehiHzreSzNTczkc9d"?&gt;
&lt;x:xmpmeta xmlns:x="adobe:ns:meta/" x:xmptk="XMP Core 5.5.0"&gt;
   &lt;rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;
      &lt;rdf:Description rdf:about="" 
            xmlns:dc="http://purl.org/dc/elements/1.1/" 
            xmlns:lr="http://ns.adobe.com/lightroom/1.0/"&gt;
         &lt;dc:subject&gt;
            &lt;rdf:Bag&gt;
               &lt;rdf:li&gt;Places&lt;/rdf:li&gt;
               &lt;rdf:li&gt;Germany&lt;/rdf:li&gt;
               &lt;rdf:li&gt;Baden-Württemberg&lt;/rdf:li&gt;
               &lt;rdf:li&gt;UmlautßüöäÜÖÄ&lt;/rdf:li&gt;
            &lt;/rdf:Bag&gt;
         &lt;/dc:subject&gt;
         &lt;lr:hierarchicalSubject&gt;
            &lt;rdf:Bag&gt;
               &lt;rdf:li&gt;Places&lt;/rdf:li&gt;
               &lt;rdf:li&gt;Places|Germany&lt;/rdf:li&gt;
               &lt;rdf:li&gt;Places|Germany|Baden-Württemberg&lt;/rdf:li&gt;
               &lt;rdf:li&gt;Places|Germany|UmlautßüöäÜÖÄ&lt;/rdf:li&gt;
            &lt;/rdf:Bag&gt;
         &lt;/lr:hierarchicalSubject&gt;
      &lt;/rdf:Description&gt;
   &lt;/rdf:RDF&gt;
&lt;/x:xmpmeta&gt;</pre>To be honest, I don't know what I'm looking for.  The "raw" XMP/xml has nothing that says how it's encoded.</p>


	<p>This can be viewed with samples/exiv2json:<pre>630 rmills@rmillsmbp:~/gnu/exiv2/0.26 $ bin/exiv2json  ~/Downloads/metadata-test.jpg 
{
    "Iptc": {
        "Envelope": {
            "CharacterSet": "G" 
        },
        "Application2": {
            "Keywords": "Places",
            "Keywords": "Germany",
            "Keywords": "Baden-Württemberg",
            "Keywords": "UmlautßüöäÜÖÄ" 
        }
    },
    "Xmp": {
        "dc": {
            "subject": "Places, Germany, Baden-Württemberg, UmlautßüöäÜÖÄ" 
        },
        "lr": {
            "hierarchicalSubject": "Places, Places|Germany, Places|Germany|Baden-Württemberg, Places|Germany|UmlautßüöäÜÖÄ" 
        },
        "xmlns": {
            "dc": "http:\/\/purl.org\/dc\/elements\/1.1\/",
            "lr": "http:\/\/ns.adobe.com\/lightroom\/1.0\/" 
        }
    }
}</pre></p>


	<p>It's been a long day (12 hours of solid work on Exiv2).  Tomorrow is another day.  I beg you to stop talking about UNICODE metadata and other types of png/metadata.  I'm working hard on build matters for Exiv2 v0.26.1.</p></div>
  
  </div>
  <div class="message reply" id="message-3084">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2944?r=3084#message-3084">RE: Exiv2 &amp; Unicode Paths on Windows</a>
    -
    Added by <a class="user active" href="/users/6975">Zoltan Hubai</a> <a title="22 Mar 2018 13:55" href="/projects/exiv2/activity?from=2018-03-22">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>Anything on an Exiv2 0.26 build that supports Unicode Paths on Windows?</p></div>
  
  </div>
  <div class="message reply" id="message-3085">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2944?r=3085#message-3085">RE: Exiv2 &amp; Unicode Paths on Windows</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="22 Mar 2018 14:35" href="/projects/exiv2/activity?from=2018-03-22">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>Nothing has changed concerning exiv2 and unicode since this was discussed 7 months ago.  The situation remains:</p>


	<p>1) You can build Exiv2 to support wstring/unicode paths on Windows.<br />2) Exif metadata strings are encoded as binary characters.  I believe wstrings can be stored in the metadata. If you do encode the data in this way, you'll almost certainly face interoperability issues with applications which expect UTF-8 encoding.</p></div>
  
  </div>
  <div class="message reply" id="message-3086">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2944?r=3086#message-3086">RE: Exiv2 &amp; Unicode Paths on Windows</a>
    -
    Added by <a class="user active" href="/users/6975">Zoltan Hubai</a> <a title="22 Mar 2018 15:43" href="/projects/exiv2/activity?from=2018-03-22">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>Thanks<br />I can build Exiv2 0.26 win32 libraries using the VS 2015 community edition with Unicode Path enable.<br />When I try to build the x64 libraries I get 11 errors.<br />all related to size_t conversion to uint32_t<br />4>..\..\src\tiffimage.cpp(196): error C2220: warning treated as error - no 'object' file generated<br />4>..\..\src\tiffimage.cpp(196): warning C4267: 'argument': conversion from 'size_t' to 'uint32_t', possible loss of data<br />4>..\..\src\tiffimage.cpp(222): warning C4267: '=': conversion from 'size_t' to 'long', possible loss of data</p>


	<p>Any solution for this?</p></div>
  
  </div>
  <div class="message reply" id="message-3087">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2944?r=3087#message-3087">RE: Exiv2 &amp; Unicode Paths on Windows</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="22 Mar 2018 17:26" href="/projects/exiv2/activity?from=2018-03-22">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>There are several ways to fix this:</p>


	<p>1) <em><strong>Best Fix</strong></em>: Change the code by adding a cast (uint32_t) on 196: <pre>   192            ByteOrder bo = TiffParser::decode(exifData_,
   193                                              iptcData_,
   194                                              xmpData_,
   195                                              io_-&gt;mmap(),
   196                                              (uint32_t) io_-&gt;size());
</pre><br />And cast (long) on 222:<br /><pre>
   222                    size = (long) io_-&gt;size();
</pre></p>


	<p>2) <em><strong>Quick Fix</strong></em>: Disable the setting in Visual Studio "Treat warnings as errors"</p>


	<p>I think it's in the compiler settings.  I try to avoid changing that setting.  Warnings should be silenced by thoughtful action, not killing the messenger!</p>


	<p>3) <em><strong>Work for me</strong></em>: I provide a patch.</p>


	<p>This kind of thing is usually quite tedious for me because it produces different warnings/errors on different platforms.</p></div>
  
  </div>
  <div class="message reply" id="message-3088">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2944?r=3088#message-3088">RE: Exiv2 &amp; Unicode Paths on Windows</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="22 Mar 2018 17:44" href="/projects/exiv2/activity?from=2018-03-22">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>I've checked the current version of the code on 'master'.  Both casts I have recommend in <em><strong>Best Fix</em></strong> are in the current code on <a class="external" href="https://github.com/exiv2/exiv2/src/tiffimage.cpp">https://github.com/exiv2/exiv2/src/tiffimage.cpp</a>.  That is indeed the correct fix and would be the patch were I to provide one.</p>


	<p>Do <strong><em>NOT</strong></em> copy any code from master into your v0.26 source code.  The project has evolved in the 11 months since v0.26.  src/tiffimage.cpp (and many other files) on master have changed and are not compatible with v0.26.</p></div>
  
  </div>
  <div class="message reply" id="message-3089">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2944?r=3089#message-3089">RE: Exiv2 &amp; Unicode Paths on Windows</a>
    -
    Added by <a class="user active" href="/users/6975">Zoltan Hubai</a> <a title="22 Mar 2018 17:45" href="/projects/exiv2/activity?from=2018-03-22">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>Thanks<br />I used 1) and fixed all the files (basicio.cpp, cr2image.cpp, crwimage.cpp, exif.cpp, jp2image.cpp, orfimage.cpp, pgfimage.cpp, pngimage.cpp, preview.cpp, rw2image.cpp, tiffimage.cpp)</p>


	<p>Did try 2) before i wrote but for some reason the settings is ignored by the compiler (Visual Studio 2015 Community V 14.0.25431.01 Update 3)<br />Did try 2) with Visual Studio 2017 Community and there it worked (however I need it for VS2015)</p></div>
  
  </div>
  <div class="message reply" id="message-3090">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2944?r=3090#message-3090">RE: Exiv2 &amp; Unicode Paths on Windows</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="22 Mar 2018 17:57" href="/projects/exiv2/activity?from=2018-03-22">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>Right.  I'm pleased that this is working for you.</p>


	<p>The EXV_UNICODE_PATH setting has always been a "poor relation" in Exiv2.  By that I mean, it is given less respect than it deserves.  I made a change to samples/exifprint.cpp for v0.26 to provide a minimal test harness which validates that it works (and not totally broken).  I ought to update the buildserver to build and test this configuration.  <a class="external" href="http://dev.exiv2.org/issues/1174">http://dev.exiv2.org/issues/1174</a> and <a class="external" href="http://dev.exiv2.org/issues/1169">http://dev.exiv2.org/issues/1169</a></p>


	<p>There's a never ending stream of tasks to be undertaken when working on an open-source project.  If you'd like to contribute, I'd be delighted to accept your help.</p>


	<p>We're having an "Exiv2 Developer's Meeting" at my home in England on May 5.  This, and other projects, will be discussed and we'll prioritise features for implementation within our resources.  <a class="external" href="https://github.com/Exiv2/exiv2/issues/225">https://github.com/Exiv2/exiv2/issues/225</a></p></div>
  
  </div>
  <div class="message reply" id="message-3091">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2944?r=3091#message-3091">RE: Exiv2 &amp; Unicode Paths on Windows</a>
    -
    Added by <a class="user active" href="/users/6975">Zoltan Hubai</a> <a title="22 Mar 2018 18:44" href="/projects/exiv2/activity?from=2018-03-22">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>Tested with Hungarian and Serbian path names and works as it should.</p></div>
  
  </div>
  <div class="message reply" id="message-3092">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2944?r=3092#message-3092">RE: Exiv2 &amp; Unicode Paths on Windows</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="22 Mar 2018 18:53" href="/projects/exiv2/activity?from=2018-03-22">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>Thanks for the update.</p></div>
  
  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-17/17)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
