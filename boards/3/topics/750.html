<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Compilation error with EXV_HAVE_XMP_TOOLKIT undefined - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="MM0eipPlgtVALK5vs44pPcZfa9EGcxjxrvAcaXmwrh7SgLVl4Z9O1RVIsWMMWSUO+c0/qPeQuUtT0IzhOolJcQ==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>Compilation error with EXV_HAVE_XMP_TOOLKIT undefined</h2>

<div class="message">
<p><span class="author">Added by <a class="user active" href="/users/318">Fulvio Senore</a> <a title="01 Jan 2011 10:29" href="/projects/exiv2/activity?from=2011-01-01">almost 11 years</a> ago</span></p>
<div class="wiki">
<p>I have compiled exiv2lib with the symbol EXV_HAVE_XMP_TOOLKIT undefined to disable xmp support and I received compilation errors about line 423 of xmp.cpp. The file contains the following code:</p>


	<p>#ifdef EXV_HAVE_XMP_TOOLKIT<br />    void XmpParser::registerNs(const std::string&#38; ns,<br />                               const std::string&#38; prefix)
    {<br />        try {<br />            initialize();<br />            SXMPMeta::DeleteNamespace(ns.c_str());<br />            SXMPMeta::RegisterNamespace(ns.c_str(), prefix.c_str());<br />        }<br />        catch (const XMP_Error&#38; e) {<br />            throw Error(40, e.GetID(), e.GetErrMsg());<br />        }<br />    } // XmpParser::registerNs<br />#else<br />    bool XmpParser::registerNs(const std::string&#38; /*ns*/,<br />                               const std::string&#38; /*prefix*/)
    {<br />        initialize();<br />        return true;<br />    } // XmpParser::registerNs<br />#endif</p>


	<p>so it looks like a change in the return type of the function has been forgotten after the "#else" line.<br />I changed the return value from bool to void, and I removed the return statement.<br />Now the library seems to work, but you will surely know the best way to fix this problem.</p>


	<p>Fulvio Senore</p>


	<p>P.S. I had to disable xmp support to remove the memory leaks that I reported about one year ago in this forum. I suspect that the problem lies in using an older version of expat, but I hope to find the time to check this in the future.</p>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (5)</h3>
  <div class="message reply" id="message-751">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/750?r=751#message-751">RE: Compilation error with EXV_HAVE_XMP_TOOLKIT undefined</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="01 Jan 2011 13:38" href="/projects/exiv2/activity?from=2011-01-01">almost 11 years</a> ago
  </h4>
  <div class="wiki"><p>Fulvio</p>


	<p>Happy New Year.</p>


	<p>I think the fix is to change the #else ... #endif code by changing bool -> void and delete the line return true;  The bool return signature seems inconsistent with the declaration in xmp.hpp</p>


	<p>I don't believe expat has been upgraded and has been at 2.0.1 for quite some time (3+ years).  Are you sure that it is expat that leaks, or could it be that XMP is leaking by failing to release expat resources in an appropriate manner?</p>


	<p>Another subject. I tested Andreas' fixes yesterday for the 7.1 compiler stall.  I've tested his fix with all the compilers (VS2003/5/8/10 msvc (32 bit) and msvc64(64 and 32 bit) and that seems to be fine now.  Good Job, Andreas (as always).  I submitted documentation and test changes to msvc.</p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-752">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/750?r=752#message-752">RE: Compilation error with EXV_HAVE_XMP_TOOLKIT undefined</a>
    -
    Added by <a class="user active" href="/users/318">Fulvio Senore</a> <a title="01 Jan 2011 13:59" href="/projects/exiv2/activity?from=2011-01-01">almost 11 years</a> ago
  </h4>
  <div class="wiki"><p>Robin,</p>


	<p>Happy New Year to you too!</p>


	<p>I am using wxWidgets which ships with expat 1.95.6: it is a very old version. I can use exiv2 with this version and I do not have linking errors, but those memory leaks with tiff files are so obvious that I cannot believe that nobody noticed them: Visual Studio is screaming at me when I close the program. As a reference, here is the older post:<br /><a class="external" href="http://dev.exiv2.org/boards/3/topics/339">http://dev.exiv2.org/boards/3/topics/339</a><br />Since the leaks are so obvious and they disappear when I disable xmp support I think that they are probably caused by using a very old version of expat. Maybe the older version has some different behaviours and XMP is failing to release resources as you suggested.</p>


	<p>Probably the only way to find a solution would be to graft a newer version of expat in wxWidgets, but I am not sure of how I should do it.</p>


	<p>Fulvio</p></div>
  
  </div>
  <div class="message reply" id="message-753">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/750?r=753#message-753">RE: Compilation error with EXV_HAVE_XMP_TOOLKIT undefined</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="01 Jan 2011 15:23" href="/projects/exiv2/activity?from=2011-01-01">almost 11 years</a> ago
  </h4>
  <div class="wiki"><p>Gosh, Fulvio.  The expat/wxWidgets/exiv2/xmpsdk/VS2003 memory management sounds like a build engineering/product integration matter.  If you can avoid the leak by simply leaving EXV_HAVE_XMP_TOOLKIT undefined then that might be fine (provided you don't require XMP support).  I'm happy to support you with issues involving code from the exiv2 library.  On the other hand if this is a complex plot involving all manner of other libraries, you'll appreciate that you'll probably have to dig around with the Microsoft heap debug code to track down the causes.</p></div>
  
  </div>
  <div class="message reply" id="message-763">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/750?r=763#message-763">RE: Compilation error with EXV_HAVE_XMP_TOOLKIT undefined</a>
    -
    Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="03 Jan 2011 16:09" href="/projects/exiv2/activity?from=2011-01-03">almost 11 years</a> ago
  </h4>
  <div class="wiki"><p>Thanks for reporting this blunder, Fulvio. It's fixed as bug <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Regression: Compilation error with EXV_HAVE_XMP_TOOLKIT undefined (Closed)" href="/issues/749">#749</a>.</p>


	<p>As for the memory leaks, the only issue we sometimes hear is a memory leak if <a href="http://www.exiv2.org/doc/classExiv2_1_1XmpParser.html#46ff7c85b860ef81310e0ac8dd6b62a2" class="external">XmpParser::terminate()</a> is not called. (The library calls initialize() automatically as needed.) Try this at the end of your program and see if the leaks go away.</p>


	<p>If you can reproduce any memory leak with the exiv2 command line tool alone or a sample program that uses only the exiv2 library, please feedback details.</p>


	<p>Andreas</p></div>
  
  </div>
  <div class="message reply" id="message-767">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/750?r=767#message-767">RE: Compilation error with EXV_HAVE_XMP_TOOLKIT undefined</a>
    -
    Added by <a class="user active" href="/users/318">Fulvio Senore</a> <a title="07 Jan 2011 08:17" href="/projects/exiv2/activity?from=2011-01-07">almost 11 years</a> ago
  </h4>
  <div class="wiki"><p>Thank you very much for pointing me to XmpParser::terminate()!<br />I added that call at program termination and now the memory leaks have disappeared.</p>


	<p>It looks like some other code misses that call, probably because I have an older version of expat.</p>


	<p>As usual, thank you for your work and for you quick help.</p>


	<p>Fulvio</p></div>
  
  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-5/5)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
