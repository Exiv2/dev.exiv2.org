<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Orientation in IIQ Files - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="adnq12WDZumvhBWoywaAEjX309dxKnqHAVOGeRs5SEeLlEE4F/mq6frgCqR00YwhCmWHroDJ2z38cxbxWACvKA==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>Orientation in IIQ Files</h2>

<div class="message">
<p><span class="author">Added by <a class="user active" href="/users/7086">Robert Bieber</a> <a title="08 Apr 2018 06:18" href="/projects/exiv2/activity?from=2018-04-08">over 3 years</a> ago</span></p>
<div class="wiki">
<p>libexiv2 doesn't currently seem to support the orientation tag in IIQ files, or at least not ones from the Leaf Credo digital backs.  The exiv2 command-line tool doesn't show anything for Exif.Image.Orientation, and in Darktable on import the images from this camera don't automatically adjust to the correct orientation.</p>


	<p>So I guess first question would be if the core devs would have any interest in taking this up as a feature request?  I do have RAW files for the Credo 40 up on raw.pixls.us, but I realize that mine is a pretty niche use case and I can definitely understand if it's not exactly a top priority.</p>


	<p>If it's not, my other question is how much effort do you think it would be for a software engineer with no prior experience with exif interpretation (and scant little experience with RAW files in general) to come up with a patch to add support?  It seems that the functionality already exists in exiftool, so there's some open-source code I can look at that does what I want to do, but I'm not sure how much of a learning curve it would be for me to get up to speed with the project in general</p>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (5)</h3>
  <div class="message reply" id="message-3105">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3104?r=3105#message-3105">RE: Orientation in IIQ Files</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Apr 2018 06:29" href="/projects/exiv2/activity?from=2018-04-08">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>The quickest way to fix this is to assign this to a member of Team Exiv2.  Please attach a test file and I'll have a look at it today.  It's probably an easy fix for somebody familiar with the code and the architecture of metadata.  If your file is larger than the Redmine limit of 20mb, please share the file on Google/DropBox/OneDrive and I will copy it to our test files on our buildserver.</p></div>
  
  </div>
  <div class="message reply" id="message-3106">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3104?r=3106#message-3106">RE: Orientation in IIQ Files</a>
    -
    Added by <a class="user active" href="/users/7086">Robert Bieber</a> <a title="08 Apr 2018 06:35" href="/projects/exiv2/activity?from=2018-04-08">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>Appreciate it, thanks.  Here's a link to one of the samples I have up currently: <a class="external" href="https://raw.pixls.us/getfile.php/1972/nice/Leaf%20-%20Credo%2040%20-%20IIQ%20L%20(4:3).IIQ">https://raw.pixls.us/getfile.php/1972/nice/Leaf%20-%20Credo%2040%20-%20IIQ%20L%20(4:3).IIQ</a></p>


	<p>Let me know if you need one in vertical orientation as well, I can dig one up if necessary.</p></div>
  
  </div>
  <div class="message reply" id="message-3107">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3104?r=3107#message-3107">RE: Orientation in IIQ Files</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Apr 2018 07:35" href="/projects/exiv2/activity?from=2018-04-08">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>Thanks.  The news isn't good.  I'm using the current 'master' in development: <pre>562 rmills@rmillsmbp:~/Downloads $ exiv2 Leaf\ -\ Credo\ 40\ -\ IIQ\ L\ \(4_3\).IIQ.tiff 
Exiv2 exception in print action for file Leaf - Credo 40 - IIQ L (4_3).IIQ.tiff:
tiff directory length is too large
563 rmills@rmillsmbp:~/Downloads $ </pre>When I debug your file (with the -pR feature added in v0.26): <pre>539 rmills@rmillsmbp:~/Downloads $ exiv2 -pR Leaf\ -\ Credo\ 40\ -\ IIQ\ L\ \(4_3\).IIQ.tiff 
STRUCTURE OF TIFF FILE (II): Leaf - Credo 40 - IIQ L (4_3).IIQ.tiff
 address |    tag                              |      type |    count |    offset | value
35074798 | 0x00fe NewSubfileType               |      LONG |        1 |           | 0
35074810 | 0x0100 ImageWidth                   |     SHORT |        1 |           | 608
35074822 | 0x0101 ImageLength                  |     SHORT |        1 |           | 456
35074834 | 0x0102 BitsPerSample                |     SHORT |        3 |  35075216 | 8 8 8
35074846 | 0x0103 Compression                  |     SHORT |        1 |           | 1
35074858 | 0x0106 PhotometricInterpretation    |     SHORT |        1 |           | 2
35074870 | 0x010e ImageDescription             |     ASCII |       14 |  35075222 | HyperFocal: 0
35074882 | 0x010f Make                         |     ASCII |        5 |  35075236 | Leaf
35074894 | 0x0110 Model                        |     ASCII |        9 |  35075241 | Credo 40
35074906 | 0x0111 StripOffsets                 |      LONG |        1 |           | 34145708
35074918 | 0x0115 SamplesPerPixel              |     SHORT |        1 |           | 3
35074930 | 0x0116 RowsPerStrip                 |      LONG |        1 |           | 456
35074942 | 0x0117 StripByteCounts              |      LONG |        1 |           | 831744
35074954 | 0x011a XResolution                  |  RATIONAL |        1 |  35075250 | 4096/12
35074966 | 0x011b YResolution                  |  RATIONAL |        1 |  35075258 | 4096/12
35074978 | 0x011c PlanarConfiguration          |     SHORT |        1 |           | 1
35074990 | 0x0128 ResolutionUnit               |     SHORT |        1 |           | 2
35075002 | 0x02bc XMLPacket                    |     ASCII |    16384 |  35075266 | &lt;?xpacket begin='' id='W5M0MpCeh ...
35075014 | 0x8298 Copyright                    |     ASCII |        1 |           | 
35075026 | 0x8769 ExifTag                      |      LONG |        1 |           | 35091650
  STRUCTURE OF TIFF FILE (II): Leaf - Credo 40 - IIQ L (4_3).IIQ.tiff
   address |    tag                              |      type |    count |    offset | value
  35091652 | 0x4746 Rating                       |     SHORT |        1 |           | 0
  35091664 | 0x829a ExposureTime                 |  RATIONAL |        1 |  35091896 | 4000/1000000
  35091676 | 0x829d FNumber                      |  RATIONAL |        1 |  35091904 | 350/100
  35091688 | 0x8822 ExposureProgram              |     SHORT |        1 |           | 1
  35091700 | 0x8827 ISOSpeedRatings              |     SHORT |        1 |           | 100
  35091712 | 0x9000 ExifVersion                  | UNDEFINED |        4 |           | 0220
  35091724 | 0x9003 DateTimeOriginal             |     ASCII |       20 |  35091912 | 2017:11:26 17:00:30
  35091736 | 0x9004 DateTimeDigitized            |     ASCII |       20 |  35091932 | 2017:11:26 17:00:30
  35091748 | 0x9102 CompressedBitsPerPixel       |  RATIONAL |        1 |  35091952 | 3/1
  35091760 | 0x9201 ShutterSpeedValue            | SRATIONAL |        1 |  35091960 | 796578/100000
  35091772 | 0x9202 ApertureValue                |  RATIONAL |        1 |  35091968 | 36147/10000
  35091784 | 0x9204 ExposureBiasValue            | SRATIONAL |        1 |  35091976 | 0/1000
  35091796 | 0x9208 LightSource                  |     SHORT |        1 |           | 255
  35091808 | 0x920a FocalLength                  |  RATIONAL |        1 |  35091984 | 800/10
  35091820 | 0x927c MakerNote                    | UNDEFINED | 34145700 |         8 | IIIICwaR........................ ...
Exiv2 exception in print action for file Leaf - Credo 40 - IIQ L (4_3).IIQ.tiff:
tiff directory length is too large
540 rmills@rmillsmbp:~/Downloads $ </pre>You can see that we threw an exception at the MakeNote.  It's 34,145,700 bytes.  Almost the whole file! <pre>563 rmills@rmillsmbp:~/Downloads $ ls -alt Leaf\ -\ Credo\ 40\ -\ IIQ\ L\ \(4_3\).IIQ.tiff 
-rw-r--r--@ 1 rmills  staff  35092025  8 Apr 07:47 Leaf - Credo 40 - IIQ L (4_3).IIQ.tiff
564 rmills@rmillsmbp:~/Downloads $</pre>I see that v0.25 reports some metadata without an exception.  The exception 'tiff directory length is too large' was added last year (in v0.26, I think) and is set at 500.  I've changed that (locally) to 5000 without success.  I increased it to 50000 and got the exception: <pre>
invalid type value detected in Image::printIFDStructure:  30531</pre>My judgement is that we'll have to study this MakerNote and write a decoder.  This is major task.  No current team member has written a makernote decoder!  It's common (I'm currently involved in an investigation of Canon's new .CR3 format) that the manufacturer provides no documentation for their MakerNote and it has to be reverse engineered by the Open Source Community.</p>


	<p>Exiv2 is used by many open-source projects including <em><strong>darktable</strong></em>  which determines orientation by calling Exiv2.</p>


	<p>Can you say something about the genesis of this file type as I've never heard of Leaf/Credo/IIQ.  As you've already speculated, Team Exiv2 has limited resources and lots of work-in-progress.  Dealing with this file type is unlikely to assigned high priority - unless you persuade us that otherwise! As the marketing people would say "What is the business case for supporting this file type?".</p>


	<p>The team is having a meeting at my home in England in May.  <a class="external" href="https://github.com/Exiv2/exiv2/issues/225">https://github.com/Exiv2/exiv2/issues/225</a>  The top priority feature for v0.28 is "Improved raw image code and test" <a class="external" href="http://dev.exiv2.org/news/3">http://dev.exiv2.org/news/3</a></p>


	<p>I've opened an issue about this:  <a class="external" href="http://dev.exiv2.org/issues/1342">http://dev.exiv2.org/issues/1342</a> "Support for IIQ Raw Files" and copied your file to our buildserver for future work.  <a class="external" href="http://exiv2.dyndns.org:8080/userContent/testfiles/1342/">http://exiv2.dyndns.org:8080/userContent/testfiles/1342/</a></p></div>
  
  </div>
  <div class="message reply" id="message-3115">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3104?r=3115#message-3115">RE: Orientation in IIQ Files</a>
    -
    Added by <a class="user active" href="/users/7086">Robert Bieber</a> <a title="08 Apr 2018 23:14" href="/projects/exiv2/activity?from=2018-04-08">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>Thanks for looking into it</p>


<blockquote>

	<p>Can you say something about the genesis of this file type as I've never heard of Leaf/Credo/IIQ</p>


</blockquote>

	<p>Sure, IIQ is the RAW format for current medium format digital backs manufactured by Phase One and Leaf (Phase One bought Leaf, which is why they have the same RAW format now), as well as older Phase One backs.  For current backs that's the Leaf Credo line and the Phase one IQ1 and IQ3 series, and I think there's a whole long list of older Phase One backs that use it.  Collectively I'd guess these make up a very significant chunk of the medium format digital backs in use (maybe even a majority?  I think Hasselblad is the only real competitor), but of course that's not a huge market.  I don't think there's a whole lot of people using a combination of MF digital backs and open source photo tools.</p>


<blockquote>

	<p>It's common (I'm currently involved in an investigation of Canon's new .CR3 format) that the manufacturer provides no documentation for their MakerNote and it has to be reverse engineered by the Open Source Community.</p>


</blockquote>

	<p>exiftool seems to be able to show the orientation info now, and latest UFRaw (although not dcraw, I guess they have some enhancements of their own to the RAW decoder) is able to correctly render vertical images, so it looks like there's some OS implementations of this out there.  Whether they'll be easy to port over or not I don't know, but if it's not something that's likely to get attention soon I might start digging into it myself whenever I get sufficiently tired of manually rotating my photos in Darktable.  It's a pretty minor annoyance, so it probably won't end up that high on my list either ;)</p></div>
  
  </div>
  <div class="message reply" id="message-3144">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3104?r=3144#message-3144">RE: Orientation in IIQ Files</a>
    -
    Added by <a class="user active" href="/users/3100">Phil Harvey</a> <a title="07 May 2018 17:19" href="/projects/exiv2/activity?from=2018-05-07">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>Yes, the PhaseOne IIQ maker notes contain the raw image data, so they are big.  But I would guess that the Exiv2 error may be because the maker notes are being interpreted as a standard TIFF format, which they are not.  However, the format of these maker notes is known -- see Image::ExifTool::PhaseOne::ProcessPhaseOne() for a code example.</p>


	<p>Adding support for these maker notes should be fairly high priority because as Robert said these are some of the most popular medium-format cameras, and have a strong user base of professional photographers.</p></div>
  
  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-5/5)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
