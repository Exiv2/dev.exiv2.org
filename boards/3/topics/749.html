<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>open image file RDONLY? - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="GHQ48i2oG2LTMS5HqMDRewisl+uTtLet2bDlbMwAK/b6OZMdX9LXYoZVMUsXF91INz7DkmJXFhckkHXkjznMmQ==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>open image file RDONLY?</h2>

<div class="message">
<p><span class="author">Added by <a class="user active" href="/users/1818">Ray NA</a> <a title="01 Jan 2011 06:20" href="/projects/exiv2/activity?from=2011-01-01">almost 11 years</a> ago</span></p>
<div class="wiki">
<p>I would like to know if the only way to ensure that an image file is RDONLY (via the ImageFacotry) is to use:</p>
	<pre><code>ImageFactory::open (const byte *data, long size)</code></pre>


	<p>There appears no other way to specify directly to this class that there is no intention to update.</p>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (7)</h3>
  <div class="message reply" id="message-754">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/749?r=754#message-754">RE: open image file RDONLY?</a>
    -
    Added by <a class="user active" href="/users/133">Robin Mills</a> <a title="01 Jan 2011 20:20" href="/projects/exiv2/activity?from=2011-01-01">almost 11 years</a> ago
  </h4>
  <div class="wiki"><p>I think (and Andreas will say if I am mistaken) the code opens a file with a call fopen(filename,"rb").  If you decide to write to the file, the code does an freopen to enable writing and will throw if unable. So you can open a readonly file.  There is no API to say "open, but throw if I attempt to write".  Of course a windows-readonly (or unix-without write permission) file would have that characteristic and throw when you attempt to write.</p>


	<p>C:\Users\rmills>exiv2 -pt R.jpg | grep Original<br />Exif.Photo.DateTimeOriginal                  Ascii      20  2010:12:27 11:24:37<br />C:\Users\rmills>attrib +r R.jpg<br />C:\Users\rmills>exiv2 -pt R.jpg | grep Original<br />Exif.Photo.DateTimeOriginal                  Ascii      20  2010:12:27 11:24:37<br />C:\Users\rmills>exiv2 ad -a 0:0:1 R.jpg<br />Exiv2 exception in adjust action for file R.jpg:<br />R.jpg: Failed to open file (w+b): Permission denied (errno = 13)<br />C:\Users\rmills>attrib -r R.jpg<br />C:\Users\rmills>exiv2 ad -a 0:0:1 R.jpg<br />C:\Users\rmills>exiv2 -pt R.jpg | grep Original<br />Exif.Photo.DateTimeOriginal                  Ascii      20  2010:12:27 11:24:38<br />C:\Users\rmills></p>


	<p>Can you explain your purpose/intent/use-case please?  And suggest an API to meet your needs.</p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-757">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/749?r=757#message-757">RE: open image file RDONLY?</a>
    -
    Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="02 Jan 2011 16:12" href="/projects/exiv2/activity?from=2011-01-02">almost 11 years</a> ago
  </h4>
  <div class="wiki"><p>The Exiv2 Image API is simple and makes file mode transparent to the user; essentially there are only two methods that access a file: Image::readMetadata and Image::writeMetadata. Under the hood the Exiv2 IO wrappers (BasicIo et al) determine the required file mode and switch automatically, as Robin said.</p>


	<p>Andreas</p></div>
  
  </div>
  <div class="message reply" id="message-761">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/749?r=761#message-761">RE: open image file RDONLY?</a>
    -
    Added by <a class="user active" href="/users/1818">Ray NA</a> <a title="03 Jan 2011 03:25" href="/projects/exiv2/activity?from=2011-01-03">almost 11 years</a> ago
  </h4>
  <div class="wiki"><p>Thanks for the replies.</p>


	<p>I used the sample easyaccess-test.cpp from the src distribution and strace certainly showed that the open(2) calls were made with RDONLY.  However, I wondered whether if there could be an extn to the i/f so that if an user wanted RDONLY access on a file, then we can be guaranteed.</p>


	<p>At the moment, it appears that we are saying:</p>


	<ul>
	<li>request a file open, it's automatically openned as RDONLY</li>
		<li>if you make a modification call, file is reopenned with RDWR</li>
	</ul>


	<p>To put some background on what I am doing, I am writting a small library/tool that will allow me to catalogue a bunch of images (jpegs/tiffs/Nikon NEFs etc) on a local rd/wr filesystem, generating a html table, with thumbnails of the images and basic image info (exif data: camera/lens/fstop/exposure/comments etc).  The intention for this html table, along with the catelogued images will be written to DVD.  The html table/images/exif info will be used as an index to the images DVD.</p>


	<p>As the cateloguing with be the LAST step before burning the disk, the images will NEVER be updated again before burning.  This means I will want to ensure that I/someone else using my library/tool will not inadvertently upd the images files by mistakenly calling an exif mod call (remember, developers are stupid and it's up to us as designers from preventing them misusing the library).</p>


	<p>Therefore, I would like to ensure that when I open a file with the exiv2 library, that I can guarantee that there will be no updates possible with the handle I have just created.</p>


	<p>Would be interested to hear you thoughts.</p>


	<p>As I say, I have a work around (open(RDONLY), read() all data to internal buf, use ImageFactory::open() on my internal buf) but this seems to unneccessary and this RDONLY/no mod to underlying data should be provided by the exiv2 i/f itself.</p>


	<p>Ray</p></div>
  
  </div>
  <div class="message reply" id="message-762">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/749?r=762#message-762">RE: open image file RDONLY?</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Jan 2011 08:05" href="/projects/exiv2/activity?from=2011-01-03">almost 11 years</a> ago
  </h4>
  <div class="wiki"><p>Ray</p>


	<p>Once you have finished updating the image, make it read-only on the file system.  That's much better than changing the API because it prevents image modification.  If we modify the API, that doesn't make the image safe because the developer can open another "handle" on the image and modify it.  Fix this from the outside - it's not a library issue.</p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-764">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/749?r=764#message-764">RE: open image file RDONLY?</a>
    -
    Added by <a class="user active" href="/users/1818">Ray NA</a> <a title="04 Jan 2011 04:14" href="/projects/exiv2/activity?from=2011-01-04">almost 11 years</a> ago
  </h4>
  <div class="wiki"><p>Robin,<br />what you are suggesting isn't really a fix, its a workaround.  Consider:</p>


	<p>If you had a txt file on your FS with r/w permission but you wanted to open this readonly, then you would request your editor to open this readonly ("vim -R" for example) - you would NOT: chmod to remove wr permission, view, chmod to reinstate wr permission.</p>


	<p>This is what you are suggesting.  Your objection to modifying the API (checking rdonly and throwing exceptions) already exists.  Consider a simple image file, and the exifcomment sample program.</p>
	<pre><code><pre>
 $ chmod 400 /tmp/img.jpg
 $ ./exifcomment /tmp/img.jpg
 Writing user comment 'An ASCII Exif comment added with Exiv2' back to the image
 Caught Exiv2 exception '/tmp/2010.jpg: Failed to open file (w+b):  (errno = 13)'</pre></code></pre>


	<p>So the actual i/f doesnt change (aside from the ImageFactory::open() allowing to specifiy RDONLY).</p></div>
  
  </div>
  <div class="message reply" id="message-766">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/749?r=766#message-766">RE: open image file RDONLY?</a>
    -
    Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="04 Jan 2011 05:15" href="/projects/exiv2/activity?from=2011-01-04">almost 11 years</a> ago
  </h4>
  <div class="wiki"><blockquote>

	<p>what you are suggesting isn't really a fix, its a workaround</p>


</blockquote>

	<p>I don't see the bug. There is nothing to fix. The high-level Exiv2 API is so simple that it doesn't need a file mode:<br />If you don't want to modify a file, don't call <code>Image::writeMetadata()</code>.</p>


	<p>Andreas</p></div>
  
  </div>
  <div class="message reply" id="message-1702">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/749?r=1702#message-1702">RE: open image file RDONLY?</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Jan 2014 09:11" href="/projects/exiv2/activity?from=2014-01-08">almost 8 years</a> ago
  </h4>
  <div class="wiki"><p>I have no idea why this forum topic has reappeared at the top of the stack.  So, I'm updating simply so that it appears answered.</p>


	<p>Happy New Year to all Exiv2 Contributors.</p>


	<p>Robin</p></div>
  
  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-7/7)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
