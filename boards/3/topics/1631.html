<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Exception: XMP JPEG segment is larger than 65535 bytes - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="kaj9DFEBZM1aU5roau3nK3jz7AS990RrriPjh+lM7+Vz5VbjI3uozQ83heTVOusYR2G4fUwU5dFTA3MPqnUIig==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>Exception: XMP JPEG segment is larger than 65535 bytes</h2>

<div class="message">
<p><span class="author">Added by <a class="user active" href="/users/3971">Ulrich Pegelow</a> <a title="26 Sep 2013 11:05" href="/projects/exiv2/activity?from=2013-09-26">about 8 years</a> ago</span></p>
<div class="wiki">
<p>Hi,</p>


	<p>I am one of the developers of darktable (<a class="external" href="http://www.darktable.org">www.darktable.org</a>) and new in this forum.<br />We are using exiv2 for our metadata management. This includes saving our development 'history stacks'<br />as XMP tags into exported files. Works very well!</p>


	<p>Our next feature release will introduce masks which means that the size of XMP tags can get significantly larger,<br />covering several 10 kbytes, and exceeding the segment limit of JPEGS. Exiv2 will throw the above exception.</p>


	<p>My question: is there a way to overcome this limit? To my understanding there is in principle a chance<br />to split tags over several segments. That seems to be the approach how large ICC profiles are typically handled.</p>


	<p>Any chance for this?</p>


	<p>Ulrich</p>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (16)</h3>
  <div class="message reply" id="message-1632">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1631?r=1632#message-1632">RE: Exception: XMP JPEG segment is larger than 65535 bytes</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="26 Sep 2013 14:19" href="/projects/exiv2/activity?from=2013-09-26">about 8 years</a> ago
  </h4>
  <div class="wiki"><p>Ulrich</p>


	<p>We've recently had a discussion on topic 1608 about JPG segments:  <a class="external" href="http://dev.exiv2.org/boards/3/topics/1608">http://dev.exiv2.org/boards/3/topics/1608</a>  And there is a document on our Wiki about the format of JPG files.  <a class="external" href="http://dev.exiv2.org/projects/exiv2/wiki/The_Metadata_in_JPEG_files">http://dev.exiv2.org/projects/exiv2/wiki/The_Metadata_in_JPEG_files</a></p>


	<p>No single APP13 block can be more than 65535 bytes, however Exiv2 does support multiple blocks.  Off hand I don't know if XMP is stored in an APP13 block.</p>


	<p>Can you attach an example of the data you wish to add.  It would be very helpful if you could present the data as an exiv2(.exe) command-line and I will investigate/debug and get back to you about this.</p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-1635">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1631?r=1635#message-1635">RE: Exception: XMP JPEG segment is larger than 65535 bytes</a>
    -
    Added by <a class="user active" href="/users/3971">Ulrich Pegelow</a> <a title="27 Sep 2013 09:53" href="/projects/exiv2/activity?from=2013-09-27">about 8 years</a> ago
  </h4>
  <div class="wiki"><p>Hi Robin,</p>


	<p>thanks for having a look into this issue.</p>


	<p>As you requested I attached an example. File large-history-stack.xmp is a sidecar file typical for the ones darktable produces - a large one indeed.</p>


	<p>When I try to insert the XMP tags into a file large-history-stack.jpg (lacking an XMP segment) I get the following:</p>


<pre>
exiv2 -iX large-history-stack.jpg
large-history-stack.jpg: Could not write metadata to file: Size of XMP JPEG segment is larger than 65535 bytes
</pre>

	<p>Ulrich</p></div>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/546">large-history-stack.xmp</a>    <span class="size">(70.3 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/546/large-history-stack.xmp">large-history-stack.xmp</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

  </div>
  <div class="message reply" id="message-1636">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1631?r=1636#message-1636">RE: Exception: XMP JPEG segment is larger than 65535 bytes</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="27 Sep 2013 20:04" href="/projects/exiv2/activity?from=2013-09-27">about 8 years</a> ago
  </h4>
  <div class="wiki"><p>Ulrich</p>


	<p>I think we might be in difficulty with this.  I had a read at this document: <a class="external" href="http://search.cpan.org/~bettelli/Image-MetaData-JPEG-0.153/lib/Image/MetaData/JPEG/Structures.pod#Structure_of_an_XMP_APP1_segment">http://search.cpan.org/~bettelli/Image-MetaData-JPEG-0.153/lib/Image/MetaData/JPEG/Structures.pod#Structure_of_an_XMP_APP1_segment</a></p>


	<p>You will see that it says:</p>


<blockquote>

	<p>XMP APP1 segments are made up by an identifier and a Unicode XMP packet (the encoding is usually UTF-8, but it can also be UTF-16 or UTF-32, both big-endian or little-endian). The packet cannot be split in multiple segments, so there is a maximum size of approximately 64KB. The structure is very simple: a fixed XMP namespace URI (null terminated, and without quotation marks) followed by the XMP packet: …..</p>


</blockquote>

	<p>Exiv2 can handle multiple APP1 segments.  However you have a single XMP packet which is longer than 64K.  The XMP Spec <a class="external" href="http://partners.adobe.com/public/developer/en/xmp/sdk/XMPspecification.pdf">http://partners.adobe.com/public/developer/en/xmp/sdk/XMPspecification.pdf</a> on p93 states:</p>


<blockquote>

	<p>IMPORTANT: Following the normal rules for JPEG sections, the header plus the following<br />data can be at most 65535 bytes long. The XMP Packet cannot be split across<br />the multiple APP1 sections, so the size of the XMP Packet can be at most<br />65502 bytes.</p>


</blockquote>

	<p>I've looked for the word 'compression' in the spec in the hope of being able to compress the packet.  The 71k file 'large-history-stack.xmp' is only 15K when zipped.  I didn't find anything to enable the packet to be compressed.</p>


	<p>Clearly, it is possible to reduce the size of the packet by elimination of white space in the XML and using single-letter namespace identifiers.  For example &lt;rdf:xxx&gt; could be shortened to &lt;r:xxx&gt;.  For the file you have sent, you might get lucky and reduce 71949 to 65000.  I believe the utility xmllint can do this for you.</p>


	<p>I don't know what a 'history stack' is.  Perhaps it's possible to flate-compress the strings in darktable:blendop_params.</p>


	<p>I don't have a solution for you.  However I'm happy to continue to discuss this and we may discover a work-around.</p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-1637">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1631?r=1637#message-1637">RE: Exception: XMP JPEG segment is larger than 65535 bytes</a>
    -
    Added by <a class="user active" href="/users/3971">Ulrich Pegelow</a> <a title="28 Sep 2013 06:24" href="/projects/exiv2/activity?from=2013-09-28">about 8 years</a> ago
  </h4>
  <div class="wiki"><p>Hi Robin,</p>


	<p>thanks for your feedback!</p>


	<p>So it looks like in principle we can not guarantee that any arbitrary sized XMP block fits into a JPEG. Your suggestion to compress the data is probably the way to go in order to reduce the problem pressure. In darktable's case there is a certain type of data that consumes most of the space - vector data describing blend masks. Compressing these data would be the first step.</p>


	<p>Thanks again.</p>


	<p>Ulrich</p></div>
  
  </div>
  <div class="message reply" id="message-1640">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1631?r=1640#message-1640">RE: Exception: XMP JPEG segment is larger than 65535 bytes</a>
    -
    Added by <a class="user active" href="/users/124">Michael Ulbrich</a> <a title="30 Sep 2013 02:08" href="/projects/exiv2/activity?from=2013-09-30">about 8 years</a> ago
  </h4>
  <div class="wiki"><p>Hi Robin, Ulrich,</p>


	<p>there is a document "XMP Specification Part3: Storage in Files" from July 2010 which is available for download on the net.</p>


	<p>It states in section 2.1.3.1 "Extended XMP in JPEG":</p>


	<p>"Following the normal rules for JPEG sections, the header plus the following data can be at most 65535 bytes<br />long. If the XMP packet is not split across multiple APP1 sections, the size of the XMP packet can be at most<br />65502 bytes. It is unusual for XMP to exceed this size; typically, it is around 2 KB.</p>


	<p>If the serialized XMP packet becomes larger than the 64 KB limit, you can divide it into a main portion<br />(StandardXMP) and an extended portion (ExtendedXMP), and store it in multiple JPEG marker segment. A<br />reader must check for the existence of ExtendedXMP, and if it is present, integrate the data with the main XMP.<br />Each portion (standard and extended) is a fully formed XMP metadata tree, although only the standard portion<br />contains a complete packet wrapper. If the data is more than twice the 64 KB limit, the extended portion can<br />also be split and stored in multiple marker segments; in this case, the split portions are not fully formed<br />metadata trees."</p>


	<p>In practice I haven't seen any example of XMP split into Standard- and ExtentedXMP yet.</p>


	<p>Would be interesting to check, if any of the standard image or metadata editors actually support this kind of split XMP over multiple APP1 segments.</p>


	<p>Best regards ... Michael</p></div>
  
  </div>
  <div class="message reply" id="message-1722">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1631?r=1722#message-1722">RE: Exception: XMP JPEG segment is larger than 65535 bytes</a>
    -
    Added by <a class="user active" href="/users/3100">Phil Harvey</a> <a title="27 Feb 2014 09:45" href="/projects/exiv2/activity?from=2014-02-27">over 7 years</a> ago
  </h4>
  <div class="wiki"><p>I have seen a number of examples of extended XMP.  Adobe products write this, and ExifTool has supported extended XMP since Oct. 26, 2008 (it was added to the XMP specification Oct. 17, 2008).</p>


	<p>- Phil</p></div>
  
  </div>
  <div class="message reply" id="message-1846">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1631?r=1846#message-1846">RE: Exception: XMP JPEG segment is larger than 65535 bytes</a>
    -
    Added by <a class="user active" href="/users/3802">Jan Rüegg</a> <a title="15 Oct 2014 12:33" href="/projects/exiv2/activity?from=2014-10-15">about 7 years</a> ago
  </h4>
  <div class="wiki"><p>Yes, this is also used for example for writing depthmap data into images, as described here:<br /><a class="external" href="https://developers.google.com/depthmap-metadata/examples">https://developers.google.com/depthmap-metadata/examples</a></p>


	<p>This is an example of such an image with extended xmp data:<br /><a class="external" href="https://github.com/spite/android-lens-blur-depth-extractor/blob/master/table.jpg">https://github.com/spite/android-lens-blur-depth-extractor/blob/master/table.jpg</a></p>


	<p>exiftool is able to read all the data:</p>
	<pre><code>exiftool table.jpg<br />...<br />Blur At Infinity                : 0.013350779<br />Focal Distance                  : 16.577824<br />Focal Point X                   : 0.5208333<br />Focal Point Y                   : 0.58125<br />Format                          : RangeInverse<br />Near                            : 12.423587799072266<br />Far                             : 390.539306640625<br />Mime                            : image/png<br />Has Extended XMP                : E0CC0C923EA0770C77E3E4EF99F538B3<br />Data                            : (Binary data 268496 bytes, use -b option to extract)<br />...</code></pre>


	<p>exiv2 doesn't see the "Data":</p>
	<pre><code>exiv2 -PX table.jpg               <br />Xmp.GFocus.BlurAtInfinity                    XmpText    11  0.013350779<br />Xmp.GFocus.FocalDistance                     XmpText     9  16.577824<br />Xmp.GFocus.FocalPointX                       XmpText     9  0.5208333<br />Xmp.GFocus.FocalPointY                       XmpText     7  0.58125<br />Xmp.GImage.Mime                              XmpText    10  image/jpeg<br />Xmp.GDepth.Format                            XmpText    12  RangeInverse<br />Xmp.GDepth.Near                              XmpText    18  12.423587799072266<br />Xmp.GDepth.Far                               XmpText    16  390.539306640625<br />Xmp.GDepth.Mime                              XmpText     9  image/png<br />Xmp.xmpNote.HasExtendedXMP                   XmpText    32  E0CC0C923EA0770C77E3E4EF99F538B3</code></pre></div>
  
  </div>
  <div class="message reply" id="message-2015">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1631?r=2015#message-2015">RE: Exception: XMP JPEG segment is larger than 65535 bytes</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="17 Apr 2015 11:53" href="/projects/exiv2/activity?from=2015-04-17">over 6 years</a> ago
  </h4>
  <div class="wiki"><p>I've updated <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Add options -pS and -dI to application exiv2 (Closed)" href="/issues/922">#922</a> and intend to fix xmp that overflows a single JPEG segment.  I've found a test file and added it to the test suite. <a class="changeset" title="Adding a test JPEG with XMP spanning multiple segments." href="/projects/exiv2/repository/exiv2/revisions/3701">r3701</a>.</p></div>
  
  </div>
  <div class="message reply" id="message-2179">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1631?r=2179#message-2179">RE: Exception: XMP JPEG segment is larger than 65535 bytes</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="02 Aug 2015 10:40" href="/projects/exiv2/activity?from=2015-08-02">over 6 years</a> ago
  </h4>
  <div class="wiki"><p>The version of exiv2(.exe) that ships with v0.25 has an option -pX to extract the XMP as "raw" xml.  That code understands Xmp.xmpNote.HasExtendedXMP.  However the current version the XMPsdk which is statically linked into libexiv2 does not understand HasExtendedXMP.  I believe XMPsdk will be ungraded in v0.26 and will handle this correctly.<pre>$ exiv2 -pX ~/Downloads/table.jpg
&lt;x:xmpmeta xmlns:x="adobe:ns:meta/" x:xmptk="Adobe XMP Core 5.1.0-jc003"&gt;
  &lt;rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;
    &lt;rdf:Description rdf:about="" 
        xmlns:GImage="http://ns.google.com/photos/1.0/image/" 
        xmlns:GDepth="http://ns.google.com/photos/1.0/depthmap/" 
      GImage:Data="/9j/4AAQSkZJRgABAQAAAQABAAD...deleted...//2Q==" 
      GDepth:Data="iVBORw...deleted...CYII="/&gt;
  &lt;/rdf:RDF&gt;
&lt;/x:xmpmeta&gt;
$ 507 rmills@rmillsmbp:~ $ exiv2 -pX ~/Downloads/table.jpg  | wc
       9      16  521029
$</pre>The output from exiv2 -PX ~/Downloads/table.jpg remains the same as you reported above.  As you correctly state "exiv2 doesn't see the "Data".</p>


	<p>There is however something odd about this sample image.  As I understand the specification, the Xmp in the "default" segment should be repeated in the Extended chain of segments.  Clearly Xmp.GFocus etc are only in the default segment.  I believe the data should be repeated in the Extended chain to off-load the reader from merging xml from the default and extended chain.</p></div>
  
  </div>
  <div class="message reply" id="message-2181">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1631?r=2181#message-2181">RE: Exception: XMP JPEG segment is larger than 65535 bytes</a>
    -
    Added by <a class="user active" href="/users/3100">Phil Harvey</a> <a title="05 Aug 2015 11:21" href="/projects/exiv2/activity?from=2015-08-05">over 6 years</a> ago
  </h4>
  <div class="wiki"><p>From the XMP specification:</p>


	<p>"A reader must check for the existence of ExtendedXMP, and if it is present, integrate the data with the main XMP."</p>


	<p>"When ExtendedXMP is required, the metadata must be split according to some algorithm that assigns more important data to the main portion, and less important data to the extended portions or portions."</p>


	<p>- Phil</p></div>
  
  </div>
  <div class="message reply" id="message-2400">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1631?r=2400#message-2400">RE: Exception: XMP JPEG segment is larger than 65535 bytes</a>
    -
    Added by <a class="user active" href="/users/3663">Tobias E.</a> <a title="10 Mar 2016 11:30" href="/projects/exiv2/activity?from=2016-03-10">over 5 years</a> ago
  </h4>
  <div class="wiki"><p>Hi,</p>


	<p>I have seen several commits in <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Add options -pS and -dI to application exiv2 (Closed)" href="/issues/922">#922</a>. Do they only change the way the exiv2 command line tool works, or will we also get support for extended XMP when using libexiv2? Glancing over the code it seem it's part of the core XMP handling, but I would like to get a confirmation on that.</p>


	<p>Tobias</p></div>
  
  </div>
  <div class="message reply" id="message-2401">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1631?r=2401#message-2401">RE: Exception: XMP JPEG segment is larger than 65535 bytes</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="10 Mar 2016 11:43" href="/projects/exiv2/activity?from=2016-03-10">over 5 years</a> ago
  </h4>
  <div class="wiki"><p>Tobias</p>


	<p>The option -pX will extract XMP (and Extended XMP).  However the version of XMPsdk in our code base remains stuck in the dark ages before Extended XMP.  Issue <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Upgrade xmpsdk source to Adobe&#39;s current version (Closed)" href="/issues/941">#941</a> is to upgrade our XMPsdk to use the latest Adobe code and to treat XMPsdk as an external library.  Regrettably, this has been deferred.  Andreas assures me that it is a considerable undertaking to implement <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Upgrade xmpsdk source to Adobe&#39;s current version (Closed)" href="/issues/941">#941</a>.</p>


	<p>One of the command-line changes in support of <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Feature: Add options -pS and -dI to application exiv2 (Closed)" href="/issues/922">#922</a> (and others) is to support the <em><strong>tgt</strong></em> '-' to mean stdin/stdout.  This enables metadata to be piped between files.  So the option: <code>-pX</code> will print XMP.  The option: <code>-eX-</code> will do the same thing.  The use-case is something like:<pre>$ exiv2 -eX- foo.jpg | exiv2 -iX- bla.jpg</pre>In addition to X for XMP, I've added C for ICC profile.</p>


	<p>I'm a little overloaded at the moment with a major home renovation project.  I've submitted the code for a lot of the <code>-e-</code> and <code>-i-</code> stuff, however I need to more thoroughly test and document this <em><strong>and</strong></em> to add tests to test suite.  If you have time to spare, I'd appreciate some help with this effort.</p></div>
  
  </div>
  <div class="message reply" id="message-2402">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1631?r=2402#message-2402">RE: Exception: XMP JPEG segment is larger than 65535 bytes</a>
    -
    Added by <a class="user active" href="/users/3663">Tobias E.</a> <a title="10 Mar 2016 11:47" href="/projects/exiv2/activity?from=2016-03-10">over 5 years</a> ago
  </h4>
  <div class="wiki"><p>Too bad, I guess I have to read the JPEG APP1 tags myself then, assemble them manually and feed the result to exiv2. Thanks for the quick answer though. :-)</p></div>
  
  </div>
  <div class="message reply" id="message-2403">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1631?r=2403#message-2403">RE: Exception: XMP JPEG segment is larger than 65535 bytes</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="10 Mar 2016 11:57" href="/projects/exiv2/activity?from=2016-03-10">over 5 years</a> ago
  </h4>
  <div class="wiki"><p>I'm not sure what you're doing, however you may find the option <strong><code>-pS</code></strong> and <strong><code>-pR</code></strong> useful for the analysis of files.  <strong><code>-pS</code></strong> prints the structure of a file.  <strong><code>-pR</code></strong> recursively prints the structure of the file.  By <em><strong>recursive</strong></em>, I mean that it will use the tiff structure printer on embedded tiff structures.</p>


	<p>If you're writing scripts to manipulate the APPx segment of a file, the combination of <strong><code>-pS</code></strong> and the utility <em><strong>dd</strong></em> are powerful medicine for locating/extracting/replacing APPx segments.  I believe this is discussed in the Wiki in the articles about the structure of various file formats.  It has also be discussed in several forum discussions which you can probably find by searching the forum.</p></div>
  
  </div>
  <div class="message reply" id="message-2404">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1631?r=2404#message-2404">RE: Exception: XMP JPEG segment is larger than 65535 bytes</a>
    -
    Added by <a class="user active" href="/users/3663">Tobias E.</a> <a title="10 Mar 2016 12:19" href="/projects/exiv2/activity?from=2016-03-10">over 5 years</a> ago
  </h4>
  <div class="wiki"><p>I am not using the command line tool at all, but libexiv2 and its C++ API. I am, just like Ulrich, a developer of darktable.</p></div>
  
  </div>
  <div class="message reply" id="message-2405">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1631?r=2405#message-2405">RE: Exception: XMP JPEG segment is larger than 65535 bytes</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="10 Mar 2016 12:35" href="/projects/exiv2/activity?from=2016-03-10">over 5 years</a> ago
  </h4>
  <div class="wiki"><p>Yes, I am describing features of the command-line tool.  However these things are implemented in the API, so you may be able to take advantage of the work I've put into these features.</p></div>
  
  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-16/16)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
