<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Lens identification mismatch - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="ysfC0CZZ5wswWk2UUzgRxerLXkZvjBq+U0+Xb0QqJYMoimk/VCMrC2U+Upjs7x321VkKP55vuwSubwfnBxPC7A==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>Lens identification mismatch</h2>

<div class="message">
<p><span class="author">Added by <a class="user active" href="/users/4823">Francois Edelin</a> <a title="03 Nov 2016 17:49" href="/projects/exiv2/activity?from=2016-11-03">about 5 years</a> ago</span></p>
<div class="wiki">
<p>Hello,<br />I use Canon 7Dm2/5Dm3 with tamron 24-70 VC and develop to tiff with Darktable 2.0.7/lensfun 0.2.8-3<br />exiv2 is in version 2.14<br />how come my lens is identified as a Sigma? A lack of lens ID in the exif from both brands? Any way to avoid this? (other than selling the tamron to buy a sigma :-))<br />Exif.CanonCs.LensType                        Short       1  Sigma 24-70mm f/2.8 IF EX DG HSM<br />Exif.CanonCs.Lens                            Short       3  24.0 - 70.0 mm<br />Exif.Canon.LensModel                         Ascii      74  24-70mm<br />Exif.Photo.LensSpecification                 Rational    4  24/1 70/1 0/1 0/1<br />Exif.Photo.LensModel                         Ascii       8  24-70mm<br />Exif.Photo.LensSerialNumber                  Ascii      11  0000000000</p>


	<p>Thank you for your support<br />Francois</p>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (8)</h3>
  <div class="message reply" id="message-2783">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2782?r=2783#message-2783">RE: Lens identification mismatch</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Nov 2016 18:21" href="/projects/exiv2/activity?from=2016-11-03">about 5 years</a> ago
  </h4>
  <div class="wiki"><p>Can you attach a test image to this thread please?</p>


	<p>Lens identification requires a "heuristic" (guess).  The lens is recognised by a numerical value in the metadata and exiv2 has a table to convert the number to a string.  Unfortunately, the (numerical) lensID is frequently used by several different lenses.  We then use code to inspect focal length and other metadata to figure/guess which lens is in use.  In your case, I believe your lensID is 137:<pre>732 rmills@rmillsmbp:~/gnu/exiv2/trunk/src $ grep 'Sigma 24-70mm f/2.8 IF EX DG HSM' canonmn.cpp 
        { 137, "Sigma 24-70mm f/2.8 IF EX DG HSM"                           }, // 4
733 rmills@rmillsmbp:~/gnu/exiv2/trunk/src $ </pre>You'll be unhappy to discover (in src/canonmn.cpp) that we know about 17 lenses that use that lensID.</p>


<pre>        { 137, "Canon EF 85mm f/1.2L"                                       }, // 0
        { 137, "Sigma 18-50mm f/2.8-4.5 DC OS HSM"                          }, // 1
        { 137, "Sigma 50-200mm f/4-5.6 DC OS HSM"                           }, // 2
        { 137, "Sigma 18-250mm f/3.5-6.3 DC OS HSM"                         }, // 3
        { 137, "Sigma 24-70mm f/2.8 IF EX DG HSM"                           }, // 4
        { 137, "Sigma 18-125mm f/3.8-5.6 DC OS HSM"                         }, // 5
        { 137, "Sigma 17-70mm f/2.8-4 DC Macro OS HSM | C"                  }, // 6
        { 137, "Sigma 17-50mm f/2.8 OS HSM"                                 }, // 7
        { 137, "Sigma 18-200mm f/3.5-6.3 DC OS HSM [II]"                    }, // 8
        { 137, "Tamron AF 18-270mm f/3.5-6.3 Di II VC PZD"                  }, // 9
        { 137, "Sigma 8-16mm f/4.5-5.6 DC HSM"                              }, // 10
        { 137, "Tamron SP 17-50mm f/2.8 XR Di II VC"                        }, // 11
        { 137, "Tamron SP 60mm f/2 Macro Di II"                             }, // 12
        { 137, "Sigma 10-20mm f/3.5 EX DC HSM"                              }, // 13
        { 137, "Tamron SP 24-70mm f/2.8 Di VC USD"                          }, // 14
        { 137, "Sigma 18-35mm f/1.8 DC HSM"                                 }, // 15
        { 137, "Sigma 12-24mm f/4.5-5.6 DG HSM II"                          }, // 16
</pre>In the next release of Exiv2 (v0.26 which is currently at RC1 and may ship in 2016), we have added a new feature to allow you to enter the name of your lens in the file ~/.exiv2  This is described:  <a class="external" href="http://dev.exiv2.org/projects/exiv2/wiki/Lens_Recognition_in_Exiv2_v026_(and_later)/">http://dev.exiv2.org/projects/exiv2/wiki/Lens_Recognition_in_Exiv2_v026_(and_later)/</a>

	<p>Although exiv2 v0.26 has not shipped, it is possible that your version of darktable already supports this feature.  Pascal de Brujin cherrypicks code from our trunk and updates exiv2 v0.25 installed on many linux distributions.  Please let me know if it works for you.</p>


	<p>If however, this doesn't work on your version of darktable, exiv2 v0.26 will ship and be included in darktable next year.  You can build darktable to include exiv2 from our trunk and I believe that is working.</p>


	<p>You can determine the lensID using the exiv2 option <strong><code>-pv</code></strong>.  For example:<pre>735 rmills@rmillsmbp:~/gnu/exiv2/trunk/src $ exiv2 -pv --grep lens/i http://clanmills.com/Stonehenge.jpg 
0x0083 Nikon3       LensType                    Byte        1  14
0x0084 Nikon3       Lens                        Rational    4  180/10 2500/10 35/10 63/10
0x008b Nikon3       LensFStops                  Undefined   4  55 1 12 0
0x000c NikonLd3     LensIDNumber                Byte        1  146
0x000d NikonLd3     LensFStops                  Byte        1  55
736 rmills@rmillsmbp:~/gnu/exiv2/trunk/src $ </pre></p></div>
  
  </div>
  <div class="message reply" id="message-2784">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2782?r=2784#message-2784">RE: Lens identification mismatch</a>
    -
    Added by <a class="user active" href="/users/4823">Francois Edelin</a> <a title="03 Nov 2016 18:43" href="/projects/exiv2/activity?from=2016-11-03">about 5 years</a> ago
  </h4>
  <div class="wiki"><p>Hi Robin,</p>


	<p>Thank you for your quick support. I was suspecting is lack of ID (or same ID for several lens) as I already had the problem with DxO/Mac.<br />Being able to set up manually a name for an ID is a great solution. I currently do not have any existing ~/.exiv2 file, shall I create one from scratch?<br />Attached the requested file (the size of the RAW is beyond the 20MB allowed for upload)</p>


	<p>Best regards,<br />Francois</p></div>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1095">160807_1155-#6017.jpg</a>    <span class="size">(3.56 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1095/160807_1155-%236017.jpg">160807_1155-#6017.jpg</a>  </td>
  <td>RAW-&gt;JPG EOS7DM2+TAMRON24-70VC_USD</td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

  </div>
  <div class="message reply" id="message-2785">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2782?r=2785#message-2785">RE: Lens identification mismatch</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Nov 2016 18:58" href="/projects/exiv2/activity?from=2016-11-03">about 5 years</a> ago
  </h4>
  <div class="wiki"><p>Here's what happens when I use your image on the trunk version of exiv2: <pre>742 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pv --grep lens/i 160807_1155-%236017.jpg 
0x0016 CanonCs      LensType                    Short       1  137
0x0017 CanonCs      Lens                        Short       3  70 24 1
0x0009 CanonCf      LensAFStopButton            Short       1  0
0x0095 Canon        LensModel                   Ascii      74  24-70mm
0xa432 Photo        LensSpecification           Rational    4  24/1 70/1 0/1 0/1
0xa434 Photo        LensModel                   Ascii       8  24-70mm
0xa435 Photo        LensSerialNumber            Ascii      11  0000000000
743 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pa --grep lens/i 160807_1155-%236017.jpg 
Exif.CanonCs.LensType                        Short       1  Sigma 24-70mm f/2.8 IF EX DG HSM
Exif.CanonCs.Lens                            Short       3  24.0 - 70.0 mm
Exif.CanonCf.LensAFStopButton                Short       1  0
Exif.Canon.LensModel                         Ascii      74  24-70mm
Exif.Photo.LensSpecification                 Rational    4  24/1 70/1 0/1 0/1
Exif.Photo.LensModel                         Ascii       8  24-70mm
Exif.Photo.LensSerialNumber                  Ascii      11  0000000000
744 rmills@rmillsmbp:~/gnu/exiv2/trunk $</pre>You can download last night's build (which includes exiv2) from our buildserver:  <a class="external" href="http://exiv2.dyndns.org:8080/userContent/builds/Latest/">http://exiv2.dyndns.org:8080/userContent/builds/Latest/</a></p>


	<p>However, you cannot replace the libexiv2.14.so with the latest from the buildserver.  Although the buildserver delivers a file called "libexiv2.14.mumble", it is a development version and no longer a plug replacement.<pre>744 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -vVg library | grep exiv2
exiv2 0.25 001900 (64 bit build)
library=/usr/local/lib/libexiv2.14.dylib
745 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre>However you can run exiv2 from the buildserver and see if it recognises your lens.  There's also a possibility that (thanks to Pascal's wonderful work), you be in luck and it will work.</p>


	<p>While you are messing with our buildserver, I'll look at your file with Darktable 2.0.7/lensfun 0.2.8-3 on Linux.</p></div>
  
  </div>
  <div class="message reply" id="message-2786">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2782?r=2786#message-2786">RE: Lens identification mismatch</a>
    -
    Added by <a class="user active" href="/users/4823">Francois Edelin</a> <a title="03 Nov 2016 19:20" href="/projects/exiv2/activity?from=2016-11-03">about 5 years</a> ago
  </h4>
  <div class="wiki"><p>I get the topic but do not really understand how to proceed (and don't want to loose too much of your time teaching me linux "how to")<br />I like the idea that the next exiv2 release will provide this custom lens name ability. Especially that I am considering buy an IRIX lens soon<br />Meanwhile, I would use one CF per lens during shooting and would apply a Darktable "Sigma2Tamron" custom style on a per upload basis.</p></div>
  
  </div>
  <div class="message reply" id="message-2787">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2782?r=2787#message-2787">RE: Lens identification mismatch</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Nov 2016 19:31" href="/projects/exiv2/activity?from=2016-11-03">about 5 years</a> ago
  </h4>
  <div class="wiki"><p>I've go this "sort of" working.  Here's what I can see:<pre>877 rmills@rmillsmbp-ubuntu:~/gnu/exiv2/trunk $ cat ~/.exiv2
[canon]
137=tamron 24-70 VC from Francois
878 rmills@rmillsmbp-ubuntu:~/gnu/exiv2/trunk $ exiv2 -pa --grep lens/i ~/Downloads/160807_1155-%236017.jpg
Exif.CanonCs.LensType                        Short       1  tamron 24-70 VC from Francois  &lt;--- GOOD eh?
Exif.CanonCs.Lens                            Short       3  24.0 - 70.0 mm
Exif.CanonCf.LensAFStopButton                Short       1  0
Exif.Canon.LensModel                         Ascii      74  24-70mm
Exif.Photo.LensSpecification                 Rational    4  24/1 70/1 0/1 0/1
Exif.Photo.LensModel                         Ascii       8  24-70mm
Exif.Photo.LensSerialNumber                  Ascii      11  0000000000</pre>Pascal has been busy and I believe he has updated darktable with the feature to read from ~/.exiv2  <a class="external" href="https://launchpad.net/~pmjdebruijn/+archive/ubuntu/darktable-release">https://launchpad.net/~pmjdebruijn/+archive/ubuntu/darktable-release</a>  Try installing Pascal's latest and greatest.  I think you will have the ~/.exiv2 feature.</p>


	<p>For me, I am hanging darktable when I import your file and suspect it's because I have the (incompatible) trunk build in my /usr/local/lib/libexiv2.14.so</p>


	<p>I'm going to reboot and try a little brain surgery on the machine.  I'm 80% confident that I'll get this working by 20:00GMT and 20% confident that I'll give up!</p>


	<p>Pascal is a very nice (and clever/diligent/good) guy.  If I don't get it to work for you, it's quite likely he'll help you.</p></div>
  
  </div>
  <div class="message reply" id="message-2788">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2782?r=2788#message-2788">RE: Lens identification mismatch</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Nov 2016 19:54" href="/projects/exiv2/activity?from=2016-11-03">about 5 years</a> ago
  </h4>
  <div class="wiki"><p>We're close, and a little out of luck.</p>


	<p>I've imported your image and the lens shows up as "Sigma bla dee bla".  However there's no question that we're using Pascal's modified libexiv2.14.0.0.  <pre>904 rmills@rmillsmbp-ubuntu:/usr $ lsof | grep darktable | grep libexiv2
darktable 6138                rmills  mem       REG                8,1   2615496     665187 /usr/lib/x86_64-linux-gnu/libexiv2.so.14.0.0
...
909 rmills@rmillsmbp-ubuntu:~/Downloads $ ls -alt /usr/lib/x86_64-linux-gnu/libexiv2.so.14.0.0 
-rw-r--r-- 1 root root 2615496 May 19 06:19 /usr/lib/x86_64-linux-gnu/libexiv2.so.14.0.0
910 rmills@rmillsmbp-ubuntu:~/Downloads $ </pre>So, we're reached 100% <em><strong>not yet</strong></em> with this feature.  However it will come to darktable soon.  No need to trouble Pascal at this time.  Of course you're always welcome to thank him and his friends for darktable.</p>


	<p>We're done on this 7 minutes ahead of schedule at 19:53GMT.</p>


	<p><img src="/attachments/download/1096/DarkTableScreenShot.png" alt="" /></p></div>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1096">DarkTableScreenShot.png</a>    <span class="size">(53 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1096/DarkTableScreenShot.png">DarkTableScreenShot.png</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

  </div>
  <div class="message reply" id="message-2789">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2782?r=2789#message-2789">RE: Lens identification mismatch</a>
    -
    Added by <a class="user active" href="/users/4823">Francois Edelin</a> <a title="03 Nov 2016 20:49" href="/projects/exiv2/activity?from=2016-11-03">about 5 years</a> ago
  </h4>
  <div class="wiki"><p>I agree, it's not a major issue as using lens in the medium values make distortions invisible, especially for transtandard like 24-70.<br />Thank you for having tried anyway.</p>


	<p>Best Regards from Switzerland<br />Francois</p></div>
  
  </div>
  <div class="message reply" id="message-2790">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2782?r=2790#message-2790">RE: Lens identification mismatch</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="03 Nov 2016 21:04" href="/projects/exiv2/activity?from=2016-11-03">about 5 years</a> ago
  </h4>
  <div class="wiki"><p>As you've probably noticed that I'm a software guy.  I know very little about photography and have no idea what lensfun does and little understanding of darktable.</p>


	<p>Photography is next on the bucket list.  <a class="external" href="http://clanmills.com/BucketList.shtml">http://clanmills.com/BucketList.shtml</a></p>


	<p>Since retiring in 2014, we have totally remodelled our home and about to set of on a journey around the world.  On our trip, we'll visit Andreas who is the founder of Exiv2 and wrote a lot of the code.  He is also from Switzerland.  Today he lives in the Far East.</p></div>
  
  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-8/8)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
