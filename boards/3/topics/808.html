<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Input data does not contain a valid image - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="JdSmk4SRbnvZL7C5Fyq9Z88bJvisJKpI1t43P9DM/sfHmQ189uuie4xLr7Wo/bFU8IlygV3HC/Ir/qe3k/UZqA==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>Input data does not contain a valid image</h2>

<div class="message">
<p><span class="author">Added by <a class="user active" href="/users/2059">Stefan Brandl</a> <a title="16 Feb 2011 10:09" href="/projects/exiv2/activity?from=2011-02-16">almost 11 years</a> ago</span></p>
<div class="wiki">
<p>Hi,<br />look at the image at <a class="external" href="http://www.brandl.eu/20050625_082910.jpg">http://www.brandl.eu/20050625_082910.jpg</a> (Attention 1MB)<br />If I do</p>


	<p>exiv2 -M"add Iptc.Application2.Credit String Mr. Smith" 20050625_082910.jpg</p>


	<p>I get:</p>


	<p>Exiv2 exception in modify action for file 20050625_082910.jpg<br />Input data does not contain a valid image</p>


	<p>What can I do?</p>


	<p>Stefan</p>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (16)</h3>
  <div class="message reply" id="message-809">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/808?r=809#message-809">RE: Input data does not contain a valid image</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="16 Feb 2011 12:31" href="/projects/exiv2/activity?from=2011-02-16">almost 11 years</a> ago
  </h4>
  <div class="wiki"><p>Stephan</p>


	<p>Thanks for bringing this to our attention.  I've reproduced this with the 0.21.1 code-base.  I ran your image through the debugger and it seems that an 18 byte block of PhotoShop data is causing the library to panic when updating the metadata.  I think I have a code fix (but no work around) which I'd like to discuss off-line with Andreas.</p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-810">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/808?r=810#message-810">RE: Input data does not contain a valid image</a>
    -
    Added by <a class="user active" href="/users/2059">Stefan Brandl</a> <a title="16 Feb 2011 12:50" href="/projects/exiv2/activity?from=2011-02-16">almost 11 years</a> ago
  </h4>
  <div class="wiki"><p>Hello Robin,<br />the image is directly from the camera. I have hundreds of such images.<br />They have never seen Photoshop.<br />Would be great to get a code-fix.</p>


	<p>Stefan</p></div>
  
  </div>
  <div class="message reply" id="message-811">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/808?r=811#message-811">RE: Input data does not contain a valid image</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="16 Feb 2011 13:15" href="/projects/exiv2/activity?from=2011-02-16">almost 11 years</a> ago
  </h4>
  <div class="wiki"><p>I'm willing to share my fix privately if you email me: <a class="email" href="mailto:robin@clanmills.com">robin@clanmills.com</a>.  However I would like Andreas to "bless" the fix before I cause unnecessary confusion.</p>


	<p>Presumably this little PhotoShop block was inserted by the camera.  My Canon camera inserts a little PhotoShop block (of 100 bytes) and I don't know what's in there.  However I believe it's the length of your block (18 bytes) which is causing pain!</p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-815">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/808?r=815#message-815">RE: Input data does not contain a valid image</a>
    -
    Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="20 Feb 2011 00:29" href="/projects/exiv2/activity?from=2011-02-20">over 10 years</a> ago
  </h4>
  <div class="wiki"><p>I've created bug <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Exiv2 fails to write to JPEG with an empty APP13 Photoshop PS3 segment  (Closed)" href="/issues/760">#760</a> for this and checked in a fix.</p>


	<p>The sample image contains an APP13 Photoshop PS3 segment with an empty payload. The exiv2 JPEG write function interpreted the empty data as invalid. With the fix, exiv2 accepts the empty block but removes it on write unless there is data to write to it.</p>


	<p>Thanks Stefan and Robin for reporting and investigating this.</p>


	<p>Andreas</p></div>
  
  </div>
  <div class="message reply" id="message-899">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/808?r=899#message-899">RE: Input data does not contain a valid image</a>
    -
    Added by <a class="user active" href="/users/339">Steve Wright</a> <a title="18 Apr 2011 23:26" href="/projects/exiv2/activity?from=2011-04-18">over 10 years</a> ago
  </h4>
  <div class="wiki"><p>Good to know we'll be getting fewer of those "does not contains" in 0.21 and future versions. Then again, the Adobe code-bit Andreas found in Stefan's example file could be the only one Exiv2 has been "choking on" since PS3 was new. Here's hoping it is, eh?</p>


	<p>BZT</p></div>
  
  </div>
  <div class="message reply" id="message-998">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/808?r=998#message-998">RE: Input data does not contain a valid image</a>
    -
    Added by <a class="user active" href="/users/339">Steve Wright</a> <a title="06 Oct 2011 18:24" href="/projects/exiv2/activity?from=2011-10-06">about 10 years</a> ago
  </h4>
  <div class="wiki"><p>Steve Wright wrote:</p>


<blockquote>

	<p>Good to know we'll be getting fewer of those "does not contains" in 0.21 and future versions. Then again, the Adobe code-bit Andreas found in Stefan's example file could be the only one Exiv2 has been "choking on" since PS3 was new. Here's hoping it is, eh?</p>


	<p>BZT</p>


</blockquote>

	<p>I'm not so sure. I'm now running 0.22 and I'm still getting these errors on a bunch of files. Did Robin's fix go in for more than one version?</p>


	<p>BZT</p></div>
  
  </div>
  <div class="message reply" id="message-999">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/808?r=999#message-999">RE: Input data does not contain a valid image</a>
    -
    Added by <a class="user active" href="/users/339">Steve Wright</a> <a title="06 Oct 2011 18:38" href="/projects/exiv2/activity?from=2011-10-06">about 10 years</a> ago
  </h4>
  <div class="wiki"><p>My bad -- it's still 0.21.1 that I'm running in Cygwin [the 0.22 is on my Linux laptop; now the proud (?!) home of Ubuntu 11.0.4 Natty].<br />For my purposes in Cygwin, most of the time, 0.21.1 suffices. In this instance, with regard to this odd error, I'd much rather patch what I have installed with Robin's fix -- or one from Andreas -- than upgrade.</p>


	<p>Of course, I could be persuaded to do otherwise... :)</p>


	<p>SJW</p></div>
  
  </div>
  <div class="message reply" id="message-1000">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/808?r=1000#message-1000">RE: Input data does not contain a valid image</a>
    -
    Added by <a class="user active" href="/users/339">Steve Wright</a> <a title="06 Oct 2011 19:47" href="/projects/exiv2/activity?from=2011-10-06">about 10 years</a> ago
  </h4>
  <div class="wiki"><p>Steve Wright wrote:</p>


<blockquote>

	<p>My bad -- it's still 0.21.1 that I'm running in Cygwin [the 0.22 is on my Linux laptop; now the proud (?!) home of Ubuntu 11.0.4 Natty].<br />For my purposes in Cygwin, most of the time, 0.21.1 suffices. In this instance, with regard to this odd error, I'd much rather patch what I have installed with Robin's fix -- or one from Andreas -- than upgrade.</p>


	<p>Of course, I could be persuaded to do otherwise... :)</p>


	<p>SJW</p>


</blockquote>

	<p>With the files I happen to be working with tonight, upgrading wouldn't make a whole lot of difference, as 0.22 is still giving the "does not contain a valid image" error on my Linux laptop like 0.21.1 did from Cygwin.</p>


	<p>Which surprises me, as bug <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Exiv2 fails to write to JPEG with an empty APP13 Photoshop PS3 segment  (Closed)" href="/issues/760">#760</a> is in the change log of 0.22, I presume: as being fixed. Maybe my files are suffering from another problem?</p>


	<p>Robin -- how well does that patch/fix work? Looks like you might still need it every now and then. :-|</p>


	<p>SJW</p></div>
  
  </div>
  <div class="message reply" id="message-1001">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/808?r=1001#message-1001">RE: Input data does not contain a valid image</a>
    -
    Added by <a class="user active" href="/users/133">Robin Mills</a> <a title="06 Oct 2011 20:56" href="/projects/exiv2/activity?from=2011-10-06">about 10 years</a> ago
  </h4>
  <div class="wiki"><p>Steve</p>


	<p>Andreas registered a bug for this <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Exiv2 fails to write to JPEG with an empty APP13 Photoshop PS3 segment  (Closed)" href="/issues/760">#760</a> and checked in a fix SVN:2461.  I think Andreas' fix was slightly different/simpler than my patch, however they amount to about the same.</p>


	<p>Can you send me a file with the fault and I'll investigate.  Which version(s) do you want me to investigate? cygwin/0.21.1 and/or linux/0.22 ?</p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-1002">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/808?r=1002#message-1002">RE: Input data does not contain a valid image</a>
    -
    Added by <a class="user active" href="/users/339">Steve Wright</a> <a title="07 Oct 2011 11:11" href="/projects/exiv2/activity?from=2011-10-07">about 10 years</a> ago
  </h4>
  <div class="wiki"><p>Robin, Andreas:</p>


	<p>I just downloaded the revised jpgimage.cpp from that revision. I guess the next thing to do, if I recall the other patches to things I've done, is re-compile Exiv2 on both machines, using this C++ file instead of the one that came with the source tarball (or in the case of 0.22 on my laptop, the Subversion snapshot).</p>


	<p>I still have the page with the file in the Repository open in another tab of my browser as I write this. Looking at the date, I'm assuming this same substitute will compile for both 0.21.1 and 0.22. Am I correct in that assumption?</p>


	<p>SJ</p></div>
  
  </div>
  <div class="message reply" id="message-1003">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/808?r=1003#message-1003">RE: Input data does not contain a valid image</a>
    -
    Added by <a class="user active" href="/users/133">Robin Mills</a> <a title="07 Oct 2011 13:03" href="/projects/exiv2/activity?from=2011-10-07">about 10 years</a> ago
  </h4>
  <div class="wiki"><p>Steve</p>


	<p>I can't follow what you're saying.  I don't know to which patch files you are referring.  Patch files are not part of the official release and we don't support them on an ongoing basis.</p>


	<p>Thanks for the .jpg which you say exhibits the issue which I believe you are experiencing with 0.21.1 and 0.22 on Linux and Cygwin.  Please give a command-line which to reproduce the issue using the image that you have sent and I will investigate.</p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-1004">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/808?r=1004#message-1004">RE: Input data does not contain a valid image</a>
    -
    Added by <a class="user active" href="/users/339">Steve Wright</a> <a title="07 Oct 2011 14:32" href="/projects/exiv2/activity?from=2011-10-07">about 10 years</a> ago
  </h4>
  <div class="wiki"><p>Second part first:</p>


	<p>On that JPEG file I tried to write an IPTC caption, same words, with the file in the same location from both machines running their respective versions of Exiv2. The same error came up in both instances.</p>


	<p>Specifically, the command line was <strong>"exiv2 -kM"set Iptc.Application2.Caption This one seems tasteful"</strong> (followed by the name of the file).</p>


	<p>Now for the first part.</p>


	<p>Back when I was keen on getting a few iView Media Pro/MS Expression Media XMP tags into Exiv2, I seem to recall Andreas saying that if I edited one thing and 'tweaked' another, then recompiled the binary, it would recognize those tags without having to provide a custom namespace. Even if, strictly speaking, it wasn't one, I considered the editing and the steps involved to be a patch. That's most likely why the term came up from my end in this discussion. Sorry if it led to any confusion.</p>


	<p>SJW</p></div>
  
  </div>
  <div class="message reply" id="message-1005">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/808?r=1005#message-1005">RE: Input data does not contain a valid image</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="07 Oct 2011 15:30" href="/projects/exiv2/activity?from=2011-10-07">about 10 years</a> ago
  </h4>
  <div class="wiki"><p>Thanks, Steve.  I've reproduced this with exiv2 0.21.1 on Ubuntu 11.04.  I attach the image you sent.  I'll investigate over the weekend and get back to you.</p>


	<p>2029 /home/rmills $ exiv2 -kM"set Iptc.Application2.Caption This one seems tasteful" ~/Desktop/1308.jpg<br />Exiv2 exception in modify action for file /home/rmills/Desktop/1308.jpg:<br />Input data does not contain a valid image<br />2030 /home/rmills $</p></div>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/291">1308_jpg.zip</a>    <span class="size">(31.7 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/291/1308_jpg.zip">1308_jpg.zip</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

  </div>
  <div class="message reply" id="message-1007">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/808?r=1007#message-1007">RE: Input data does not contain a valid image</a>
    -
    Added by <a class="user active" href="/users/339">Steve Wright</a> <a title="08 Oct 2011 15:06" href="/projects/exiv2/activity?from=2011-10-08">about 10 years</a> ago
  </h4>
  <div class="wiki"><p>Robin has emailed me and asked that I let everyone reading this topic thread know that two Adobe applications he uses (one Mac and one not) gave errors on the sample file I sent him. Modifying, and therefore re-writing, the IPTC Core data in another Adobe app (Bridge from CS5, and here I'm <em>presuming</em> it's the Windows build), and subsequently trying the same command that gave the error on my machines (see my last post on this thread), were both successful.</p>


	<p>He and I both wonder if Adobe doesn't have a simple tool for correcting IPTC Core data in files, and if there isn't, it makes one wonder <strong>why</strong> there isn't, as it was Adobe software that produced [the cause for] this error to begin with.</p>


	<p>So these "does not contain a valid image" errors that persist do not seem to be caused by empty-byte blocks of the kind Andreas explained to the OP, Stefan Brandi. There might be yet another cause, and the newer exiv2 versions "still can't deal" and so err out.</p>


	<p>I'm sure when all the causes and effects are known about this, Andreas will be prompt with a solution.</p>


	<p>SJ Wright</p></div>
  
  </div>
  <div class="message reply" id="message-1008">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/808?r=1008#message-1008">RE: Input data does not contain a valid image</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="08 Oct 2011 15:32" href="/projects/exiv2/activity?from=2011-10-08">about 10 years</a> ago
  </h4>
  <div class="wiki"><p>Guys</p>


	<p>Steve's issue with the IPTC data is different from the original matter which was fixed in issue <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Exiv2 fails to write to JPEG with an empty APP13 Photoshop PS3 segment  (Closed)" href="/issues/760">#760</a>.  In the original issue, an empty IPTC block was tripping an exception.</p>


	<p>In Steve's image (written by PS CS1) the IPTC block is indeed wrong.  PS Elements 6.0 can't even open the file!  I modified the IPTC data in the image with Adobe Bridge CS5 and that repaired the IPTC datablock.  After that, exiv2 was happy to modify the corrected file.</p>


	<p>Other folks have been discussing this matter.  For example:<br /><a class="external" href="http://photo.net/digital-darkroom-forum/00E1r4">http://photo.net/digital-darkroom-forum/00E1r4</a></p>


	<p>I don't think this matter warrants further attention.  exiv2 cannot reasonably be expected to handle corrupt files.  PhotoShop CS is a rather elderly product (2003).</p></div>
  
  </div>
  <div class="message reply" id="message-1016">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/808?r=1016#message-1016">RE: Input data does not contain a valid image</a>
    -
    Added by <a class="user active" href="/users/339">Steve Wright</a> <a title="25 Oct 2011 22:01" href="/projects/exiv2/activity?from=2011-10-25">about 10 years</a> ago
  </h4>
  <div class="wiki"><p>All the same, through fits and starts and trial and error, I've come up with an approach that seems to work w/re making these files "valid" and write-able with Exiv2.</p>


<pre>
My four-step process for "restoring" JPEG files that other apps appear to have put "beyond help." 

1. Extract all metadata to .exv files [exiv2 -ea $foo]
2. Use "jhead -purejpg" to strip them down to rudimentary JFIF data
3. Write the metadata back to the files from the .exv's [exiv2 -kia $foo]
4. Test arbitrary files by writing new metadata to them.</pre>

	<p>Seems to work so far.</p>


	<p>Steve Wright</p></div>
  
  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-16/16)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
