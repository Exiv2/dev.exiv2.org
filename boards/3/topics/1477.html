<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Exeption &quot;Failed to read image data&quot; - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="yqZgwC5gDanz+P18MzbgE04bt0We/FpJLj3TWKhZA7Qo68svXBrBqaac4nCM4ewgcYnjPG8f+/PTHUPQ62Dk2w==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>Exeption &quot;Failed to read image data&quot;</h2>

<div class="message">
<p><span class="author">Added by Anonymous <a title="09 Mar 2013 01:50" href="/projects/exiv2/activity?from=2013-03-09">over 8 years</a> ago</span></p>
<div class="wiki">
<p>Hi!</p>


	<p>I tried to read EXIF data from attached file. But when I call method readMetadata(), I get exception: "Failed to read image data" although method get() doesn't return 0. This exception happens only on Windows application, on Linux it work fine. Also, if you tried execute command print for this file using  "Exiv2 v0.23 Windows executable" you will get the same exception.</p>


	<p>When I open this image using another program, for example, FastStone I can see EXIF data for this file.</p>


	<p>Can you, please, describe how can I read EXIF data from this file, or how to check if EXIF date is bad not using catching exception (because I have problem with catcing exeption on Windows). What method can I call to check file?<br />Or maybe this is bug in Exiv2?</p>


	<p>Thanks, for attention.</p>
</div>
<div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/459">0_71669_fa7746c8_orig.jpg</a>    <span class="size">(1.1 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/459/0_71669_fa7746c8_orig.jpg">0_71669_fa7746c8_orig.jpg</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (12)</h3>
  <div class="message reply" id="message-1478">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1477?r=1478#message-1478">RE: Exeption &quot;Failed to read image data&quot;</a>
    -
    Added by <a class="user active" href="/users/3762">Nehal J Wani</a> <a title="10 Mar 2013 21:57" href="/projects/exiv2/activity?from=2013-03-10">over 8 years</a> ago
  </h4>
  <div class="wiki"><p>Hey!<br />      You said that "This exception happens only on Windows application, on Linux it work fine." But I am using Linux and getting the same error. Perhaps the image file is corrupt. Could you please check and re-attach the file? Or are you talking of this corrupted file only?</p>


	<p>When I open the image in any browser, I get the error:<br />The image "http://dev.exiv2.org/attachments/459/0_71669_fa7746c8_orig.jpg" cannot be displayed because it contains errors.</p></div>
  
  </div>
  <div class="message reply" id="message-1479">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1477?r=1479#message-1479">RE: Exeption &quot;Failed to read image data&quot;</a>
    -
    Added by Anonymous <a title="11 Mar 2013 13:39" href="/projects/exiv2/activity?from=2013-03-11">over 8 years</a> ago
  </h4>
  <div class="wiki"><p>I rechecked this image (I mean corrupted file) on Linux. You are right it causes exception on Linux too.<br />So, I am interesting, is there any way to check this kind of file before it cause exception (because I have problem to catch exception on Windows).</p>


	<p>I also have  tried to open this image in all viewers I have, but only FastStone shown EXIF data for this image.</p></div>
  
  </div>
  <div class="message reply" id="message-1480">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1477?r=1480#message-1480">RE: Exeption &quot;Failed to read image data&quot;</a>
    -
    Added by <a class="user active" href="/users/3762">Nehal J Wani</a> <a title="12 Mar 2013 13:36" href="/projects/exiv2/activity?from=2013-03-12">over 8 years</a> ago
  </h4>
  <div class="wiki"><p>It is not the case that <strong>only</strong> FastStone shows EXIF data for this image. I ran exif on this image in Linux and got output (<a class="external" href="http://pastebin.com/LmuP7ji7">http://pastebin.com/LmuP7ji7</a>).  Other exif tools say "This photo does NOT contain EXIF metadata". There might be a parsing bug in exiv2 (I won't call it a real bug, as the file is corrupt, but still). Most probably, it is jpgimage.cpp  which throws error code 14.</p>


	<p>In most image files, the meta-data is defined in the first 100k of the file. So one can check the file size before performing any further action. In this case, the file was 1.1k in size, which seems arbitrarily truncated and hence corrupted.</p>


	<p>I'll discuss exception handling in terminal. In Linux,  one can catch exception by noting the return code of the exiv2 program. If it is non-zero (In this case 1), then one can be sure that some error has been raised.</p>


	<p>In the example below, L.jpg is perfect while 0_71669_fa7746c8_orig.jpg is corrupt.</p>


	<p>[Wani@Linux exiv2-0.23]$ exiv2  ~/Temp/L.jpg > Output; echo $?<br />0<br />[Wani@Linux exiv2-0.23]$ exiv2  ~/0_71669_fa7746c8_orig.jpg > Output; echo $?<br />Exiv2 exception in print action for file /home/Wani/0_71669_fa7746c8_orig.jpg:<br />Failed to read image data<br />1<br />[Wani@Linux exiv2-0.23]$</p>


	<p>If you are using say, a C/C++ program and calling exiv2 via system(), then the return value of the call will give the exit code.<br />To see how to record the same in Windows, read <a class="external" href="http://goo.gl/ekb8d">http://goo.gl/ekb8d</a></p></div>
  
  </div>
  <div class="message reply" id="message-1481">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1477?r=1481#message-1481">RE: Exeption &quot;Failed to read image data&quot;</a>
    -
    Added by Anonymous <a title="13 Mar 2013 12:57" href="/projects/exiv2/activity?from=2013-03-13">over 8 years</a> ago
  </h4>
  <div class="wiki"><p>I used exiv2 as a library in my Qt-based app. So, this exception cause crash in my app, when I want app still working, may be without showing EXIF data.</p>


	<p>So I need way to check file with this kind of corruption by calling some check method.<br />Now, method Exiv2::Image::AutoPtr::get() doesn't return 0 for this file. Is there any other way to check file before exception will happens?</p></div>
  
  </div>
  <div class="message reply" id="message-1482">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1477?r=1482#message-1482">RE: Exeption &quot;Failed to read image data&quot;</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="13 Mar 2013 13:29" href="/projects/exiv2/activity?from=2013-03-13">over 8 years</a> ago
  </h4>
  <div class="wiki"><p>Two suggestions:</p>


	<p>1) Can you catch it with try { .... } catch ( ... ) { ... }; in your C++ code ?<br />2) If that doesn't work, you could execute a small sample application such as exifprint with system() and test the return code as described by Nehal.  If exifprint crashed, there's no point in opening with library linked to your application.  That will isolate your Qt process and avoid the crash.</p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-1483">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1477?r=1483#message-1483">RE: Exeption &quot;Failed to read image data&quot;</a>
    -
    Added by Anonymous <a title="14 Mar 2013 00:58" href="/projects/exiv2/activity?from=2013-03-14">over 8 years</a> ago
  </h4>
  <div class="wiki"><p>1) I can't catch exception, because 'catch' doesn't called in Windows.<br />2) I develop image viewer app. So, this way, I think, is not so quick, because I can call methods for getting exif data for hundreds image in the same time. For, example, for getting preview for all RAW-image in folder.</p>


	<p>Thanks, for help. I think it it makes sense to open issue for this 'bug'.</p></div>
  
  </div>
  <div class="message reply" id="message-1484">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1477?r=1484#message-1484">RE: Exeption &quot;Failed to read image data&quot;</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Mar 2013 10:10" href="/projects/exiv2/activity?from=2013-03-14">over 8 years</a> ago
  </h4>
  <div class="wiki"><p>A couple of questions:</p>


	<p>1) Which compiler/build system are you using on Windows?<br />QtCreator/Visual Studio?  Which compiler GCC, Clang, CL, something else?</p>


	<p>2) Do you know paths to hundreds of images before you open them?<br />You don't need to open them one at a time.  I wrote a script (which I've put below) and exiv2 opened a file 200 times in 1.2 seconds on my rather elderly Windows/XP machine:<br /><pre>
592 rmills@nv10042:~/gnu/exiv2/test.build/samples $ foo.sh
26
real    0m1.219s
user    0m0.546s
sys     0m0.358s
5200 foo.txt
593 rmills@nv10042:~/gnu/exiv2/test.build/samples $</pre></p>


	<p>Here's the script:<pre>
#!/bin/sh
exiv2 ~/R.jpg | wc -l
time exiv2 \
~/R.jpg ~/R.jpg ~/R.jpg ~/R.jpg ~/R.jpg ~/R.jpg ~/R.jpg ~/R.jpg ~/R.jpg ~/R.jpg \
... repeated ...
~/R.jpg ~/R.jpg ~/R.jpg ~/R.jpg ~/R.jpg ~/R.jpg ~/R.jpg ~/R.jpg ~/R.jpg ~/R.jpg \
&gt; foo.txt
wc -l  foo.txt
</pre><br />I'll take a look at your file this evening after work.</p></div>
  
  </div>
  <div class="message reply" id="message-1485">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1477?r=1485#message-1485">RE: Exeption &quot;Failed to read image data&quot;</a>
    -
    Added by Anonymous <a title="14 Mar 2013 13:38" href="/projects/exiv2/activity?from=2013-03-14">over 8 years</a> ago
  </h4>
  <div class="wiki"><p>I had built library in Linux using:</p>


	<p>./configure --prefix=/usr/i586-mingw32msvc<br />make</p>


	<p>and use obtained dll for linking app in Windows.</p>


	<p>I am going to try build Exiv2 library in Windows this weekend. Maybe it will helps me with catching exceptions.</p></div>
  
  </div>
  <div class="message reply" id="message-1486">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1477?r=1486#message-1486">RE: Exeption &quot;Failed to read image data&quot;</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Mar 2013 13:56" href="/projects/exiv2/activity?from=2013-03-14">over 8 years</a> ago
  </h4>
  <div class="wiki"><p>And are you building your app with QtCreator on Windows?</p></div>
  
  </div>
  <div class="message reply" id="message-1487">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1477?r=1487#message-1487">RE: Exeption &quot;Failed to read image data&quot;</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="14 Mar 2013 21:49" href="/projects/exiv2/activity?from=2013-03-14">over 8 years</a> ago
  </h4>
  <div class="wiki"><p>Aleksandr</p>


	<p>I'm puzzled.  I've run exiv2(.exe) on several platforms and with your file, they are report:<pre>Exiv2 exception in print action for file Aleks.jpg:
Failed to read image data</pre><br />This message is being generated from actions.cpp where there is an exception handler. <pre>int Print::run(const std::string&#38; path)
    try {
        path_ = path;
        int rc = 0;
        switch (Params::instance().printMode_) {
        case Params::pmSummary: rc = printSummary();     break;
        case Params::pmList:    rc = printList();        break;
        case Params::pmComment: rc = printComment();     break;
        case Params::pmPreview: rc = printPreviewList(); break;
        }
        return rc;
    }
    catch(const Exiv2::AnyError&#38; e) {
        std::cerr &lt;&lt; "Exiv2 exception in print action for file " 
                  &lt;&lt; path &lt;&lt; ":\n" &lt;&lt; e &lt;&lt; "\n";
        return 1;
    } // Print::run</pre>This isn't a bug.  The library throws an exception and it's the caller's responsibility to catch it - as illustrated in the code above.</p>


	<p>You've said <em>"I can't catch exception, because 'catch' doesn't called in Windows."</em>.  For sure, the catch is working on Windows on the Cygwin and MSVC builds.</p>


	<p>I seldom use MinGW and the version of QtCreator I have installed on my Windows machine is for building with Visual Studio.  It's going to take a considerable effort to download and install Qt/QtCreator/MinGW/GCC/CMake and whatever else is needed to build everything with MinGW/Qt/QtCreator.</p>


	<p>Can you build please build exiv2(.exe) and/or samples/exifprint(.exe) on your platform and use them on your file from the command-line.  Did exiv2 really manage to exit without printing "Exiv2 exception in print action....." ?   Can you share the output from the program?</p></div>
  
  </div>
  <div class="message reply" id="message-1488">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1477?r=1488#message-1488">RE: Exeption &quot;Failed to read image data&quot;</a>
    -
    Added by Anonymous <a title="17 Mar 2013 07:29" href="/projects/exiv2/activity?from=2013-03-17">over 8 years</a> ago
  </h4>
  <div class="wiki"><p>I had built Exiv2 library on Windows using this help: <a class="external" href="http://dev.exiv2.org/boards/3/topics/1259">http://dev.exiv2.org/boards/3/topics/1259</a> (this help is really useful)<br />and now I can catch exception!!!</p>


	<p>Thank to all for the help!</p></div>
  
  </div>
  <div class="message reply" id="message-1607">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1477?r=1607#message-1607">RE: Exeption &quot;Failed to read image data&quot;</a>
    -
    Added by fdsf hfgh <a title="29 Aug 2013 00:25" href="/projects/exiv2/activity?from=2013-08-29">about 8 years</a> ago
  </h4>
  <div class="wiki"><p>library is a way to read image data, you can also install an <a class="wiki-page new" href="/projects/exiv2/wiki/Image_windows_viewer_c%23">image windows viewer c#</a>http://www.rasteredge.com/how-to/csharp-imaging/create-windows-viewer/. there are many on the web, google around, you can find one similar to faststone. it also display multiple image formats.</p></div>
  
  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-12/12)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
