<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>What if an image has no previews? [OSX] - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="di1EOsOkEak49l9lbVf/aBOkA51kG+LRwe0DlIbO7OWUYO/Vsd7dqW2SQGnSgPNbLDZX5JX4Q2s8zZMcxfcLig==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>What if an image has no previews? [OSX]</h2>

<div class="message">
<p><span class="author">Added by <a class="user active" href="/users/6936">Patrick Hennessey</a> <a title="16 Mar 2018 00:39" href="/projects/exiv2/activity?from=2018-03-16">over 3 years</a> ago</span></p>
<div class="wiki">
<p>If no preview is found after running the -pp option, is there a method to force OSX to generate a preview thumbnail of an image? I have a bunch of TIF and JPG files that result in no reply when trying to extract a preview.</p>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (5)</h3>
  <div class="message reply" id="message-3072">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3071?r=3072#message-3072">RE: What if an image has no previews? [OSX]</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="16 Mar 2018 07:55" href="/projects/exiv2/activity?from=2018-03-16">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>Patrick</p>


	<p>At the moment, exiv2 can only read previews in images.  You cannot modify, delete, or add previews to images.  There is a project being discussed to add this capability, however it's still in early stages of discussion by private email.</p>


	<p>The storage of thumbnails is complex.  It's not a single tag and there can be multiple thumbnails at different resolutions.  Additionally there can be thumbnails embedded in the MakerNote.  And for even more complexity, different formats (TIFF, JPEG, PNG etc) can store thumbnails in format specific ways which are not part of the Exif standard.</p>


	<p>You can download my favourite test file from <a class="external" href="http://clanmills.com/Stonehenge.jpg">http://clanmills.com/Stonehenge.jpg</a></p>


	<p>There are a couple of tags explained on page 24 (physically p29) of the Exif standard: <a class="external" href="http://www.cipa.jp/std/documents/e/DC-008-2012_E.pdf">http://www.cipa.jp/std/documents/e/DC-008-2012_E.pdf</a></p>


	<p><img src="/attachments/download/1216/exif-thumbnail.png" alt="" /></p>


	<p>We can manually extract the thumbnail from the image as follows:<br /><pre>$ exiv2 -pa --grep JPEG ~/Stonehenge.jpg
Exif.Thumbnail.JPEGInterchangeFormat         Long        1  4442    &lt;--- location of thumbnail
Exif.Thumbnail.JPEGInterchangeFormatLength   Long        1  10837   &lt;--- length   of thumbnail
$ exiv2 -pS ~/Stonehenge.jpg                 # examine Structure of image file
STRUCTURE OF JPEG FILE: /Users/rmills/Stonehenge.jpg
 address | marker       |  length | data
       0 | 0xffd8 SOI  
       2 | 0xffe1 APP1  |   15288 | Exif..II*...................... &lt;--- location of the exif data
   15292 | 0xffe1 APP1  |    2604 | http://ns.adobe.com/xap/1.0/.&lt;?x
   17898 | 0xffed APP13 |      96 | Photoshop 3.0.8BIM.......'.....
   17996 | 0xffe2 APP2  |    4094 | MPF.II*...............0100.....
   22092 | 0xffdb DQT   |     132 
   22226 | 0xffc0 SOF0  |      17 
   22245 | 0xffc4 DHT   |     418 
   22665 | 0xffda SOS  
$ </pre>We extract the exif data.  The segment is 2 bytes into the file and its marker is 4 bytes (2 byte marker and 2 byte length).  There are 6 leading bytes ("Exif\0\0") in the segment.<pre>$ dd bs=1 skip=$((2+4+6)) count=15288 if=~/Stonehenge.jpg &gt; Stonehenge.exif
15288+0 records in
15288+0 records out
15288 bytes transferred in 0.164319 secs (93039 bytes/sec)
$ dd bs=1 skip=4442 count=10837 if=~/Stonehenge.exif | exiv2 -      # extract thumbnail and pipe through exiv2
10837+0 records in
10837+0 records out
10837 bytes transferred in 0.039951 secs (271257 bytes/sec)
File name       : -
MIME type       : image/jpeg
Image size      : 160 x 120
-: No Exif data found in the file
$ </pre>As you can see, this isn't trivial.  The reverse process (to write the tags/binary thumbnail) is formidable.   It's unlikely that you can add/del/mod exif thumbnail until we implement thumbnail editing in Exiv2.</p>


	<p>Incidentally the exif data is an embedded tiff:<pre>$ exiv2 Stonehenge.exif                                             # exif data is a TIFF !
File name       : Stonehenge.exif
MIME type       : image/tiff                                        &lt;--- It's a TIFF!
...
Thumbnail       : image/jpeg, 10837 Bytes                           &lt;--- Thumbnail in embedded tiff!
...
$ </pre></p>


	<p>I suspect there is a simpler way to write a thumbnail directly into a segment in a JPEG (not embedded in the Exif data), however I have to do more research to understand this.</p></div>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1216">exif-thumbnail.png</a>    <span class="size">(72.5 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1216/exif-thumbnail.png">exif-thumbnail.png</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

  </div>
  <div class="message reply" id="message-3073">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3071?r=3073#message-3073">RE: What if an image has no previews? [OSX]</a>
    -
    Added by <a class="user active" href="/users/76">Gilles Caulier</a> <a title="16 Mar 2018 08:19" href="/projects/exiv2/activity?from=2018-03-16">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>Preview can be written in image with a standard : IPTC. A lots of application use it already:</p>


	<p><a class="external" href="https://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/IPTC.html#ApplicationRecord">https://www.sno.phy.queensu.ca/~phil/exiftool/TagNames/IPTC.html#ApplicationRecord</a></p>


	<p>...search ObjectPreviewFileFormat tag to see all the format supported.</p>


	<p>The preview image must be JPEG for interroperability. The IPTC tag relevant said that image must be limited to 256Ko, but With JPEG container, this break the IPTC metadata SEGMENT which is limited to ... 64Ko. There is no limitation problem with other image format, as TIFF, JPEG2000, or PNG.</p>


	<p>If you know this limitation, you can use Iptc.preview tag. We use it in digiKam for all image formats supporting Iptc. When an image edit is done, we record a medium preview image stored in Iptc to render quickly the image while a slide show for ex.</p>


	<p>Originally, i thinking to use another image format as preview, as something like wavelets based preview to optimize size and quality, but this will work only in DK, not outside.</p>


	<p><a class="external" href="https://cgit.kde.org/digikam.git/tree/libs/dmetadata/metaengine_image.cpp#n1059">https://cgit.kde.org/digikam.git/tree/libs/dmetadata/metaengine_image.cpp#n1059</a></p>


	<p>The same can be certainly done in Xmp, but i never checked this point, as Iptc do the stuff very well. After all, in DK we have a dedicated XMP namespace where a specific tag can be created to store a wavelets preview binary array...</p>


	<p>Gilles Caulier</p></div>
  
  </div>
  <div class="message reply" id="message-3074">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3071?r=3074#message-3074">RE: What if an image has no previews? [OSX]</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="16 Mar 2018 08:26" href="/projects/exiv2/activity?from=2018-03-16">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>Thank you Gilles for this insight.  I suspected there could be other ways to achieve a successful result.  Thanks for contributing to this discussion.</p></div>
  
  </div>
  <div class="message reply" id="message-3075">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3071?r=3075#message-3075">RE: What if an image has no previews? [OSX]</a>
    -
    Added by <a class="user active" href="/users/6936">Patrick Hennessey</a> <a title="16 Mar 2018 16:18" href="/projects/exiv2/activity?from=2018-03-16">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>Thanks for the insight! To Gilles, is there another terminal command that will force OSX to generate a preview for a particular image file that exiv2 cannot find a thumbnail for?</p></div>
  
  </div>
  <div class="message reply" id="message-3076">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3071?r=3076#message-3076">RE: What if an image has no previews? [OSX]</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="16 Mar 2018 17:39" href="/projects/exiv2/activity?from=2018-03-16">over 3 years</a> ago
  </h4>
  <div class="wiki"><p>Patrick:</p>


	<p>I'll leave Gilles to answer your question in his own way.   And I hope he'll give you the exiv2 command to insert a thumbnail into XMP or IPTC metadata.</p>


	<p>I'd implement this as a bash script.  I'd enumerate the previews with exiv2 and if there are none, I'd create a thumbnail with OSX sips command and use Gilles magic to insert the thumbnail into the image as XMP or IPTC.</p>


	<p>You can count the number of previews in an image with exiv2 and wc: <pre>$ exiv2 -pp ~/Stonehenge.jpg | wc -l
1
$ exiv2 -pp ~/gnu/github/exiv2/exiv2/test/data/Reagan.tiff | wc -l
0
$ </pre>The sips commands to create a thumbnail are:<pre>$ cp ~/Stonehenge.jpg /tmp
$ exiv2 -pa --grep dimension/i /tmp/Stonehenge.jpg 
Exif.Photo.PixelXDimension                   Short       1  6000
Exif.Photo.PixelYDimension                   Short       1  4000
$ sips --resampleHeightWidthMax 200 /tmp/Stonehenge.jpg 
/private/tmp/Stonehenge.jpg
&lt;CGColor 0x7fbfe5e12780&gt; [&lt;CGColorSpace 0x7fbfe5e1d2c0&gt; (kCGColorSpaceDeviceRGB)] ( 0 0 0 1 )
  /private/tmp/Stonehenge.jpg
$ exiv2 -pa --grep dimension/i /tmp/Stonehenge.jpg 
Exif.Photo.PixelXDimension                   Long        1  200
Exif.Photo.PixelYDimension                   Long        1  133
$ </pre></p></div>
  
  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-5/5)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
