<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Exiv2 appears to corrupt RAW files from a Sony NEX-6 - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="vdgJZbSHdSczaGvMMbNCA7+BMwMa/xPTFTZXYffLBHVflaKKxv25J2YMdMCOZE4wgBNneuscsmnoFsfptPLjGg==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>Exiv2 appears to corrupt RAW files from a Sony NEX-6</h2>

<div class="message">
<p><span class="author">Added by <a class="user active" href="/users/1465">Malcolm Hoar</a> <a title="31 Dec 2012 13:55" href="/projects/exiv2/activity?from=2012-12-31">almost 9 years</a> ago</span></p>
<div class="wiki">
<p>I have attached a very boring RAW image taken with a Sony NEX-6.</p>


	<p>An application of mine built using Exiv2 appears to corrupt this and similar files.</p>


	<p>In order to take my code out of the equation, I tried adding some metatags to this image using the vanilla Exiv2.exe binary.</p>


	<p>Specifically, I used:</p>


	<p>exiv2 0.23 001700 (32 bit build)</p>


	<p>this running on Windows 7 (64-bit).</p>


	<p>The Exiv2 command I used was taken from the man page:</p>


	<p>exiv2 -M"set Exif.GPSInfo.GPSLatitude 4/1 15/1 33/1" -M"set Exif.GPSInfo.GPSLatitudeRef N" DSC00608.ARW</p>


	<p>After running this command successfully I can see that the GPS info has been added. However, the RAW file can no longer be opened in Photoshop (using ACR 7.3). Nor can it be opened using Sony's Image Data Converter 4.0. Both programs suggest that the file has been corrupted.</p>


	<p>Obviously, both programs open the original file just fine.</p>


	<p>Note: ACR 7.2 or later is required for NEX-6 RAW files.</p>


	<p>This appears to be a very serious problem and any help would be much appreciated.</p>
</div>
<div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/423">DSC00608.ARW</a>    <span class="size">(16 MB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/423/DSC00608.ARW">DSC00608.ARW</a>  </td>
  <td>Sample RAW file from Sony NEX-6</td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (12)</h3>
  <div class="message reply" id="message-1348">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1347?r=1348#message-1348">RE: Exiv2 appears to corrupt RAW files from a Sony NEX-6</a>
    -
    Added by <a class="user active" href="/users/1465">Malcolm Hoar</a> <a title="31 Dec 2012 14:54" href="/projects/exiv2/activity?from=2012-12-31">almost 9 years</a> ago
  </h4>
  <div class="wiki"><p>Additional info that I hope is helpful:</p>


	<p>The damage appears to arise within the metadata; the embedded preview is okay and so is the RAW data itself.</p>


	<p>dcraw will convert the RAW image data successfully. However, once the RAW file has been modified by Exiv2, dcraw is unable to read the camera white balance (although it still converts the RAW data).</p>


	<p>C:\ZIP>dcraw -w DSC00608.ARW<br />DSC00608.ARW: Cannot use camera white balance.</p></div>
  
  </div>
  <div class="message reply" id="message-1349">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1347?r=1349#message-1349">RE: Exiv2 appears to corrupt RAW files from a Sony NEX-6</a>
    -
    Added by <a class="user active" href="/users/1465">Malcolm Hoar</a> <a title="31 Dec 2012 15:29" href="/projects/exiv2/activity?from=2012-12-31">almost 9 years</a> ago
  </h4>
  <div class="wiki"><p>Once the RAW file has been modified by Exiv2, I note that Exiftool reports:</p>


	<p>Warning : [minor] Bad format (53730) for SR2Private entry 0</p>


	<p>I think (hope) that's a pretty good clue as to where things are going wrong.</p>


	<p>Also, for anyone wishing to look at this problem but lacking access to Photoshop...</p>


	<p>The problem can also been seen with the Adobe DNG Converter 7.3. Free and legit download here:</p>


	<p><a class="external" href="http://www.adobe.com/support/downloads/detail.jsp?ftpID=5519">http://www.adobe.com/support/downloads/detail.jsp?ftpID=5519</a></p></div>
  
  </div>
  <div class="message reply" id="message-1352">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1347?r=1352#message-1352">RE: Exiv2 appears to corrupt RAW files from a Sony NEX-6</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="02 Jan 2013 10:15" href="/projects/exiv2/activity?from=2013-01-02">almost 9 years</a> ago
  </h4>
  <div class="wiki"><p>Thanks for sending this, Malcolm.  I've been on vacation.  I'll try to look at this after work this evening and get back to you.</p>


	<p>Happy New Year</p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-1368">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1347?r=1368#message-1368">RE: Exiv2 appears to corrupt RAW files from a Sony NEX-6</a>
    -
    Added by <a class="user active" href="/users/1465">Malcolm Hoar</a> <a title="15 Jan 2013 12:28" href="/projects/exiv2/activity?from=2013-01-15">almost 9 years</a> ago
  </h4>
  <div class="wiki"><p>Any update on this issue? I think it's quite a serious bug.</p></div>
  
  </div>
  <div class="message reply" id="message-1369">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1347?r=1369#message-1369">RE: Exiv2 appears to corrupt RAW files from a Sony NEX-6</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="15 Jan 2013 13:23" href="/projects/exiv2/activity?from=2013-01-15">almost 9 years</a> ago
  </h4>
  <div class="wiki"><p>Apologies, Malcolm.  I've been busy with various things, including working for a living.</p>


	<p>I started to look at that and the realized this is a raw file.  And although Sony's RAW files are similar to TIFF, I'm not sure they are identical.  So I've wondered if that's the matter.  However I promise to look this evening.  My wife's at the theater, so I'll do it after I finish a couple of other promises I've made earlier today!</p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-1370">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1347?r=1370#message-1370">RE: Exiv2 appears to corrupt RAW files from a Sony NEX-6</a>
    -
    Added by <a class="user active" href="/users/1465">Malcolm Hoar</a> <a title="15 Jan 2013 13:33" href="/projects/exiv2/activity?from=2013-01-15">almost 9 years</a> ago
  </h4>
  <div class="wiki"><p>Thanks Robin. I do understand the time pressures having a wife and 3 kids to feed myself.</p>


	<p>I truly appreciate the considerable efforts made by all of the volunteers who contribute to this terrific project.</p>


	<p>I am sincerely grateful for whatever you can do, whenever you can do it!</p></div>
  
  </div>
  <div class="message reply" id="message-1371">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1347?r=1371#message-1371">RE: Exiv2 appears to corrupt RAW files from a Sony NEX-6</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="15 Jan 2013 13:35" href="/projects/exiv2/activity?from=2013-01-15">almost 9 years</a> ago
  </h4>
  <div class="wiki"><p>Malcolm</p>


	<p>Ah, you're smoothing my feathers (and my ego).  I'll look tonight.  Scout's Honour!</p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-1372">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1347?r=1372#message-1372">RE: Exiv2 appears to corrupt RAW files from a Sony NEX-6</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="15 Jan 2013 21:50" href="/projects/exiv2/activity?from=2013-01-15">almost 9 years</a> ago
  </h4>
  <div class="wiki"><p>Malcolm</p>


	<p>I've reproduced the DNG convertor issue as you described, however exiftool didn't grumble.</p>


	<p>I've got to say that I just groan at the thought of this.  As you'll be aware, although exiftool finds fault with the modified file, exiv2 does not.  So while I agree that exiv2's handling of the file is harmful, he has not left the file in a state that enables me to rerun the damaged file in the debugger and say "Ah..........".</p>


<pre>
508 rmills@rmills-laptop:~/Downloads/Malcolm $ exiftool DSC00608.ARW.corrupted 
ExifTool Version Number         : 8.91
File Name                       : DSC00608.ARW.corrupted
...
Focal Length                    : 153.0 mm (35 mm equivalent: 229.0 mm)
Hyperfocal Distance             : 208.23 m
Light Value                     : 11.9
509 rmills@rmills-laptop:~/Downloads/Malcolm $ exiftool DSC00608.ARW.corrupted  | wc
    138     696    6093
510 rmills@rmills-laptop:~/Downloads/Malcolm $ exiftool DSC00608.ARW.corrupted  | grep GPS
GPS Latitude Ref                : North
GPS Latitude                    : 4 deg 15' 33.00" N
511 rmills@rmills-laptop:~/Downloads/Malcolm $ 
</pre>

	<p>I actually used exiv2 on Windows7/64.  It's a 64 bit build from the trunk in August.<br /><pre>
C:\Users\rmills\Downloads\Malcolm&gt;exiv2 -v -V
exiv2 0.23 001700 (64 bit build)
Copyright (C) 2004-2012 Andreas Huggel.

This program is free software; you can redistribute it and/or
...
MSVC=8,DEBUG=0,DLL=0,Bits=8:date="Aug 22 2012",time=11:49:52
C:\Users\rmills\Downloads\Malcolm&gt;
</pre></p>


	<p>Drilling down into this issue is going to be hard work.  I can't help wondering if Phil would be willing to get involved, as you have reported a message from his code which will probably shed light on this.</p>


	<p>I always like to help - however in this case I think I have to say "Sorry - ARW files are not supported".</p>


	<p>Robin<br />It's been a long day.  Maybe I'll feel more enthusiastic to tackle this at the weekend.  However it's my birthday on Friday and I've plans for the weekend, and a Burns Supper in Houston on the following weekend.</p></div>
  
  </div>
  <div class="message reply" id="message-1376">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1347?r=1376#message-1376">RE: Exiv2 appears to corrupt RAW files from a Sony NEX-6</a>
    -
    Added by <a class="user active" href="/users/1465">Malcolm Hoar</a> <a title="16 Jan 2013 09:28" href="/projects/exiv2/activity?from=2013-01-16">almost 9 years</a> ago
  </h4>
  <div class="wiki"><p>Thanks Robin. Yes, think adding full write support for these RAW files is going to be a major project.</p>


	<p>If you look at Sony.pm is the Exiftool source and search for SR2Private, you'll get some hints. Sadly, I think it will take more time that I currently have to wrap my brain around all of this (plus all the Exiftool and Exiv2 internals).</p>


	<p>I'll have to ponder the options for my application.</p></div>
  
  </div>
  <div class="message reply" id="message-1378">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1347?r=1378#message-1378">RE: Exiv2 appears to corrupt RAW files from a Sony NEX-6</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="16 Jan 2013 13:26" href="/projects/exiv2/activity?from=2013-01-16">almost 9 years</a> ago
  </h4>
  <div class="wiki"><p>Malcolm</p>


	<p>I don't know anything about your project.  Perhaps you can motivate me to dig into this.  If you want to talk, I'm willing to discuss this on Skype (probably at the weekend).</p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-1379">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1347?r=1379#message-1379">RE: Exiv2 appears to corrupt RAW files from a Sony NEX-6</a>
    -
    Added by <a class="user active" href="/users/1465">Malcolm Hoar</a> <a title="16 Jan 2013 17:10" href="/projects/exiv2/activity?from=2013-01-16">almost 9 years</a> ago
  </h4>
  <div class="wiki"><p>It's a Digital Asset Management system for cataloging my photos.</p>


	<p>It scans a file structure looking for files that have been added, removed, or updated. Extracts some EXIF and IPTC data, adds that to a database and generates thumbs. The database is a flat file, cached in memory for speed.</p>


	<p>The rest of the system is built into a web server and hence the interface for searching and updating the IPTC tags is all browser based. Also, the images sent to the browser can be decompressed, scaled, and even color managed by the server. The browser simply renders a bitmap.</p>


	<p>It only provides for updating a few fields: Caption, Copyright, Urgency (used as a ranking), City, State, Country plus GPS coords.</p>


	<p>Obviously, it uses Exiv2 to handle all of the metadata reads and writes but having replaced my old Nikon with a new Sony NEX-6 I have a fairly major problem.</p>


	<p>I'm looking at removing the Exiv2 updates (which corrupt the Sony files). If I log the updates to a transaction file, I can run a Perl/Exiftool script to update the images. Looks like that won't be too hard if I gloss over some of the multi-user concurrent update problems (acceptable in the short-medium term).</p></div>
  
  </div>
  <div class="message reply" id="message-1381">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/1347?r=1381#message-1381">RE: Exiv2 appears to corrupt RAW files from a Sony NEX-6</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="16 Jan 2013 21:11" href="/projects/exiv2/activity?from=2013-01-16">almost 9 years</a> ago
  </h4>
  <div class="wiki"><p>Malcolm</p>


	<p>Thanks for the update.  It's good to hear how folks use exiv2.  I regret that the fun of the new camera is being spoiled by this software issue.  Life's full of ups and downs.  You'll discover a different workflow and everything will work out fine.  You'll see!</p>


	<p>Robin</p></div>
  
  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-12/12)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
