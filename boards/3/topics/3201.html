<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Want to get back to using exiv2 executable, but... - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="WheOZZ3w1cgCJ6NhDOiZd9oSnEVS6gMifgXbeXfOzJ64WiWK74oZyFdDvG2zP5VE5YDIPKMJopiDJUvxNPcr8Q==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>Want to get back to using exiv2 executable, but...</h2>

<div class="message">
<p><span class="author">Added by <a class="user active" href="/users/339">Steve Wright</a> <a title="31 Oct 2018 11:35" href="/projects/exiv2/activity?from=2018-10-31">about 3 years</a> ago</span></p>
<div class="wiki">
<p>...it's been years since I've written a (bash) script to add a "flexible" number of keywords to a JPEG file.</p>


	<p>By "flexible" I mean: unknown before the script is run.</p>


	<p>The script I've been using, which was originally written for Exiftool, is attached with some recently commented-out code (function twokey)returned to execution.</p>


	<p>I've consulted linuxquestions.org, but they can only give me pointers on the bash part of the code. I need a "second pair of eyes" to check what might be wrong with the Exiv2 parts.</p>


	<p>BZT<br />Great to be back.</p>
</div>
<div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1252">addkeys.sh.txt</a>    <span class="size">(1.13 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1252/addkeys.sh.txt">addkeys.sh.txt</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (12)</h3>
  <div class="message reply" id="message-3202">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3201?r=3202#message-3202">RE: Want to get back to using exiv2 executable, but...</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="31 Oct 2018 16:45" href="/projects/exiv2/activity?from=2018-10-31">about 3 years</a> ago
  </h4>
  <div class="wiki"><p>How nice to hear from you.  Gosh, it's been a while.  2012 maybe?  Since we last spoke, I've retired and returned from Silicon Valley to my home in England.</p>


	<p>We released Exiv2 v0.27 RC1 last Friday:</p>


	<p><a class="external" href="http://dev.exiv2.org/boards/3/topics/2830">http://dev.exiv2.org/boards/3/topics/2830</a><br /><a class="external" href="http://exiv2.dyndns.org">http://exiv2.dyndns.org</a></p>


	<p>I highly recommend the O'Reilly Book "Learning the bash shell".  Bash is very useful.  It takes a while to learn.  Well worth the effort.</p>


	<p>Can you explain what this does?  <em><strong>It goes crazy on my laptop and shows lots of binary data</strong></em>. You're adding key/value pairs to something in IPTC.   Can you give me a couple of files before/after running this and I'll see what you're doing.</p>


	<p>I've tidied your code to make it easier to read and reordered the functions (declare them, then use them).</p>


<pre>#!/bin/bash

function twokey () {
    taxt=$(echo "$k" | cut -d, -f2)
    keycount=$(echo "$k" | tr ',' ' ' | wc -w)
    for keys in $(echo "$k" | tr ',' ' ' | wc -w)
    do
        echo "${keys}" 
        exiv2 --keep -M"add Iptc.Application2.Keywords $taxt" -M"add Xmp.dc.subject $taxt" "$f" 
        ((taxt++))
    done
    exiv2 -g Iptc.Application2.Keywords -Pv "$f" 
}

function dothedeed () {
    echo -e "Adding Keywords to \e[5;42m$f\e[0m." 
    echo -e "$f\t$k" 
    keycount=$(echo "$k" | tr ',' ' ' | wc -w)
    echo "$f: There are $keycount keywords." 
    echo "Here's the Keyword string." 
    echo -e "$k" 
    exiftool -sep "," -fast5 -overwrite_original_in_place -q -P -Keywords+="$k" -Subject+="$k" "$f" 
    twokey
}

function dav () {
    echo -e "What text file will I be using?" 
    read -er item
    f=$item
    while IFS="^" read -r f k
    do
        echo -e "File is \e[31m$f\e[0m" 
        if [[ ! -f "$f" ]]; then
            echo "I don't see $f in this directory." 
            echo "Moving to next list item." 
            continue
        fi
        dothedeed
    done&lt;"$f" 
}

dav

# That's all Folks!
##</pre></div>
  
  </div>
  <div class="message reply" id="message-3203">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3201?r=3203#message-3203">RE: Want to get back to using exiv2 executable, but...</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="31 Oct 2018 16:49" href="/projects/exiv2/activity?from=2018-10-31">about 3 years</a> ago
  </h4>
  <div class="wiki"><p>By the way, I love this line of code: <pre>echo "I don't see $f in this directory."</pre></p></div>
  
  </div>
  <div class="message reply" id="message-3213">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3201?r=3213#message-3213">RE: Want to get back to using exiv2 executable, but...</a>
    -
    Added by <a class="user active" href="/users/339">Steve Wright</a> <a title="04 Nov 2018 19:17" href="/projects/exiv2/activity?from=2018-11-04">about 3 years</a> ago
  </h4>
  <div class="wiki"><p>Yes, that is a precious one, isn't it.</p>


	<p>Good to hear you're back in England. Funny thing .. I just sent Andreas an email asking where you were. I should have logged in here and checked this thread instead.</p>


	<p>Always going for the long, hard route to a solution, me. Linux (currently running Kubuntu 17.04) is treating me well, and vice versa. Do you know if there are .debs available on dyndyns.org? As before I'm not keen on installing from scratch unless I absolutely must. Ubuntu's repositories bring us Exiv2 users up to 0.25, which is OK with me; I can wait until I upgrade to Ku-18 (available but I must backup -- about 75 GB -- before I install it). I'm sure it's in the repos for the newer versions.</p>


	<p>Steve W</p></div>
  
  </div>
  <div class="message reply" id="message-3214">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3201?r=3214#message-3214">RE: Want to get back to using exiv2 executable, but...</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="04 Nov 2018 19:35" href="/projects/exiv2/activity?from=2018-11-04">about 3 years</a> ago
  </h4>
  <div class="wiki"><p>We could produce debs, I think.  Thanks to Luis, we have now 100% adopted CMake as our build infrastructure on all platforms.  CMake has a companion CPack for creating packages and we're using that to create the source and binary <em><strong>bundles</strong></em> for the web site.  It's reasonable to believe that CPack could produce what you want.  However, as you know, everything takes time and Luis and I have been working long days recently.  Extending the scope of the project is impossible if we're going to make Exiv2 v0.27 GM for Christmas <em><strong>(and we will</strong></em>).</p>


	<p>I believe ubuntu-18.04 LTS (which I run on my machines) has Exiv2 v0.25.  I had a discussion with a <strong>darktable</strong> user during the week and concluded that we're still stuck in the dark ages!</p></div>
  
  </div>
  <div class="message reply" id="message-3215">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3201?r=3215#message-3215">RE: Want to get back to using exiv2 executable, but...</a>
    -
    Added by <a class="user active" href="/users/339">Steve Wright</a> <a title="04 Nov 2018 20:35" href="/projects/exiv2/activity?from=2018-11-04">about 3 years</a> ago
  </h4>
  <div class="wiki"><p>I tested your revision of my script. The IPTC keyword adding is a bit off; any hyphenated keys get repeated as the last keyword, and the XMP Subject <em>is</em>__ the hyphenated keyword.</p>


	<p>Here's a zip with a test picture -- as yet un-keyword-ed --, the script and the keywords I was going to add to it. I'll try get  Exiv2 0.27 (probably from an on-web resource), install it and try again.</p></div>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1254">testpic keys.zip</a>    <span class="size">(287 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1254/testpic%20keys.zip">testpic keys.zip</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

  </div>
  <div class="message reply" id="message-3216">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3201?r=3216#message-3216">RE: Want to get back to using exiv2 executable, but...</a>
    -
    Added by <a class="user active" href="/users/339">Steve Wright</a> <a title="04 Nov 2018 20:59" href="/projects/exiv2/activity?from=2018-11-04">about 3 years</a> ago
  </h4>
  <div class="wiki"><p>Well, I tried installing 0.25 from github. git clone worked OK, but apparently my CMake (which I just now installed) didn't have a default compiler set.<br />A copy of my output log is attached. Should I get the CMake GUI?</p>


	<p>Steve</p></div>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/1255">CMakeOutput.log</a>    <span class="size">(39.2 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/1255/CMakeOutput.log">CMakeOutput.log</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

  </div>
  <div class="message reply" id="message-3225">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3201?r=3225#message-3225">RE: Want to get back to using exiv2 executable, but...</a>
    -
    Added by <a class="user active" href="/users/339">Steve Wright</a> <a title="11 Nov 2018 10:38" href="/projects/exiv2/activity?from=2018-11-11">about 3 years</a> ago
  </h4>
  <div class="wiki"><p>Robin,</p>


	<p>Even with 0.27 installed, the revised script only writes 1 random keyword, this time to both IPTC Keywords and XMP Subject. I'm at a loss as to how to improve it.</p>


	<p>Steve</p></div>
  
  </div>
  <div class="message reply" id="message-3226">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3201?r=3226#message-3226">RE: Want to get back to using exiv2 executable, but...</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="11 Nov 2018 11:09" href="/projects/exiv2/activity?from=2018-11-11">about 3 years</a> ago
  </h4>
  <div class="wiki"><p>I don't know what this script is meant to do.  Can you post:</p>


	<p>1) An image before and after it runs with exif tool.<br />I want to know what you're trying to do to the image</p>


	<p>2) A transcript of the user experience.<br />I never use read in scripts.  I don't know what that code is attempting to do and it produces a load of binary output on MacOS-X.</p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-3233">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3201?r=3233#message-3233">RE: Want to get back to using exiv2 executable, but...</a>
    -
    Added by <a class="user active" href="/users/339">Steve Wright</a> <a title="15 Nov 2018 16:35" href="/projects/exiv2/activity?from=2018-11-15">about 3 years</a> ago
  </h4>
  <div class="wiki"><p>As the current announcement thread on 0.27 RC1 is locked, I'll make this announcement here, for the benefit of new users of the product.</p>


	<p>Robin emailed me earlier today (15-11) to say RC2 is going to be released to the usual places (github and dyndyns.org) tomorrow. He didn't say what the specific changes or fixes were, but I'm sure there are as many of those as there were with RC1.</p>


	<p>Steve Wright</p></div>
  
  </div>
  <div class="message reply" id="message-3234">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3201?r=3234#message-3234">RE: Want to get back to using exiv2 executable, but...</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="15 Nov 2018 17:18" href="/projects/exiv2/activity?from=2018-11-15">about 3 years</a> ago
  </h4>
  <div class="wiki"><p>Thanks Steve.  We've had very good feedback on RC1 and dealt with everything reported.   The fixes are listed in releasenotes.txt</p>


	<p>I am really pleased with Exiv2 v0.27.  It's the best tested and documented release of Exiv2.  This is thanks to Luis and Dan who have done outstanding work.  With more folks working on Exiv2, I've had time to improve the release process and the web site.</p>


	<p>The release should be available on <a class="external" href="http://exiv2.dyndns.org">http://exiv2.dyndns.org</a> by 21:00GMT on 2018-11-16</p></div>
  
  </div>
  <div class="message reply" id="message-3235">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3201?r=3235#message-3235">RE: Want to get back to using exiv2 executable, but...</a>
    -
    Added by <a class="user active" href="/users/339">Steve Wright</a> <a title="16 Nov 2018 13:30" href="/projects/exiv2/activity?from=2018-11-16">about 3 years</a> ago
  </h4>
  <div class="wiki"><p>Finally working</p>


	<p>Thanks again to Robin.</p>


	<p>For anyone curious as to the changes, here's the whole script (unworkable parts edited out):<br /><pre>#!/bin/bash

function twokey () {
    keycount=$(echo "$k" | tr ',' ' ' | wc -w)
    echo "$f: There are $keycount keywords." 
    IFS=,
    for ky in $k
    do
      exiv2 --keep -M"add Iptc.Application2.Keywords $ky" -M"add Xmp.dc.subject $ky" "$f" 
      echo "Adding keyword $ky" 
    done
    returned=$(exiv2 -g Iptc.Application2.Keywords -Pv "$f" | tr '\n' ',' | sed "s/,$//")
 }

function dav () {
    echo -e "What text file will I be using?" 
    read -er item
    f=$item
    while IFS="^" read -r f k
    do
        echo -e "File is \e[31m$f\e[0m" 
        if [[ ! -f "$f" ]]; then
            echo "I don't see $f in this directory." 
            echo "Moving to next list item." 
            continue
        fi
        twokey
    done&lt;"$f" 
}

dav</pre></p></div>
  
  </div>
  <div class="message reply" id="message-3237">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/3201?r=3237#message-3237">RE: Want to get back to using exiv2 executable, but...</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="16 Nov 2018 22:02" href="/projects/exiv2/activity?from=2018-11-16">about 3 years</a> ago
  </h4>
  <div class="wiki"><p>I'm still totally baffled about what this is meant to do and it produces lots of binary output on the terminal.</p>


	<p>I've written something that <em><strong>sort of</strong></em> does what I think you want.  I never use bash <strong>read</strong>, I use the "Software Tools" approach of using  command-line arguments.</p>


<pre>$ curl -O http://clanmills.com/Stonehenge.jpg
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 6599k  100 6599k    0     0   686k      0  0:00:09  0:00:09 --:--:-- 1191k
$ exiv2 -pa --grep Keywords  Stonehenge.jpg 
$ ./steve.sh name Robin  age 67 skill C++ --files Stonehenge.jpg
$ exiv2 -pa --grep Keywords  Stonehenge.jpg 
Iptc.Application2.Keywords                   String     10  name,Robin
Iptc.Application2.Keywords                   String      6  age,67
Iptc.Application2.Keywords                   String      9  skill,C++
$ ./steve.sh occupation retired --files Stonehenge.jpg
$ exiv2 -pa --grep Keywords  Stonehenge.jpg 
Iptc.Application2.Keywords                   String     10  name,Robin
Iptc.Application2.Keywords                   String      6  age,67
Iptc.Application2.Keywords                   String      9  skill,C++
Iptc.Application2.Keywords                   String     18  occupation,retired
$ </pre>

	<p>Here's the code in steve.sh<pre>#!/usr/bin/env bash
this=$0

syntaxError()
{
    echo "usage: $this [key value]+ --files file ..." 
    exit $1
}

if [ "$#" == "0" ]; then syntaxError ; fi

declare -a key
declare -a value
declare -a files
N=0
F=0

while [ $# -ne 0 ] ; do
    case "$1" in
      -h|--help|-\?)
         syntaxError 0
      ;;

      --files)
        shift
        while [ $# -ne 0 ]; do
            if [ ! -e $1 ]; then
                echo $1 does not exist
                exit 2
            fi
            files[$F]=$1
            F=$((F+1))
            shift
        done
      ;;

      *)if [ $# -gt 1 ]; then
            key[$N]=$1;
            value[$N]=$2;
            shift 2
        else
            echo "key/value pairs aren't matched" 
            syntaxError 2
        fi
        N=$((N+1))
      ;;
    esac
done

if [ $F -eq 0 ]; then
    echo no files given
    syntaxError 1
fi

n=0
while [ $n -ne $N ]; do
    k=${key[$n]}
    v=${value[$n]}
    f=0
    while [ $f -ne $F ]; do
        file=${files[$f]}
        exiv2 -M"add Iptc.Application2.Keywords $k,$v" "$file" 
        f=$((f+1))
    done
    n=$((n+1))
done

# That's all Folks!
##</pre></p></div>
  
  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-12/12)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
