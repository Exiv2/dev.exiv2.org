<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Best way to save image+metadata into new file - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="bPNDmWaezawqMlPnOXEp2DP+R1a72icJWoK4uzz8u/COvuh2FOQBrH9WTOuGpiXrDGwTL0o5hrOnoigzf8Vcnw==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>Best way to save image+metadata into new file</h2>

<div class="message">
<p><span class="author">Added by <a class="user active" href="/users/4762">Goran Nagy</a> <a title="02 Dec 2016 20:41" href="/projects/exiv2/activity?from=2016-12-02">almost 5 years</a> ago</span></p>
<div class="wiki">
<p>Hi,</p>


	<p>I have an image Image1.jpg. I would like to read metadata, change some of it and then save everything (image + metadata) into new file Image2.jpg (may be in different folder). What would be the best (fastest) way of doing this? writeMetadata saves metadata into same file, which is not what I want. Is it possible to somehow tell exiv2 to use different path for saving?</p>


	<p>I am using c++ library, not command line tool.</p>


	<p>Thanks<br />Goran</p>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (5)</h3>
  <div class="message reply" id="message-2794">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2793?r=2794#message-2794">RE: Best way to save image+metadata into new file</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="02 Dec 2016 21:11" href="/projects/exiv2/activity?from=2016-12-02">almost 5 years</a> ago
  </h4>
  <div class="wiki"><p>Yes, you can do that.  Take a look at the code in <em><strong><code>&lt;exiv2dir&gt;/samples/metacopy.cpp</code></strong></em> to see how to do that.</p></div>
  
  </div>
  <div class="message reply" id="message-2801">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2793?r=2801#message-2801">RE: Best way to save image+metadata into new file</a>
    -
    Added by <a class="user active" href="/users/4762">Goran Nagy</a> <a title="10 Jan 2017 16:38" href="/projects/exiv2/activity?from=2017-01-10">almost 5 years</a> ago
  </h4>
  <div class="wiki"><p>Sorry for not getting back to you sooner, but only now I had time to check what you suggested.</p>


	<p>However, this does not seem like a solution for what I need. I may be wrong though.</p>


	<p>Let me explain a bit what my need is. I am evaluating exiv2 for an Android app. When user decides to write metadata (for certain image), the app should write that into temporary file. That temporary file should be all that is written. At this point I don't want to write into original file anything.<br />This is done in exiv2's native code (obviously). After execution is back to Java, it will then overwrite original file with this temporary file. So, basically there are two writings: once into temporary file (by exiv2) and once overwriting original file (java code).</p>


The way I understand exiv2's code, when writeMetadata() is called it will use it's own temporary file (not always though), and write stuff (image data + metadata) into it, and then it will overwrite original file. Which is similar to what I would like with 2 differences:
	<ul>
	<li>I want to perform second part in Java code</li>
		<li>I want to tell exiv2 what temporary file (path) to use</li>
	</ul>


	<p>I still haven't find a good way to do that.</p>


	<p>In the sample you suggested to check, it reads data from one file and writes it into second file. However, second file needs to exist, and it will only transfer metadata into second file, not image data. At least that's how I understand it.</p>


	<p>I suppose I could maybe create myJpegImage which inherits from JpegImage and override JpegBase::writeMetadata():</p>


<pre>
    void JpegBase::writeMetadata()
    {
        if (io_-&gt;open() != 0) {
            throw Error(9, io_-&gt;path(), strError());
        }
        IoCloser closer(*io_);
        BasicIo::AutoPtr tempIo(io_-&gt;temporary()); // may throw
        assert (tempIo.get() != 0);

        doWriteMetadata(*tempIo); // may throw
        io_-&gt;close();
        io_-&gt;transfer(*tempIo); // may throw
    } // JpegBase::writeMetadata
</pre>

	<p>Original code (above) uses temporary file, and then transfers data from temporary file to original. By using my own temporary file path and at the end not calling <br /><pre>
      io_-&gt;transfer(*tempIo); // may throw
</pre><br />it would do what I need: write everything into temporary file, and then stop leaving original file intact.</p>


	<p>But the way I understand it, I would need to do this for every format, which seems a lot of work.</p>


	<p>So, is there a better way and I am missing something?</p></div>
  
  </div>
  <div class="message reply" id="message-2802">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2793?r=2802#message-2802">RE: Best way to save image+metadata into new file</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="10 Jan 2017 20:05" href="/projects/exiv2/activity?from=2017-01-10">almost 5 years</a> ago
  </h4>
  <div class="wiki"><p>I need to give this some thought and I'm on vacation in New Zealand at the moment.</p>


	<p>It sounds as though you may have to rewrite writeMetadata() for every image type (about 15 of them).   That might be quite easy.  If you need the same code in each format, it might be straightforward to do something like this:<pre>void JpegBase::writeMetadata()
{
#ifndef USE_GORANS_WRITEMETADATA
... the usual stuff
#else
    goransWriteMetadata();
#endif
}</pre>And put your code into Image::goransWriteMetadata().</p>


	<p>You can rewrite BasicIo::temporary() to change the path to the temporary file.</p>


	<p>One of objectives for 2017 is to support build/test for mobile (iOS and Android).  I've never worked with either of those systems and don't know what's involved.  It sounds as though you are well on your way to building Exiv2 for Android.  If there's a strong need to jump between Native (C++) and Java code on Android, I'd be interested in adding the USE_GORANS_WRITEMETADATA code to the code in the repos.  Of course, it wouldn't be labelled with your name, we'll detect the platform and build appropriately.</p>


	<p>Perhaps we could discuss this together on Skype (or FaceTime or Google+) in February when I'm back home in England.</p></div>
  
  </div>
  <div class="message reply" id="message-2803">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2793?r=2803#message-2803">RE: Best way to save image+metadata into new file</a>
    -
    Added by <a class="user active" href="/users/4762">Goran Nagy</a> <a title="12 Jan 2017 14:03" href="/projects/exiv2/activity?from=2017-01-12">almost 5 years</a> ago
  </h4>
  <div class="wiki"><p>OK, I'll try changing the code myself.</p>


	<p>Sure, you can contact me when you come back. I am far from being expert in JNI and native code, but maybe I can be of some help.</p></div>
  
  </div>
  <div class="message reply" id="message-2804">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2793?r=2804#message-2804">RE: Best way to save image+metadata into new file</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="12 Jan 2017 19:58" href="/projects/exiv2/activity?from=2017-01-12">almost 5 years</a> ago
  </h4>
  <div class="wiki"><p>Together we'll figure this out.  I don't know anything about developing for Android, however I know Java quite well have worked with JNI.  You'll have to dig around to fix this and I will work with you when I get home.  I'll be back at work on January 23.   Hopefully we'll find a way to deal with this that becomes part of the code base going forward.</p></div>
  
  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-5/5)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
