<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>How to clean memory ? - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="i2/wT4TXDSB5a43/1AijmbvXjM1A80Qp1kBGPyMgpDFpIlug9q3BICwPkvNr36+qhEXYtLEQ5ZMrYNa3YBlDXg==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>How to clean memory ?</h2>

<div class="message">
<p><span class="author">Added by <a class="user active" href="/users/4340">Mikayel Egibyan</a> <a title="30 Apr 2015 13:04" href="/projects/exiv2/activity?from=2015-04-30">over 6 years</a> ago</span></p>
<div class="wiki">
<p>Hi,</p>


	<p>What is the correct way to "clean everything up after using" ?<br />Once I read whatever I wanted, I do not want to keep anything in memory.</p>


	<p>Thanks!<br />Mikayel</p>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (5)</h3>
  <div class="message reply" id="message-2046">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2045?r=2046#message-2046">RE: How to clean memory ?</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="30 Apr 2015 13:27" href="/projects/exiv2/activity?from=2015-04-30">over 6 years</a> ago
  </h4>
  <div class="wiki"><p>I'm not sure I understand the question.  You must be asking this question for a reason.  What are you thinking about?</p>


	<p>There isn't much left in memory when you've closed the files and any open iterators.  Everything is cleaned up by the object destructors when they go out of scope.  If you modify our old friend samples/exifprint.cpp from:<pre>int main(int argc, char* const argv[])
try {

    if (argc != 2) {
        std::cout &lt;&lt; "Usage: " &lt;&lt; argv[0] &lt;&lt; " file\n";
        return 1;
    }

    Exiv2::Image::AutoPtr image = Exiv2::ImageFactory::open(argv[1]);
    ...

    return 0;
}
//catch (std::exception&#38; e) {
//catch (Exiv2::AnyError&#38; e) {
catch (Exiv2::Error&#38; e) {
    std::cout &lt;&lt; "Caught Exiv2 exception '" &lt;&lt; e.what() &lt;&lt; "'\n";
    return -1;
}</pre>To be like this:<pre>int main(int argc, char* const argv[])
try {

    if (argc != 2) {
        std::cout &lt;&lt; "Usage: " &lt;&lt; argv[0] &lt;&lt; " file\n";
        return 1;
    }
    dumpSomethingAboutAvailableMemory();
    if ( 1 ) {

        Exiv2::Image::AutoPtr image = Exiv2::ImageFactory::open(argv[1]);
        ...
    }
    dumpSomethingAboutAvailableMemory();

    return 0;
}
//catch (std::exception&#38; e) {
//catch (Exiv2::AnyError&#38; e) {
catch (Exiv2::Error&#38; e) {
    std::cout &lt;&lt; "Caught Exiv2 exception '" &lt;&lt; e.what() &lt;&lt; "'\n";
    return -1;
}</pre>I think you've find that Exiv2 has retained very little memory.</p>


	<p>Please don't ask me to write dumpSomethingAboutAvailableMemory() because that would be platform specific and I'd have to think about what should be written.  The very simple dumpS..() might be: <pre>std::cout &lt;&lt; "Enter a number: " ; int n ; std::cin &gt;&gt; n ; std::cout &lt;&lt; n &lt;&lt; std::endl;</pre>While the terminal is sitting waiting for input, use your platform activity monitoring tools to inspect the process.</p></div>
  
  </div>
  <div class="message reply" id="message-2047">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2045?r=2047#message-2047">RE: How to clean memory ?</a>
    -
    Added by <a class="user active" href="/users/4340">Mikayel Egibyan</a> <a title="30 Apr 2015 13:31" href="/projects/exiv2/activity?from=2015-04-30">over 6 years</a> ago
  </h4>
  <div class="wiki"><p>How can you manually close the file?</p>


	<p>Thanks!</p></div>
  
  </div>
  <div class="message reply" id="message-2048">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2045?r=2048#message-2048">RE: How to clean memory ?</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="30 Apr 2015 13:35" href="/projects/exiv2/activity?from=2015-04-30">over 6 years</a> ago
  </h4>
  <div class="wiki"><p>Yes.  image->close() does that.  <a class="external" href="http://exiv2.org/doc/classExiv2_1_1BasicIo.html">http://exiv2.org/doc/classExiv2_1_1BasicIo.html</a></p>


<pre>1049 rmills@rmillsmbp:~/gnu/exiv2/trunk $ find . -name "*.hpp" -exec grep -H close {} \;
./include/exiv2/basicio.hpp:              safe to call close on a closed instance.
./include/exiv2/basicio.hpp:        virtual int close() = 0;
./include/exiv2/basicio.hpp:      @brief Utility class that closes a BasicIo instance upon destruction.
./include/exiv2/basicio.hpp:          ensure BasicIo instances get closed. Useful when functions return
./include/exiv2/basicio.hpp:        //! Destructor, closes the BasicIo reference
./include/exiv2/basicio.hpp:        virtual ~IoCloser() { close(); }
./include/exiv2/basicio.hpp:        void close() { if (bio_.isopen()) bio_.close(); }
./include/exiv2/basicio.hpp:        //! Destructor. Flushes and closes an open file.
./include/exiv2/basicio.hpp:          @brief Flush and unwritten data and close the file . It is
./include/exiv2/basicio.hpp:              safe to call close on an already closed instance.
./include/exiv2/basicio.hpp:        virtual int close();
./include/exiv2/basicio.hpp:          @brief close the file source and set a new path.
./include/exiv2/basicio.hpp:        virtual int close();
./include/exiv2/basicio.hpp:        virtual int close();
./include/exiv2/ssh.hpp:          @note Be sure to close() the file handle after use.
./src/doxygen.hpp:  allows it to be used in closed-source projects.
./xmpsdk/include/client-glue/WXMPFiles.hpp:#define zXMPFiles_CloseFile_1(closeFlags) \
./xmpsdk/include/client-glue/WXMPFiles.hpp:    WXMPFiles_CloseFile_1 ( this-&gt;xmpFilesRef, closeFlags, &#38;wResult )
./xmpsdk/include/client-glue/WXMPFiles.hpp:                                    XMP_OptionBits closeFlags,
1050 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre></div>
  
  </div>
  <div class="message reply" id="message-2049">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2045?r=2049#message-2049">RE: How to clean memory ?</a>
    -
    Added by <a class="user active" href="/users/4340">Mikayel Egibyan</a> <a title="30 Apr 2015 14:45" href="/projects/exiv2/activity?from=2015-04-30">over 6 years</a> ago
  </h4>
  <div class="wiki"><p>I don't think I have close() option for Exiv2::Image::AutoPtr</p></div>
  
  </div>
  <div class="message reply" id="message-2050">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2045?r=2050#message-2050">RE: How to clean memory ?</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="30 Apr 2015 14:52" href="/projects/exiv2/activity?from=2015-04-30">over 6 years</a> ago
  </h4>
  <div class="wiki"><p>Trying closing the io object within the AutoPtr().  <a class="external" href="http://exiv2.org/doc/classExiv2_1_1Image.html">http://exiv2.org/doc/classExiv2_1_1Image.html</a><br /><pre>    image-&gt;io().close(); </pre></p></div>
  
  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-5/5)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
