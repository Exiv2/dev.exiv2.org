<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Help a newbie... - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="LYeR4A4bls5WA0Vh2Hw8vz+AHiYAX9W61TfoHfsx4xjPyjoPfGFazgNnWm1nqzCMABJKX/G8dAAoF3iVuAgEdw==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>Help a newbie...</h2>

<div class="message">
<p><span class="author">Added by <a class="user active" href="/users/1465">Malcolm Hoar</a> <a title="26 Oct 2010 16:29" href="/projects/exiv2/activity?from=2010-10-26">about 11 years</a> ago</span></p>
<div class="wiki">
<p>So, I have been able to read some EXIF data with:</p>


	<p>Exiv2::Image::AutoPtr image = Exiv2::ImageFactory::open("C:\\Foo\\Bar.jpg");<br />image->readMetadata();<br />Exiv2::ExifData &#38;exifData = image->exifData();<br />Exiv2::Exifdatum&#38; tag = exifData["SomeTagHere"];<br />foo = tag.toString();</p>


	<p>But I cannot figure out to how to retrieve what is described in the<br />command line version of Exiv2 as the "interpreted or translated" values.<br />Something like this for the lens data:</p>


	<p>"AF-S VR Zoom-Nikkor 70-200mm f/2.8G IF-ED"</p>


	<p>Is this even possible without printing?</p>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (15)</h3>
  <div class="message reply" id="message-683">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/682?r=683#message-683">RE: Help a newbie...</a>
    -
    Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="26 Oct 2010 18:19" href="/projects/exiv2/activity?from=2010-10-26">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>Hi Malcolm,</p>


	<p>Something like</p>


<pre>
std::string val = tag.print(&#38;exifData);
</pre>

	<p>should do the trick. See <a href="http://uk.groups.yahoo.com/group/exiv2/message/1408" class="external">this post</a> for details.</p>


	<p>Andreas</p></div>
  
  </div>
  <div class="message reply" id="message-684">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/682?r=684#message-684">RE: Help a newbie...</a>
    -
    Added by <a class="user active" href="/users/1465">Malcolm Hoar</a> <a title="26 Oct 2010 20:33" href="/projects/exiv2/activity?from=2010-10-26">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>Duh! Perfect, thank you!</p>


	<p>This is all quite a change from Perl and Exiftool. My C++ is rusty to say<br />the least, and to makes matters worse, I'm much more familiar with CString<br />than std::string (which I think is more of a handicap than a help here).</p>


	<p>tag.print() should allow me to finish prototyping this part of my app. Then <br />I'll start looking at some other libraries I need and then make a decision on<br />what String/Array/Map classes to use.</p>


	<p>I'll need to study some performance characteristics and I have noticed <br />some weirdness -- recursing over a directory structure of files, it<br />periodically slows down while memory usage increases dramatically.<br />Then memory falls back and processing accelerates again. Maybe it's<br />a debugger thing but I might be back if I can get the issue more<br />fully characterized.</p>


	<p>I will be looking for some tools to handle and render JPEGs (including those <br />embedded within RAW files which I believe I can extract with exiv2). I also<br />want to resize, make thumbs, scale (with interpolation) and add color <br />management (LCMS?). Longer term, maybe a database (SQLite?).</p>


	<p>Any general pointers on tools that play nice (or otherwise) with exiv2<br />very much appreciated. It seems like you guys have already walked a<br />similar path ;-)</p></div>
  
  </div>
  <div class="message reply" id="message-685">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/682?r=685#message-685">RE: Help a newbie...</a>
    -
    Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="26 Oct 2010 21:44" href="/projects/exiv2/activity?from=2010-10-26">about 11 years</a> ago
  </h4>
  <div class="wiki"><blockquote>

	<p>some weirdness -- recursing over a directory structure of files, it<br />periodically slows down while memory usage increases dramatically.</p>


</blockquote>

	<p>The only known performance issue I am aware of is <a class="issue tracker-1 status-5 priority-4 priority-default closed" title="Bug: Nikon Makernote tags regresssion in exiv 0.19 (Closed)" href="/issues/677">#677</a>. It's related to Nikon Makernotes and only exists in 0.19. So make sure you use version 0.20. In any case, if you do think this has anything to do with Exiv2 please let us know.</p>


	<p>-ahu.</p></div>
  
  </div>
  <div class="message reply" id="message-686">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/682?r=686#message-686">RE: Help a newbie...</a>
    -
    Added by <a class="user active" href="/users/1465">Malcolm Hoar</a> <a title="26 Oct 2010 23:10" href="/projects/exiv2/activity?from=2010-10-26">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>Thanks for that. I am already running 0.20.</p>


	<p>Definitely seeing some large (100MB) memory surges when recursing over many<br />thousands of files, extracting EXIF/IPTC (no XMP and no write operations).<br />These are mainly NEF and JPEG but there are some other oddball files and I am <br />catching/ignoring a few exiv2 exceptions on those. Currently about 50<br />exceptions on 20,000 files.</p>


	<p>I will at least take those bad files out of the equation tomorrow and see what <br />happens. If memory usage is still weird I'll see what else I can find.</p></div>
  
  </div>
  <div class="message reply" id="message-690">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/682?r=690#message-690">RE: Help a newbie...</a>
    -
    Added by <a class="user active" href="/users/1465">Malcolm Hoar</a> <a title="27 Oct 2010 12:06" href="/projects/exiv2/activity?from=2010-10-27">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>Well, the wild memory usage is definitely coming from some non-image file type.<br />Limiting my processing to NEF and JPEG files solved that problem. I will get<br />back to this and see exactly which files are causing the issue; looks like<br />it's something that should be handled more elegantly.  In the meantime...</p>


	<p>I have cut my code right back to this:</p>


	<p>Exiv2::Image::AutoPtr image = Exiv2::ImageFactory::open("C:\\ZIP\\DSC_0002.jpg");<br />image->readMetadata();<br />image = Exiv2::ImageFactory::open("C:\\ZIP\\DSC_0005.jpg");<br />image->readMetadata();</p>


	<p>If I paste this into the sample exifprint program, all is well.</p>


	<p>However, if I paste this code into a MFC application and execute it,<br />it seems to leak memory. I used a default MFC template as created<br />by VS2008. I have tried linking to the static and DLL versions of<br />exiv2.lib and it seems to happen with both. I think I have followed<br />all of the rules per README-MSVC.txt.</p>


	<p>Any suggestions on how to find the cause of this?</p>


	<p>I did notice that the dumped blocks contain a lot of URL references<br />(<a class="external" href="http://...">http://...</a>) and perhaps they will provide some clue! I have<br />attached a listing.</p></div>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/215">dump.txt</a>    <span class="size">(31.4 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/215/dump.txt">dump.txt</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

  </div>
  <div class="message reply" id="message-691">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/682?r=691#message-691">gpx files give exiv2 a small fit...</a>
    -
    Added by <a class="user active" href="/users/1465">Malcolm Hoar</a> <a title="27 Oct 2010 12:41" href="/projects/exiv2/activity?from=2010-10-27">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>Just to close the loop on the wild memory usage...</p>


	<p>This is caused by some GPS track logs in the .gpx file format, <br />which is XML based.</p>


	<p>Opening a largish (5MB) .gpx file causes a trivial app to grab<br />some 250MB of memory. The problem was made much worse because<br />I had failed to check for exifData.empty(). My bad :-(</p>


	<p>I'm not sure if a formal report would be appropriate or not.<br />I'd be happy to submit one together with a sample file if<br />requested.</p></div>
  
  </div>
  <div class="message reply" id="message-692">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/682?r=692#message-692">RE: Help a newbie...</a>
    -
    Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="27 Oct 2010 17:57" href="/projects/exiv2/activity?from=2010-10-27">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>yes please attach a file. I suspect it somehow gets passed to xmp-sdk. For the memory leak, make sure you call <a href="http://exiv2.org/doc/classExiv2_1_1XmpParser.html" class="external">XmpParser::terminate</a> in case the XMP parser was used.</p></div>
  
  </div>
  <div class="message reply" id="message-695">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/682?r=695#message-695">RE: Help a newbie...</a>
    -
    Added by <a class="user active" href="/users/1465">Malcolm Hoar</a> <a title="27 Oct 2010 18:14" href="/projects/exiv2/activity?from=2010-10-27">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>Excellent, thank you so much for that kind sir.</p>


	<p>Calling XmpParser::terminate() does indeed fix the leak!</p>


	<p>I have attached a sample GPX file (Zipped because it's quite compressible).</p>


	<p>If you try to extract EXIF/IPTC from this file, exiv2 should grind for a<br />while and chew up gobs of memory in the process.</p></div>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/216">gpx.zip</a>    <span class="size">(625 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/216/gpx.zip">gpx.zip</a>  </td>
  <td></td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

  </div>
  <div class="message reply" id="message-698">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/682?r=698#message-698">RE: Help a newbie...</a>
    -
    Added by <a class="user active" href="/users/133">Robin Mills</a> <a title="28 Oct 2010 00:43" href="/projects/exiv2/activity?from=2010-10-28">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>Malcolm</p>


	<p>It sounds as though this XmpParser::terminate business is plugging the leak.</p>


	<p>I'm rather surprised by what you're doing here.  Are you reading the GPX file using XMP (hosted by exiv2)?  I didn't know you could do that.</p>


	<p>I wrote some python scripts a couple of years ago for geotagging.  I read the GPX file with python's xml.dom.minidom module.  I use exiv2 (via pyexiv2) to get the photo date and then write the exif GPS tags to the photos.  Details and code at: <a class="external" href="http://clanmills.com/articles/gpsexiftags/">http://clanmills.com/articles/gpsexiftags/</a></p>


	<p>Robin</p></div>
  
  </div>
  <div class="message reply" id="message-699">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/682?r=699#message-699">RE: Help a newbie...</a>
    -
    Added by <a class="user active" href="/users/1465">Malcolm Hoar</a> <a title="28 Oct 2010 11:47" href="/projects/exiv2/activity?from=2010-10-28">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>Robin,</p>


	<p>It was an accident really. I was recursing over a large image collection and found<br />some GPX files mixed in with that. exiv2 kinda choked on those; I'm guessing<br />it saw XML and tried to interpret them like XMP. I've solved that problem<br />simply by filtering on the file extension. I probably should have done that<br />from the start by this was just a prototyping exercise.</p>


	<p>I have been tagging my images using Perl, Exiftool and derivative of:</p>


	<p><a class="external" href="http://www.carto.net/projects/photoTools/gpsPhoto/">http://www.carto.net/projects/photoTools/gpsPhoto/</a></p>


	<p>However, my plan is to move everything (including the tagging) to C++ and exiv2.</p>


	<p>I'm quite sure that exiv2 will do everything I need. Now I just have to<br />figure out how to handle/render the actual images. Then I can tackle the<br />user interface and other grunt work ;-)</p></div>
  
  </div>
  <div class="message reply" id="message-700">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/682?r=700#message-700">RE: Help a newbie...</a>
    -
    Added by <a class="user active" href="/users/133">Robin Mills</a> <a title="28 Oct 2010 13:51" href="/projects/exiv2/activity?from=2010-10-28">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>Ah.  So you're saying library ate the .GPX and almost leaked memory in the process.  How interesting.  That explains why pyexiv2 used to ignore the GPX and now he's a little confused and thinks it's an image (so I added an extension filter to my script to ignore GPX).</p>


	<p>Thanks for the pointer to the carto.net web site.  I think Mr Carto was ploughing the same field in 2008 in Perl/exiftool that I ploughed in python in April 2008.</p>


	<p>Although I don't know exactly what you're doing, I'm confident in the exiv2 library to deliver performance and functionality.  I wrote my stuff 2 years ago and it's working well on Mac/Linux/Windows.  I occasionally rebuild to keep up with Python (I'm now 2.6) and exiv2 (now at 0.21) and pyexiv2 (now at 0.2).  A variant of my code ships in Phatch (an open-source photo batch processor).</p>


	<p>So good luck with your C++ approach.  Let me know if you need help.</p></div>
  
  </div>
  <div class="message reply" id="message-702">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/682?r=702#message-702">RE: Help a newbie...</a>
    -
    Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="29 Oct 2010 07:30" href="/projects/exiv2/activity?from=2010-10-29">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>The gpx file - and for that matter any XML file - is mistaken as an XMP sidecar file <a href="http://dev.exiv2.org/projects/exiv2/repository/entry/trunk/src/xmpsidecar.cpp#L183" class="external">because it starts with <code><?xml</code></a>.<br />I don't see a quick fix for this, will need to read up on how XMP sidecar files are supposed to look like to see if there is a more specific test. Suggestions welcome!</p></div>
  
  </div>
  <div class="message reply" id="message-703">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/682?r=703#message-703">RE: Help a newbie...</a>
    -
    Added by <a class="user active" href="/users/133">Robin Mills</a> <a title="29 Oct 2010 07:58" href="/projects/exiv2/activity?from=2010-10-29">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>Here's the start a gpx file on my machine (which is xml of course):</p>


	<p><?xml version="1.0" encoding="utf-8"?><br />&lt;gpx version="</p>


	<p>So if file extension is extension.to_lower()=='gpx' and you read the first 3 or four lines and encounter "&lt;gpx" (anywhere on the line), then I think it's safe to assume it's not a sidecar.  To be honest, I'm not sure what's in a sidecar, however I think this simple test should be OK.</p></div>
  
  </div>
  <div class="message reply" id="message-704">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/682?r=704#message-704">RE: Help a newbie...</a>
    -
    Added by <a class="user active" href="/users/1465">Malcolm Hoar</a> <a title="29 Oct 2010 08:34" href="/projects/exiv2/activity?from=2010-10-29">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>Looking at the file extension is probably easiest test ;-)</p>


	<p>Having said that, my Photoshop generated XMP files do <strong>not</strong> start with &lt;?xml.</p>


	<p>I think the &lt;x:xmpmeta (supplied by Photoshop) is <strong>required</strong>. But it <strong>may</strong> (or may not) follow the optional &lt;?xml.</p>


	<p>So you may need to examine the first <strong>two</strong> tags.</p></div>
  
  </div>
  <div class="message reply" id="message-705">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/682?r=705#message-705">RE: Help a newbie...</a>
    -
    Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="29 Oct 2010 23:15" href="/projects/exiv2/activity?from=2010-10-29">about 11 years</a> ago
  </h4>
  <div class="wiki"><p>Both <?xml and &lt;xmpmeta&gt; are optional. If I understand correctly, after the optional XML header, there is either an &lt;xmpmeta&gt; or an <?xpacket .. ?> element.</p>


	<p>So if the data starts with a regular XML header, exiv2 now checks the second element and only if that is either an &lt;xmpmeta&gt; or <?xpacket .. ?> element it's considered XMP data. (Exiv2 also operates on images in memory, thus it may not have a file extension.)</p>


	<p>Andreas</p></div>
  
  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-15/15)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
