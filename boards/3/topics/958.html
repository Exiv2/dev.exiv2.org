<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>xmp-data created in a jpeg using exiv2 cannot be read from this file using exiv2  - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="+NvPx6iL/jnDSMTTohP8kd00Kc5likqLjahAiJqZ4g4almQo2vEyOZYs298dxPCi4qZ9t5Rp6zFwiNAA2aAFYQ==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>xmp-data created in a jpeg using exiv2 cannot be read from this file using exiv2 </h2>

<div class="message">
<p><span class="author">Added by <a class="user active" href="/users/2738">Silke Werner</a> <a title="17 Aug 2011 04:15" href="/projects/exiv2/activity?from=2011-08-17">over 10 years</a> ago</span></p>
<div class="wiki">
<p>Hi,</p>


	<p>I am new to using Exiv2 in my software. I try to add some "service-information" <br />to a screenshot the user can make from my softwares GUI. Therefore i tried <br />adding some XMP data with an own namespace  </p>
	<pre><code>Exiv2::XmpData xmpData;<br />  Exiv2::XmpProperties::registerNs("MyCompany/", "RS");</code></pre>
	<pre><code>xmpData["Xmp.RS.SerialNumber"] = "123456789";<br />  xmpData["Xmp.RS.SoftwareVersion"] = "9.9.9.9";</code></pre>
	<pre><code>Exiv2::Image::AutoPtr image = Exiv2::ImageFactory::open(rsFile.ToStdString());<br />  assert(image.get() != 0);<br />  image-&gt;setXmpData(xmpData);<br />  image-&gt;writeMetadata();</code></pre>


	<p>---> creates an XMP-Block in the ImageFile, that i can view correctly with ExifToolGui<br />but something seems to be wrong, as reading the XMP-Data from this file using the<br />following lines of code fails!</p>
	<pre><code>Exiv2::Image::AutoPtr image = Exiv2::ImageFactory::open(argv[1]);<br />  assert(image.get() != 0);<br />  image-&gt;readMetadata();  ---&gt; XMP_Error while decoding</code></pre>


	<p>If i look at the jpeg file i created in a Hex-Viewer, I can see lot ans lots of spaces ( Hex 20 )<br />between the xmpmeta end tag and the xpacket end tag.</p>


	<p>I think those spaces might be the problem, but where do they come from!<br />I would be greatful for any hint on where I am doing something wrong...</p>


	<p>Thanks<br />Silke</p>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (7)</h3>
  <div class="message reply" id="message-959">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/958?r=959#message-959">RE: xmp-data created in a jpeg using exiv2 cannot be read from this file using exiv2 </a>
    -
    Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="17 Aug 2011 06:10" href="/projects/exiv2/activity?from=2011-08-17">over 10 years</a> ago
  </h4>
  <div class="wiki"><p>Silke,</p>


	<p>Can you turn your code snippets into a small reproducer program for this problem and post it here if the problem persists?</p>


	<p>Andreas</p></div>
  
  </div>
  <div class="message reply" id="message-960">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/958?r=960#message-960">RE: xmp-data created in a jpeg using exiv2 cannot be read from this file using exiv2 </a>
    -
    Added by <a class="user active" href="/users/2738">Silke Werner</a> <a title="18 Aug 2011 02:40" href="/projects/exiv2/activity?from=2011-08-18">over 10 years</a> ago
  </h4>
  <div class="wiki"><p>Andreas,</p>


	<p>Thanks for offering to have a look at my problem.</p>


	<p>I am using exiv2 with VS2008 / WinXP.<br />To keep it simple I "exchanged" the source-code of your "xmpsample.cpp" <br />with the following lines of code.</p>


	<p>int main(int argc, char* const argv[])<br />try 
{<br />  if (argc != 2) 
  {<br />    std::cout << "Usage: " << argv<sup><a href="#fn0">0</a></sup> << " file\n";<br />    return 1;<br />  }
{<br />    std::cout << "Caught Exiv2 exception '" << e << "'\n";<br />    return -1;<br />}</p>
	<pre><code>std::string testFile = argv[1];</code></pre>
	<pre><code>//Open File and write some XMP<br />  Exiv2::Image::AutoPtr image = Exiv2::ImageFactory::open(testFile);<br />  assert(image.get() != 0);</code></pre>
	<pre><code>Exiv2::XmpData xmpDataW;<br />  Exiv2::XmpProperties::registerNs("R&#38;S/", "RS");<br />  xmpDataW["Xmp.RS.SerialNumber"] = "12345678";<br />  xmpDataW["Xmp.RS.SoftwareVersion"] = "9.9.9.9";</code></pre>
	<pre><code>image-&gt;setXmpData(xmpDataW);<br />  image-&gt;writeMetadata();<br />  image.release();</code></pre>
	<pre><code>Exiv2::Image::AutoPtr imageOpenSameFileAgain = Exiv2::ImageFactory::open(testFile);<br />  assert(imageOpenSameFileAgain.get() != 0);<br />  imageOpenSameFileAgain-&gt;readMetadata();</code></pre>
	<pre><code>Exiv2::XmpData &#38;xmpDataR = imageOpenSameFileAgain-&gt;xmpData();<br />  if (xmpDataR.empty()) 
  {<br />    std::string error(argv[1]);<br />    error += ": No XMP data found in the file";<br />    throw Exiv2::Error(1, error);<br />  }<br />  else
  {<br />    Exiv2::XmpData::const_iterator pos = xmpDataR.findKey(Exiv2::XmpKey("Xmp.RS.SoftwareVersion"));<br />    if (pos == xmpDataR.end()) 
    {<br />      std::string error(argv[1]);<br />      error += ": SoftwareVersion not found in XMP data of the file";<br />      throw Exiv2::Error(1, error);<br />    }</code></pre>
	<pre><code>Exiv2::Value::AutoPtr v = pos-&gt;getValue();<br />    assert(v-&gt;ok());<br />    std::string sXMPValue = v-&gt;toString();<br />    std::cout &lt;&lt; sXMPValue &lt;&lt; "\n";<br />  }</code></pre>
	<pre><code>return 0;<br />}<br />catch (Exiv2::AnyError&#38; e)</code></pre>


	<p>and still get the same error I encountered in my own project<br />"writeMetadata" seems to work fine, but opening the same file<br />again and trying "readMetadata" results in an XMP_Error!</p>


	<p>see attached files</p>


	<p>Silke</p></div>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/275">testXMP.jpg</a>    <span class="size">(92.3 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/275/testXMP.jpg">testXMP.jpg</a>  </td>
  <td>the XMP data I wrote using this code</td>
  <td>
  </td>
  <td>
  </td>
</tr>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/276">SpacesInHexViewOfImage.JPG</a>    <span class="size">(209 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/276/SpacesInHexViewOfImage.JPG">SpacesInHexViewOfImage.JPG</a>  </td>
  <td>hex view of the xmp data in this jpeg</td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

  </div>
  <div class="message reply" id="message-961">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/958?r=961#message-961">RE: xmp-data created in a jpeg using exiv2 cannot be read from this file using exiv2 </a>
    -
    Added by <a class="user active" href="/users/2738">Silke Werner</a> <a title="18 Aug 2011 02:43" href="/projects/exiv2/activity?from=2011-08-18">over 10 years</a> ago
  </h4>
  <div class="wiki"><p>sorry, the formatting somehow scrambled my little programm code, that i posted just a minute ago.<br />I try adding the source code file instead</p>


	<p>Silke</p></div>
  <div class="attachments">
<div class="contextual">
  
</div>
<table>
<tr>
  <td>
    <a class="icon icon-attachment" href="/attachments/277">xmpsample.cpp</a>    <span class="size">(1.87 KB)</span>
    <a class="icon-only icon-download" title="Download" href="/attachments/download/277/xmpsample.cpp">xmpsample.cpp</a>  </td>
  <td>&quot;my version&quot; of xmpsample.cpp</td>
  <td>
  </td>
  <td>
  </td>
</tr>
</table>
</div>

  </div>
  <div class="message reply" id="message-962">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/958?r=962#message-962">RE: xmp-data created in a jpeg using exiv2 cannot be read from this file using exiv2 </a>
    -
    Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="18 Aug 2011 03:39" href="/projects/exiv2/activity?from=2011-08-18">over 10 years</a> ago
  </h4>
  <div class="wiki"><p>That's a nice reproducer. I actually expected the issue would go away when I asked for it because I couldn't reproduce it with your initial information and the exiv2 tool. But now with the sample program, I also get an XMP parsing error. <br />The relevant difference to your initial post is the namespace URI: with MyCompany/ it works fine! The XMP toolkit doesn't like the ampersand (&#38;) in your URI, "R&#38;S/". Interestingly, replacing "&#38;" with "&amp;" also works but generates an Exiv2 warning. (That warning looks like a bug.)</p>


	<p>Andreas</p></div>
  
  </div>
  <div class="message reply" id="message-963">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/958?r=963#message-963">RE: xmp-data created in a jpeg using exiv2 cannot be read from this file using exiv2 </a>
    -
    Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="18 Aug 2011 03:44" href="/projects/exiv2/activity?from=2011-08-18">over 10 years</a> ago
  </h4>
  <div class="wiki"><blockquote>

	<p>Interestingly, replacing "&#38;" with "&amp;" also works</p>


</blockquote>

	<p>and this confuses Redmine too. I wrote</p>


<pre>replacing "&#38;" with "&amp;amp;"</pre>

	<p>Andreas</p></div>
  
  </div>
  <div class="message reply" id="message-964">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/958?r=964#message-964">RE: xmp-data created in a jpeg using exiv2 cannot be read from this file using exiv2 </a>
    -
    Added by <a class="user active" href="/users/2738">Silke Werner</a> <a title="18 Aug 2011 04:34" href="/projects/exiv2/activity?from=2011-08-18">over 10 years</a> ago
  </h4>
  <div class="wiki"><p>Hi Andreas,</p>


	<p>Thanks for the fast reply!<br />My little program works fine, once I got rid of the "&#38;" in my URI :-)</p>


	<p>As it is with software development, I immediately stumbled across my next problem:-)<br />In the "real world" my serialnumber contains non ASCII-characters ( Utf-8 coding ), <br />which is why i wanted to use XMP as I read that unicode strings are possible with XMP.</p>


	<p>Unfortunately I quickly found out that writing unicode values to XMP its not as easy as</p>


	<p>Exiv2::XmpData xmpDataW;<br />xmpDataW["Xmp.RS.SerialNumber"] = "12345678-ä";</p>


	<p>Searching the forums for a while I didn't find any thread about this topic.<br />Maybe you have some little code snippets that show how to set a unicode string as value for a XMP property?</p>


	<p>Cheers<br />Silke</p></div>
  
  </div>
  <div class="message reply" id="message-965">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/958?r=965#message-965">RE: xmp-data created in a jpeg using exiv2 cannot be read from this file using exiv2 </a>
    -
    Added by <a class="user active" href="/users/53">Andreas Huggel</a> <a title="18 Aug 2011 04:57" href="/projects/exiv2/activity?from=2011-08-18">over 10 years</a> ago
  </h4>
  <div class="wiki"><blockquote>

	<p>Unfortunately I quickly found out that writing unicode values to XMP its not as easy as</p>


	<p>Exiv2::XmpData xmpDataW;<br />xmpDataW["Xmp.RS.SerialNumber"] = "12345678-ä";</p>


</blockquote>

	<p>It shouldn't be much more difficult. Create an std::string s with your UTF encoded text and assign it to the property</p>


<pre>
std::string s = makeUtfEncodedText();
xmpDataW["Xmp.RS.SerialNumber"] = s;</pre><br /></pre>

	<p>Andreas</p></div>
  
  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-7/7)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
