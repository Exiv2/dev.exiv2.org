<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>xmp metadata modified when using »exiv2 insert -lcompr -S.tif none/*.tif« - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="oDXVo5w9Pk4/Uu3dsES6VcWE0GMqsXuPoOpDNYZIzgNCeH5M7kfyTmo28tEPk7Zm+haEGttS2jVdytO9xXEpbA==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
</head>
<body class="project-exiv2 has-main-menu controller-messages action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            <input type="hidden" name="messages" value="1" />
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        <input type="hidden" name="messages" value="1" />
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=boards" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=boards">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards selected" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <p class="breadcrumb"><a href="/projects/exiv2/boards">Forums</a> » <a href="/projects/exiv2/boards/3">Forum</a> » </p>

<div class="contextual">
    
    
    
    
</div>

<h2>xmp metadata modified when using »exiv2 insert -lcompr -S.tif none/*.tif«</h2>

<div class="message">
<p><span class="author">Added by <a class="user active" href="/users/4759">Jochen Barth</a> <a title="19 Sep 2016 12:11" href="/projects/exiv2/activity?from=2016-09-19">about 5 years</a> ago</span></p>
<div class="wiki">
<p>Dear forum,</p>


	<p>I'll try to de-compress tiff files with multiple TIFF-Directories, e. g. tiffinfo 00007.tif:<br />TIFF Directory at offset 0x8 (8)<br />  Subfile Type: (0 = 0x0)<br />  Image Width: 3442 Image Length: 6017<br />  Resolution: 697.719, 697.719 pixels/inch<br />  Bits/Sample: 8<br />  Compression Scheme: LZW<br />...<br />TIFF Directory at offset 0x1897ec4 (25788100)<br />  ExposureTime: 0.076923<br />  FNumber: 9.000000<br />  ExposureProgram: 1<br />  ISOSpeedRatings: 125<br />  Tag 34864: 2<br />  Tag 34866: 125<br />...</p>


	<p>When de-compressing using tiffcp -c none compr/00007.tif none/00007.tif <br />the secondary TIFF Directory is being lost.</p>


	<p>So I've tried exiv2 to copy the metadata from compr/00007.tif to none/00007.tif,<br />but then the XMP XML/RDF metadata is somewhat disordered (tags to attributes, partially):</p>


	<p>6c6<br /><   Compression Scheme: LZW<br />---</p>


<blockquote>

	<p>Compression Scheme: None</p>


</blockquote>

	<p>18,235c18,221<br />< &lt;x:xmpmeta xmlns:x="adobe:ns:meta/" x:xmptk="Adobe XMP Core 5.3-c011 66.145661, 2012/02/06-14:56:27        "&gt;<br /><    &lt;rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&gt;<br /><       &lt;rdf:Description rdf:about="" <br /><             xmlns:xmp="http://ns.adobe.com/xap/1.0/"><br /><          &lt;xmp:Rating&gt;0&lt;/xmp:Rating&gt;<br />< &lt;xmp:ModifyDate&gt;2016-06-03T07:34:05+02:00&lt;/xmp:ModifyDate&gt;<br />< &lt;xmp:CreateDate&gt;2016-06-02T12:06:58&lt;/xmp:CreateDate&gt;<br />< &lt;xmp:MetadataDate&gt;2016-06-03T07:34:05+02:00&lt;/xmp:MetadataDate&gt;<br /><          &lt;xmp:CreatorTool&gt;Adobe Photoshop CS6 (Windows)&lt;/xmp:CreatorTool&gt;<br /><       &lt;/rdf:Description&gt;<br /><       &lt;rdf:Description rdf:about="" <br /><             xmlns:aux="http://ns.adobe.com/exif/1.0/aux/"><br />< &lt;aux:SerialNumber&gt;073022001352&lt;/aux:SerialNumber&gt;<br /><          &lt;aux:LensInfo&gt;100/1 100/1 0/0 0/0&lt;/aux:LensInfo&gt;<br /><          &lt;aux:Lens&gt;EF100mm f/2.8 Macro USM&lt;/aux:Lens&gt;</p>


	<p>...</p>
	<pre><code>&gt; &amp;lt;x:xmpmeta xmlns:x="adobe:ns:meta/" x:xmptk="XMP Core  4.4.0-Exiv2"&amp;gt;<br /> &gt;  &amp;lt;rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"&amp;gt;<br /> &gt;   &amp;lt;rdf:Description rdf:about="" <br /> &gt;     xmlns:xmp="http://ns.adobe.com/xap/1.0/" <br /> &gt;     xmlns:aux="http://ns.adobe.com/exif/1.0/aux/" <br /> &gt;     xmlns:photoshop="http://ns.adobe.com/photoshop/1.0/" <br /> &gt;     xmlns:xmpMM="http://ns.adobe.com/xap/1.0/mm/" <br /> &gt; xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" <br /> &gt; xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" <br /> &gt;     xmlns:dc="http://purl.org/dc/elements/1.1/" <br /> &gt;     xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" <br /> &gt;    xmp:Rating="0" <br /> &gt;    xmp:ModifyDate="2016-06-03T07:34:05+02:00" <br /> &gt;    xmp:CreateDate="2016-06-02T12:06:58" <br /> &gt;    xmp:MetadataDate="2016-06-03T07:34:05+02:00" <br /> &gt;    xmp:CreatorTool="Adobe Photoshop CS6 (Windows)" <br /> &gt;    aux:SerialNumber="073022001352" <br /> &gt;    aux:LensInfo="100/1 100/1 0/0 0/0" <br /> &gt;    aux:Lens="EF100mm f/2.8 Macro USM"</code></pre>


	<p>...</p>


	<p>Is there a switch to prevent this modification and copy metadata "as pure as possible" from file a to b?</p>


	<p>Kind regards,<br />Jochen</p>
</div>

</div>
<br />

<div id="replies">
<h3 class="comments icon icon-comments">Replies (6)</h3>
  <div class="message reply" id="message-2738">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2737?r=2738#message-2738">RE: xmp metadata modified when using »exiv2 insert -lcompr -S.tif none/*.tif«</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="19 Sep 2016 12:36" href="/projects/exiv2/activity?from=2016-09-19">about 5 years</a> ago
  </h4>
  <div class="wiki"><p>I think the answer is "Yes".  However we have to get to a common understanding of what you hope to achieve.</p>


	<p>New features have been added to the trunk (for the upcoming v0.26 release) to extract and insert XMP into images.  To extract raw XMP to stdout:<pre>$ exiv2 -pX foo.img </pre>To insert raw XMP (from the file foo.xmp)<pre>$ exiv2 -iXX foo.img</pre>You can pipe XMP from stdin:<pre>$ cat my_file.xmp | exiv2 -iXX- foo.img</pre></p>


	<p>And there are better file dump and analysis tools. The following command recursively dump structures from an image to help you understand what is being done.<pre> $ exiv2 -pR foo.img</pre></p>


	<p>Please take a look at those tools.  To make more progress with your request, please attach a sample image and a longer explanation of your thoughts.  When we are <em>"on the same page"</em>, I'm confident we'll find a way forward.</p></div>
  
  </div>
  <div class="message reply" id="message-2739">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2737?r=2739#message-2739">RE: xmp metadata modified when using »exiv2 insert -lcompr -S.tif none/*.tif«</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="19 Sep 2016 12:59" href="/projects/exiv2/activity?from=2016-09-19">about 5 years</a> ago
  </h4>
  <div class="wiki"><p>I omitted to say that if you are dealing with multi-page tiff files, our support for this is an open issue <a class="issue tracker-2 status-2 priority-4 priority-default" title="Feature: Multi-page tiff image support (Assigned)" href="/issues/1124">#1124</a>.  It's on the list of features being considered for v0.27.  <a class="external" href="http://dev.exiv2.org/news/3">http://dev.exiv2.org/news/3</a></p>


	<p>I had some success in using libtiff to split multi-page tiff files into single pages, modify pages, and reassemble the multi-page document with libtiff's tiffcp command.  This is described in <a class="issue tracker-2 status-2 priority-4 priority-default" title="Feature: Multi-page tiff image support (Assigned)" href="/issues/1124">#1124</a> and has been occasionally discussed in the forum.  Searching for tiffcp will reveal those conversions.</p></div>
  
  </div>
  <div class="message reply" id="message-2740">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2737?r=2740#message-2740">RE: xmp metadata modified when using »exiv2 insert -lcompr -S.tif none/*.tif«</a>
    -
    Added by <a class="user active" href="/users/4759">Jochen Barth</a> <a title="19 Sep 2016 15:28" href="/projects/exiv2/activity?from=2016-09-19">about 5 years</a> ago
  </h4>
  <div class="wiki"><p>No, the image is not multi-tiff; it is 2-tiff-directories/1-image-data;</p>


	<p>here is the file for download:</p>


	<p><a class="external" href="http://digi.ub.uni-heidelberg.de/diglitData/v/00007.tif">http://digi.ub.uni-heidelberg.de/diglitData/v/00007.tif</a></p>


	<p>Kind regards,<br />Jochen</p></div>
  
  </div>
  <div class="message reply" id="message-2741">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2737?r=2741#message-2741">RE: xmp metadata modified when using »exiv2 insert -lcompr -S.tif none/*.tif«</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="19 Sep 2016 17:22" href="/projects/exiv2/activity?from=2016-09-19">about 5 years</a> ago
  </h4>
  <div class="wiki"><p>Thank You for providing a test file and clarifying that we are discussing a single page tiff.</p>


	<p>What issue are we trying to solve here?</p>


	<p>Exiv2 normally builds an internal representation of the metadata in memory.  The v0.26 options: <em><strong><code>-pX</code></strong></em>  and <em><strong><code>-iXX</code></strong></em> literally copy the metadata from the image.  The command: <em><strong><code>$ exiv2 -ex /path/to/0007.tif</code></strong></em> reads your image into memory and serialises that data into the sidecar <em><strong><code>/path/to/0007.xmp</code></strong></em>.  The command: <em><strong><code>$ exiv2 -pX ..... 0007.tif</code></strong></em> copies the XMP from the image to standard output (without deserializing/serializing the XMP).   The command: <em><strong><code>$ exiv2 -iXX- /path/to/0007.tif</code></strong></em> copies the XMP from standard input and directly updates the image /path/to/0007.tif.</p>


	<p>So, I think way to move the XMP with minimum processing (and therefore maximum fidelity) is to use the <em><strong><code>-pX/iXX</code></strong></em> options to extract the XMP from one image and place it in another.</p>


	<p>Here's what I see.  I can dump the structure of the TIFF file, extract and rewrite the XMP.<pre>607 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pR http://digi.ub.uni-heidelberg.de/diglitData/v/00007.tif | head -10 ; echo '...' ; 
STRUCTURE OF TIFF FILE (II): http://digi.ub.uni-heidelberg.de/diglitData/v/00007.tif
 address |    tag                           |      type |    count |    offset | value
      10 | 0x00fe NewSubfileType            |      LONG |        1 |         0 | 0
      22 | 0x0100 ImageWidth                |     SHORT |        1 |      3442 | 3442
      34 | 0x0101 ImageLength               |     SHORT |        1 |      6017 | 6017
      46 | 0x0102 BitsPerSample             |     SHORT |        3 |       314 | 8 8 8
      58 | 0x0103 Compression               |     SHORT |        1 |         5 | 5
      70 | 0x0106 PhotometricInterpretation |     SHORT |        1 |         2 | 2
      82 | 0x010f Make                      |     ASCII |        6 |       320 | Canon
      94 | 0x0110 Model                     |     ASCII |       14 |       326 | Canon EOS 5DS
...
608 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pR http://digi.ub.uni-heidelberg.de/diglitData/v/00007.tif | tail -10
  25788414 | 0xa402 ExposureMode              |     SHORT |        1 |         1 | 1
  25788426 | 0xa403 WhiteBalance              |     SHORT |        1 |         1 | 1
  25788438 | 0xa406 SceneCaptureType          |     SHORT |        1 |         0 | 0
  25788450 | 0xa431 BodySerialNumber          |     ASCII |       13 |  25788614 | 073022001352
  25788462 | 0xa432 LensSpecification         |  RATIONAL |        4 |  25788627 | 100/0 1/0 100/0 1/0
  25788474 | 0xa434 LensModel                 |     ASCII |       24 |  25788659 | EF100mm f/2.8 Macro USM
  25788486 | 0xa435 LensSerialNumber          |     ASCII |       11 |  25788683 | 0000000000
  END http://digi.ub.uni-heidelberg.de/diglitData/v/00007.tif
     298 | 0x8773 InterColorProfile         | UNDEFINED |      560 |     28040 | ...0ADBE....mntrRGB XYZ ....... ...
END http://digi.ub.uni-heidelberg.de/diglitData/v/00007.tif
609 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pX http://digi.ub.uni-heidelberg.de/diglitData/v/00007.tif | xmllint --pretty 1 - | wc 
    214     291   10576
610 rmills@rmillsmbp:~/gnu/exiv2/trunk $ curl --silent -O http://digi.ub.uni-heidelberg.de/diglitData/v/00007.tif
611 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pX test/data/Reagan.jpg  | exiv2 -iXX- 00007.tif 
612 rmills@rmillsmbp:~/gnu/exiv2/trunk $ exiv2 -pX 00007.tif  | xmllint --pretty 1 - | wc 
     69     264    6354
613 rmills@rmillsmbp:~/gnu/exiv2/trunk $ </pre></p></div>
  
  </div>
  <div class="message reply" id="message-2742">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2737?r=2742#message-2742">RE: xmp metadata modified when using »exiv2 insert -lcompr -S.tif none/*.tif«</a>
    -
    Added by <a class="user active" href="/users/4759">Jochen Barth</a> <a title="20 Sep 2016 09:50" href="/projects/exiv2/activity?from=2016-09-20">about 5 years</a> ago
  </h4>
  <div class="wiki"><p>Our partner wants non-compressed tiff files, but we have internally lzw compressed ones.<br />The metadata of the tiffs should not change (excluding compression info, of course) - but with imagemagick the secondary tiff directory is being lost.</p></div>
  
  </div>
  <div class="message reply" id="message-2743">
    <div class="contextual">
      
      
      
    </div>
  <h4>
    
    <a href="/boards/3/topics/2737?r=2743#message-2743">RE: xmp metadata modified when using »exiv2 insert -lcompr -S.tif none/*.tif«</a>
    -
    Added by <a class="user active" href="/users/119">Robin Mills</a> <a title="20 Sep 2016 10:53" href="/projects/exiv2/activity?from=2016-09-20">about 5 years</a> ago
  </h4>
  <div class="wiki"><p>I'm lost, Jochen.  I don't know anything about your partner, libtiff or imagemagick.  I'm trying to help you.  I'm guessing that you have some kind of image processing pipeline and you want Exiv2 to copy the metadata from the original images into the processed images.  Is that right?  Would it help to discuss this on an instant messenger such as Skype ('clanmills')?</p></div>
  
  </div>
</div>
<span class="pagination"><ul class="pages"></ul><span><span class="items">(1-6/6)</span> </span></span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
