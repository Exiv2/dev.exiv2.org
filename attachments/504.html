<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>exiv2_convert.patch - Exiv2</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="description" content="Redmine" />
<meta name="keywords" content="issue,bug,tracker" />
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="YCxdtghN7IupcQK1aIS0IC2wcjdTt/kQZZ95VWxRMj6CYfZZejcgi/wVHbnXU7gTEiImTqJUWKqYv+ndL2jVUQ==" />
<link rel='shortcut icon' href='/favicon.ico?1550767427' />
<link rel="stylesheet" media="all" href="/stylesheets/jquery/jquery-ui-1.11.0.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/application.css?1550767427" />
<link rel="stylesheet" media="all" href="/stylesheets/responsive.css?1550767427" />

<script src="/javascripts/jquery-1.11.1-ui-1.11.0-ujs-4.3.1.js?1550767427"></script>
<script src="/javascripts/application.js?1550767427"></script>
<script src="/javascripts/responsive.js?1550767427"></script>
<script>
//<![CDATA[
$(window).load(function(){ warnLeavingUnsaved('The current page contains unsaved text that will be lost if you leave this page.'); });
//]]>
</script>


<!-- page specific tags -->
    <link rel="stylesheet" media="screen" href="/stylesheets/scm.css?1550767427" /></head>
<body class="project-exiv2 has-main-menu controller-attachments action-show avatars-off">

<div id="wrapper">

<div class="flyout-menu js-flyout-menu">


        <div class="flyout-menu__search">
            <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
            
            <label class="search-magnifier search-magnifier--flyout" for="flyout-search">&#9906;</label>
            <input type="text" name="q" id="flyout-search" class="small js-search-input" placeholder="Search" />
</form>        </div>


        <h3>Project</h3>
        <span class="js-project-menu"></span>

    <h3>General</h3>
    <span class="js-general-menu"></span>

    <span class="js-sidebar flyout-menu__sidebar"></span>

    <h3>Profile</h3>
    <span class="js-profile-menu"></span>

</div>

<div id="wrapper2">
<div id="wrapper3">
<div id="top-menu">
    <div id="account">
        <ul><li><a class="login" href="/login">Sign in</a></li></ul>    </div>
    
    <ul><li><a class="home" href="/">Home</a></li><li><a class="projects" href="/projects">Projects</a></li><li><a class="help" href="https://www.redmine.org/guide">Help</a></li></ul></div>

<div id="header">

    <a href="#" class="mobile-toggle-button js-flyout-menu-toggle-button"></a>

    <div id="quick-search">
        <form action="/projects/exiv2/search" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
        <input type="hidden" name="scope" />
        
        <label for='q'>
          <a accesskey="4" href="/projects/exiv2/search">Search</a>:
        </label>
        <input type="text" name="q" id="q" size="20" class="small" accesskey="f" />
</form>        <div id="project-jump" class="drdn"><span class="drdn-trigger">Exiv2</span><div class="drdn-content"><div class="quick-search"><input type="text" name="q" id="projects-quick-search" value="" class="autocomplete" data-automcomplete-url="/projects/autocomplete.js?jump=issues" autocomplete="off" /></div><div class="drdn-items projects selection"></div><div class="drdn-items all-projects selection"><a href="/projects?jump=issues">All Projects</a></div></div></div>
    </div>

    <h1><span class="current-project">Exiv2</span></h1>

    <div id="main-menu" class="tabs">
        <ul><li><a class="overview" href="/projects/exiv2">Overview</a></li><li><a class="activity" href="/projects/exiv2/activity">Activity</a></li><li><a class="roadmap" href="/projects/exiv2/roadmap">Roadmap</a></li><li><a class="issues selected" href="/projects/exiv2/issues">Issues</a></li><li><a class="news" href="/projects/exiv2/news">News</a></li><li><a class="wiki" href="/projects/exiv2/wiki">Wiki</a></li><li><a class="boards" href="/projects/exiv2/boards">Forums</a></li><li><a class="repository" href="/projects/exiv2/repository">Repository</a></li></ul>
        <div class="tabs-buttons" style="display:none;">
            <button class="tab-left" onclick="moveTabLeft(this); return false;"></button>
            <button class="tab-right" onclick="moveTabRight(this); return false;"></button>
        </div>
    </div>
</div>

<div id="main" class="nosidebar">
    <div id="sidebar">
        
        
    </div>

    <div id="content">
        
        <div class="contextual">
  <a class="icon icon-download" href="/attachments/download/504/exiv2_convert.patch">Download (6.71 KB)</a></div>

<h2>
  <a class="issue tracker-2 status-5 priority-4 priority-default closed" title="Make dependency to iconv optional" href="/issues/902">Feature #902</a> Â» exiv2_convert.patch
</h2>

<div class="attachments">
<p>Proposition patch to use internal charset encoding - 
   <span class="author"><a class="user active" href="/users/3832">Eric TRINH</a>, 20 May 2013 01:51</span></p>
</div>
<div class="filecontent-container">
  
  <form action="/attachments/504" accept-charset="UTF-8" method="get"><input name="utf8" type="hidden" value="&#x2713;" />
    <p>
      View differences:
      <label><input type="radio" name="type" id="type_inline" value="inline" onchange="this.form.submit()" checked="checked" /> inline</label>
      <label><input type="radio" name="type" id="type_sbs" value="sbs" onchange="this.form.submit()" /> side by side</label>
    </p>
</form>  
<div class="autoscroll">
<table class="filecontent">
<thead>
  <tr>
    <th colspan="3" class="filename">
      exiv2/src/convert.cpp	2013-05-20 07:35:27 +0000
    </th>
  </tr>
</thead>
<tbody>
<tr>
  <th class="line-num">70</th>
  <th class="line-num">70</th>
  <td class="line-code ">
    <pre>// *****************************************************************************</pre>
  </td>
</tr>
<tr>
  <th class="line-num">71</th>
  <th class="line-num">71</th>
  <td class="line-code ">
    <pre>// local declarations</pre>
  </td>
</tr>
<tr>
  <th class="line-num">72</th>
  <th class="line-num">72</th>
  <td class="line-code ">
    <pre>namespace {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">73</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>#if defined WIN32 &amp;&amp; !defined __CYGWIN__</pre>
  </td>
</tr>
<tr>
  <th class="line-num">74</th>
  <th class="line-num">73</th>
  <td class="line-code ">
    <pre>    // Convert string charset with Windows functions.</pre>
  </td>
</tr>
<tr>
  <th class="line-num">75</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    bool convertStringCharsetWindows(std::string&amp; str, const char* from, const char* to);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">76</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>#endif</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">74</th>
  <td class="line-code diff_in">
    <pre>    bool convertStringCharsetUni(std::string&amp; str, const char* from, const char* to);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">77</th>
  <th class="line-num">75</th>
  <td class="line-code ">
    <pre>#if defined EXV_HAVE_ICONV</pre>
  </td>
</tr>
<tr>
  <th class="line-num">78</th>
  <th class="line-num">76</th>
  <td class="line-code ">
    <pre>    // Convert string charset with iconv.</pre>
  </td>
</tr>
<tr>
  <th class="line-num">79</th>
  <th class="line-num">77</th>
  <td class="line-code ">
    <pre>    bool convertStringCharsetIconv(std::string&amp; str, const char* from, const char* to);</pre>
  </td>
</tr>
<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">1334</th>
  <th class="line-num">1332</th>
  <td class="line-code ">
    <pre>        bool ret = false;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1335</th>
  <th class="line-num">1333</th>
  <td class="line-code ">
    <pre>#if defined EXV_HAVE_ICONV</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1336</th>
  <th class="line-num">1334</th>
  <td class="line-code ">
    <pre>        ret = convertStringCharsetIconv(str, from, to);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1337</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>#elif defined WIN32 &amp;&amp; !defined __CYGWIN__</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1338</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        ret = convertStringCharsetWindows(str, from, to);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1339</th>
  <th class="line-num">1335</th>
  <td class="line-code ">
    <pre>#else</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1340</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre># ifndef SUPPRESS_WARNINGS</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1341</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        EXV_WARNING &lt;&lt; &quot;Charset conversion required but no character mapping functionality available.\n&quot;;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1342</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre># endif</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1336</th>
  <td class="line-code diff_in">
    <pre>        ret = convertStringCharsetUni(str, from, to);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1343</th>
  <th class="line-num">1337</th>
  <td class="line-code ">
    <pre>#endif</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1344</th>
  <th class="line-num">1338</th>
  <td class="line-code ">
    <pre>        return ret;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1345</th>
  <th class="line-num">1339</th>
  <td class="line-code ">
    <pre>    }</pre>
  </td>
</tr>
<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">1350</th>
  <th class="line-num">1344</th>
  <td class="line-code ">
    <pre>namespace {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1351</th>
  <th class="line-num">1345</th>
  <td class="line-code ">
    <pre></pre>
  </td>
</tr>
<tr>
  <th class="line-num">1352</th>
  <th class="line-num">1346</th>
  <td class="line-code ">
    <pre>    using namespace Exiv2;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1353</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre></pre>
  </td>
</tr>
<tr>
  <th class="line-num">1354</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>#if defined WIN32 &amp;&amp; !defined __CYGWIN__</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1347</th>
  <td class="line-code diff_in">
    <pre>	</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1355</th>
  <th class="line-num">1348</th>
  <td class="line-code ">
    <pre>    bool swapBytes(std::string&amp; str)</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1356</th>
  <th class="line-num">1349</th>
  <td class="line-code ">
    <pre>    {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1357</th>
  <th class="line-num">1350</th>
  <td class="line-code ">
    <pre>        // Naive byte-swapping, I&#39;m sure this can be done more efficiently</pre>
  </td>
</tr>
<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">1369</th>
  <th class="line-num">1362</th>
  <td class="line-code ">
    <pre>        return true;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1370</th>
  <th class="line-num">1363</th>
  <td class="line-code ">
    <pre>    }</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1371</th>
  <th class="line-num">1364</th>
  <td class="line-code ">
    <pre></pre>
  </td>
</tr>
<tr>
  <th class="line-num">1372</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    bool mb2wc(UINT cp, std::string&amp; str)</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1373</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1374</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        if (str.empty()) return true;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1375</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        int len = MultiByteToWideChar(cp, 0, str.c_str(), (int)str.size(), 0, 0);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1376</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        if (len == 0) {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1377</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>#ifdef DEBUG</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1378</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            EXV_DEBUG &lt;&lt; &quot;mb2wc: Failed to determine required size of output buffer.\n&quot;;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1379</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>#endif</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1380</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            return false;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1381</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        }</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1382</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        std::vector&lt;std::string::value_type&gt; out;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1383</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        out.resize(len * 2);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1384</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        int ret = MultiByteToWideChar(cp, 0, str.c_str(), (int)str.size(), (LPWSTR)&amp;out[0], len * 2);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1385</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        if (ret == 0) {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1386</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>#ifdef DEBUG</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1387</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            EXV_DEBUG &lt;&lt; &quot;mb2wc: Failed to convert the input string to a wide character string.\n&quot;;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1388</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>#endif</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1389</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            return false;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1390</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        }</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1391</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        str.assign(out.begin(), out.end());</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1392</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        return true;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1393</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    }</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1394</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre></pre>
  </td>
</tr>
<tr>
  <th class="line-num">1395</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    bool wc2mb(UINT cp, std::string&amp; str)</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1365</th>
  <td class="line-code diff_in">
    <pre>    bool utf8ToUcs2le(std::string&amp; str)</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1396</th>
  <th class="line-num">1366</th>
  <td class="line-code ">
    <pre>    {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1397</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        if (str.empty()) return true;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1398</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        if (str.size() &amp; 1) {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1399</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>#ifdef DEBUG</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1400</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            EXV_DEBUG &lt;&lt; &quot;wc2mb: Size &quot; &lt;&lt; str.size() &lt;&lt; &quot; of input string is not even.\n&quot;;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1401</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>#endif</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1402</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            return false;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1403</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        }</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1404</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        int len = WideCharToMultiByte(cp, 0, (LPCWSTR)str.data(), (int)str.size() / 2, 0, 0, 0, 0);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1405</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        if (len == 0) {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1406</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>#ifdef DEBUG</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1407</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            EXV_DEBUG &lt;&lt; &quot;wc2mb: Failed to determine required size of output buffer.\n&quot;;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1408</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>#endif</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1409</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            return false;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1410</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        }</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1411</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        std::vector&lt;std::string::value_type&gt; out;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1412</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        out.resize(len);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1413</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        int ret = WideCharToMultiByte(cp, 0, (LPCWSTR)str.data(), (int)str.size() / 2, (LPSTR)&amp;out[0], len, 0, 0);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1414</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        if (ret == 0) {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1415</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>#ifdef DEBUG</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1416</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            EXV_DEBUG &lt;&lt; &quot;wc2mb: Failed to convert the input string to a multi byte string.\n&quot;;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1417</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>#endif</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1418</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            return false;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1419</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        }</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1420</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        str.assign(out.begin(), out.end());</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1421</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        return true;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1367</th>
  <td class="line-code diff_in">
    <pre>		try {</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1368</th>
  <td class="line-code diff_in">
    <pre>			std::string _str;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1369</th>
  <td class="line-code diff_in">
    <pre>			for (unsigned int i = 0; i &lt; str.size();) {	</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1370</th>
  <td class="line-code diff_in">
    <pre>				int val = 0;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1371</th>
  <td class="line-code diff_in">
    <pre>				if ((unsigned char)str[i] &lt; 0x80) val = str[i], ++i;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1372</th>
  <td class="line-code diff_in">
    <pre>				else if ((str[i] &amp; 0xE0) == 0xE0) {</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1373</th>
  <td class="line-code diff_in">
    <pre>					if (str.at(i + 1) == 0 || str.at(i + 2) == 0) return false;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1374</th>
  <td class="line-code diff_in">
    <pre>					i += 3;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1375</th>
  <td class="line-code diff_in">
    <pre>					val = (str.at(i) &amp; 0x0F)&lt;&lt;12 | (str.at(i + 1) &amp; 0x3F)&lt;&lt;6  | (str.at(i + 2) &amp; 0x3F);</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1376</th>
  <td class="line-code diff_in">
    <pre>				}</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1377</th>
  <td class="line-code diff_in">
    <pre>				else if ((str[i] &amp; 0xC0) == 0xC0) {</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1378</th>
  <td class="line-code diff_in">
    <pre>					if (str.at(i + 1) == 0) return false;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1379</th>
  <td class="line-code diff_in">
    <pre>					i += 2;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1380</th>
  <td class="line-code diff_in">
    <pre>					val = (str.at(i) &amp; 0x1F)&lt;&lt;6 | (str.at(i + 1) &amp; 0x3F);</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1381</th>
  <td class="line-code diff_in">
    <pre>				}</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1382</th>
  <td class="line-code diff_in">
    <pre>				_str += (unsigned char)(val &amp; 0xff), _str += (unsigned char)(val &gt;&gt; 8);				</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1383</th>
  <td class="line-code diff_in">
    <pre>			}</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1384</th>
  <td class="line-code diff_in">
    <pre>			str = _str;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1385</th>
  <td class="line-code diff_in">
    <pre>		}</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1386</th>
  <td class="line-code diff_in">
    <pre>		catch (...) {</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1387</th>
  <td class="line-code diff_in">
    <pre>			return false;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1388</th>
  <td class="line-code diff_in">
    <pre>		}</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1389</th>
  <td class="line-code diff_in">
    <pre>		return true;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1390</th>
  <td class="line-code diff_in">
    <pre>    }</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1391</th>
  <td class="line-code diff_in">
    <pre></pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1392</th>
  <td class="line-code diff_in">
    <pre>	bool ucs2leToUtf8(std::string&amp; str)</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1393</th>
  <td class="line-code diff_in">
    <pre>    {</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1394</th>
  <td class="line-code diff_in">
    <pre>		std::string _str;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1395</th>
  <td class="line-code diff_in">
    <pre>		for (unsigned int i = 0; i &lt; str.size(); i += 2) {</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1396</th>
  <td class="line-code diff_in">
    <pre>			unsigned short c = (unsigned char)str[i] + (((unsigned short)str[i + 1]) &lt;&lt; 8);</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1397</th>
  <td class="line-code diff_in">
    <pre>			if (c&lt;0x80) _str+=c;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1398</th>
  <td class="line-code diff_in">
    <pre>			else if (c&lt;0x800) _str+=192+c/64, _str+=128+c%64;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1399</th>
  <td class="line-code diff_in">
    <pre>			else if (c-0xd800u&lt;0x800) return false;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1400</th>
  <td class="line-code diff_in">
    <pre>			else _str+=224+c/4096, _str+=128+c/64%64, _str+=128+c%64;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1401</th>
  <td class="line-code diff_in">
    <pre>		}</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1402</th>
  <td class="line-code diff_in">
    <pre>		str = _str;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1403</th>
  <td class="line-code diff_in">
    <pre>		return true;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1422</th>
  <th class="line-num">1404</th>
  <td class="line-code ">
    <pre>    }</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1423</th>
  <th class="line-num">1405</th>
  <td class="line-code ">
    <pre></pre>
  </td>
</tr>
<tr>
  <th class="line-num">1424</th>
  <th class="line-num">1406</th>
  <td class="line-code ">
    <pre>    bool utf8ToUcs2be(std::string&amp; str)</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1425</th>
  <th class="line-num">1407</th>
  <td class="line-code ">
    <pre>    {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1426</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        bool ret = <span>mb2wc(CP_UTF8, </span>str);</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1408</th>
  <td class="line-code diff_in">
    <pre>        bool ret = <span>utf8ToUcs2le(</span>str);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1427</th>
  <th class="line-num">1409</th>
  <td class="line-code ">
    <pre>        if (ret) ret = swapBytes(str);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1428</th>
  <th class="line-num">1410</th>
  <td class="line-code ">
    <pre>        return ret;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1429</th>
  <th class="line-num">1411</th>
  <td class="line-code ">
    <pre>    }</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1430</th>
  <th class="line-num">1412</th>
  <td class="line-code ">
    <pre></pre>
  </td>
</tr>
<tr>
  <th class="line-num">1431</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    bool utf8ToUcs2le(std::string&amp; str)</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1432</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1433</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        return mb2wc(CP_UTF8, str);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1434</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    }</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1435</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre></pre>
  </td>
</tr>
<tr>
  <th class="line-num">1436</th>
  <th class="line-num">1413</th>
  <td class="line-code ">
    <pre>    bool ucs2beToUtf8(std::string&amp; str)</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1437</th>
  <th class="line-num">1414</th>
  <td class="line-code ">
    <pre>    {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1438</th>
  <th class="line-num">1415</th>
  <td class="line-code ">
    <pre>        bool ret = swapBytes(str);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1439</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        if (ret) ret = <span>wc2mb(CP_UTF8, </span>str);</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1416</th>
  <td class="line-code diff_in">
    <pre>        if (ret) ret = <span>ucs2leToUtf8(</span>str);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1440</th>
  <th class="line-num">1417</th>
  <td class="line-code ">
    <pre>        return ret;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1441</th>
  <th class="line-num">1418</th>
  <td class="line-code ">
    <pre>    }</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1442</th>
  <th class="line-num">1419</th>
  <td class="line-code ">
    <pre></pre>
  </td>
</tr>
<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">1445</th>
  <th class="line-num">1422</th>
  <td class="line-code ">
    <pre>        return swapBytes(str);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1446</th>
  <th class="line-num">1423</th>
  <td class="line-code ">
    <pre>    }</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1447</th>
  <th class="line-num">1424</th>
  <td class="line-code ">
    <pre></pre>
  </td>
</tr>
<tr>
  <th class="line-num">1448</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    bool ucs2leToUtf8(std::string&amp; str)</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1449</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1450</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        return wc2mb(CP_UTF8, str);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1451</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    }</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1452</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre></pre>
  </td>
</tr>
<tr>
  <th class="line-num">1453</th>
  <th class="line-num">1425</th>
  <td class="line-code ">
    <pre>    bool ucs2leToUcs2be(std::string&amp; str)</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1454</th>
  <th class="line-num">1426</th>
  <td class="line-code ">
    <pre>    {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1455</th>
  <th class="line-num">1427</th>
  <td class="line-code ">
    <pre>        return swapBytes(str);</pre>
  </td>
</tr>
<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">1457</th>
  <th class="line-num">1429</th>
  <td class="line-code ">
    <pre></pre>
  </td>
</tr>
<tr>
  <th class="line-num">1458</th>
  <th class="line-num">1430</th>
  <td class="line-code ">
    <pre>    bool iso88591ToUtf8(std::string&amp; str)</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1459</th>
  <th class="line-num">1431</th>
  <td class="line-code ">
    <pre>    {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1460</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        bool ret = mb2wc(28591, str);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1461</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        if (ret) ret = wc2mb(CP_UTF8, str);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1462</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>        return ret;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1432</th>
  <td class="line-code diff_in">
    <pre>		std::string mcstr;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1433</th>
  <td class="line-code diff_in">
    <pre>		mcstr.reserve(str.size() * 2);</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1434</th>
  <td class="line-code diff_in">
    <pre>        for (unsigned int i = 0; i &lt; str.size(); ++i) {</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1435</th>
  <td class="line-code diff_in">
    <pre>			mcstr += str[i];</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1436</th>
  <td class="line-code diff_in">
    <pre>			mcstr += &#39;\0&#39;;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1437</th>
  <td class="line-code diff_in">
    <pre>        }</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1438</th>
  <td class="line-code diff_in">
    <pre>		str = mcstr;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1439</th>
  <td class="line-code diff_in">
    <pre>        return ucs2leToUtf8(str);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1463</th>
  <th class="line-num">1440</th>
  <td class="line-code ">
    <pre>    }</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1464</th>
  <th class="line-num">1441</th>
  <td class="line-code ">
    <pre></pre>
  </td>
</tr>
<tr>
  <th class="line-num">1465</th>
  <th class="line-num">1442</th>
  <td class="line-code ">
    <pre>    bool asciiToUtf8(std::string&amp; /*str*/)</pre>
  </td>
</tr>
<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">1490</th>
  <th class="line-num">1467</th>
  <td class="line-code ">
    <pre>        // Update the convertStringCharset() documentation if you add more here!</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1491</th>
  <th class="line-num">1468</th>
  <td class="line-code ">
    <pre>    };</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1492</th>
  <th class="line-num">1469</th>
  <td class="line-code ">
    <pre></pre>
  </td>
</tr>
<tr>
  <th class="line-num">1493</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>    bool convertStringCharset<span>Windows</span>(std::string&amp; str, const char* from, const char* to)</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1470</th>
  <td class="line-code diff_in">
    <pre>    bool convertStringCharset<span>Uni</span>(std::string&amp; str, const char* from, const char* to)</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1494</th>
  <th class="line-num">1471</th>
  <td class="line-code ">
    <pre>    {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1495</th>
  <th class="line-num">1472</th>
  <td class="line-code ">
    <pre>        bool ret = false;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1496</th>
  <th class="line-num">1473</th>
  <td class="line-code ">
    <pre>        const ConvFctList* p = find(convFctList, std::make_pair(from, to));</pre>
  </td>
</tr>
<tr class="spacing">
  <th class="line-num">...</th><th class="line-num">...</th><td></td>
</tr>
<tr>
  <th class="line-num">1498</th>
  <th class="line-num">1475</th>
  <td class="line-code ">
    <pre>        if (p) ret = p-&gt;convFct_(tmpstr);</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1499</th>
  <th class="line-num">1476</th>
  <td class="line-code ">
    <pre>#ifndef SUPPRESS_WARNINGS</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1500</th>
  <th class="line-num">1477</th>
  <td class="line-code ">
    <pre>        else {</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1501</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>            EXV_WARNING &lt;&lt; &quot;No <span>Windows </span>function to map character string from &quot; &lt;&lt; from &lt;&lt; &quot; to &quot; &lt;&lt; to &lt;&lt; &quot; available.\n&quot;;</pre>
  </td>
</tr>
<tr>
  <th class="line-num"></th>
  <th class="line-num">1478</th>
  <td class="line-code diff_in">
    <pre>            EXV_WARNING &lt;&lt; &quot;No <span></span>function to map character string from &quot; &lt;&lt; from &lt;&lt; &quot; to &quot; &lt;&lt; to &lt;&lt; &quot; available.\n&quot;;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1502</th>
  <th class="line-num">1479</th>
  <td class="line-code ">
    <pre>        }</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1503</th>
  <th class="line-num">1480</th>
  <td class="line-code ">
    <pre>#endif</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1504</th>
  <th class="line-num">1481</th>
  <td class="line-code ">
    <pre>        if (ret) str = tmpstr;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1505</th>
  <th class="line-num">1482</th>
  <td class="line-code ">
    <pre>        return ret;</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1506</th>
  <th class="line-num">1483</th>
  <td class="line-code ">
    <pre>    }</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1507</th>
  <th class="line-num">1484</th>
  <td class="line-code ">
    <pre></pre>
  </td>
</tr>
<tr>
  <th class="line-num">1508</th>
  <th class="line-num"></th>
  <td class="line-code diff_out">
    <pre>#endif // defined WIN32 &amp;&amp; !defined __CYGWIN__</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1509</th>
  <th class="line-num">1485</th>
  <td class="line-code ">
    <pre>#if defined EXV_HAVE_ICONV</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1510</th>
  <th class="line-num">1486</th>
  <td class="line-code ">
    <pre>    bool convertStringCharsetIconv(std::string&amp; str, const char* from, const char* to)</pre>
  </td>
</tr>
<tr>
  <th class="line-num">1511</th>
  <th class="line-num">1487</th>
  <td class="line-code ">
    <pre>    {</pre>
  </td>
</tr>
</tbody>
</table>
</div>




</div>

<span class="pagination filepreview">
  <ul class="pages"></ul><span><span class="items">(1-1/1)</span> </span>
</span>



        
        <div style="clear:both;"></div>
    </div>
</div>
</div>

<div id="ajax-indicator" style="display:none;"><span>Loading...</span></div>
<div id="ajax-modal" style="display:none;"></div>

<div id="footer">
  <div class="bgl"><div class="bgr">
    Powered by <a href="https://www.redmine.org/">Redmine</a> &copy; 2006-2018 Jean-Philippe Lang
  </div></div>
</div>
</div>
</div>

</body>
</html>
